import"./engine.js";const Il=(a,e=1)=>Array.from({length:Math.ceil(a.length/e)},(t,s)=>a.slice(s*e,s*e+e)),Cl=(a,e)=>a.filter(t=>!e.includes(t)),Rl=a=>{for(let e=a.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[a[e],a[t]]=[a[t],a[e]]}},_l=(a,e,t)=>t.indexOf(a)===e&&a!==null&&a!==void 0,vl=a=>a.filter(_l),wl={chunk:Il,difference:Cl,shuffle:Rl,unique:vl};var Ll={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0},bl=Array.prototype.slice;function Vs(a){var e=a.length;return e?e===1?[a[0]]:e===2?[a[0],a[1]]:e===3?[a[0],a[1],a[2]]:bl.call(a,0):[]}function Pl(a){var e={};for(var t in a)Ll[t]||(e[t]=a[t]);return e}function Ol(a){return typeof a=="function"&&a.isMemoized}function Dl(a,e){return a===e||a!==a&&e!==e}function Kn(a,e){var t={};for(var s in a)t[s]=a[s];for(var s in e)t[s]=e[s];return t}var Nl=function(){function a(e){this.keys=[],this.values=[],this.options=e;var t=typeof e.isMatchingKey=="function";t?this.getKeyIndex=this._getKeyIndexFromMatchingKey:e.maxSize>1?this.getKeyIndex=this._getKeyIndexForMany:this.getKeyIndex=this._getKeyIndexForSingle,this.canTransformKey=typeof e.transformKey=="function",this.shouldCloneArguments=this.canTransformKey||t,this.shouldUpdateOnAdd=typeof e.onCacheAdd=="function",this.shouldUpdateOnChange=typeof e.onCacheChange=="function",this.shouldUpdateOnHit=typeof e.onCacheHit=="function"}return Object.defineProperty(a.prototype,"size",{get:function(){return this.keys.length},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"snapshot",{get:function(){return{keys:Vs(this.keys),size:this.size,values:Vs(this.values)}},enumerable:!1,configurable:!0}),a.prototype._getKeyIndexFromMatchingKey=function(e){var t=this.options,s=t.isMatchingKey,i=t.maxSize,n=this.keys,r=n.length;if(!r)return-1;if(s(n[0],e))return 0;if(i>1){for(var c=1;c<r;c++)if(s(n[c],e))return c}return-1},a.prototype._getKeyIndexForMany=function(e){var t=this.options.isEqual,s=this.keys,i=s.length;if(!i)return-1;if(i===1)return this._getKeyIndexForSingle(e);var n=e.length,r,c;if(n>1){for(var o=0;o<i;o++)if(r=s[o],r.length===n){for(c=0;c<n&&t(r[c],e[c]);c++);if(c===n)return o}}else for(var o=0;o<i;o++)if(r=s[o],r.length===n&&t(r[0],e[0]))return o;return-1},a.prototype._getKeyIndexForSingle=function(e){var t=this.keys;if(!t.length)return-1;var s=t[0],i=s.length;if(e.length!==i)return-1;var n=this.options.isEqual;if(i>1){for(var r=0;r<i;r++)if(!n(s[r],e[r]))return-1;return 0}return n(s[0],e[0])?0:-1},a.prototype.orderByLru=function(e,t,s){for(var i=this.keys,n=this.values,r=i.length,c=s;c--;)i[c+1]=i[c],n[c+1]=n[c];i[0]=e,n[0]=t;var o=this.options.maxSize;r===o&&s===r?(i.pop(),n.pop()):s>=o&&(i.length=n.length=o)},a.prototype.updateAsyncCache=function(e){var t=this,s=this.options,i=s.onCacheChange,n=s.onCacheHit,r=this.keys[0],c=this.values[0];this.values[0]=c.then(function(o){return t.shouldUpdateOnHit&&n(t,t.options,e),t.shouldUpdateOnChange&&i(t,t.options,e),o},function(o){var l=t.getKeyIndex(r);throw l!==-1&&(t.keys.splice(l,1),t.values.splice(l,1)),o})},a}();function ys(a,e){if(e===void 0&&(e={}),Ol(a))return ys(a.fn,Kn(a.options,e));if(typeof a!="function")throw new TypeError("You must pass a function to `memoize`.");var t=e.isEqual,s=t===void 0?Dl:t,i=e.isMatchingKey,n=e.isPromise,r=n===void 0?!1:n,c=e.maxSize,o=c===void 0?1:c,l=e.onCacheAdd,h=e.onCacheChange,d=e.onCacheHit,u=e.transformKey,p=Kn({isEqual:s,isMatchingKey:i,isPromise:r,maxSize:o,onCacheAdd:l,onCacheChange:h,onCacheHit:d,transformKey:u},Pl(e)),g=new Nl(p),f=g.keys,m=g.values,E=g.canTransformKey,A=g.shouldCloneArguments,S=g.shouldUpdateOnAdd,I=g.shouldUpdateOnChange,T=g.shouldUpdateOnHit,R=function(){var b=A?Vs(arguments):arguments;E&&(b=u(b));var w=f.length?g.getKeyIndex(b):-1;if(w!==-1)T&&d(g,p,R),w&&(g.orderByLru(f[w],m[w],w),I&&h(g,p,R));else{var C=a.apply(this,arguments),v=A?b:Vs(arguments);g.orderByLru(v,C,f.length),r&&g.updateAsyncCache(R),S&&l(g,p,R),I&&h(g,p,R)}return m[0]};return R.cache=g,R.fn=a,R.isMemoized=!0,R.options=p,R}const Ml=ys((a,e)=>{if(typeof a=="string"){const t=e[a.toLowerCase()];if(typeof t=="string")return t}return"?"}),kl=ys(a=>{let e=null;const t=[],s=/:([A-Z0-9?]+)/gm;for(;(e=s.exec(a))!==null;)t.push(e[1]);return t}),Ul=ys(a=>{let e=null;const t=[],s=/([0-9]+[A-Z?]{1}|[A-Z?]{1})/gm;for(;(e=s.exec(a))!==null;){const i=e[0];if(i.length>=2){const{length:n}=i,r=i.slice(0,n-1),c=i[n-1],o=new Array(+r).fill(c);t.push(...o);continue}t.push(i)}return t}),xl=(a,e)=>{const t=a,s=GameCore.Utils.Object.invert(e),i={};let n=0,r=0;return kl(t).forEach(o=>{n=0,r++,i[r]||(i[r]={}),Ul(o).forEach(h=>{n++,i[r][n]=Ml(h,s)})}),i},Bl=ys((a,e)=>{const t=e[a];return typeof t=="string"?`${t.toUpperCase()}`:"?"}),lo=(a,e,t=!1)=>{let s="";if(!GameCore.Utils.Valid.isObject(a))return s;let i="",n=1;for(const r in a){if(!GameCore.Utils.Object.hasOwn(a,r))continue;const c=a[r];if(GameCore.Utils.Valid.isObject(c)){s+=`:${lo(c,e,!0)}`;continue}if(!GameCore.Utils.Valid.isString(c))continue;const o=Bl(c,e);o===i?(n++,s=s.slice(0,-2)):n=1,s+=`${n}${o}`,i=o}return s=s.replace(/1([A-Z])/g,"$1"),s},Fl=a=>{try{return atob(a)}catch{return""}},Gl=a=>{try{return btoa(a)}catch{return""}},Hl={decodeMap:xl,encodeMap:lo,hashToString:Fl,stringToHash:Gl},Yl=(a,e)=>{const t=document.createElement("style"),s=Object.keys(e).map(i=>Kl(i,e[i])).join(";");return t.innerHTML=`${a} { ${s} }`,document.head.appendChild(t),t},Kl=(a,e)=>`${GameCore.Utils.String.toKebabCase(a)}: ${e}`,Vl={dynamicCSS:Yl},ho=a=>{try{return JSON.parse(a)}catch{return null}},uo=a=>{try{return JSON.stringify(a,null,0)}catch{return""}},Wl=a=>ho(uo(a)),jl={clone:Wl,decode:ho,encode:uo},qi=a=>{const e=typeof a=="object"||typeof a=="function",t=Array.isArray(a);return a!==null&&e&&!t},$l=a=>a==null,po=a=>{if(!qi(a))return a;for(const e in a){$l(a[e])&&delete a[e];const t=a[e];qi(t)&&(a[e]=po(t))}return a},dn=(a,e)=>Object.prototype.hasOwnProperty.call(a,e),zl=a=>{const e={};return Object.keys(a).forEach(t=>{if(!dn(a,t))return;const s=a[t];typeof s=="string"&&(e[s]=t)}),e},Xl=(a,e)=>{if(!Array.isArray(a))return{};const t={};return a.forEach(s=>{if(!dn(s,e))return;const i=s[e];typeof i=="string"&&(t[i]=s)}),t},ql={clear:po,hasOwn:dn,invert:zl,keyBy:Xl},Zl=a=>a&&a[0].toUpperCase()+a.slice(1),Ql=a=>{let e=0;if(a.length==0)return e;for(let t=0;t<a.length;t++){const s=a.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return e},Jl=a=>Object.keys(a).reduce((t,s)=>{const i=a[s];return i!==void 0&&t.push(`${s}=${i}`),t},[]).join("&"),eh="0123456789ABCDEF",th=(a="0x")=>{let e=a;for(let t=0;t<6;t++)e+=eh[Math.floor(Math.random()*16)];return e},sh=a=>a.replace(/^([a-z])|\s+([a-z])/g,(e,t)=>t?t.toUpperCase():e.toUpperCase()).replace(/\s+/g,""),ih=a=>a.replace(/^([a-z])|\s+([a-z])/g,(e,t)=>t?t.toUpperCase():e.toLowerCase()).replace(/\s+/g,""),nh=a=>a.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase(),ah=(a,e)=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*#%&!";let s="",i=a;e!=null&&(i-=e.length,s+=e);for(let n=0;n<i;n++){const r=Math.floor(Math.random()*t.length);s+=t.charAt(r)}return s},rh=a=>a.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,t=>t==="đ"?"d":"D"),oh=(a,e)=>{const t=a.split(" "),i=(t.length<=1?[...t]:[t[0],t.pop()]).join(" "),n=i.lastIndexOf(" ")||0,r=n>=0?n:e;return(i.length>e?i.substring(0,r):i).substring(0,e)},ch=(a=16)=>{const e=s=>Math.floor(s).toString(a);return e(Date.now()/1e3)+" ".repeat(a).replace(/./g,()=>e(Math.random()*a))},lh={capitalize:Zl,hashCode:Ql,params:Jl,toCamelCase:ih,toKebabCase:nh,toUpperCamelCase:sh,randomColor:th,random:ah,removeDiacritics:rh,getShortName:oh,generateObjectId:ch},hh=a=>typeof a=="boolean",go="false";console.log("DEBUG",go);const uh=()=>go==="true",dh=a=>typeof a=="function",ph=a=>typeof a=="number"&&!isNaN(a),gh=a=>["string","number","symbol"].indexOf(typeof a)>-1,fh=a=>typeof a=="string",Eh=(a,e,t)=>{const{timeout:s=1e3,checkInterval:i=100}=t||{};return new Promise(n=>{const r=setInterval(()=>{const c=typeof a=="function"?a():a,o=typeof e=="function"?e():e;c===o&&(clearInterval(r),n(!0))},i);s>0&&setTimeout(()=>{clearInterval(r),n(!1)},s)})},mh={isBoolean:hh,isDebugger:uh,isFunction:dh,isNumber:ph,isObject:qi,isPropertyKey:gh,isString:fh,isValueChangeAsync:Eh},Ah=a=>{const{scene:e,key:t,newKey:s}=a,i=e.textures.get(t).getSourceImage();if(!i)return!1;const n=Math.min(i.width,i.height);s||e.textures.removeKey(t);const r=e.textures.createCanvas(s||t,n,n),c=r.context;return c.beginPath(),c.arc(n/2,n/2,n/2,0,Math.PI*2,!1),c.clip(),r.draw((i.width-n)/2,(i.height-n)/2,i),!0},Sh=a=>{const{scene:e,key:t,newKey:s,radius:i}=a;let{width:n,height:r}=a;const c=e.textures.get(t).getSourceImage();if(!c)return!1;n||(n=c.width),r||(r=c.height),s||e.textures.removeKey(t);const o=e.textures.createCanvas(s||t,n,r),l=o.context,d=Math.min(n,r)/100*i/2,u=0,p=0;return l.beginPath(),l.moveTo(u+d,p),l.lineTo(u+n-d,p),l.quadraticCurveTo(u+n,p,u+n,p+d),l.lineTo(u+n,p+r-d),l.quadraticCurveTo(u+n,p+r,u+n-d,p+r),l.lineTo(u+d,p+r),l.quadraticCurveTo(u,p+r,u,p+r-d),l.lineTo(u,p+d),l.quadraticCurveTo(u,p,u+d,p),l.closePath(),l.clip(),o.draw(0,0,c),!0},yh={drawCircle:Ah,drawBorder:Sh},Th=["","K","M","B","T","AA","AB","AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN","AO","AP","AQ","AR","AS","AT","AU","AV","AW","AX","AY","AZ","BA","BB","BC","BD","BE","BF","BG","BH","BI","BJ","BK","BL","BM","BN","BO","BP","BQ","BR"],Ih=(a,e)=>{const{fractionalDigits:t=0,startAbbreviate:s=1e3,abbreviateStep:i=3,maxLength:n=-1,removeLastZero:r=!0,suffixes:c=Th}=e||{},o=n===-1?99999999:n;if(a>=s){const u=Math.floor(a/10**i),p=Math.floor((u.toString().length-1)/i)+1,f=(a/(10**i)**p).toFixed(t),m=o-c[p].length,E=f.substring(0,m);return(r?Vn(E):E)+c[p]}const l=a.toFixed(t),h=o-c[0].length,d=l.substring(0,h);return r?Vn(d):d+c[0]},Vn=a=>{if(a.indexOf(".")<0)return a;for(let e=a.length-1;e>=0;e--){if(a[e]==".")return a.substring(0,e);if(a[e]!="0")return a.substring(0,e+1)}return a},Ch=(a,e,t="0")=>{let s=a.toString();const i=s.length;for(let n=0;n<e-i;n++)s=t+s;return s},Rh=(a,e,t="0")=>{let s=a.toString();const i=s.length;for(let n=0;n<e-i;n++)s=s+t;return s},_h={toAbbreviatedString:Ih,padStart:Ch,padEnd:Rh},vh=()=>{const a=navigator.userAgent;return/Windows|Mac OS/i.test(a)&&!/like Mac OS/.test(a)},wh=()=>{const a=navigator.userAgent;return/Android|iP[ao]d|iPhone/i.test(a)},Lh=()=>FBInstant.getPlatform()==="ANDROID",bh=()=>FBInstant.getPlatform()==="IOS",Ph=()=>FBInstant.getPlatform()==="MOBILE_WEB",Oh=()=>Math.round(window.devicePixelRatio)||1,Dh={isDesktop:vh,isMobile:wh,isAndroid:Lh,isIOS:bh,isMobileWeb:Ph,pixelRatio:Oh},fo={Array:wl,Hash:Hl,Html:Vl,Json:jl,Object:ql,String:lh,Valid:mh,Image:yh,Number:_h,Device:Dh};function Eo(a){return Object.prototype.toString.call(a).slice(8,-1)}function ws(a){if(Eo(a)!=="Object")return!1;const e=Object.getPrototypeOf(a);return e.constructor===Object&&e===Object.prototype}function Wn(a){return Eo(a)==="Symbol"}function jn(a,e,t,s){const i={}.propertyIsEnumerable.call(s,e)?"enumerable":"nonenumerable";i==="enumerable"&&(a[e]=t),i==="nonenumerable"&&Object.defineProperty(a,e,{value:t,enumerable:!1,writable:!0,configurable:!0})}function mo(a,e,t){if(!ws(e))return e;let s={};if(ws(a)){const c=Object.getOwnPropertyNames(a),o=Object.getOwnPropertySymbols(a);s=[...c,...o].reduce((l,h)=>{const d=a[h];return(!Wn(h)&&!Object.getOwnPropertyNames(e).includes(h)||Wn(h)&&!Object.getOwnPropertySymbols(e).includes(h))&&jn(l,h,d,a),l},{})}const i=Object.getOwnPropertyNames(e),n=Object.getOwnPropertySymbols(e);return[...i,...n].reduce((c,o)=>{let l=e[o];const h=ws(a)?a[o]:void 0;h!==void 0&&ws(l)&&(l=mo(h,l,t));const d=t?t(h,l,o):l;return jn(c,o,d,e),c},s)}function Me(a,...e){return e.reduce((t,s)=>mo(t,s),a)}const Ao=2,Nh=1920/Ao,Mh=1080/Ao,kh=530,$n=Nh-kh,zn=Mh,Uh={ENV:"development",AppId:"195590",ApiHost:"",OtherHost:"",Notification:{Enable:!0,DisableSendNotification:!0,ApiUrl:"https://nostra-notifications.suncs.io",GameTitle:"Sun Studio",GameImage:""},PlayerMock:{id:"",signature:""},OpponentMock:{id:"",signature:""},MatchMockFailRate:5,Gameplay:{StartLevel:1,StartCoins:6,DelayFinishGame:1700,HintWaitTime:5e3,Powers:{FreeCoins:{enable:!0,duration:1e3*60*3},SpeedUp:{enable:!0,modifier:2}},MaxLevel:1598,MaximumMeleeLevel:11,MaximumRangedLevel:11,CheaterIds:[],ChallengeFriends:{activePerLevel:2,maxActiveCount:1}},Tutorial:{ForceUseTutorial:!1,NumberOfTutorial:{GuideOne:1,GuideTwo:1,GuidePrevent:-1,GuideThree:1}},PlayerDataStore:"PlayerData.PopJewels",Game:{AutoResize:!0,PortraitRatio:320/518,PortraitWidth:375,PortraitHeight:667,LandscapeRatio:$n/zn,LandscapeWidth:$n,LandscapeHeight:zn,ForcePixelRatio:0,DisableLandscape:!0,FullSizeOnLandscape:!1},Debugger:{ShowInspector:!1,ShowMonitoring:!1,ShowConsole:!1,Expanded:!1,AutoRefresh:!0,InspectorAutoUpdate:!0,Opacity:.8},Statistics:{Enable:!1,DisplayMode:0,FPS:!0,MS:!0,MB:!0,Opacity:.8,ShowFPSInGame:!0,ShowMemoryInGame:!1},ParticleEditor:{Enable:!1,Opacity:.8,Expanded:!0},LevelBuilder:{Enable:!1,Opacity:.8,Expanded:!1},OfflineReward:{Enable:!0,ValuePerMinute:1,MinimumTimeToActive:1*60*60*1e3,LevelScalingModifier:1.12},ProfilerPlugin:{Enable:!1},Match:{MaxRescueCount:1,RescueGamePopupTimeout:15,ContinueSingleMatchEnabled:!1,SingleMatchStore:"singleMatch",LocalSingleMatchDefault:{_id:"12345678890",status:"open",playerId:"",score:0,level:1,startedAt:0,updateAt:0,finishAt:0,data:{}}},DailyRewards:{MaxDays:6,MockTime:0,CheckInterrupt:!0},DailyTasks:{Duration:86400},Tournament:{UseMock:!1,ForcePlay:!1,UseLeaderboard:!1,TournamentContextIds:[]},Battle:{UseMock:!1,RankingDevTest:!1},LeadersBoard:{Name:null,UseMock:!1,Prefix:"leaderboards",LeaderboardId:"",Limit:50},EnableEffectSceneTransition:!1,Ads:{Enabled:!0,CalculateSafeAreaBottom:!0,EnableRewardVideoResetInterstitial:!1,Mockup:{Enable:!1,ErrorRate:5,GiphyApiKey:""},InterstitialAdOptions:{pID:"",showWhenStartGame:!1,secondsFirstTime:45,secondsBetweenAds:90},RewardAdOptions:{pID:"",secondsFirstTime:0,secondsBetweenAds:0},BannerAdOptions:[{placementId:"1",bannerHeight:50,platform:"MOBILE",secondsReload:0},{placementId:"2",bannerHeight:50,platform:"DESKTOP",secondsReload:0}]},Network:{MaximumRequest:6,Timeout:15e3,Retries:3},Analytics:{GoogleAnalytics:{consoleLog:!1},FacebookAnalytics:null},Sentry:{errorCodes:{accepted:[],ignored:["USER_INPUT","NETWORK_FAILURE"]},errorMessages:{accepted:[],ignored:["Load image failed","Request failed to be processed","Failed to fetch","reading 'renderList'","reading 'skeletonData'"]}},Rollbar:{Enable:!1,UseMockup:!1,FilterError:{Codes:{accepted:[],ignored:["USER_INPUT","NETWORK_FAILURE"]},Messages:{accepted:[],ignored:["Load image failed","Request failed to be processed","Failed to fetch","reading 'renderList'","reading 'skeletonData'"]}},ListPlayerDevIds:[]},UnitsConfig:{MELEE:{listLevelsUseSprite:[]},RANGED:{listLevelsUseSprite:[]}},Performance:{Enable:!1,trackingSceneKeys:["DASHBOARD_SCENE","GAME_SCENE"],minQuality:1,maxQuality:2,fpsThreshold:48,checkInterval:2e3,qualityAdjustStep:.1,autoUpgradeQuality:!0,onlyUpdateWhenSwitchScene:!0}},xh={AppId:"527305895544198",Game:{},Ads:{Enabled:!0,InterstitialAdOptions:{showWhenStartGame:!1,secondsFirstTime:0,secondsBetweenAds:0},Mockup:{Enable:!0,ErrorRate:5,GiphyApiKey:"VmjHIRsfrwCAssDS4mDo9DoImxJm1lLM"}},ParticleEditor:{Enable:!1,Expanded:!1},Debugger:{ShowMonitoring:!1,ShowInspector:!1},Statistics:{Enable:!1,ShowFPSInGame:!1}},Bh={ENV:"development",Notification:{Enable:!1},Ads:{Enabled:!0,Mockup:{Enable:!1,ErrorRate:5,GiphyApiKey:"VmjHIRsfrwCAssDS4mDo9DoImxJm1lLM"},RewardAdOptions:{pID:"123"},InterstitialAdOptions:{pID:"456"},BannerAdOptions:[{placementId:"789",bannerHeight:50,platform:"MOBILE",secondsReload:0},{placementId:"012",bannerHeight:50,platform:"DESKTOP",secondsReload:0}]},Analytics:{GoogleAnalytics:null},Statistics:{ShowFPSInGame:!0},Tournament:{UseMock:!0},Battle:{UseMock:!0}},So=2,Fh=1920/So,Gh=1080/So,Hh=530,Xn=Fh-Hh,qn=Gh,Yh={Game:{LandscapeRatio:Xn/qn,LandscapeWidth:Xn,LandscapeHeight:qn,ForcePixelRatio:0},Statistics:{Enable:!1},Rollbar:{Enable:!1},Ads:{Enabled:!0},Analytics:{FacebookAnalytics:{}}},Kh={ENV:"production",ApiHost:"",OtherHost:"",Notification:{Enable:!1,GameTitle:"Dinosaur Merge Master",GameImage:"https://static-tt.citigo.site/fbig-singleplay-apps/dino-merge-master.jpg"},LeadersBoard:{Prefix:"leaderboards",LeaderboardId:""},Debugger:{ShowConsole:!1,ShowInspector:!1,ShowMonitoring:!1},Statistics:{Enable:!1,ShowFPSInGame:!1,ShowMemoryInGame:!1},Ads:{Enabled:!0,Mockup:{Enable:!1}}};let tt=Uh;const Vh="production";switch(Vh){case"development":tt=Me({...tt},Bh),tt=Me({...tt},xh);break;case"production":tt=Me({...tt},Kh),tt=Me({...tt},Yh);break}const yo=tt,Wh=a=>e=>{try{const{game:t}=window,{module:s}=e;if(!t.scene.getScenes(!0).find(c=>c.scene.key===a))return;const r=s.default;t.scene.remove(a),t.scene.add(a,r,!0),t.scene.bringToTop(t.globalScene),console.log("%c HotScene: ",a)}catch{}};function Ts(a,e,t){var s,i,n;e===void 0&&(e=50),t===void 0&&(t={});var r=(s=t.isImmediate)!=null&&s,c=(i=t.callback)!=null&&i,o=t.maxWait,l=Date.now(),h=[];function d(){if(o!==void 0){var p=Date.now()-l;if(p+e>=o)return o-p}return e}var u=function(){var p=[].slice.call(arguments),g=this;return new Promise(function(f,m){var E=r&&n===void 0;if(n!==void 0&&clearTimeout(n),n=setTimeout(function(){if(n=void 0,l=Date.now(),!r){var S=a.apply(g,p);c&&c(S),h.forEach(function(I){return(0,I.resolve)(S)}),h=[]}},d()),E){var A=a.apply(g,p);return c&&c(A),f(A)}h.push({resolve:f,reject:m})})};return u.cancel=function(p){n!==void 0&&clearTimeout(n),h.forEach(function(g){return(0,g.reject)(p)}),h=[]},u}let jt=!1;const jh=(a,e=jt)=>t=>{try{const{game:s}=window,{module:i}=t;jt=e;const r=s.scene.getScenes(!0).find(h=>h.scene.key===a);if(!r)return;const c=i.default,o=`${a}-draft`;s.scene.remove(o);const l=s.scene.add(o,c);jt&&console.log("HotSceneObjects: ",a,l),l.events.once(Phaser.Scenes.Events.RENDER,Ts(()=>{const h=l.children.getAll();To(r,h),s.scene.remove(o)}),50),s.scene.run(o),s.scene.bringToTop(r),s.scene.bringToTop(s.globalScene)}catch(s){console.warn(s)}},To=(a,e,t)=>{e.forEach(s=>{if(!s.name)return;let i=null;if(t?i=t.getByName(s.name):i=a.children.getByName(s.name),jt&&console.log("Checking object: ",s.name,s.type),!i)return;if(s.type==="Container"){const o=s,l=i,h=o.getAll();if(To(a,h,l),l.freezeContainer)return;console.log("%c Update container: ",l.name)}const n=Reflect.ownKeys(s),r=["_events","_sysEvents","input","localTransform","list","displayList","frame"],c=n.filter(o=>{if(typeof o!="string"||r.indexOf(o)>=0||!i)return!1;const l=Reflect.get(s,o);if(l instanceof Function||l instanceof Phaser.Scene||l instanceof Phaser.GameObjects.Group||l instanceof Phaser.GameObjects.GameObject)return!1;const h=Reflect.get(i,o);return l!==h});c.length<1||(jt&&console.log("HotObject: ",s.name,c),c.forEach(o=>{if(!i)return;const l=Reflect.get(s,o),h=Reflect.get(i,o),d=Reflect.set(i,o,l);jt&&console.log("Update property: ",d,o,{oldValue:h,newValue:l})}))})},$h={Scene:Wh,SceneObjects:jh},zh={Configs:yo,Utils:fo,LiveUpdate:$h};window.GameCore=zh;const Xh="production";console.warn(Xh,{Configs:yo,isDebugger:fo.Valid.isDebugger()});const qh="null",Zh=qh!=="null",Qh=()=>{const a=setInterval(()=>{window.Sentry&&(clearInterval(a),console.warn({isSentryEnabled:Zh}))},100)},Jh=(a,e)=>{window.Sentry&&window.Sentry.addBreadcrumb({category:a,message:e})},eu=a=>{{console.error(a);return}},me=a=>{a&&eu(a)},tu="modulepreload",su=function(a,e){return new URL(a,e).href},Zn={},rt=function(e,t,s){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(n=>{if(n=su(n,s),n in Zn)return;Zn[n]=!0;const r=n.endsWith(".css"),c=r?'[rel="stylesheet"]':"";if(!!s)for(let h=i.length-1;h>=0;h--){const d=i[h];if(d.href===n&&(!r||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${c}`))return;const l=document.createElement("link");if(l.rel=r?"stylesheet":tu,r||(l.as="script",l.crossOrigin=""),l.href=n,document.head.appendChild(l),r)return new Promise((h,d)=>{l.addEventListener("load",h),l.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())},G={BUTTON_CLICK:"button_click",SCREEN_OPEN:"screen_open",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",SHARE:"share",MESSAGE:"message",INVITE:"invite",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",NEW_USER:"new_user",AD_IMPRESSION:"ad_impression",JOIN_GROUP:"join_group",EARN_UNIT:"earn_unit",USE_ITEM:"use_item",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",GLANCE_GAME_LOAD:"game_load",GLANCE_GAME_START:"game_start",GLANCE_GAME_REPLAY:"game_replay",GLANCE_GAME_LEVEL:"game_level",GLANCE_GAME_END:"game_end",GLANCE_GAME_LEVEL_COMPLETED:"level_completed",GLANCE_REWARDED_AD:"rewarded_ad",GLANCE_GAME_MILESTONE:"game_milestone",GLANCE_GAME_LIFE_END:"game_life_end",GLANCE_INGAME_TRANSACTIONS:"ingame_transactions"},{ForcePixelRatio:Qn}=GameCore.Configs.Game,Io=()=>Qn>0?Qn:GameCore.Utils.Device.isDesktop()||GameCore.Utils.Device.pixelRatio()>1?2:1,Ke=Io(),M={AVATAR:{KEY:"avatar",FILE:"./assets/images/others/avatar.png",CONFIG:{}},ICON_EARTH:{KEY:"icon-earth",FILE:"./assets/images/others/icon-earth.png",CONFIG:{}},BG_DESERT:{KEY:"background_desert",FILE:`./assets/images/${Ke}x/bg_desert.jpg`,CONFIG:{}},BG_ICE:{KEY:"background_ice",FILE:`./assets/images/${Ke}x/bg_ice.jpg`,CONFIG:{}},BG_TREE:{KEY:"background_tree",FILE:`./assets/images/${Ke}x/bg_tree.jpg`,CONFIG:{}},BG_VOLCANO:{KEY:"background_volcano",FILE:`./assets/images/${Ke}x/bg_volcano.jpg`,CONFIG:{}},BG_CRYSTAL:{KEY:"background_crystal",FILE:`./assets/images/${Ke}x/bg_crystal.jpg`,CONFIG:{}},BG_LANDSCAPE_DESERT:{KEY:"background_landscape_desert",FILE:`./assets/images/${Ke}x/bg_landscape_desert.jpg`,CONFIG:{}},BG_LANDSCAPE_ICE:{KEY:"background_landscape_ice",FILE:`./assets/images/${Ke}x/bg_landscape_ice.jpg`,CONFIG:{}},BG_LANDSCAPE_TREE:{KEY:"background_landscape_tree",FILE:`./assets/images/${Ke}x/bg_landscape_tree.jpg`,CONFIG:{}},BG_LANDSCAPE_VOLCANO:{KEY:"background_landscape_volcano",FILE:`./assets/images/${Ke}x/bg_landscape_volcano.jpg`,CONFIG:{}},BG_LANDSCAPE_CRYSTAL:{KEY:"background_landscape_crystal",FILE:`./assets/images/${Ke}x/bg_landscape_crystal.jpg`,CONFIG:{}}};class fs{playerId;name;photo;locale;constructor(e,t,s,i){this.playerId=e,this.name=t,this.photo=s||M.AVATAR.FILE,this.locale=i||"en_US"}toObject(){return{playerId:this.playerId,name:this.name,photo:this.photo,locale:this.locale,score:0}}}const iu=a=>new Promise(e=>setTimeout(e,a)),Jn=a=>{const e=new Date(a),t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},{Notification:nu}=GameCore.Configs,{GameTitle:au,GameImage:ru}=nu;class ou{async createAsync(e){return await GameSDK.tournament.createAsync(e)}async shareAsync(e){await GameSDK.tournament.shareAsync(e)}async joinAsync(e){return await GameSDK.tournament.joinAsync(e)}async postScoreAsync(e){await GameSDK.tournament.postScoreAsync(e)}async getTournamentsAsync(){return await GameSDK.tournament.getTournamentsAsync()}}class cu{facebook;isCalledSubscribeBot=!1;isCalledCreateShortcut=!1;constructor(e){this.facebook=e}async switchAsync(e){await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.switchAsync(e)}async chooseAsync(){try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2}),GameSDK.context.getID()}catch(e){if(e instanceof Object&&GameCore.Utils.Object.hasOwn(e,"code"))switch(e.code){case"USER_INPUT":return!1;case"SAME_CONTEXT":return GameSDK.context.getID()}return null}}async createAsync(e){try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.createAsync(`${e}`),GameSDK.context.getID()}catch(t){if(t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code"))switch(t.code){case"USER_INPUT":return!1;case"SAME_CONTEXT":return GameSDK.context.getID()}return null}}async getPlayerToken(){return(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature()}async getContextPlayers(e){try{const t=await GameSDK.context.getPlayersAsync(),s=[];return t.forEach(i=>{const n=i.getID();if(n===e)return;const r=i.getName();if(!r)return;const c=i.getPhoto();s.push(new fs(n,r,c).toObject())}),GameCore.Utils.Array.unique(s)}catch(t){return console.warn("getPlayersAsync",{error:t}),[]}}async shareAsync(e){await GameSDK.shareAsync(e)}async sendMessage(e){}async inviteAsync(e){}async postSessionScoreAsync(e){await GameSDK.postSessionScoreAsync(e)}async getRewardedVideoAsync(e){return await GameSDK.getRewardedVideoAsync(e)}async getInterstitialAdAsync(e){return await GameSDK.getInterstitialAdAsync(e)}getContextID(){return GameSDK.context.getID()}async attemptToAddShortcut(){if(this.isCalledCreateShortcut)return!1;try{if(GameSDK.getPlatform()==="ANDROID")return!1;const s=(await GameSDK.player.getDataAsync(["lastCallCreateShortcut"])||{}).lastCallCreateShortcut;if(s&&Jn(+s))return!1;const i=Date.now();if(GameSDK.player.setDataAsync({lastCallCreateShortcut:i}),!this.isSupportAPI("canCreateShortcutAsync"))return!1;if(await GameSDK.canCreateShortcutAsync()){const{SHORTCUT_CREATE:c,SHORTCUT_CREATE_POPUP:o}=G;this.isCalledCreateShortcut=!0,window.game.analytics.event(o);try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.createShortcutAsync(),window.game.analytics.event(c,{success:!0}),!0}catch{return window.game.analytics.event(c,{success:!1}),!1}}return!1}catch{return!1}}async attemptToSubscribeBot(){if(this.isCalledSubscribeBot)return!1;try{if(!this.isSupportAPI("player.canSubscribeBotAsync"))return!1;if(await GameSDK.player.canSubscribeBotAsync()){const i=(await GameSDK.player.getDataAsync(["lastCallSubscribeBot"])||{}).lastCallSubscribeBot;if(i&&Jn(+i))return!1;const n=Date.now();GameSDK.player.setDataAsync({lastCallSubscribeBot:n});const{BOT_SUBSCRIBE:r,BOT_SUBSCRIBE_POPUP:c}=G;this.isCalledSubscribeBot=!0,window.game.analytics.event(c);try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.player.subscribeBotAsync(),window.game.analytics.event(r,{success:!0}),!0}catch{return window.game.analytics.event(r,{success:!1}),!1}}return!1}catch{return!1}}async matchPlayerAsync(e,t,s){try{return!this.isSupportAPI("checkCanPlayerMatchAsync")||!await GameSDK.checkCanPlayerMatchAsync()?!1:(await GameSDK.matchPlayerAsync(e,t,s),!0)}catch{return!1}}setLoadingProgress(e){GameSDK.setLoadingProgress(e)}getLocale(){return GameSDK.getLocale()||"en"}async injectTournament(){this.facebook.tournament=new ou,this.facebook.getTournamentAsync=this.getTournamentAsync,this.facebook.requestTournamentAsync=this.requestTournamentAsync}async getTournamentAsync(){return await GameSDK.getTournamentAsync()}requestTournamentAsync=async e=>{try{await this.facebook.getTournamentAsync(),await this.facebook.tournament.shareAsync({score:e})}catch{const s=GameSDK.player.getName();await this.facebook.tournament.createAsync({initialScore:e,config:{tournamentTitle:`${s}'s Tournament`}})}};async sendNotificationAsync(e){try{const{message:t,delayTime:s}=e;await FBInstant.graphApi.requestAsync("/me/notifications","POST",{message:JSON.stringify({title:au,body:t,media_url:ru}),schedule_interval:s})}catch(t){console.warn("🤖 ? sendNotificationAsync",t)}}isSupportAPI(e){return GameSDK.getSupportedAPIs().includes(e)}}let ea=0,Fe=0;class lu{game;progressFbTimeEvent;constructor(e){this.game=e}loadingProgressFbBootScene(){let i=100;Fe=30;const n=()=>{if(i<=0){clearTimeout(this.progressFbTimeEvent);return}this.progressFbTimeEvent=setTimeout(()=>{this.game.facebook.setLoadingProgress(Math.round(Fe)),Fe+=30/i,i--,n()},50)};n()}finishLoadingProgressFbBootScene(){clearTimeout(this.progressFbTimeEvent)}loadingProgressFbLoadScene(){(!Fe||Fe<30)&&(Fe=60),ea=Fe;const t=()=>{this.progressFbTimeEvent=setTimeout(()=>{this.game.facebook.setLoadingProgress(Math.round(Fe)),Fe+=.1,t()},50)};t()}onProgress(e){const t=100-Fe,s=Math.round(e*t+Fe);s>ea&&clearTimeout(this.progressFbTimeEvent),this.game.facebook.setLoadingProgress(s)}}class hu{addKillRevive(){[Phaser.GameObjects.RenderTexture,Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Shape,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText,Phaser.GameObjects.Particles.ParticleEmitter,Phaser.GameObjects.Particles.ParticleEmitterManager].forEach(e=>{e.prototype.kill=this.kill,e.prototype.revive=this.revive})}addKillReviveGroup(){Phaser.GameObjects.Group.prototype.killGroup=this.killGroup,Phaser.GameObjects.Group.prototype.reviveGroup=this.reviveGroup}addSetWorldSize(){[Phaser.GameObjects.RenderTexture,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite].forEach(e=>{e.prototype.setWorldSize=this.setWorldSize})}addSetWorldSizeForContainer(){[Phaser.GameObjects.Container].forEach(e=>{e.prototype.setWorldSize=this.setWorldSizeForContainer})}addGetWorldPosition(){[Phaser.GameObjects.RenderTexture,Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Shape,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText].forEach(e=>{e.prototype.getWorldPosition=this.getWorldPosition})}addDrawDebugBox(){[Phaser.GameObjects.RenderTexture,Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Shape,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText,Phaser.GameObjects.Zone].forEach(e=>{e.prototype.drawDebugBox=this.drawDebugBox})}addHighQuality(){[Phaser.GameObjects.Text].forEach(e=>{e.prototype.setHighQuality=this.setHighQuality})}kill(){this.setActive(!1),this.setVisible(!1)}revive(){this.setActive(!0),this.setVisible(!0)}killGroup(){this.getChildren().forEach(e=>{e.setActive(!1),e.setVisible(!1)})}reviveGroup(){this.getChildren().forEach(e=>{e.setActive(!0),e.setVisible(!0)})}setWorldSize(e,t){this.setSize(e,t),this.setDisplaySize(e,t)}setWorldSizeForContainer(e,t,s=2){this.setSize(e*s,t*s),this.setDisplaySize(e,t)}getWorldPosition(){const e=this.getWorldTransformMatrix(),{translateX:t,translateY:s}=e.decomposeMatrix();return{x:t,y:s}}drawDebugBox(e,t){const{x:s,y:i,width:n,height:r,depth:c,originX:o,originY:l}=this,h=this.scene.add.rectangle(s,i,n,r,e,t);h.setName("Debug Box"),h.setDepth(c);const{isNumber:d}=GameCore.Utils.Valid;return d(o)&&d(l)&&h.setOrigin(o,l),h}setHighQuality(){return this.renderer instanceof Phaser.Renderer.WebGL.WebGLRenderer?this.setResolution(this.scene.game.world.getZoomRatio()*2):this}}const Zi={LOADED:"loaded",DISPLAYED:"displayed"};var Co=(a=>(a.IDLE="idle",a.LOADING="loading",a.FILLED="filled",a.SHOWING="showing",a))(Co||{});const Ro=Co;var _o=(a=>(a.REWARDED="rewarded",a.INTERSTITIAL="interstitial",a))(_o||{});const Ge=_o;class Lt extends Error{code;constructor(e,t){super(t),this.code=e,this.message=t}}class uu{type;status;constructor(e){this.type=e,this.status=Ro.IDLE}}GameCore.Ads={Types:Ge,Status:Ro,Events:Zi,AdError:Lt,AdInstance:uu};class du extends Phaser.Plugins.BasePlugin{events;enabled;config;lastInterAdShownTime;lastRewardAdShownTime;interstitial;rewardedVideo;safeAreaBottom;showingBannerAd;reloadBannerAdIntervals;bannerAdConfig;isHaveBannerAdOptions;init(){this.events=new Phaser.Events.EventEmitter,this.safeAreaBottom=0,this.lastInterAdShownTime=0,this.lastRewardAdShownTime=0,this.showingBannerAd={},this.reloadBannerAdIntervals={},this.isHaveBannerAdOptions=!0}calculateSafeAreaBottom(){try{if(!this.config.calculateSafeAreaBottom)return;this.safeAreaBottom=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sab")),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(e,t){this.enabled=t.enabled,this.config=t;const{bannerAdOptions:s}=this.config;s.length===0&&(this.isHaveBannerAdOptions=!1),this.setAdInstance(e),this.calculateSafeAreaBottom()}setAdInstance(e){const{rewardAdOptions:t,interstitialAdOptions:s}=this.config;this.interstitial=new e(Ge.INTERSTITIAL,t.pID),this.rewardedVideo=new e(Ge.REWARDED,s.pID)}async preloadInterstitialAdAsync(){console.log("preloading Interstitial"),await this.preloadAdAsync(Ge.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new Lt("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(Ge.INTERSTITIAL)}async preloadRewardedVideoAsync(){console.log("preloading RewardedVideo"),await this.preloadAdAsync(Ge.REWARDED)}async showRewardedVideoAsync(){if(!this.canbeShowRewardAd())throw new Lt("REWARDED_VIDEO_CAN_NOT_SHOW","Can't show rewarded video");await this.showAdAsync(Ge.REWARDED),this.lastRewardAdShownTime=window.performance.now()/1e3}getRemainingRewardTime(){const e=window.performance.now()/1e3,{secondsBetweenAds:t}=this.config.rewardAdOptions,s=e-this.lastRewardAdShownTime;return s<t?t-s:0}async preloadAdAsync(e){if(!this.enabled)throw new Lt("ADS_NOT_ENABLED","Ads is't enabled");const t=this.getAdInstanceByType(e);if(t===null)throw new Lt("AD_INSTANCE_NOT_INITIALLED","The instance ads not yet initiated");await t.loadAsync(),this.events.emit(Zi.LOADED,e)}async showAdAsync(e){if(!this.enabled)throw new Lt("ADS_NOT_ENABLED","Ads is't enabled");const t=this.getAdInstanceByType(e);if(t===null)throw new Lt("AD_INSTANCE_NOT_INITIALLED","The instance ads not yet initiated");if(e===Ge.INTERSTITIAL&&(this.lastInterAdShownTime=window.performance.now()/1e3),e===Ge.REWARDED){this.lastRewardAdShownTime=window.performance.now()/1e3;const{enableRewardVideoResetInterstitial:s}=this.config;s&&(this.lastInterAdShownTime=this.lastRewardAdShownTime)}await t.showAsync(),this.events.emit(Zi.DISPLAYED,e)}getAdStatus(e){const t=this.getAdInstanceByType(e);return t?t.getStatus():null}getAdInstanceByType(e){switch(e){case Ge.INTERSTITIAL:return this.interstitial;case Ge.REWARDED:return this.rewardedVideo;default:return null}}canbeShowInterstitialAd(){return this.canbeShowInterstitialAdByTime()}canbeShowInterstitialAdByTime(){const e=window.performance.now()/1e3,{secondsFirstTime:t,secondsBetweenAds:s}=this.config.interstitialAdOptions,i=Math.floor(e-this.lastInterAdShownTime);return this.lastInterAdShownTime>0?i>=s:i>=t}canbeShowRewardAd(){const e=window.performance.now()/1e3,{secondsFirstTime:t,secondsBetweenAds:s}=this.config.rewardAdOptions,i=Math.floor(e-this.lastRewardAdShownTime);return this.lastRewardAdShownTime>0?i>=s:i>=t}canShowBannerAd(){if(!this.isHaveBannerAdOptions)return!1;const{bannerAdOptions:e}=this.config,t=GameCore.Utils.Device.isDesktop();for(let s=0;s<e.length;s++){const i=e[s],n=i.platform;if(n=="ALL"||n=="DESKTOP"&&t||n=="MOBILE"&&!t)return this.bannerAdConfig=i,!0}return!1}async showBannerAdAsync(){if(!this.enabled||!this.canShowBannerAd())return;this.reloadBannerAdIntervals=this.reloadBannerAdIntervals||{};const{placementId:e,secondsReload:t}=this.bannerAdConfig;if(!(!e||e=="")){if(t>0){if(this.reloadBannerAdIntervals[e])return;this.loadBannerAdAsync(e),this.reloadBannerAdIntervals[e]=setInterval(()=>{this.loadBannerAdAsync(e)},t*1e3);return}this.loadBannerAdAsync(e)}}async loadBannerAdAsync(e){if(this.enabled)try{await GameSDK.loadBannerAdAsync(e),this.showingBannerAd[e]=!0}catch(t){console.log(t)}}async hideBannerAdAsync(){if(this.enabled&&this.isHaveBannerAdOptions)try{if(!this.enabled)return;const{bannerAdOptions:e}=this.config;e.forEach(t=>{const{placementId:s}=t,i=this.reloadBannerAdIntervals[s];i&&(clearInterval(i),this.reloadBannerAdIntervals[s]=null),this.showingBannerAd[s]=!1}),await GameSDK.hideBannerAdAsync()}catch(e){console.log(e)}}getBannerHeight(){if(!this.enabled||!this.canShowBannerAd())return 0;const{bannerHeight:e=0}=this.bannerAdConfig||{},t=e+this.safeAreaBottom;if(this.game.world){const s=this.game.world,i=s.getPixelRatio(),n=s.getZoomRatio(),r=s.getScreenHeight()*.01;return this.game.world.getPhysicPixels(t+r,i/n)}return t}}class pu{name;color;selfLog;options;constructor(e,t,s){this.name=e,this.color=s||"#FFF",this.options=t,this.selfLog=!0,console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t,s){this.processEvent(e,t,s),this.selfLog&&console.info(`%c${this.name}: event`,`color: ${this.color}`,{name:e,value:s,payload:t})}pageview(e){const t=this.getPageByKey(e);this.processPageView(t),this.selfLog&&console.info(`%c${this.name}: pageview`,`color: ${this.color}`,{page:t})}levelStart(e,t,s){this.processLevelStart(e,t,s),this.selfLog&&console.info(`%c${this.name}: level start`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelFail(e,t,s){this.processLevelFail(e,t,s),this.selfLog&&console.info(`%c${this.name}: level fail`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelRescue(e,t,s){this.processLevelRescue(e,t,s),this.selfLog&&console.info(`%c${this.name}: level rescue`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelComplete(e,t,s){this.processLevelComplete(e,t,s),this.selfLog&&console.info(`%c${this.name}: level complete`,`color: ${this.color}`,{level:e,score:t,levelName:s})}showInterstitialAd(e){this.processShowInterstitialAd(e),this.selfLog&&console.info(`%c${this.name}: show interstitial ad`,`color: ${this.color}`,{placement:e})}showRewardedVideoAd(e){this.processShowRewardedVideoAd(e),this.selfLog&&console.info(`%c${this.name}: show rewarded video ad`,`color: ${this.color}`,{placement:e})}receiveReward(e){this.processReceiveReward(e),this.selfLog&&console.info(`%c${this.name}: receive reward`,`color: ${this.color}`,{placement:e})}showAdFail(e,t,s){this.processShowAdFail(e,t,s),this.selfLog&&console.info(`%c${this.name}: show ad fail`,`color: ${this.color}`,{type:e,placement:t,reason:s})}gameMilestone(e,t,s,i){this.processGameMilestone(e,t,s,i),this.selfLog&&console.info(`%c${this.name}: game milestone`,`color: ${this.color}`,{type:e,meta:t,level:s,score:i})}gameLifeEnd(e,t,s){this.processGameLifeEnd(e,t,s),this.selfLog&&console.info(`%c${this.name}: game life end`,`color: ${this.color}`,{remainingLife:e,level:t,score:s})}gameIngameTransactions(e,t,s,i){this.gameIngameTransactions(e,t,s,i),this.selfLog&&console.info(`%c${this.name}: ingame transaction`,`color: ${this.color}`,{transactionType:e,meta:t,level:s,score:i})}getPageByKey(e){let t=e.replace(/_/g,"-");return t=t.toLowerCase(),t}processLevelStart(e,t,s){}processLevelFail(e,t,s){}processLevelRescue(e,t,s){}processLevelComplete(e,t,s){}processShowInterstitialAd(e){}processShowRewardedVideoAd(e){}processReceiveReward(e){}processShowAdFail(e,t,s){}processGameMilestone(e,t={},s=0,i=0){}processGameLifeEnd(e,t=0,s=0){}processIngameTransactions(e,t={},s=0,i=0){}}GameCore.Analytics={BaseAnalytics:pu};class gu extends Phaser.Plugins.BasePlugin{analytics;init(){this.analytics=[]}add(e){this.analytics.push(e)}pageview=e=>{this.isActive()&&this.analytics.forEach(t=>{t.pageview(e)})};event(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.event(e,t,s)})}levelStart(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.levelStart(e,t,s)})}levelRescue(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.levelRescue(e,t,s)})}levelFail(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.levelFail(e,t,s)})}levelComplete(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.levelComplete(e,t,s)})}showInterstitialAd(e){this.isActive()&&this.analytics.forEach(t=>{t.showInterstitialAd(e)})}showRewardedVideoAd(e){this.isActive()&&this.analytics.forEach(t=>{t.showRewardedVideoAd(e)})}receiveReward(e){this.isActive()&&this.analytics.forEach(t=>{t.receiveReward(e)})}showAdFail(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.showAdFail(e,t,s)})}gameMilestone(e,t,s,i){this.isActive()&&this.analytics.forEach(n=>{n.gameMilestone(e,t,s,i)})}gameLifeEnd(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.gameLifeEnd(e,t,s)})}gameIngameTransactions(e,t,s,i){this.isActive()&&this.analytics.forEach(n=>{n.gameIngameTransactions(e,t,s,i)})}isActive(){return this.analytics.length>=1}}const Dt={BACKGROUND:{KEY:"background",FILE:"./assets/music/bg_music.ogg"},EFFECTS_FILES:{"start-game-sound":"./assets/sounds/start-game-sound.ogg","next-round-effect":"./assets/sounds/next-round-effect.ogg","lose-sound":"./assets/sounds/lose-sound.ogg","thunder-sound":"./assets/sounds/thunder-sound.ogg","close-click":"./assets/sounds/close-click.ogg","button-click":"./assets/sounds/button-click.ogg","drag-unit-end":"./assets/sounds/drag-unit-end.ogg","drag-unit-start":"./assets/sounds/drag-unit-start.ogg","start-battle":"./assets/sounds/start-battle.ogg","melee-attack":"./assets/sounds/melee-attack.ogg","arrow-shoot":"./assets/sounds/arrow-shoot.ogg","win-battle":"./assets/sounds/win-battle.ogg","unit-damaged":"./assets/sounds/unit-damaged.ogg","unit-merge":"./assets/sounds/unit-merge.ogg","turn-switch":"./assets/sounds/turn-switch.ogg","unit-unlock":"./assets/sounds/unit-unlock.ogg","coin-spawn":"./assets/sounds/coin-spawn.ogg","coin-increase-repeatedly":"./assets/sounds/coin-increase-repeatedly.ogg","gift-charge":"./assets/sounds/gift-charge.ogg","gift-explode":"./assets/sounds/gift-explode.ogg","gift-reveal":"./assets/sounds/gift-reveal.ogg"}},{EFFECTS_FILES:fu}=Dt;class Eu{game;audios;volume;constructor(e){this.game=e,this.audios=new Map}play(e,t){const s={volume:this.volume,...t||{}};s.volume!==this.volume&&(s.volume*=this.volume);const i=this.audios.get(e);if(i){i.play(void 0,s);return}this.game.globalScene.load.audio(e,fu[e]),this.game.globalScene.load.on(`${Phaser.Loader.Events.FILE_KEY_COMPLETE}audio-${e}`,()=>{const n=this.game.sound.add(e);this.audios.set(e,n),n.play(void 0,s)}),this.game.globalScene.load.start()}pause(e){const t=this.audios.get(e);t&&t.pause()}pauseAll(){this.audios.forEach(e=>{e.pause()})}resumeAll(){this.audios.forEach(e=>{e.resume()})}stop(e){const t=this.audios.get(e);t&&t.stop()}setVolume(e){this.volume=e}isMusicEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("music")};isSoundEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("sound")}}class mu{name;game;isSprite;audio;markers;volume;volumePerMs;targetVolume;constructor(e,t,s){this.name=t,this.game=e,this.markers={},this.isSprite=s,this.volume=0,this.isSprite||(this.audio=this.game.sound.add(this.name))}play(e,t){const s={volume:this.volume,...t||{}};if(s.volume!==this.volume&&(s.volume*=this.volume),!this.isSprite){if(this.audio?.seek>0){this.audio.resume();return}this.audio?.play(e,s);return}this.createMaker(e),this.markers[e]?.play(e,s)}pause(e){if(!this.isSprite){this.audio?.pause();return}this.markers[e]?.pause()}stop(e){if(!this.isSprite){this.audio?.stop();return}this.markers[e]?.stop()}setVolume(e,t){if(t===0||e===this.volume){this.game.globalScene.events.off(Phaser.Scenes.Events.UPDATE,this.handleIncreaseVolume),this.volume=e,this.audio?.setVolume(e);return}this.volumePerMs=(e-this.volume)/t,this.targetVolume=e,this.game.globalScene.events.off(Phaser.Scenes.Events.UPDATE,this.handleIncreaseVolume),this.game.globalScene.events.on(Phaser.Scenes.Events.UPDATE,this.handleIncreaseVolume)}handleIncreaseVolume=(e,t)=>{this.volume+=this.volumePerMs*t,this.audio?.setVolume(this.volume),(this.volumePerMs>=0&&this.volume>=this.targetVolume||this.volumePerMs<=0&&this.volume<=this.targetVolume)&&(this.volume=this.targetVolume,this.game.globalScene.events.off(Phaser.Scenes.Events.UPDATE,this.handleIncreaseVolume))};isMusicEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("music")};isSoundEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("sound")};createMaker(e){if(!this.markers[e])try{this.markers[e]=this.game.sound.addAudioSprite(this.name)}catch(t){console.warn("createMaker",t)}}}const{EFFECTS_FILES:dv}=Dt;class Au extends Phaser.Plugins.BasePlugin{soundManager;musicManager;isMuteAll;initMusic=e=>{this.musicManager=new mu(this.game,e,!1),this.setMusicVolume(0)};initSound=()=>{this.soundManager=new Eu(this.game),this.setSoundVolume(1)};playSound(e,t){try{if(!this.soundManager||this.isMuteAll||!this.soundManager.isSoundEnabled())return;this.soundManager.play(e,t)}catch{}}stopSound(e){try{this.soundManager.stop(e)}catch{}}playMusic(e={}){try{if(!this.musicManager||this.isMuteAll||!this.musicManager.isMusicEnabled())return;this.musicManager.play("",{loop:!0,volume:.4,...e})}catch{}}pauseMusic(){try{if(!this.musicManager)return;this.musicManager.pause("")}catch{}}stopMusic(){try{if(!this.musicManager)return;this.musicManager.stop("")}catch{}}pauseAllSounds(){try{if(!this.soundManager)return;this.soundManager.pauseAll()}catch{}}resumeAllSounds(){try{if(!this.soundManager)return;this.soundManager.resumeAll()}catch{}}setSoundVolume(e){try{if(!this.soundManager)return;this.soundManager.setVolume(e)}catch(t){console.warn("setSoundVolume",t)}}setMusicVolume(e,t=0){try{if(!this.musicManager)return;this.musicManager.setVolume(e,t)}catch(s){console.warn("setMusicVolume",s)}}muteAll(){this.isMuteAll=!0,this.game.globalScene.sound.mute=!0}unmuteAll(){this.isMuteAll=!1,this.game.globalScene.sound.mute=!1}}const vo="AUTH_TOKEN_REQUEST",wo="AUTH_TOKEN_RECEIVED";class Su extends Error{payload;constructor(e,t){super(e),this.name="RequestTokenFail",this.message=e||"Request token fail",this.payload=t||{}}}var Ws="NOT_FOUND";function yu(a){var e;return{get:function(s){return e&&a(e.key,s)?e.value:Ws},put:function(s,i){e={key:s,value:i}},getEntries:function(){return e?[e]:[]},clear:function(){e=void 0}}}function Tu(a,e){var t=[];function s(c){var o=t.findIndex(function(h){return e(c,h.key)});if(o>-1){var l=t[o];return o>0&&(t.splice(o,1),t.unshift(l)),l.value}return Ws}function i(c,o){s(c)===Ws&&(t.unshift({key:c,value:o}),t.length>a&&t.pop())}function n(){return t}function r(){t=[]}return{get:s,put:i,getEntries:n,clear:r}}var Iu=function(e,t){return e===t};function Cu(a){return function(t,s){if(t===null||s===null||t.length!==s.length)return!1;for(var i=t.length,n=0;n<i;n++)if(!a(t[n],s[n]))return!1;return!0}}function Ru(a,e){var t=typeof e=="object"?e:{equalityCheck:e},s=t.equalityCheck,i=s===void 0?Iu:s,n=t.maxSize,r=n===void 0?1:n,c=t.resultEqualityCheck,o=Cu(i),l=r===1?yu(o):Tu(r,o);function h(){var d=l.get(arguments);if(d===Ws){if(d=a.apply(null,arguments),c){var u=l.getEntries(),p=u.find(function(g){return c(g.value,d)});p&&(d=p.value)}l.put(arguments,d)}return d}return h.clearCache=function(){return l.clear()},h}function _u(a){var e=Array.isArray(a[0])?a[0]:a;if(!e.every(function(s){return typeof s=="function"})){var t=e.map(function(s){return typeof s=="function"?"function "+(s.name||"unnamed")+"()":typeof s}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return e}function vu(a){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];var i=function(){for(var r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];var l=0,h,d={memoizeOptions:void 0},u=c.pop();if(typeof u=="object"&&(d=u,u=c.pop()),typeof u!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof u+"]");var p=d,g=p.memoizeOptions,f=g===void 0?t:g,m=Array.isArray(f)?f:[f],E=_u(c),A=a.apply(void 0,[function(){return l++,u.apply(null,arguments)}].concat(m)),S=a(function(){for(var T=[],R=E.length,b=0;b<R;b++)T.push(E[b].apply(null,arguments));return h=A.apply(null,T),h});return Object.assign(S,{resultFunc:u,memoizedResultFunc:A,dependencies:E,lastResult:function(){return h},recomputations:function(){return l},resetRecomputations:function(){return l=0}}),S};return i}var j=vu(Ru);const pn="auth",wu=a=>a[pn].token,Lu=a=>a[pn].isRequesting,Lo=j([wu],a=>a),bu=j([Lu],a=>a),Pu=()=>async(a,e)=>{try{const{facebook:t}=window.game,s=e(),i=Lo(s);if(bu(s)||i!=="")return;a({type:vo,payload:{}});const r=await t.getPlayerToken();a(ta(r))}catch(t){if(t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;if(a(ta("")),t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"message")&&typeof t.message=="string"){me(new Error(t.message));return}me(new Su)}},ta=a=>({type:wo,payload:{token:a}});class Ou extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async requestToken(){const{storage:e}=this.game;await e.dispatch(Pu())}getToken(){return Lo(this.state)}}const K={BOOT_SCENE:"BOOT_SCENE",LOAD_SCENE:"LOAD_SCENE",MAP_SCENE:"MAP_SCENE",GAME_SCENE:"GAME_SCENE",GLOBAL_SCENE:"GLOBAL_SCENE",LEVEL_BUILDER_SCENE:"LEVEL_BUILDER_SCENE",TEST_SCENE:"TEST_SCENE",ANIMATIONS_SCENE:"ANIMATIONS_SCENE"},Ks={RUN:Symbol("RUN"),SLEEP:Symbol("SLEEP"),SWITCH:Symbol("SWITCH")},Du={OPEN:"open",CLOSE:"close",CREATED:"created"},P={UNITS_SCREEN:"UNITS_SCREEN",READY_SCREEN:"READY_SCREEN",NOTIFY_SCREEN:"NOTIFY_SCREEN",RESULT_SCREEN:"RESULT_SCREEN",BATTLE_SCREEN:"BATTLE_SCREEN",LOADING_SCREEN:"LOADING_SCREEN",SETTINGS_SCREEN:"SETTINGS_SCREEN",UNIT_REWARD_SCREEN:"UNIT_REWARD_SCREEN",UNIT_UNLOCK_SCREEN:"UNIT_UNLOCK_SCREEN",LEADER_BOARD_SCREEN:"LEADER_BOARD_SCREEN",BATTLE_RESULT_SCREEN:"BATTLE_RESULT_SCREEN",OFFLINE_REWARD_SCREEN:"OFFLINE_REWARD_SCREEN",CLOSEABLE_NOTIFY_SCREEN:"CLOSEABLE_NOTIFY_SCREEN",FREE_GOLD_REWARD_SCREEN:"FREE_GOLD_REWARD_SCREEN",CHALLENGE_SPLASH_SCREEN:"CHALLENGE_SPLASH_SCREEN",RESET_DATA_SCREEN:"RESET_DATA_SCREEN",START_OVER_POPUP:"START_OVER_POPUP"},$e={SCREEN:200,POPUP:300,SPLASH:400,PRIORITY:999},Nu="single",$t="challenge-friends",Mu="matching-group",sa="tournaments",Wt="open",Es="active",js="finished",bo="CONTEXT_RECEIVED",ku="CONTEXT_PROCESSED",Po="CONTEXT_GAME_MODE_DETECTED",Oo="CONTEXT_GAME_MODE_REQUESTED",Do="MESSAGES_SENT_UPDATE",No="MESSAGES_SENT_REMOVE",Mo="SCENE_KEY_UPDATE",Uu="share_invite",ia="tournament",si="challenge_friend_match",xu="matching_group_match",ko="challenge_friends_message";class Uo extends Error{constructor(e,t){super(e,t),this.name="InvalidContextId",this.message=e||"This contextId is not valid",this.payload=t}}class Bu extends Error{constructor(e,t){super(e,t),this.name="InvalidOpponentId",this.message=e||"This opponentId is not valid",this.payload=t}}class Fu extends Error{constructor(e,t){super(e,t),this.name="WideFrameRenderFail",this.message=e||"Wide frame render fail",this.payload=t}}const Gu={PASS_LEVELS:{ID:"pass-levels",EVENTS:{PASS_LEVEL:"pass-level"}},COLLECT_DIAMONDS:{ID:"collect-diamonds",EVENTS:{COLLECT_DIAMONDS:"collect-diamonds"}},INVITE_FRIENDS:{ID:"invite-friends",EVENTS:{INVITED_FRIEND:"INVITED_FRIEND"}},REACH_SCORE:{ID:"reach-score",EVENTS:{ADD_SCORE:"add-score"}},EVENTS:{TASKS_RESET:"tasks-reset",NOTICE_UPDATE:"notice-update"}},Hu=a=>a.messages.data,Yu=(a,e)=>e.opponentId,xo=j([Hu],a=>a);j([xo,Yu],(a,e)=>!GameCore.Utils.Valid.isString(e)||!GameCore.Utils.Object.hasOwn(a,e)?!1:a[e].sent);var Bo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ku(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Qi={},Vu={get exports(){return Qi},set exports(a){Qi=a}};(function(a){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function i(o,l,h){this.fn=o,this.context=l,this.once=h||!1}function n(o,l,h,d,u){if(typeof h!="function")throw new TypeError("The listener must be a function");var p=new i(h,d||o,u),g=t?t+l:l;return o._events[g]?o._events[g].fn?o._events[g]=[o._events[g],p]:o._events[g].push(p):(o._events[g]=p,o._eventsCount++),o}function r(o,l){--o._eventsCount===0?o._events=new s:delete o._events[l]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var l=[],h,d;if(this._eventsCount===0)return l;for(d in h=this._events)e.call(h,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(h)):l},c.prototype.listeners=function(l){var h=t?t+l:l,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,p=d.length,g=new Array(p);u<p;u++)g[u]=d[u].fn;return g},c.prototype.listenerCount=function(l){var h=t?t+l:l,d=this._events[h];return d?d.fn?1:d.length:0},c.prototype.emit=function(l,h,d,u,p,g){var f=t?t+l:l;if(!this._events[f])return!1;var m=this._events[f],E=arguments.length,A,S;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),E){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,d),!0;case 4:return m.fn.call(m.context,h,d,u),!0;case 5:return m.fn.call(m.context,h,d,u,p),!0;case 6:return m.fn.call(m.context,h,d,u,p,g),!0}for(S=1,A=new Array(E-1);S<E;S++)A[S-1]=arguments[S];m.fn.apply(m.context,A)}else{var I=m.length,T;for(S=0;S<I;S++)switch(m[S].once&&this.removeListener(l,m[S].fn,void 0,!0),E){case 1:m[S].fn.call(m[S].context);break;case 2:m[S].fn.call(m[S].context,h);break;case 3:m[S].fn.call(m[S].context,h,d);break;case 4:m[S].fn.call(m[S].context,h,d,u);break;default:if(!A)for(T=1,A=new Array(E-1);T<E;T++)A[T-1]=arguments[T];m[S].fn.apply(m[S].context,A)}}return!0},c.prototype.on=function(l,h,d){return n(this,l,h,d,!1)},c.prototype.once=function(l,h,d){return n(this,l,h,d,!0)},c.prototype.removeListener=function(l,h,d,u){var p=t?t+l:l;if(!this._events[p])return this;if(!h)return r(this,p),this;var g=this._events[p];if(g.fn)g.fn===h&&(!u||g.once)&&(!d||g.context===d)&&r(this,p);else{for(var f=0,m=[],E=g.length;f<E;f++)(g[f].fn!==h||u&&!g[f].once||d&&g[f].context!==d)&&m.push(g[f]);m.length?this._events[p]=m.length===1?m[0]:m:r(this,p)}return this},c.prototype.removeAllListeners=function(l){var h;return l?(h=t?t+l:l,this._events[h]&&r(this,h)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,a.exports=c})(Vu);const Wu=Qi,ju=new Wu,ye={COIN_SUFFIX:"coinSuffixValue",COIN_BASE_VALUE:"coinBaseValue",PLAYER_UNIT_DATA:"playerUnitData",LEVEL_PROGRESS:"playerLevelProgress",MELEE_UNLOCKED:"meleeUnlockedUnitLevel",RANGED_UNLOCKED:"rangedUnlockedUnitLevel",FREE_GOLD_LAST_USED:"freeCoinsLastUsedTime",SELECTED_LEVEL:"selectedLevel",UNIT_SCREEN_AD_WATCHED_COUNT:"unitScreenAdWatchedCount"},{LEVEL_PROGRESS:$u}=ye,zu=async()=>{const{player:a,globalScene:e}=window.game,{playerId:t,photo:s}=a.getPlayer(),i=a.getCustomData($u),n=Xu({playerId:t,playerPhoto:s,playerLevel:i});if(!n)return console.warn("getRenderOptionsGameResult"),null;const r={name:"mess-game-result",width:476,height:246,renderOptions:n};return await e.frameCapture.capture(r)},Xu=a=>{const{playerId:e,playerPhoto:t,playerLevel:s=1}=a;return typeof e!="string"||typeof t!="string"?null:{avatar:{name:`${e}`,type:"image",x:50,y:68,image:t,width:105,height:105,fallbackWithImage:M.AVATAR.KEY},wideFrame:{name:"wide-frame-game-result",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-game-result.png",width:476,height:246},playerLevel:{type:"text",x:234,y:35,font:"800 18px",fillStyle:"#424ec4",text:`Level ${s}`,textAlign:"center"}}},qu=async a=>{const{globalScene:e}=window.game;console.info("🚀 > getRenderOptionsChallenge",a);const t=Zu(a);if(!t)return console.warn("getRenderOptionsChallenge"),null;const s={name:"mess-challenge",width:476,height:246,renderOptions:t};return await e.frameCapture.capture(s)},Zu=a=>{const{playerId:e,playerPhoto:t,opponentId:s,opponentPhoto:i}=a;return typeof e!="string"||typeof s!="string"?null:{playerAvatar:{name:`${e}`,type:"image",x:20,y:75,image:t||M.AVATAR.FILE,width:105,height:105,fallbackWithImage:M.AVATAR.KEY},opponentAvatar:{name:`${s}`,type:"image",x:357,y:75,image:i||M.AVATAR.FILE,width:105,height:105,fallbackWithImage:M.AVATAR.KEY},wideFrame:{name:"wide-frame-game-challenge",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-game-challenge.png",width:476,height:246}}},Fo=a=>{const{contextId:e}=a;if(e===""||typeof e!="string")throw new Uo(null,{contextId:e})},Qu=a=>{const{opponentId:e,contextId:t}=a;if(e===""||typeof e!="string")throw new Bu(null,{opponentId:e});if(t===""||typeof t!="string")throw new Uo(null,{contextId:t})},Go=a=>{const{imageShare:e}=a;if(e===null)throw new Fu},Ho=(a,e=!0)=>(t,s)=>{const i=s(),n=xo(i);if(e){if(n[a]?.sent)return;t(Ju(a))}n[a]?.sent&&t(ed(a))},Ju=a=>({type:Do,payload:{opponentId:a}}),ed=a=>({type:No,payload:{opponentId:a}}),Yo=async(a,e)=>{const{facebook:t,rollbar:s}=window.game;try{Qu({opponentId:a,contextId:e});const i=FBInstant.context.getID();if(i===e&&e!=="")return i;if(a==="10"&&e!=="")return e;if(e)return await t.switchAsync(e),FBInstant.context.getID()}catch(i){s.sendException(i)}return""},td=async a=>{const{battle:e,analytics:t,facebook:s,storage:i,rollbar:n}=window.game;try{const{matchId:r,opponentId:c,contextId:o}=a,l=e.getPlayerInfo();if(!l)return;const h=e.getOpponentInfo();if(!h)return;const{playerId:d,playerName:u,playerPhoto:p}=l,{playerPhoto:g}=h,f=await Yo(c,o);Fo({contextId:f});const m=await qu({playerId:d,playerPhoto:p,opponentId:c,opponentPhoto:g});Go({imageShare:m}),await s.sendMessage({cta:{default:"Play now",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${u} challenges you`,localizations:{vi_VN:`${u} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:m||"",template:"challenge",data:{type:si,matchId:r,playerId:d,opponentId:c,status:Es}}),i.dispatch(Ho(c)),t.event(G.MESSAGE,{message_content_type:"Challenge",success:!0}),ju.emit(Gu.INVITE_FRIENDS.EVENTS.INVITED_FRIEND,{type:"friend",value:1,opponentId:c})}catch(r){t.event(G.MESSAGE,{message_content_type:"Challenge",success:!1}),n.sendException(r)}},sd=async a=>{const{player:e,analytics:t,facebook:s,storage:i,rollbar:n}=window.game;try{const{matchId:r,opponentId:c,contextId:o}=a,l=await Yo(c,o);Fo({contextId:l});const h=await zu();Go({imageShare:h});const{name:d,playerId:u}=e.getPlayer();await s.sendMessage({cta:{default:"Revenge",localizations:{vi_VN:"Trả thù"}},text:{default:`${d} beat your troops!`,localizations:{vi_VN:`${d} đã đánh bại quân của bạn!`}},image:h||"",template:"pass_score",data:{type:si,matchId:r,playerId:u,opponentId:c,status:Es}}),i.dispatch(Ho(c)),t.event(G.MESSAGE,{message_content_type:"Beat",success:!0})}catch(r){t.event(G.MESSAGE,{message_content_type:"Beat",success:!1}),n.sendException(r)}},ii="player",id=a=>a[ii],nd=a=>a[ii].data,ad=a=>a[ii].connectedPlayers,rd=(a,e)=>e.limit,od=(a,e)=>e.offset,ni=j([id],a=>a),ds=j([ni],a=>a.playerId),cd=j([ni],a=>a.ASID),Jt=j([nd],a=>a);j([Jt],a=>a.settings);const Ko=j([ad],a=>a),ld=j([Ko,rd,od],(a,e,t)=>typeof e!="number"?[]:typeof t!="number"?[]:Object.keys(a).slice(t,e+t)||[]),hd=j([Jt],a=>a.customFields);class Vo extends Error{constructor(e,t){super(e,t),this.name="BadRequest",this.message=e||"This request is bad",this.payload=t}}class Ji extends Error{constructor(e,t){super(e,t),this.name="RequestTimeout",this.message=e||"This request is timeout",this.payload=t}}const{AppId:ud,Network:gn}=GameCore.Configs,dd=a=>{if(!a.ok)throw new Vo(null,{response:a})},Wo=()=>{const a=window.game.auth.getToken();return{token:a,timeout:gn.Timeout,headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}},jo=(a,e,t,s)=>async()=>{try{const i=`${a}/apps/${ud}/${e}`,n=new AbortController;t.signal=n.signal;const r=setTimeout(()=>{n.abort()},t.timeout);GameCore.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const c=await fetch(i,t);return clearTimeout(r),dd(c),await c.json()||{}}catch(i){if(i instanceof Vo)return null;throw i instanceof Object&&GameCore.Utils.Object.hasOwn(i,"name")&&i.name==="AbortError"?new Ji(null):i}},fn=async(a,e)=>{try{return a()}catch(t){if(t instanceof Ji&&e>0)try{return await iu(600),await fn(a,e-1)}catch{return{}}return t instanceof Ji?{}:(console.warn(t),{})}},ai=async(a,e={},t,s=gn.Retries)=>{if(!t)return{};try{const i={...Wo(),...e,method:"GET"},n=jo(t,a,i);return await fn(n,s)}catch(i){return console.warn(i),{}}},es=async(a,e,t={},s,i=gn.Retries)=>{if(!s)return{};try{const n={...Wo(),...t,method:"POST"},r=jo(s,a,n,e);return await fn(r,i)}catch(n){return console.warn(n),{}}},{ApiHost:Is}=GameCore.Configs,di=async a=>{try{const t=await es("matches",{opponentPlayerId:a},{},Is);return t?GameCore.Utils.Valid.isObject(t.data)?t.data:{}:{}}catch(e){return console.warn("createMatchAsync",e),{}}},pd=async()=>{try{const e=await ai("matches",{},Is);return e?e.data:[]}catch(a){return console.warn("getMatchesAsync",a),[]}},gd=async a=>{try{const e=`matches/${a}/join`,t=await es(e,{},{},Is);return t?GameCore.Utils.Valid.isObject(t.data)?t.data:{}:{}}catch(e){return console.warn("joinMatchAsync",e),{}}},fd=async a=>{try{const e=`matches/${a}`,t=await ai(e,{},Is);return t?GameCore.Utils.Valid.isObject(t.data)?t.data:{}:{}}catch(e){return console.warn("getMatchDetailByIdAsync",e),{}}},na=async(a,e)=>{try{const t=`matches/${a}/finish`,s=await es(t,{matchId:a,level:e},{},Is);return s?GameCore.Utils.Valid.isObject(s.data)?s.data:{}:{}}catch(t){return console.warn("finishMatchAsync",t),{}}},st={IDLE:"IDLE",INITIALIZING:"INITIALIZING",STARTED:"STARTED"},{MaximumMeleeLevel:Ed,MaximumRangedLevel:md}=GameCore.Configs.Gameplay,{CheaterIds:Ad}=GameCore.Configs.Gameplay;class Sd extends Phaser.Plugins.BasePlugin{status=st.IDLE;matchId;contextId;playerInfo;opponentInfo;replayOpponentId;get state(){return this.game.storage.getState()}async sendChallengeMessage(e,t){try{const s=ds(this.state);await this.updateProfiles(s,t);const i=await di(t);this.validateMatchData(i);const n=i._id;await td({contextId:e,opponentId:t,matchId:n})}catch(s){console.warn("sendChallengeMessage",s)}finally{this.playerInfo=null,this.opponentInfo=null}}async createBattle(e,t=!0){const{facebook:s,globalScene:i}=this.game;try{i.screen.open(P.NOTIFY_SCREEN,{message:i.lang.Text.LOADING,loading:!0}),this.setStatus(st.INITIALIZING);const n=ds(this.state);if(e===n)throw new Error("You can not challenge yourself");let r=null;const c=await s.getContextPlayers("");c.length>0&&c.map(({playerId:l})=>l).includes(e)&&(r=FBInstant.context.getID()),r||(r=await s.createAsync(e)),this.validateContextId(r),r===""||typeof r!="string"||await this.startBattle(r,e),t&&this.game.scene.sleep(K.GAME_SCENE),this.setStatus(st.STARTED)}catch(n){console.warn("createBattle",n),t&&this.game.scene.sleep(K.GAME_SCENE),this.setStatus(st.IDLE)}finally{t&&this.game.scene.run(K.GAME_SCENE),i.screen.close(P.NOTIFY_SCREEN)}}async continueBattle(e,t){const{globalScene:s,facebook:i}=this.game;try{s.screen.open(P.NOTIFY_SCREEN,{message:s.lang.Text.LOADING,loading:!0}),this.setStatus(st.INITIALIZING);const n=ds(this.state);if(t===n)throw new Error("You can not challenge yourself");let r=await gd(e);if("_id"in r||(r=await fd(e)),this.validateMatchData(r,e),this.matchId=e,this.contextId=i.getContextID(),r.status===js){const c=await di(t);this.validateMatchData(c),this.matchId=c._id}await this.updateProfiles(n,t),this.setStatus(st.STARTED)}catch(n){console.warn("continueBattle",n),this.setStatus(st.IDLE)}finally{s.screen.close(P.NOTIFY_SCREEN)}}async finishBattle(e){console.log("🤖 ? finishBattle",e);try{if(!this.matchId)return;if(e==="win"){await na(this.matchId,1);const{playerId:t}=this.opponentInfo||{};this.contextId&&t&&await sd({matchId:this.matchId,contextId:this.contextId,opponentId:t})}e==="lose"&&await na(this.matchId,2),this.logMatchEvent(G.MATCH_END)}catch(t){console.warn("finishBattle",t)}finally{this.matchId=null,this.contextId=null,this.playerInfo=null;const{playerId:t}=this.opponentInfo||{};this.replayOpponentId=t||this.replayOpponentId,this.opponentInfo=null,window.clientInformation.opponentIsCheater=!1,this.setStatus(st.IDLE)}}getReplayOpponentId(){return this.replayOpponentId}getPlayerInfo(){return this.playerInfo}getOpponentInfo(){return this.opponentInfo}logMatchEvent(e){const{playerLevel:t}=this.opponentInfo||{};if(!t)return;const{analytics:s}=this.game;s.event(e,{game_mode:GameCore.Utils.String.toUpperCamelCase($t),level:t,level_name:`level_${t}`})}async startBattle(e,t){try{const s=await di(t);this.validateMatchData(s);const{_id:i}=s;this.matchId=i,this.contextId=e,this.logMatchEvent(G.MATCH_START)}catch(s){console.warn("startBattleFriends",s)}}async updateProfiles(e,t){try{const{profile:s}=this.game;await s.requestProfile(e),await s.requestProfile(t);const i=s.getProfiles(),n=i[e];this.validateProfileData(n);let r=i[t]||{};console.log("opponentProfile",r),r=this.handleNewPlayerInvitation(r),this.validateProfileData(r),console.log("🤖 ? updateProfiles",n,r);const{playerUnitData:c,playerLevelProgress:o}=n.customFields||{};this.updatePlayerProfile({playerId:e,playerName:n.name,playerPhoto:n.photo?n.photo:M.AVATAR.FILE,playerLevel:o,unitData:c});const{playerUnitData:l,playerLevelProgress:h}=r.customFields||{};this.updatePlayerProfile({playerId:t,playerName:r.name,playerPhoto:r.photo?r.photo:M.AVATAR.FILE,playerLevel:h,unitData:l}),Ad.includes(t)&&(window.clientInformation.opponentIsCheater=!0)}catch(s){throw console.warn(s),new Error("Can not update profiles")}}updatePlayerProfile(e){this.playerInfo=e}updateOpponentProfile(e){this.opponentInfo=e}handleNewPlayerInvitation(e){const t=GameCore.Utils.Json.clone(e||{});if(!t.customFields){const r={MELEE:{},RANGED:{}};for(let c=1;c<=Ed;c++)r.MELEE[c]=0;for(let c=1;c<=md;c++)r.RANGED[c]=0;return t.customFields={playerUnitData:"0-0-m2-0-0/0-0-0-0-0/r1-0-0-0-0",playerLevelProgress:2},t}const{playerUnitData:s,playerLevelProgress:i}=t.customFields||{},n=i&&typeof i=="number"&&i>=2;return n||(t.customFields.playerLevelProgress=2),(!s||!n)&&(t.customFields.playerUnitData="0-0-m2-0-0/0-0-0-0-0/r1-0-0-0-0"),t}validateProfileData(e){if(!e)throw new Error("Profile is not found");const{customFields:t}=e;if(!t)throw new Error("Profile customFields is not found");const{playerUnitData:s,playerLevelProgress:i}=t||{};if(typeof i!="number")throw new Error("Player level is not found");if(typeof s!="string")throw new Error("Player unit data is not found");this.validateUnitData(s)}validateUnitData(e){const t=e.split("/");if(t.length!==3)throw new Error("Unit data segment is not valid");const s=[],i=t[0].split("-");if(i.length!==5)throw new Error("Unit data row 1 is not valid");s.push(...i);const n=t[1].split("-");if(n.length!==5)throw new Error("Unit data row 2 is not valid");s.push(...n);const r=t[2].split("-");if(r.length!==5)throw new Error("Unit data row 3 is not valid");if(s.push(...r),s.some(o=>{if(o[0]==="0")return!1;if(o[0]!=="r"&&o[0]!=="m")return!0;const l=parseInt(o.substring(1));return l<1||l>11}))throw new Error("Unit type is not valid")}validateContextId(e){if(e===!1)throw new Error("User canceled")}validateMatchData(e,t){if(console.log("🤖 ? validateMatchData",e),!e)throw new Error("Match is not found");if(!GameCore.Utils.Valid.isObject(e))throw new Error("Match is not valid");if(!("_id"in e))throw new Error("Match id is not valid");if(t&&t!==e._id)throw new Error("Match id is not matched");if(!("whitePlayerId"in e))throw new Error("Match white player id is not valid");if(!("blackPlayerId"in e))throw new Error("Match black player id is not valid")}async getMatchHistory(){try{const e=await pd(),{UseMock:t}=GameCore.Configs.Battle;if(console.log("🤖 ? getMatchHistory",e,t),t){const s=[],i=ds(this.state);if(console.log("🤖 ? getMatchHistory",i),!i)return[];for(let n=0;n<50;n++){const r=`${n+1e5}`,c=n%2===0?i:r,o=n%2===0?1:2,l=n%2===0?2:1,h={_id:`${n}`,whitePlayerId:i,blackPlayerId:r,winnerId:c,whitePlayerScore:o,blackPlayerScore:l,whitePlayerLevel:o,blackPlayerLevel:l,status:"finished",updatedAt:"2022-07-13T07:07:00.524Z"};s.push(h)}return this.validateMatchHistory(s),s}return this.validateMatchHistory(e),e}catch(e){return console.warn("getMatchHistory",e),[]}}validateMatchHistory(e){if(Array.isArray(e)===!1)throw new Error("Match history is invalid");e.forEach(t=>{if(GameCore.Utils.Valid.isObject(t)===!1)throw new Error("Match is not valid");if(!("_id"in t))throw new Error("Match id is not valid");if(!("whitePlayerId"in t))throw new Error("Match white player id is not valid");if(!("blackPlayerId"in t))throw new Error("Match black player id is not valid");if(!("status"in t))throw new Error("Match status is not valid");if(!("whitePlayerScore"in t))throw new Error("Match white player score is not valid");if(!("blackPlayerScore"in t))throw new Error("Match black player score is not valid");if(!("whitePlayerLevel"in t))throw new Error("Match white player level is not valid");if(!("blackPlayerLevel"in t))throw new Error("Match black player level is not valid");if(!("updatedAt"in t))throw new Error("Match updated at is not valid")})}setStatus(e){this.status=e}getStatus(){return this.status}}class q{baseValue;suffix;constructor(e,t,s){this.suffix=t||0,this.baseValue=Math.floor(e),!s&&(this.initValue(),this.refactorValue())}initValue(){if(this.suffix===0&&this.baseValue>=1e3){const e=this.baseValue.toString(),t=e.length-1;this.suffix=Math.floor(t/3);const s=t%3;this.suffix>=2&&(this.baseValue=parseInt(e.substring(0,4+s)));return}this.baseValue*=1e3}refactorValue(){if(this.baseValue=Math.floor(this.baseValue),this.baseValue>=1e6){this.baseValue=Math.floor(this.baseValue/1e3),this.suffix++;return}if(this.baseValue===0){this.suffix=0;return}if(this.baseValue<1e3&&this.suffix>0){this.baseValue*=1e3,this.suffix--;return}}add(e){if(e.baseValue<0){this.subtract(new q(e.baseValue*-1,e.suffix,!0));return}if(!(this.suffix-e.suffix>=2)){if(e.suffix-this.suffix>=2){this.baseValue=e.baseValue,this.suffix=e.suffix;return}if(this.suffix===e.suffix)this.baseValue+=e.baseValue;else{this.suffix=this.suffix>e.suffix?this.suffix:e.suffix;const t=this.suffix>e.suffix?this.baseValue:e.baseValue,s=this.suffix>e.suffix?e:this;this.baseValue=t+Math.floor(s.baseValue/1e3)}this.refactorValue()}}subtract(e){if(e.suffix>this.suffix){this.baseValue=0,this.suffix=0;return}if(e.baseValue>this.baseValue&&e.suffix===this.suffix){this.baseValue=0,this.suffix=0;return}this.suffix-e.suffix>=2||(this.baseValue-=Math.floor(e.baseValue/Math.pow(1e3,this.suffix-e.suffix)),this.refactorValue())}multiply(e){if(typeof e=="number"&&e<1e3){this.baseValue*=e,this.refactorValue();return}const t=typeof e=="number"?new q(e):e;this.suffix+=t.suffix,this.baseValue*=Math.floor(t.baseValue/1e3),this.refactorValue()}divide(e){if(typeof e=="number"&&e<1e3){this.baseValue/=e,this.refactorValue();return}const t=typeof e=="number"?new q(e):e;this.suffix-=t.suffix,this.baseValue/=Math.floor(t.baseValue/1e3),this.refactorValue()}clone(){return new q(this.baseValue,this.suffix,!0)}biggerThan(e){return this.suffix>e.suffix?!0:this.suffix<e.suffix?!1:this.baseValue>e.baseValue}smallerThan(e){return this.suffix<e.suffix?!0:this.suffix>e.suffix?!1:this.baseValue<e.baseValue}toString(){return`${Math.floor(this.baseValue/1e3)}${this.generateTextSuffix()}`}generateTextSuffix(){switch(this.suffix){case 0:return"";case 1:return"K";case 2:return"M";case 3:return"B";case 4:return"T";default:{const e=this.suffix-5,t=Math.floor(e/26),s=e%26,i=String.fromCharCode(t+65),n=String.fromCharCode(s+65);return`${i}${n}`}}}}class yd extends Phaser.Events.EventEmitter{emit(e,t){return super.emit(e,t)}}const $o={RECEIVED:"received"},zo="UPDATE_COINS",Xo="coins",qo=a=>a[Xo],Td=a=>qo(a).coinBaseValue,Id=a=>qo(a).coinSuffixValue,Cd=j([Td],a=>a),Rd=j([Id],a=>a),{COIN_BASE_VALUE:_d,COIN_SUFFIX:vd}=ye,Zo=(a,e)=>async t=>{try{const s=new q(a,e,!0);t(Qo(s.baseValue,s.suffix))}catch(s){const{rollbar:i}=window.game;i.sendException(s)}},wd=(a,e)=>async t=>{try{const s=new q(a,e,!0),{suffix:i,baseValue:n}=s;t(Qo(n,i));const{player:r}=window.game;r.setMultiCustomData({[vd]:i,[_d]:n})}catch(s){const{rollbar:i}=window.game;i.sendException(s)}},Qo=(a,e)=>({type:zo,payload:{coinBaseValue:a,coinSuffixValue:e}});let Ld=class extends Phaser.Plugins.BasePlugin{events;currentCoins;constructor(e){super(e),this.events=new yd}get state(){return this.game.storage.getState()}getCurrentCoins(){if(!this.currentCoins){const e=Cd(this.state),t=Rd(this.state);this.currentCoins=new q(e,t,!0)}return this.currentCoins}plusCoins(e,t){const s=new q(e,t,!0);this.currentCoins.add(s),this.updateCurrentCoins()}minusCoins(e,t){const s=new q(e,t,!0);this.currentCoins.subtract(s),this.updateCurrentCoins()}updateCurrentCoins=Ts(()=>{const{storage:e}=this.game,{baseValue:t,suffix:s}=this.currentCoins;e.dispatch(wd(t,s))},2e3);receiveCoins(e,t){const{storage:s}=this.game;s.dispatch(Zo(e,t)),this.currentCoins=new q(e,t,!0),this.events.emit($o.RECEIVED,this.currentCoins)}};const bd='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',Pd=(a,e)=>({string:"+",style:"font-size: 1px; padding: "+Math.floor(e/2)+"px "+Math.floor(a/2)+"px;"}),Od=(a,e=1)=>{const t=new Image;t.onload=function(){const s=Pd(this.width*e,this.height*e);console.info(`%c ${s.string}`,`${s.style} background: transparent url(${a}) no-repeat center center; background-size: ${this.width*e}px ${this.height*e}px;`)},t.src=a};class Dd extends Phaser.Plugins.ScenePlugin{width;height;renderOptions;canvas;preload(e){const t=Object.keys(e);t.length<1||(t.forEach(s=>{this.scene.load.image(s,e[s])}),this.scene.load.start())}async capture(e){const{width:t,height:s,renderOptions:i}=e;return this.width=t,this.height=s,this.renderOptions=i,this.createCanvas(),await this.loadImages(),this.drawObjects(),this.snapshotFrame()}createCanvas(){this.canvas||(this.canvas=this.game.textures.createCanvas("FrameCaptureCanvas")),this.canvas.clear(),this.canvas.setSize(this.width,this.height)}loadImages(){return new Promise((e,t)=>{for(const s in this.renderOptions){const{name:i,image:n}=this.renderOptions[s];!n||this.scene.textures.get(i).key===i||this.scene.load.image(i,n)}this.scene.load.on(Phaser.Loader.Events.COMPLETE,e),this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,()=>{const s=new Error("Load image failed");t(s)}),this.scene.load.start()})}drawObjects(){for(const e in this.renderOptions){const t=this.renderOptions[e];switch(t.type){case"text":this.drawText(t);break;case"image":this.drawImage(t);break}}}drawText(e){const{context:t}=this.canvas,{x:s,y:i,font:n,text:r,fillStyle:c,lineWidth:o,textAlign:l}=e;t.font=`${n} ${bd}`,t.fillStyle=c||"#ffffff",o&&(t.lineWidth=o),l&&(t.textAlign=l),t.fillText(r,s,i)}drawImage(e){const{context:t}=this.canvas,{x:s,y:i,name:n,frame:r,width:c,height:o,fallbackWithImage:l}=e;let h=this.scene.textures.get(n),d=h.getSourceImage(r);h.key==="__MISSING"&&l&&(h=this.scene.textures.get(l),d=h.getSourceImage()),t.drawImage(d,s,i,c,o)}snapshotFrame(){const e=this.canvas.getCanvas().toDataURL("image/jpeg",.85);return GameCore.Utils.Valid.isDebugger()&&Od(e),e}}class Nd extends Phaser.Events.EventEmitter{game;options;performance;isRunning=!1;checkTimer;fpsHistory;constructor(e,t,s){super(),this.game=e,this.options=s,this.performance=t}start=()=>{if(this.isRunning)return;this.isRunning=!0;const{checkInterval:e}=this.options;this.checkTimer=e,this.fpsHistory=[],this.game.events.on(Phaser.Core.Events.POST_STEP,this.onPostStep)};stop=()=>{if(!this.isRunning)return;this.isRunning=!1,this.game.events.off(Phaser.Core.Events.POST_STEP,this.onPostStep);const{onlyUpdateWhenSwitchScene:e}=this.options;e&&this.checkFps()};onPostStep=(e,t)=>{if(this.checkTimer-=t,this.checkTimer>0)return;const{checkInterval:s,onlyUpdateWhenSwitchScene:i}=this.options;this.checkTimer+=s,this.fpsHistory.push(this.game.loop.actualFps),i===!1&&this.fpsHistory.length>=5&&this.checkFps()};checkFps(){if(this.fpsHistory.length===0)return;const{autoUpgradeQuality:e}=this.options;let t=!1;this.isLowFps()?t=this.performance.downgradeGraphicsQuality():e&&this.isHighFps()&&(t=this.performance.upgradeGraphicsQuality()),t&&(this.fpsHistory=[])}getFpsMedian(){return Phaser.Math.Median(this.fpsHistory)}isLowFps(){return this.getFpsMedian()<this.options.fpsThreshold}isHighFps(){return this.getFpsMedian()>this.options.fpsThreshold*1.2}}class Md extends Phaser.Plugins.BasePlugin{fpsTracker;pixelRatio;minQuality;maxQuality;qualityAdjustStep;trackingSceneKeys=[];configure(e){const{pixelRatio:t,minQuality:s,maxQuality:i,qualityAdjustStep:n,trackingSceneKeys:r,...c}=e;this.pixelRatio=t,this.minQuality=s,this.maxQuality=i,this.qualityAdjustStep=n,this.trackingSceneKeys=r,this.fpsTracker=new Nd(this.game,this,c)}active(){this.game.events.on(Phaser.Scenes.Events.WAKE,this.trackingScene),this.game.events.on(Phaser.Scenes.Events.START,this.trackingScene)}trackingScene=e=>{if(!this.trackingSceneKeys.includes(e))return;const t=this.game.scene.getScene(e);t.events.once(Phaser.Scenes.Events.UPDATE,this.fpsTracker.start),t.events.once(Phaser.Scenes.Events.SLEEP,this.fpsTracker.stop)};downgradeGraphicsQuality(){const e=this.pixelRatio;if(e<=this.minQuality)return!1;const t=+(e-this.qualityAdjustStep).toFixed(2);return t<this.minQuality?!1:(this.pixelRatio=t,this.game.world.resize(this.pixelRatio),console.warn(`💫 Graphics quality was downgraded! (${e} -> ${t})`),!0)}upgradeGraphicsQuality(){const e=this.pixelRatio;if(e>=this.maxQuality)return!1;const t=+(e+this.qualityAdjustStep).toFixed(2);return t>this.maxQuality?!1:(this.pixelRatio=t,this.game.world.resize(this.pixelRatio),console.warn(`🚀 Graphics quality was upgraded! (${e} -> ${t})`),!0)}}const Zt={sound:!0,music:!0,vibrate:!0,speedUp:!1},{StartCoins:kd,MaximumMeleeLevel:Ud,MaximumRangedLevel:xd}=GameCore.Configs.Gameplay,{Valid:re,Object:Pe}=GameCore.Utils;class En{coins;settings;gameData;userGuideDisplays;freeCoinsLastUsedTime;offlineRewardLastCheck;constructor(e){this.setupDefaultData(),this.updateCoins(e),this.updateSettings(e),this.updateGameData(e),this.updateUserGuideDisplays(e),this.updateFreeCoinsLastUsedTime(e),this.updateOfflineRewardLastCheck(e)}setupDefaultData(){this.coins={suffix:0,baseValue:kd*1e3},this.settings={...Zt};const e={MELEE:{},RANGED:{}};for(let t=1;t<=Ud;t++)e.MELEE[t]=0;for(let t=1;t<=xd;t++)e.RANGED[t]=0;this.gameData={selectedLevel:0,playerUnitData:"0-0-0-0-0/0-0-0-0-0/0-0-m1-0-0",playerLevelProgress:0,meleeUnlockedUnitLevel:0,rangedUnlockedUnitLevel:0,unitScreenAdWatchedCount:e},this.userGuideDisplays=0,this.freeCoinsLastUsedTime=0,this.offlineRewardLastCheck=0}updateCoins(e){const{coins:t}=e;re.isObject(t)!==!1&&(Pe.hasOwn(t,"suffix")&&re.isNumber(t.suffix)&&(this.coins.suffix=t.suffix),Pe.hasOwn(t,"baseValue")&&re.isNumber(t.baseValue)&&(this.coins.baseValue=t.baseValue))}updateSettings(e){const{settings:t}=e;re.isObject(t)!==!1&&(Pe.hasOwn(t,"sound")&&re.isBoolean(t.sound)&&(this.settings.sound=t.sound),Pe.hasOwn(t,"music")&&re.isBoolean(t.music)&&(this.settings.music=t.music),Pe.hasOwn(t,"vibrate")&&re.isBoolean(t.vibrate)&&(this.settings.vibrate=t.vibrate),Pe.hasOwn(t,"speedUp")&&re.isBoolean(t.speedUp)&&(this.settings.speedUp=t.speedUp))}updateGameData(e){const{gameData:t}=e;if(re.isObject(t)!==!1&&(Pe.hasOwn(t,"selectedLevel")&&re.isNumber(t.selectedLevel)&&(this.gameData.selectedLevel=t.selectedLevel),Pe.hasOwn(t,"playerUnitData")&&re.isString(t.playerUnitData)&&this.validateUnitData(t.playerUnitData)&&(this.gameData.playerUnitData=t.playerUnitData),Pe.hasOwn(t,"playerLevelProgress")&&re.isNumber(t.playerLevelProgress)&&(this.gameData.playerLevelProgress=t.playerLevelProgress),Pe.hasOwn(t,"playerLevelProgress")&&re.isNumber(t.meleeUnlockedUnitLevel)&&(this.gameData.meleeUnlockedUnitLevel=t.meleeUnlockedUnitLevel),Pe.hasOwn(t,"rangedUnlockedUnitLevel")&&re.isNumber(t.rangedUnlockedUnitLevel)&&(this.gameData.rangedUnlockedUnitLevel=t.rangedUnlockedUnitLevel),Pe.hasOwn(t,"unitScreenAdWatchedCount")&&re.isObject(t.unitScreenAdWatchedCount))){const s=t.unitScreenAdWatchedCount;if(re.isObject(s.MELEE))for(const[i,n]of Object.entries(s.MELEE)){const r=parseInt(i);re.isNumber(r)&&re.isNumber(n)&&(this.gameData.unitScreenAdWatchedCount.MELEE[r]=n)}if(re.isObject(s.RANGED))for(const[i,n]of Object.entries(s.RANGED)){const r=parseInt(i);re.isNumber(r)&&re.isNumber(n)&&(this.gameData.unitScreenAdWatchedCount.RANGED[r]=n)}}}updateUserGuideDisplays(e){const{userGuideDisplays:t}=e;re.isNumber(t)!==!1&&(this.userGuideDisplays=t)}updateFreeCoinsLastUsedTime(e){const{freeCoinsLastUsedTime:t}=e;re.isNumber(t)!==!1&&(this.freeCoinsLastUsedTime=t)}updateOfflineRewardLastCheck(e){const{offlineRewardLastCheck:t}=e;re.isNumber(t)!==!1&&(this.offlineRewardLastCheck=t)}validateUnitData=e=>{const t=e.split("/");if(t.length!==3)return!1;const s=[],i=t[0].split("-");if(i.length!==5)return!1;s.push(...i);const n=t[1].split("-");if(n.length!==5)return!1;s.push(...n);const r=t[2].split("-");return!(r.length!==5||(s.push(...r),s.some(o=>{if(o[0]==="0")return!1;if(o[0]!=="r"&&o[0]!=="m")return!0;const l=parseInt(o.substring(1));return l<1||l>11})))};toObject(){return{coins:this.coins,settings:this.settings,gameData:this.gameData,userGuideDisplays:this.userGuideDisplays,freeCoinsLastUsedTime:this.freeCoinsLastUsedTime,offlineRewardLastCheck:this.offlineRewardLastCheck}}convertToPlayerData(){const{gameData:e}=this,{baseValue:t,suffix:s}=this.coins;return{settings:this.settings,customFields:{coinBaseValue:t,coinSuffixValue:s,freeCoinsLastUsedTime:this.freeCoinsLastUsedTime,offlineRewardLastCheck:this.offlineRewardLastCheck,selectedLevel:e.selectedLevel,playerUnitData:e.playerUnitData,playerLevelProgress:e.playerLevelProgress,meleeUnlockedUnitLevel:e.meleeUnlockedUnitLevel,rangedUnlockedUnitLevel:e.rangedUnlockedUnitLevel,unitScreenAdWatchedCount:e.unitScreenAdWatchedCount},userGuideDisplays:this.userGuideDisplays}}convertToFacebookData(e){const{settings:t,customFields:s,userGuideDisplays:i}=e,{selectedLevel:n,coinBaseValue:r,coinSuffixValue:c,freeCoinsLastUsedTime:o,offlineRewardLastCheck:l,playerUnitData:h,playerLevelProgress:d,meleeUnlockedUnitLevel:u,rangedUnlockedUnitLevel:p,unitScreenAdWatchedCount:g}=s;return this.settings=t,this.userGuideDisplays=i,this.freeCoinsLastUsedTime=o,this.offlineRewardLastCheck=l,this.coins.suffix=c,this.coins.baseValue=r,this.gameData.selectedLevel=n,this.gameData.playerUnitData=h,this.gameData.playerLevelProgress=d,this.gameData.meleeUnlockedUnitLevel=u,this.gameData.rangedUnlockedUnitLevel=p,this.gameData.unitScreenAdWatchedCount=g,this.toObject()}}const{ApiHost:Bd}=GameCore.Configs,ri=async a=>{},Fd=async a=>(await es(`players/${a}/user-guide-displays/inc`,{},{},Bd))?.data||{},Jo="PLAYER_RECEIVED",ec="PLAYER_DATA_UPDATE",tc="PLAYER_SCORE_UPDATE",sc="PLAYER_PROFILE_UPDATE",ic="PLAYER_SETTING_UPDATE",nc="PLAYER_CONNECTED_PLAYERS_UPDATE";class ac extends Error{payload;constructor(e,t){super(e),this.name="PlayerDataNameNotSupport",this.message=e||"The name of player data is not supported",this.payload=t||{}}}const bt=a=>{try{const e=localStorage.getItem(a);return e===null?null:GameCore.Utils.Json.decode(e)}catch{return null}},Pt=(a,e)=>{try{const t=bt(a);let s={};GameCore.Utils.Valid.isObject(t)&&(s=t);const i=GameCore.Utils.Json.clone(e);if(!GameCore.Utils.Valid.isObject(i))return!1;const n=GameCore.Utils.Object.clear(i),r=Me(s,n),c=GameCore.Utils.Json.encode(r);return localStorage.setItem(a,c),!0}catch{return!1}},{AppId:aa}=GameCore.Configs,Gd=(a,e)=>t=>{const{playerId:s,name:i,photo:n,locale:r}=a;t({type:Jo,payload:{playerId:s,name:i,photo:n,locale:r,data:e||{}}})},Hd=()=>async a=>{try{const{facebook:e}=window.game,t=await new Promise((n,r)=>{e.once("players",c=>{n(c)}),e.once("playersfail",()=>r([])),e.getPlayers()}),s=n=>!!n,i=t.map(n=>{const r=n.getID(),c=n.getName(),o=n.getPhoto();return!r||!c||!o?null:new fs(r,c,o).toObject()}).filter(s);if(i.length<1)return;a(rc(i))}catch(e){me(e)}},rc=a=>({type:nc,payload:{connectedPlayers:a}}),Yd=(a,e)=>(t,s)=>{try{let i=s();t({type:ic,payload:{name:a,value:e}}),i=s();const n=Jt(i),r=new En({}).convertToFacebookData(n);FBInstant.player.setDataAsync(r)}catch(i){me(i)}},Kd=()=>async(a,e)=>{try{const t=e(),s=ni(t),{playerId:i,name:n,photo:r,locale:c}=s,o=await FBInstant.player.getASIDAsync();a({type:sc,payload:{profile:{appId:aa,playerId:i,name:n,photo:r,locale:c,ASID:o}}}),await ri({appId:aa,playerId:i,name:n,photo:r,locale:c,ASID:o})}catch(t){me(t)}},Vd=(a,e)=>async(t,s)=>{try{console.info("🚀 > setPlayerCustomData",{name:a,data:e});const i={customFields:{[a]:e}};await t(mn(i));const n=s(),c={...Jt(n)};ri(c)}catch(i){if(i instanceof ac)return;me(i)}},Wd=a=>async(e,t)=>{try{console.info("🚀 > setMultiCustomData",a),await e(mn({customFields:a}));const i=t(),r={...Jt(i)};ri(r)}catch(s){if(console.log("🤖 ? error",s),s instanceof ac)return;me(s)}},mn=a=>e=>{try{e({type:ec,payload:{data:a}})}catch(t){me(t)}},jd=()=>async(a,e)=>{try{const{facebook:t}=window.game;a(mn({userGuideDisplays:1}));const s=e(),i=ds(s);await Fd(i),t.data.set("userGuideDisplays",1)}catch(t){me(t)}},ra=a=>async(e,t)=>{try{await e({type:tc,payload:{score:a}}),ri({score:a});const s=t(),n={...Jt(s)};Pt(GameCore.Configs.PlayerDataStore,n)}catch(s){me(s)}},{COIN_BASE_VALUE:$d,COIN_SUFFIX:zd}=ye;class Xd extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async incUserGuideDisplays(){const{storage:e}=this.game;await e.dispatch(jd())}receiveData(e,t){const{storage:s}=this.game;s.dispatch(Gd(e,t))}async updateData(){const{storage:e}=this.game;await e.dispatch(Kd())}async updateBestScore(e){const t=this.getBestScore();if(e<=t)return;const{storage:s}=this.game;await s.dispatch(ra(e))}async setScore(e){const{storage:t}=this.game;await t.dispatch(ra(e))}async setSetting(e,t){const{storage:s}=this.game;await s.dispatch(Yd(e,t))}async setCustomData(e,t){const{storage:s}=this.game;await s.dispatch(Vd(e,t))}async setMultiCustomData(e){const{storage:t}=this.game;await t.dispatch(Wd(e))}async requestConnectedPlayers(){const{storage:e}=this.game;await e.dispatch(Hd())}async updateConnectedPlayers(e){const{storage:t}=this.game;await t.dispatch(rc(e))}getPlayer(){return ni(this.state)}getPlayerId(){return this.getPlayer().playerId}getPlayerASID(){return cd(this.state)}getPlayerData(){return this.getPlayer().data}getPlayerSetting(e){const t=this.getPlayerSettings();return typeof e!="string"?null:GameCore.Utils.Object.hasOwn(t,e)?t[e]:GameCore.Utils.Object.hasOwn(Zt,e)?Zt[e]:null}getPlayerSettings(){return this.getPlayerData().settings}getPlayerIsNew(){return this.getPlayer().isUserNew}getCoins(){const e=this.getCustomData($d),t=this.getCustomData(zd);return!GameCore.Utils.Valid.isNumber(e)||!GameCore.Utils.Valid.isNumber(t)?0:new q(e,t,!0)}getDiamond(){const e=this.getCustomData("diamond");return GameCore.Utils.Valid.isNumber(e)?e:0}getCustomData(e){const t=hd(this.state);return!GameCore.Utils.Valid.isObject(t)||!GameCore.Utils.Object.hasOwn(t,e)?null:t[e]}getConnectedPlayers(){return Ko(this.state)}getConnectedPlayerIds(e,t){return ld(this.state,{limit:e,offset:t})}getBestScore(){return 0}}const{ApiHost:oc}=GameCore.Configs,qd=async a=>{const e=GameCore.Utils.String.params(a);return(await ai(`players?${e}`,{},oc))?.data||[]},Zd=async a=>(await ai(`players/${a}`,{},oc))?.data||[],An="PROFILES_DATA_UPDATE",Sn="profile",Qd=a=>a[Sn].data,Jd=a=>a[Sn].profileIds,ep=j([Qd],a=>a),tp=j([Jd],a=>a),sp=a=>async(e,t)=>{try{const s=t(),i=tp(s),n=GameCore.Utils.Array.difference(a,i);if(n.length<1)return;const r=await qd({playerIds:n});e({type:An,payload:{data:r}})}catch(s){me(s)}},ip=a=>async e=>{try{const t=await Zd(a);e({type:An,payload:{data:[t]}})}catch(t){me(t)}};class np extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async requestProfiles(e){const{storage:t}=this.game;await t.dispatch(sp(e))}async requestProfile(e){const{storage:t}=this.game;await t.dispatch(ip(e))}getProfiles(){return ep(this.state)}}var en={},ap={get exports(){return en},set exports(a){en=a}};(function(a,e){(function(t,s){a.exports=s()})(Bo,function(){return function(t){var s={};function i(n){if(s[n])return s[n].exports;var r=s[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=s,i.d=function(n,r,c){i.o(n,r)||Object.defineProperty(n,r,{enumerable:!0,get:c})},i.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},i.t=function(n,r){if(1&r&&(n=i(n)),8&r||4&r&&typeof n=="object"&&n&&n.__esModule)return n;var c=Object.create(null);if(i.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:n}),2&r&&typeof n!="string")for(var o in n)i.d(c,o,function(l){return n[l]}.bind(null,o));return c},i.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return i.d(r,"a",r),r},i.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)},i.p="",i(i.s=6)}([function(t,s,i){var n=i(12),r={};function c(T,R){return R===o(T)}function o(T){var R=typeof T;return R!=="object"?R:T?T instanceof Error?"error":{}.toString.call(T).match(/\s([a-zA-Z]+)/)[1].toLowerCase():"null"}function l(T){return c(T,"function")}function h(T){var R=Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),b=RegExp("^"+R+"$");return d(T)&&b.test(T)}function d(T){var R=typeof T;return T!=null&&(R=="object"||R=="function")}function u(){var T=I();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(R){var b=(T+16*Math.random())%16|0;return T=Math.floor(T/16),(R==="x"?b:7&b|8).toString(16)})}var p={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};function g(T,R){var b,w;try{b=r.stringify(T)}catch(C){if(R&&l(R))try{b=R(T)}catch(v){w=v}else w=C}return{error:w,value:b}}function f(T,R){return function(b,w){try{R(b,w)}catch(C){T.error(C)}}}function m(T){return function R(b,w){var C,v,N,B={};try{for(v in b)(C=b[v])&&(c(C,"object")||c(C,"array"))?w.includes(C)?B[v]="Removed circular reference: "+o(C):((N=w.slice()).push(C),B[v]=R(C,N)):B[v]=C}catch(x){B="Failed cloning custom data: "+x.message}return B}(T,[T])}var E=["log","network","dom","navigation","error","manual"],A=["critical","error","warning","info","debug"];function S(T,R){for(var b=0;b<T.length;++b)if(T[b]===R)return!0;return!1}function I(){return Date.now?+Date.now():+new Date}t.exports={addParamsAndAccessTokenToPath:function(T,R,b){(b=b||{}).access_token=T;var w,C=[];for(w in b)Object.prototype.hasOwnProperty.call(b,w)&&C.push([w,b[w]].join("="));var v="?"+C.sort().join("&");(R=R||{}).path=R.path||"";var N,B=R.path.indexOf("?"),x=R.path.indexOf("#");B!==-1&&(x===-1||x>B)?(N=R.path,R.path=N.substring(0,B)+v+"&"+N.substring(B+1)):x!==-1?(N=R.path,R.path=N.substring(0,x)+v+N.substring(x)):R.path=R.path+v},createItem:function(T,R,b,w,C){for(var v,N,B,x,H,Y,Z=[],ce=[],Ae=0,ie=T.length;Ae<ie;++Ae){var nt=o(Y=T[Ae]);switch(ce.push(nt),nt){case"undefined":break;case"string":v?Z.push(Y):v=Y;break;case"function":x=f(R,Y);break;case"date":Z.push(Y);break;case"error":case"domexception":case"exception":N?Z.push(Y):N=Y;break;case"object":case"array":if(Y instanceof Error||typeof DOMException<"u"&&Y instanceof DOMException){N?Z.push(Y):N=Y;break}if(w&&nt==="object"&&!H){for(var be=0,ns=w.length;be<ns;++be)if(Y[w[be]]!==void 0){H=Y;break}if(H)break}B?Z.push(Y):B=Y;break;default:if(Y instanceof Error||typeof DOMException<"u"&&Y instanceof DOMException){N?Z.push(Y):N=Y;break}Z.push(Y)}}B&&(B=m(B)),Z.length>0&&(B||(B=m({})),B.extraArgs=m(Z));var Xe={message:v,err:N,custom:B,timestamp:I(),callback:x,notifier:b,diagnostic:{},uuid:u()};return function(as,xe){xe&&xe.level!==void 0&&(as.level=xe.level,delete xe.level),xe&&xe.skipFrames!==void 0&&(as.skipFrames=xe.skipFrames,delete xe.skipFrames)}(Xe,B),w&&H&&(Xe.request=H),C&&(Xe.lambdaContext=C),Xe._originalArgs=T,Xe.diagnostic.original_arg_types=ce,Xe},addErrorContext:function(T,R){var b=T.data.custom||{},w=!1;try{for(var C=0;C<R.length;++C)R[C].hasOwnProperty("rollbarContext")&&(b=n(b,m(R[C].rollbarContext)),w=!0);w&&(T.data.custom=b)}catch(v){T.diagnostic.error_context="Failed: "+v.message}},createTelemetryEvent:function(T){for(var R,b,w,C,v=0,N=T.length;v<N;++v)switch(o(C=T[v])){case"string":!R&&S(E,C)?R=C:!w&&S(A,C)&&(w=C);break;case"object":b=C}return{type:R||"manual",metadata:b||{},level:w}},filterIp:function(T,R){if(T&&T.user_ip&&R!==!0){var b=T.user_ip;if(R)try{var w;if(b.indexOf(".")!==-1)(w=b.split(".")).pop(),w.push("0"),b=w.join(".");else if(b.indexOf(":")!==-1){if((w=b.split(":")).length>2){var C=w.slice(0,3),v=C[2].indexOf("/");v!==-1&&(C[2]=C[2].substring(0,v)),b=C.concat("0000:0000:0000:0000:0000").join(":")}}else b=null}catch{b=null}else b=null;T.user_ip=b}},formatArgsAsString:function(T){var R,b,w,C=[];for(R=0,b=T.length;R<b;++R){switch(o(w=T[R])){case"object":(w=(w=g(w)).error||w.value).length>500&&(w=w.substr(0,497)+"...");break;case"null":w="null";break;case"undefined":w="undefined";break;case"symbol":w=w.toString()}C.push(w)}return C.join(" ")},formatUrl:function(T,R){if(!(R=R||T.protocol)&&T.port&&(T.port===80?R="http:":T.port===443&&(R="https:")),R=R||"https:",!T.hostname)return null;var b=R+"//"+T.hostname;return T.port&&(b=b+":"+T.port),T.path&&(b+=T.path),b},get:function(T,R){if(T){var b=R.split("."),w=T;try{for(var C=0,v=b.length;C<v;++C)w=w[b[C]]}catch{w=void 0}return w}},handleOptions:function(T,R,b,w){var C=n(T,R,b);return C=function(v,N){return v.hostWhiteList&&!v.hostSafeList&&(v.hostSafeList=v.hostWhiteList,v.hostWhiteList=void 0,N&&N.log("hostWhiteList is deprecated. Use hostSafeList.")),v.hostBlackList&&!v.hostBlockList&&(v.hostBlockList=v.hostBlackList,v.hostBlackList=void 0,N&&N.log("hostBlackList is deprecated. Use hostBlockList.")),v}(C,w),!R||R.overwriteScrubFields||R.scrubFields&&(C.scrubFields=(T.scrubFields||[]).concat(R.scrubFields)),C},isError:function(T){return c(T,"error")||c(T,"exception")},isFiniteNumber:function(T){return Number.isFinite(T)},isFunction:l,isIterable:function(T){var R=o(T);return R==="object"||R==="array"},isNativeFunction:h,isObject:d,isString:function(T){return typeof T=="string"||T instanceof String},isType:c,isPromise:function(T){return d(T)&&c(T.then,"function")},jsonParse:function(T){var R,b;try{R=r.parse(T)}catch(w){b=w}return{error:b,value:R}},LEVELS:{debug:0,info:1,warning:2,error:3,critical:4},makeUnhandledStackInfo:function(T,R,b,w,C,v,N,B){var x={url:R||"",line:b,column:w};x.func=B.guessFunctionName(x.url,x.line),x.context=B.gatherContext(x.url,x.line);var H=typeof document<"u"&&document&&document.location&&document.location.href,Y=typeof window<"u"&&window&&window.navigator&&window.navigator.userAgent;return{mode:v,message:C?String(C):T||N,url:H,stack:[x],useragent:Y}},merge:n,now:I,redact:function(){return"********"},RollbarJSON:r,sanitizeUrl:function(T){var R=function(b){if(c(b,"string")){for(var w=p,C=w.parser[w.strictMode?"strict":"loose"].exec(b),v={},N=0,B=w.key.length;N<B;++N)v[w.key[N]]=C[N]||"";return v[w.q.name]={},v[w.key[12]].replace(w.q.parser,function(x,H,Y){H&&(v[w.q.name][H]=Y)}),v}}(T);return R?(R.anchor===""&&(R.source=R.source.replace("#","")),T=R.source.replace("?"+R.query,"")):"(unknown)"},set:function(T,R,b){if(T){var w=R.split("."),C=w.length;if(!(C<1))if(C!==1)try{for(var v=T[w[0]]||{},N=v,B=1;B<C-1;++B)v[w[B]]=v[w[B]]||{},v=v[w[B]];v[w[C-1]]=b,T[w[0]]=N}catch{return}else T[w[0]]=b}},setupJSON:function(T){l(r.stringify)&&l(r.parse)||(c(JSON,"undefined")||(T?(h(JSON.stringify)&&(r.stringify=JSON.stringify),h(JSON.parse)&&(r.parse=JSON.parse)):(l(JSON.stringify)&&(r.stringify=JSON.stringify),l(JSON.parse)&&(r.parse=JSON.parse))),l(r.stringify)&&l(r.parse)||T&&T(r))},stringify:g,maxByteSize:function(T){for(var R=0,b=T.length,w=0;w<b;w++){var C=T.charCodeAt(w);C<128?R+=1:C<2048?R+=2:C<65536&&(R+=3)}return R},typeName:o,uuid4:u}},function(t,s,i){i(17);var n=i(18),r=i(0);t.exports={error:function(){var c=Array.prototype.slice.call(arguments,0);c.unshift("Rollbar:"),n.ieVersion()<=8?console.error(r.formatArgsAsString(c)):console.error.apply(console,c)},info:function(){var c=Array.prototype.slice.call(arguments,0);c.unshift("Rollbar:"),n.ieVersion()<=8?console.info(r.formatArgsAsString(c)):console.info.apply(console,c)},log:function(){var c=Array.prototype.slice.call(arguments,0);c.unshift("Rollbar:"),n.ieVersion()<=8?console.log(r.formatArgsAsString(c)):console.log.apply(console,c)}}},function(t,s,i){t.exports={parse:function(n){var r,c,o={protocol:null,auth:null,host:null,path:null,hash:null,href:n,hostname:null,port:null,pathname:null,search:null,query:null};if((r=n.indexOf("//"))!==-1?(o.protocol=n.substring(0,r),c=r+2):c=0,(r=n.indexOf("@",c))!==-1&&(o.auth=n.substring(c,r),c=r+1),(r=n.indexOf("/",c))===-1){if((r=n.indexOf("?",c))===-1)return(r=n.indexOf("#",c))===-1?o.host=n.substring(c):(o.host=n.substring(c,r),o.hash=n.substring(r)),o.hostname=o.host.split(":")[0],o.port=o.host.split(":")[1],o.port&&(o.port=parseInt(o.port,10)),o;o.host=n.substring(c,r),o.hostname=o.host.split(":")[0],o.port=o.host.split(":")[1],o.port&&(o.port=parseInt(o.port,10)),c=r}else o.host=n.substring(c,r),o.hostname=o.host.split(":")[0],o.port=o.host.split(":")[1],o.port&&(o.port=parseInt(o.port,10)),c=r;if((r=n.indexOf("#",c))===-1?o.path=n.substring(c):(o.path=n.substring(c,r),o.hash=n.substring(r)),o.path){var l=o.path.split("?");o.pathname=l[0],o.query=l[1],o.search=o.query?"?"+o.query:null}return o}}},function(t,s,i){var n=i(24),r=new RegExp("^(([a-zA-Z0-9-_$ ]*): *)?(Uncaught )?([a-zA-Z0-9-_$ ]*): ");function c(){return null}function o(d){var u={};return u._stackFrame=d,u.url=d.fileName,u.line=d.lineNumber,u.func=d.functionName,u.column=d.columnNumber,u.args=d.args,u.context=null,u}function l(d,u){return{stack:function(){var p=[];u=u||0;try{p=n.parse(d)}catch{p=[]}for(var g=[],f=u;f<p.length;f++)g.push(new o(p[f]));return g}(),message:d.message,name:h(d),rawStack:d.stack,rawException:d}}function h(d){var u=d.name&&d.name.length&&d.name,p=d.constructor.name&&d.constructor.name.length&&d.constructor.name;return u&&p?u==="Error"?p:u:u||p}t.exports={guessFunctionName:function(){return"?"},guessErrorClass:function(d){if(!d||!d.match)return["Unknown error. There was no error message to display.",""];var u=d.match(r),p="(unknown)";return u&&(p=u[u.length-1],d=(d=d.replace((u[u.length-2]||"")+p+":","")).replace(/(^[\s]+|[\s]+$)/g,"")),[p,d]},gatherContext:c,parse:function(d,u){var p=d;if(p.nested||p.cause){for(var g=[];p;)g.push(new l(p,u)),p=p.nested||p.cause,u=0;return g[0].traceChain=g,g[0]}return new l(p,u)},Stack:l,Frame:o}},function(t,s,i){var n=i(0),r=i(5);function c(o,l){var h=l.split("."),d=h.length-1;try{for(var u=0;u<=d;++u)u<d?o=o[h[u]]:o[h[u]]=n.redact()}catch{}}t.exports=function(o,l,h){if(l=l||[],h)for(var d=0;d<h.length;++d)c(o,h[d]);var u=function(f){for(var m,E=[],A=0;A<f.length;++A)m="^\\[?(%5[bB])?"+f[A]+"\\[?(%5[bB])?\\]?(%5[dD])?$",E.push(new RegExp(m,"i"));return E}(l),p=function(f){for(var m,E=[],A=0;A<f.length;++A)m="\\[?(%5[bB])?"+f[A]+"\\[?(%5[bB])?\\]?(%5[dD])?",E.push(new RegExp("("+m+"=)([^&\\n]+)","igm"));return E}(l);function g(f,m){return m+n.redact()}return r(o,function f(m,E,A){var S=function(I,T){var R;for(R=0;R<u.length;++R)if(u[R].test(I)){T=n.redact();break}return T}(m,E);return S===E?n.isType(E,"object")||n.isType(E,"array")?r(E,f,A):function(I){var T;if(n.isType(I,"string"))for(T=0;T<p.length;++T)I=I.replace(p[T],g);return I}(S):S})}},function(t,s,i){var n=i(0);t.exports=function(r,c,o){var l,h,d,u,p=n.isType(r,"object"),g=n.isType(r,"array"),f=[];if(o=o||{obj:[],mapped:[]},p){if(u=o.obj.indexOf(r),p&&u!==-1)return o.mapped[u]||o.obj[u];o.obj.push(r),u=o.obj.length-1}if(p)for(l in r)Object.prototype.hasOwnProperty.call(r,l)&&f.push(l);else if(g)for(d=0;d<r.length;++d)f.push(d);var m=p?{}:[],E=!0;for(d=0;d<f.length;++d)h=r[l=f[d]],m[l]=c(l,h,o),E=E&&m[l]===r[l];return p&&!E&&(o.mapped[u]=m),E?r:m}},function(t,s,i){t.exports=i(7)},function(t,s,i){var n=i(8),r=typeof window<"u"&&window._rollbarConfig,c=r&&r.globalAlias||"Rollbar",o=typeof window<"u"&&window[c]&&typeof window[c].shimId=="function"&&window[c].shimId()!==void 0;if(typeof window>"u"||window._rollbarStartTime||(window._rollbarStartTime=new Date().getTime()),!o&&r){var l=new n(r);window[c]=l}else typeof window<"u"?(window.rollbar=n,window._rollbarDidLoad=!0):typeof self<"u"&&(self.rollbar=n,self._rollbarDidLoad=!0);t.exports=n},function(t,s,i){var n=i(9),r=i(31),c=i(32),o=i(35),l=i(37),h=i(4),d=i(38);n.setComponents({telemeter:r,instrumenter:c,polyfillJSON:o,wrapGlobals:l,scrub:h,truncation:d}),t.exports=n},function(t,s,i){var n=i(10),r=i(0),c=i(15),o=i(1),l=i(19),h=i(20),d=i(2),u=i(23),p=i(26),g=i(27),f=i(28),m=i(3);function E(C,v){this.options=r.handleOptions(w,C,null,o),this.options._configuredOptions=C;var N=this.components.telemeter,B=this.components.instrumenter,x=this.components.polyfillJSON;this.wrapGlobals=this.components.wrapGlobals,this.scrub=this.components.scrub;var H=this.components.truncation,Y=new h(H),Z=new c(this.options,Y,d,H);N&&(this.telemeter=new N(this.options)),this.client=v||new n(this.options,Z,o,this.telemeter,"browser");var ce=T(),Ae=typeof document<"u"&&document;this.isChrome=ce.chrome&&ce.chrome.runtime,this.anonymousErrorsPending=0,function(ie,nt,be){ie.addTransform(u.handleDomException).addTransform(u.handleItemWithError).addTransform(u.ensureItemHasSomethingToSay).addTransform(u.addBaseInfo).addTransform(u.addRequestInfo(be)).addTransform(u.addClientInfo(be)).addTransform(u.addPluginInfo(be)).addTransform(u.addBody).addTransform(p.addMessageWithError).addTransform(p.addTelemetryData).addTransform(p.addConfigToPayload).addTransform(u.addScrubber(nt.scrub)).addTransform(p.addPayloadOptions).addTransform(p.userTransform(o)).addTransform(p.addConfiguredOptions).addTransform(p.addDiagnosticKeys).addTransform(p.itemToPayload)}(this.client.notifier,this,ce),this.client.queue.addPredicate(f.checkLevel).addPredicate(g.checkIgnore).addPredicate(f.userCheckIgnore(o)).addPredicate(f.urlIsNotBlockListed(o)).addPredicate(f.urlIsSafeListed(o)).addPredicate(f.messageIsIgnored(o)),this.setupUnhandledCapture(),B&&(this.instrumenter=new B(this.options,this.client.telemeter,this,ce,Ae),this.instrumenter.instrument()),r.setupJSON(x)}var A=null;function S(C){var v="Rollbar is not initialized";o.error(v),C&&C(new Error(v))}function I(C){for(var v=0,N=C.length;v<N;++v)if(r.isFunction(C[v]))return C[v]}function T(){return typeof window<"u"&&window||typeof self<"u"&&self}E.init=function(C,v){return A?A.global(C).configure(C):A=new E(C,v)},E.prototype.components={},E.setComponents=function(C){E.prototype.components=C},E.prototype.global=function(C){return this.client.global(C),this},E.global=function(C){if(A)return A.global(C);S()},E.prototype.configure=function(C,v){var N=this.options,B={};return v&&(B={payload:v}),this.options=r.handleOptions(N,C,B,o),this.options._configuredOptions=r.handleOptions(N._configuredOptions,C,B),this.client.configure(this.options,v),this.instrumenter&&this.instrumenter.configure(this.options),this.setupUnhandledCapture(),this},E.configure=function(C,v){if(A)return A.configure(C,v);S()},E.prototype.lastError=function(){return this.client.lastError},E.lastError=function(){if(A)return A.lastError();S()},E.prototype.log=function(){var C=this._createItem(arguments),v=C.uuid;return this.client.log(C),{uuid:v}},E.log=function(){if(A)return A.log.apply(A,arguments);var C=I(arguments);S(C)},E.prototype.debug=function(){var C=this._createItem(arguments),v=C.uuid;return this.client.debug(C),{uuid:v}},E.debug=function(){if(A)return A.debug.apply(A,arguments);var C=I(arguments);S(C)},E.prototype.info=function(){var C=this._createItem(arguments),v=C.uuid;return this.client.info(C),{uuid:v}},E.info=function(){if(A)return A.info.apply(A,arguments);var C=I(arguments);S(C)},E.prototype.warn=function(){var C=this._createItem(arguments),v=C.uuid;return this.client.warn(C),{uuid:v}},E.warn=function(){if(A)return A.warn.apply(A,arguments);var C=I(arguments);S(C)},E.prototype.warning=function(){var C=this._createItem(arguments),v=C.uuid;return this.client.warning(C),{uuid:v}},E.warning=function(){if(A)return A.warning.apply(A,arguments);var C=I(arguments);S(C)},E.prototype.error=function(){var C=this._createItem(arguments),v=C.uuid;return this.client.error(C),{uuid:v}},E.error=function(){if(A)return A.error.apply(A,arguments);var C=I(arguments);S(C)},E.prototype.critical=function(){var C=this._createItem(arguments),v=C.uuid;return this.client.critical(C),{uuid:v}},E.critical=function(){if(A)return A.critical.apply(A,arguments);var C=I(arguments);S(C)},E.prototype.buildJsonPayload=function(C){return this.client.buildJsonPayload(C)},E.buildJsonPayload=function(){if(A)return A.buildJsonPayload.apply(A,arguments);S()},E.prototype.sendJsonPayload=function(C){return this.client.sendJsonPayload(C)},E.sendJsonPayload=function(){if(A)return A.sendJsonPayload.apply(A,arguments);S()},E.prototype.setupUnhandledCapture=function(){var C=T();this.unhandledExceptionsInitialized||(this.options.captureUncaught||this.options.handleUncaughtExceptions)&&(l.captureUncaughtExceptions(C,this),this.wrapGlobals&&this.options.wrapGlobalEventHandlers&&this.wrapGlobals(C,this),this.unhandledExceptionsInitialized=!0),this.unhandledRejectionsInitialized||(this.options.captureUnhandledRejections||this.options.handleUnhandledRejections)&&(l.captureUnhandledRejections(C,this),this.unhandledRejectionsInitialized=!0)},E.prototype.handleUncaughtException=function(C,v,N,B,x,H){if(this.options.captureUncaught||this.options.handleUncaughtExceptions){if(this.options.inspectAnonymousErrors&&this.isChrome&&x===null&&v==="")return"anonymous";var Y,Z=r.makeUnhandledStackInfo(C,v,N,B,x,"onerror","uncaught exception",m);r.isError(x)?(Y=this._createItem([C,x,H]))._unhandledStackInfo=Z:r.isError(v)?(Y=this._createItem([C,v,H]))._unhandledStackInfo=Z:(Y=this._createItem([C,H])).stackInfo=Z,Y.level=this.options.uncaughtErrorLevel,Y._isUncaught=!0,this.client.log(Y)}},E.prototype.handleAnonymousErrors=function(){if(this.options.inspectAnonymousErrors&&this.isChrome){var C=this;try{Error.prepareStackTrace=function(v,N){if(C.options.inspectAnonymousErrors&&C.anonymousErrorsPending){if(C.anonymousErrorsPending-=1,!v)return;v._isAnonymous=!0,C.handleUncaughtException(v.message,null,null,null,v)}return v.stack}}catch(v){this.options.inspectAnonymousErrors=!1,this.error("anonymous error handler failed",v)}}},E.prototype.handleUnhandledRejection=function(C,v){if(this.options.captureUnhandledRejections||this.options.handleUnhandledRejections){var N="unhandled rejection was null or undefined!";if(C)if(C.message)N=C.message;else{var B=r.stringify(C);B.value&&(N=B.value)}var x,H=C&&C._rollbarContext||v&&v._rollbarContext;r.isError(C)?x=this._createItem([N,C,H]):(x=this._createItem([N,C,H])).stackInfo=r.makeUnhandledStackInfo(N,"",0,0,null,"unhandledrejection","",m),x.level=this.options.uncaughtErrorLevel,x._isUncaught=!0,x._originalArgs=x._originalArgs||[],x._originalArgs.push(v),this.client.log(x)}},E.prototype.wrap=function(C,v,N){try{var B;if(B=r.isFunction(v)?v:function(){return v||{}},!r.isFunction(C)||C._isWrap)return C;if(!C._rollbar_wrapped&&(C._rollbar_wrapped=function(){N&&r.isFunction(N)&&N.apply(this,arguments);try{return C.apply(this,arguments)}catch(Y){var H=Y;throw H&&window._rollbarWrappedError!==H&&(r.isType(H,"string")&&(H=new String(H)),H._rollbarContext=B()||{},H._rollbarContext._wrappedSource=C.toString(),window._rollbarWrappedError=H),H}},C._rollbar_wrapped._isWrap=!0,C.hasOwnProperty))for(var x in C)C.hasOwnProperty(x)&&x!=="_rollbar_wrapped"&&(C._rollbar_wrapped[x]=C[x]);return C._rollbar_wrapped}catch{return C}},E.wrap=function(C,v){if(A)return A.wrap(C,v);S()},E.prototype.captureEvent=function(){var C=r.createTelemetryEvent(arguments);return this.client.captureEvent(C.type,C.metadata,C.level)},E.captureEvent=function(){if(A)return A.captureEvent.apply(A,arguments);S()},E.prototype.captureDomContentLoaded=function(C,v){return v||(v=new Date),this.client.captureDomContentLoaded(v)},E.prototype.captureLoad=function(C,v){return v||(v=new Date),this.client.captureLoad(v)},E.prototype.loadFull=function(){o.info("Unexpected Rollbar.loadFull() called on a Notifier instance. This can happen when Rollbar is loaded multiple times.")},E.prototype._createItem=function(C){return r.createItem(C,o,this)};var R=i(29),b=i(30),w={version:R.version,scrubFields:b.scrubFields,logLevel:R.logLevel,reportLevel:R.reportLevel,uncaughtErrorLevel:R.uncaughtErrorLevel,endpoint:R.endpoint,verbose:!1,enabled:!0,transmit:!0,sendConfig:!1,includeItemsInTelemetry:!0,captureIp:!0,inspectAnonymousErrors:!0,ignoreDuplicateErrors:!0,wrapGlobalEventHandlers:!1};t.exports=E},function(t,s,i){var n=i(11),r=i(13),c=i(14),o=i(0);function l(u,p,g,f,m){this.options=o.merge(u),this.logger=g,l.rateLimiter.configureGlobal(this.options),l.rateLimiter.setPlatformOptions(m,this.options),this.api=p,this.queue=new r(l.rateLimiter,p,g,this.options);var E=this.options.tracer||null;d(E)?(this.tracer=E,this.options.tracer="opentracing-tracer-enabled",this.options._configuredOptions.tracer="opentracing-tracer-enabled"):this.tracer=null,this.notifier=new c(this.queue,this.options),this.telemeter=f,h(u),this.lastError=null,this.lastErrorHash="none"}function h(u){u.stackTraceLimit&&(Error.stackTraceLimit=u.stackTraceLimit)}function d(u){if(!u||!u.scope||typeof u.scope!="function")return!1;var p=u.scope();return!(!p||!p.active||typeof p.active!="function")}l.rateLimiter=new n({maxItems:0,itemsPerMinute:60}),l.prototype.global=function(u){return l.rateLimiter.configureGlobal(u),this},l.prototype.configure=function(u,p){var g=this.options,f={};p&&(f={payload:p}),this.options=o.merge(g,u,f);var m=this.options.tracer||null;return d(m)?(this.tracer=m,this.options.tracer="opentracing-tracer-enabled",this.options._configuredOptions.tracer="opentracing-tracer-enabled"):this.tracer=null,this.notifier&&this.notifier.configure(this.options),this.telemeter&&this.telemeter.configure(this.options),h(u),this.global(this.options),d(u.tracer)&&(this.tracer=u.tracer),this},l.prototype.log=function(u){var p=this._defaultLogLevel();return this._log(p,u)},l.prototype.debug=function(u){this._log("debug",u)},l.prototype.info=function(u){this._log("info",u)},l.prototype.warn=function(u){this._log("warning",u)},l.prototype.warning=function(u){this._log("warning",u)},l.prototype.error=function(u){this._log("error",u)},l.prototype.critical=function(u){this._log("critical",u)},l.prototype.wait=function(u){this.queue.wait(u)},l.prototype.captureEvent=function(u,p,g){return this.telemeter&&this.telemeter.captureEvent(u,p,g)},l.prototype.captureDomContentLoaded=function(u){return this.telemeter&&this.telemeter.captureDomContentLoaded(u)},l.prototype.captureLoad=function(u){return this.telemeter&&this.telemeter.captureLoad(u)},l.prototype.buildJsonPayload=function(u){return this.api.buildJsonPayload(u)},l.prototype.sendJsonPayload=function(u){this.api.postJsonPayload(u)},l.prototype._log=function(u,p){var g;if(p.callback&&(g=p.callback,delete p.callback),this.options.ignoreDuplicateErrors&&this._sameAsLastError(p)){if(g){var f=new Error("ignored identical item");f.item=p,g(f)}}else try{this._addTracingInfo(p),p.level=p.level||u,this.telemeter&&this.telemeter._captureRollbarItem(p),p.telemetryEvents=this.telemeter&&this.telemeter.copyEvents()||[],this.notifier.log(p,g)}catch(m){g&&g(m),this.logger.error(m)}},l.prototype._defaultLogLevel=function(){return this.options.logLevel||"debug"},l.prototype._sameAsLastError=function(u){if(!u._isUncaught)return!1;var p=function(g){var f=g.message||"",m=(g.err||{}).stack||String(g.err);return f+"::"+m}(u);return this.lastErrorHash===p||(this.lastError=u.err,this.lastErrorHash=p,!1)},l.prototype._addTracingInfo=function(u){if(this.tracer){var p=this.tracer.scope().active();if(function(m){if(!m||!m.context||typeof m.context!="function")return!1;var E=m.context();return!(!E||!E.toSpanId||!E.toTraceId||typeof E.toSpanId!="function"||typeof E.toTraceId!="function")}(p)){p.setTag("rollbar.error_uuid",u.uuid),p.setTag("rollbar.has_error",!0),p.setTag("error",!0),p.setTag("rollbar.item_url","https://rollbar.com/item/uuid/?uuid="+u.uuid),p.setTag("rollbar.occurrence_url","https://rollbar.com/occurrence/uuid/?uuid="+u.uuid);var g=p.context().toSpanId(),f=p.context().toTraceId();u.custom?(u.custom.opentracing_span_id=g,u.custom.opentracing_trace_id=f):u.custom={opentracing_span_id:g,opentracing_trace_id:f}}}},t.exports=l},function(t,s,i){var n=i(0);function r(l){this.startTime=n.now(),this.counter=0,this.perMinCounter=0,this.platform=null,this.platformOptions={},this.configureGlobal(l)}function c(l,h,d){return!l.ignoreRateLimit&&h>=1&&d>h}function o(l,h,d,u,p,g,f){var m=null;return d&&(d=new Error(d)),d||u||(m=function(E,A,S,I,T){var R,b=A.environment||A.payload&&A.payload.environment;R=T?"item per minute limit reached, ignoring errors until timeout":"maxItems has been hit, ignoring errors until reset.";var w={body:{message:{body:R,extra:{maxItems:S,itemsPerMinute:I}}},language:"javascript",environment:b,notifier:{version:A.notifier&&A.notifier.version||A.version}};return E==="browser"?(w.platform="browser",w.framework="browser-js",w.notifier.name="rollbar-browser-js"):E==="server"?(w.framework=A.framework||"node-js",w.notifier.name=A.notifier.name):E==="react-native"&&(w.framework=A.framework||"react-native",w.notifier.name=A.notifier.name),w}(l,h,p,g,f)),{error:d,shouldSend:u,payload:m}}r.globalSettings={startTime:n.now(),maxItems:void 0,itemsPerMinute:void 0},r.prototype.configureGlobal=function(l){l.startTime!==void 0&&(r.globalSettings.startTime=l.startTime),l.maxItems!==void 0&&(r.globalSettings.maxItems=l.maxItems),l.itemsPerMinute!==void 0&&(r.globalSettings.itemsPerMinute=l.itemsPerMinute)},r.prototype.shouldSend=function(l,h){var d=(h=h||n.now())-this.startTime;(d<0||d>=6e4)&&(this.startTime=h,this.perMinCounter=0);var u=r.globalSettings.maxItems,p=r.globalSettings.itemsPerMinute;if(c(l,u,this.counter))return o(this.platform,this.platformOptions,u+" max items reached",!1);if(c(l,p,this.perMinCounter))return o(this.platform,this.platformOptions,p+" items per minute reached",!1);this.counter++,this.perMinCounter++;var g=!c(l,u,this.counter),f=g;return g=g&&!c(l,p,this.perMinCounter),o(this.platform,this.platformOptions,null,g,u,p,f)},r.prototype.setPlatformOptions=function(l,h){this.platform=l,this.platformOptions=h},t.exports=r},function(t,s,i){var n=Object.prototype.hasOwnProperty,r=Object.prototype.toString,c=function(o){if(!o||r.call(o)!=="[object Object]")return!1;var l,h=n.call(o,"constructor"),d=o.constructor&&o.constructor.prototype&&n.call(o.constructor.prototype,"isPrototypeOf");if(o.constructor&&!h&&!d)return!1;for(l in o);return l===void 0||n.call(o,l)};t.exports=function o(){var l,h,d,u,p,g={},f=null,m=arguments.length;for(l=0;l<m;l++)if((f=arguments[l])!=null)for(p in f)h=g[p],g!==(d=f[p])&&(d&&c(d)?(u=h&&c(h)?h:{},g[p]=o(u,d)):d!==void 0&&(g[p]=d));return g}},function(t,s,i){var n=i(0);function r(o,l,h,d){this.rateLimiter=o,this.api=l,this.logger=h,this.options=d,this.predicates=[],this.pendingItems=[],this.pendingRequests=[],this.retryQueue=[],this.retryHandle=null,this.waitCallback=null,this.waitIntervalID=null}r.prototype.configure=function(o){this.api&&this.api.configure(o);var l=this.options;return this.options=n.merge(l,o),this},r.prototype.addPredicate=function(o){return n.isFunction(o)&&this.predicates.push(o),this},r.prototype.addPendingItem=function(o){this.pendingItems.push(o)},r.prototype.removePendingItem=function(o){var l=this.pendingItems.indexOf(o);l!==-1&&this.pendingItems.splice(l,1)},r.prototype.addItem=function(o,l,h,d){l&&n.isFunction(l)||(l=function(){});var u=this._applyPredicates(o);if(u.stop)return this.removePendingItem(d),void l(u.err);if(this._maybeLog(o,h),this.removePendingItem(d),this.options.transmit){this.pendingRequests.push(o);try{this._makeApiRequest(o,function(p,g){this._dequeuePendingRequest(o),l(p,g)}.bind(this))}catch(p){this._dequeuePendingRequest(o),l(p)}}else l(new Error("Transmit disabled"))},r.prototype.wait=function(o){n.isFunction(o)&&(this.waitCallback=o,this._maybeCallWait()||(this.waitIntervalID&&(this.waitIntervalID=clearInterval(this.waitIntervalID)),this.waitIntervalID=setInterval(function(){this._maybeCallWait()}.bind(this),500)))},r.prototype._applyPredicates=function(o){for(var l=null,h=0,d=this.predicates.length;h<d;h++)if(!(l=this.predicates[h](o,this.options))||l.err!==void 0)return{stop:!0,err:l.err};return{stop:!1,err:null}},r.prototype._makeApiRequest=function(o,l){var h=this.rateLimiter.shouldSend(o);h.shouldSend?this.api.postItem(o,function(d,u){d?this._maybeRetry(d,o,l):l(d,u)}.bind(this)):h.error?l(h.error):this.api.postItem(h.payload,l)};var c=["ECONNRESET","ENOTFOUND","ESOCKETTIMEDOUT","ETIMEDOUT","ECONNREFUSED","EHOSTUNREACH","EPIPE","EAI_AGAIN"];r.prototype._maybeRetry=function(o,l,h){var d=!1;if(this.options.retryInterval){for(var u=0,p=c.length;u<p;u++)if(o.code===c[u]){d=!0;break}d&&n.isFiniteNumber(this.options.maxRetries)&&(l.retries=l.retries?l.retries+1:1,l.retries>this.options.maxRetries&&(d=!1))}d?this._retryApiRequest(l,h):h(o)},r.prototype._retryApiRequest=function(o,l){this.retryQueue.push({item:o,callback:l}),this.retryHandle||(this.retryHandle=setInterval(function(){for(;this.retryQueue.length;){var h=this.retryQueue.shift();this._makeApiRequest(h.item,h.callback)}}.bind(this),this.options.retryInterval))},r.prototype._dequeuePendingRequest=function(o){var l=this.pendingRequests.indexOf(o);l!==-1&&(this.pendingRequests.splice(l,1),this._maybeCallWait())},r.prototype._maybeLog=function(o,l){if(this.logger&&this.options.verbose){var h=l;if(h=(h=h||n.get(o,"body.trace.exception.message"))||n.get(o,"body.trace_chain.0.exception.message"))return void this.logger.error(h);(h=n.get(o,"body.message.body"))&&this.logger.log(h)}},r.prototype._maybeCallWait=function(){return!(!n.isFunction(this.waitCallback)||this.pendingItems.length!==0||this.pendingRequests.length!==0)&&(this.waitIntervalID&&(this.waitIntervalID=clearInterval(this.waitIntervalID)),this.waitCallback(),!0)},t.exports=r},function(t,s,i){var n=i(0);function r(c,o){this.queue=c,this.options=o,this.transforms=[],this.diagnostic={}}r.prototype.configure=function(c){this.queue&&this.queue.configure(c);var o=this.options;return this.options=n.merge(o,c),this},r.prototype.addTransform=function(c){return n.isFunction(c)&&this.transforms.push(c),this},r.prototype.log=function(c,o){if(o&&n.isFunction(o)||(o=function(){}),!this.options.enabled)return o(new Error("Rollbar is not enabled"));this.queue.addPendingItem(c);var l=c.err;this._applyTransforms(c,function(h,d){if(h)return this.queue.removePendingItem(c),o(h,null);this.queue.addItem(d,o,l,c)}.bind(this))},r.prototype._applyTransforms=function(c,o){var l=-1,h=this.transforms.length,d=this.transforms,u=this.options,p=function(g,f){g?o(g,null):++l!==h?d[l](f,u,p):o(null,f)};p(null,c)},t.exports=r},function(t,s,i){var n=i(0),r=i(16),c={hostname:"api.rollbar.com",path:"/api/1/item/",search:null,version:"1",protocol:"https:",port:443};function o(h,d,u,p,g){this.options=h,this.transport=d,this.url=u,this.truncation=p,this.jsonBackup=g,this.accessToken=h.accessToken,this.transportOptions=l(h,u)}function l(h,d){return r.getTransportFromOptions(h,c,d)}o.prototype.postItem=function(h,d){var u=r.transportOptions(this.transportOptions,"POST"),p=r.buildPayload(this.accessToken,h,this.jsonBackup),g=this;setTimeout(function(){g.transport.post(g.accessToken,u,p,d)},0)},o.prototype.buildJsonPayload=function(h,d){var u,p=r.buildPayload(this.accessToken,h,this.jsonBackup);return(u=this.truncation?this.truncation.truncate(p):n.stringify(p)).error?(d&&d(u.error),null):u.value},o.prototype.postJsonPayload=function(h,d){var u=r.transportOptions(this.transportOptions,"POST");this.transport.postJsonPayload(this.accessToken,u,h,d)},o.prototype.configure=function(h){var d=this.oldOptions;return this.options=n.merge(d,h),this.transportOptions=l(this.options,this.url),this.options.accessToken!==void 0&&(this.accessToken=this.options.accessToken),this},t.exports=o},function(t,s,i){var n=i(0);t.exports={buildPayload:function(r,c,o){if(!n.isType(c.context,"string")){var l=n.stringify(c.context,o);l.error?c.context="Error: could not serialize 'context'":c.context=l.value||"",c.context.length>255&&(c.context=c.context.substr(0,255))}return{access_token:r,data:c}},getTransportFromOptions:function(r,c,o){var l=c.hostname,h=c.protocol,d=c.port,u=c.path,p=c.search,g=r.timeout,f=function(A){var S=typeof window<"u"&&window||typeof self<"u"&&self,I=A.defaultTransport||"xhr";return S.fetch===void 0&&(I="xhr"),S.XMLHttpRequest===void 0&&(I="fetch"),I}(r),m=r.proxy;if(r.endpoint){var E=o.parse(r.endpoint);l=E.hostname,h=E.protocol,d=E.port,u=E.pathname,p=E.search}return{timeout:g,hostname:l,protocol:h,port:d,path:u,search:p,proxy:m,transport:f}},transportOptions:function(r,c){var o=r.protocol||"https:",l=r.port||(o==="http:"?80:o==="https:"?443:void 0),h=r.hostname,d=r.path,u=r.timeout,p=r.transport;return r.search&&(d+=r.search),r.proxy&&(d=o+"//"+h+d,h=r.proxy.host||r.proxy.hostname,l=r.proxy.port,o=r.proxy.protocol||o),{timeout:u,protocol:o,hostname:h,path:d,port:l,method:c,transport:p}},appendPathToPath:function(r,c){var o=/\/$/.test(r),l=/^\//.test(c);return o&&l?c=c.substring(1):o||l||(c="/"+c),r+c}}},function(t,s){(function(i){i.console||(i.console={});for(var n,r,c=i.console,o=function(){},l=["memory"],h="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");n=l.pop();)c[n]||(c[n]={});for(;r=h.pop();)c[r]||(c[r]=o)})(typeof window>"u"?this:window)},function(t,s,i){var n={ieVersion:function(){if(typeof document<"u"){for(var r=3,c=document.createElement("div"),o=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++r+"]><i></i><![endif]-->",o[0];);return r>4?r:void 0}}};t.exports=n},function(t,s,i){function n(r,c,o,l){r._rollbarWrappedError&&(l[4]||(l[4]=r._rollbarWrappedError),l[5]||(l[5]=r._rollbarWrappedError._rollbarContext),r._rollbarWrappedError=null);var h=c.handleUncaughtException.apply(c,l);o&&o.apply(r,l),h==="anonymous"&&(c.anonymousErrorsPending+=1)}t.exports={captureUncaughtExceptions:function(r,c,o){if(r){var l;if(typeof c._rollbarOldOnError=="function")l=c._rollbarOldOnError;else if(r.onerror){for(l=r.onerror;l._rollbarOldOnError;)l=l._rollbarOldOnError;c._rollbarOldOnError=l}c.handleAnonymousErrors();var h=function(){var d=Array.prototype.slice.call(arguments,0);n(r,c,l,d)};o&&(h._rollbarOldOnError=l),r.onerror=h}},captureUnhandledRejections:function(r,c,o){if(r){typeof r._rollbarURH=="function"&&r._rollbarURH.belongsToShim&&r.removeEventListener("unhandledrejection",r._rollbarURH);var l=function(h){var d,u,p;try{d=h.reason}catch{d=void 0}try{u=h.promise}catch{u="[unhandledrejection] error getting `promise` from event"}try{p=h.detail,!d&&p&&(d=p.reason,u=p.promise)}catch{}d||(d="[unhandledrejection] error getting `reason` from event"),c&&c.handleUnhandledRejection&&c.handleUnhandledRejection(d,u)};l.belongsToShim=o,r._rollbarURH=l,r.addEventListener("unhandledrejection",l)}}}},function(t,s,i){var n=i(0),r=i(21),c=i(22);function o(l){this.truncation=l}o.prototype.get=function(l,h,d,u,p){u&&n.isFunction(u)||(u=function(){}),n.addParamsAndAccessTokenToPath(l,h,d);var g=n.formatUrl(h);this._makeZoneRequest(l,g,"GET",null,u,p,h.timeout,h.transport)},o.prototype.post=function(l,h,d,u,p){if(u&&n.isFunction(u)||(u=function(){}),!d)return u(new Error("Cannot send empty request"));var g;if((g=this.truncation?this.truncation.truncate(d):n.stringify(d)).error)return u(g.error);var f=g.value,m=n.formatUrl(h);this._makeZoneRequest(l,m,"POST",f,u,p,h.timeout,h.transport)},o.prototype.postJsonPayload=function(l,h,d,u,p){u&&n.isFunction(u)||(u=function(){});var g=n.formatUrl(h);this._makeZoneRequest(l,g,"POST",d,u,p,h.timeout,h.transport)},o.prototype._makeZoneRequest=function(){var l=typeof window<"u"&&window||p!==void 0&&p,h=l&&l.Zone&&l.Zone.current,d=Array.prototype.slice.call(arguments);if(h&&h._name==="angular"){var u=h._parent,p=this;u.run(function(){p._makeRequest.apply(void 0,d)})}else this._makeRequest.apply(void 0,d)},o.prototype._makeRequest=function(l,h,d,u,p,g,f,m){if(typeof RollbarProxy<"u")return function(E,A){new RollbarProxy().sendJsonPayload(E,function(S){},function(S){A(new Error(S))})}(u,p);m==="fetch"?r(l,h,d,u,p,f):c(l,h,d,u,p,g,f)},t.exports=o},function(t,s,i){var n=i(1),r=i(0);t.exports=function(c,o,l,h,d,u){var p,g;r.isFiniteNumber(u)&&(p=new AbortController,g=setTimeout(function(){p.abort()},u)),fetch(o,{method:l,headers:{"Content-Type":"application/json","X-Rollbar-Access-Token":c,signal:p&&p.signal},body:h}).then(function(f){return g&&clearTimeout(g),f.json()}).then(function(f){d(null,f)}).catch(function(f){n.error(f.message),d(f)})}},function(t,s,i){var n=i(0),r=i(1);function c(o,l){var h=new Error(o);return h.code=l||"ENOTFOUND",h}t.exports=function(o,l,h,d,u,p,g){var f;if(!(f=p?p():function(){var A,S,I=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],T=I.length;for(S=0;S<T;S++)try{A=I[S]();break}catch{}return A}()))return u(new Error("No way to send a request"));try{try{var m=function(){try{if(m&&f.readyState===4){m=void 0;var A=n.jsonParse(f.responseText);if((T=f)&&T.status&&T.status===200)return void u(A.error,A.value);if(function(R){return R&&n.isType(R.status,"number")&&R.status>=400&&R.status<600}(f)){if(f.status===403){var S=A.value&&A.value.message;r.error(S)}u(new Error(String(f.status)))}else u(c("XHR response had no status code (likely connection failure)"))}}catch(R){var I;I=R&&R.stack?R:new Error(R),u(I)}var T};f.open(h,l,!0),f.setRequestHeader&&(f.setRequestHeader("Content-Type","application/json"),f.setRequestHeader("X-Rollbar-Access-Token",o)),n.isFiniteNumber(g)&&(f.timeout=g),f.onreadystatechange=m,f.send(d)}catch{if(typeof XDomainRequest<"u"){if(!window||!window.location)return u(new Error("No window available during request, unknown environment"));window.location.href.substring(0,5)==="http:"&&l.substring(0,5)==="https"&&(l="http"+l.substring(5));var E=new XDomainRequest;E.onprogress=function(){},E.ontimeout=function(){u(c("Request timed out","ETIMEDOUT"))},E.onerror=function(){u(new Error("Error during request"))},E.onload=function(){var S=n.jsonParse(E.responseText);u(S.error,S.value)},E.open(h,l,!0),E.send(d)}else u(new Error("Cannot find a method to transport a request"))}}catch(A){u(A)}}},function(t,s,i){var n=i(0),r=i(3),c=i(1);function o(u,p,g){var f=u.message,m=u.custom;f||(f="Item sent with null or missing arguments.");var E={body:f};m&&(E.extra=n.merge(m)),n.set(u,"data.body",{message:E}),g(null,u)}function l(u){var p=u.stackInfo.stack;return p&&p.length===0&&u._unhandledStackInfo&&u._unhandledStackInfo.stack&&(p=u._unhandledStackInfo.stack),p}function h(u,p,g){var f=u&&u.data.description,m=u&&u.custom,E=l(u),A=r.guessErrorClass(p.message),S={exception:{class:d(p,A[0],g),message:A[1]}};if(f&&(S.exception.description=f),E){var I,T,R,b,w,C,v,N;for(E.length===0&&(S.exception.stack=p.rawStack,S.exception.raw=String(p.rawException)),S.frames=[],v=0;v<E.length;++v)T={filename:(I=E[v]).url?n.sanitizeUrl(I.url):"(unknown)",lineno:I.line||null,method:I.func&&I.func!=="?"?I.func:"[anonymous]",colno:I.column},g.sendFrameUrl&&(T.url=I.url),T.method&&T.method.endsWith&&T.method.endsWith("_rollbar_wrapped")||(R=b=w=null,(C=I.context?I.context.length:0)&&(N=Math.floor(C/2),b=I.context.slice(0,N),R=I.context[N],w=I.context.slice(N)),R&&(T.code=R),(b||w)&&(T.context={},b&&b.length&&(T.context.pre=b),w&&w.length&&(T.context.post=w)),I.args&&(T.args=I.args),S.frames.push(T));S.frames.reverse(),m&&(S.extra=n.merge(m))}return S}function d(u,p,g){return u.name?u.name:g.guessErrorClass?p:"(unknown)"}t.exports={handleDomException:function(u,p,g){if(u.err&&r.Stack(u.err).name==="DOMException"){var f=new Error;f.name=u.err.name,f.message=u.err.message,f.stack=u.err.stack,f.nested=u.err,u.err=f}g(null,u)},handleItemWithError:function(u,p,g){if(u.data=u.data||{},u.err)try{u.stackInfo=u.err._savedStackTrace||r.parse(u.err,u.skipFrames),p.addErrorContext&&function(f){var m=[],E=f.err;for(m.push(E);E.nested||E.cause;)E=E.nested||E.cause,m.push(E);n.addErrorContext(f,m)}(u)}catch(f){c.error("Error while parsing the error object.",f);try{u.message=u.err.message||u.err.description||u.message||String(u.err)}catch(m){u.message=String(u.err)||String(m)}delete u.err}g(null,u)},ensureItemHasSomethingToSay:function(u,p,g){u.message||u.stackInfo||u.custom||g(new Error("No message, stack info, or custom data"),null),g(null,u)},addBaseInfo:function(u,p,g){var f=p.payload&&p.payload.environment||p.environment;u.data=n.merge(u.data,{environment:f,level:u.level,endpoint:p.endpoint,platform:"browser",framework:"browser-js",language:"javascript",server:{},uuid:u.uuid,notifier:{name:"rollbar-browser-js",version:p.version},custom:u.custom}),g(null,u)},addRequestInfo:function(u){return function(p,g,f){var m={};u&&u.location&&(m.url=u.location.href,m.query_string=u.location.search);var E="$remote_ip";g.captureIp?g.captureIp!==!0&&(E+="_anonymize"):E=null,E&&(m.user_ip=E),Object.keys(m).length>0&&n.set(p,"data.request",m),f(null,p)}},addClientInfo:function(u){return function(p,g,f){if(!u)return f(null,p);var m=u.navigator||{},E=u.screen||{};n.set(p,"data.client",{runtime_ms:p.timestamp-u._rollbarStartTime,timestamp:Math.round(p.timestamp/1e3),javascript:{browser:m.userAgent,language:m.language,cookie_enabled:m.cookieEnabled,screen:{width:E.width,height:E.height}}}),f(null,p)}},addPluginInfo:function(u){return function(p,g,f){if(!u||!u.navigator)return f(null,p);for(var m,E=[],A=u.navigator.plugins||[],S=0,I=A.length;S<I;++S)m=A[S],E.push({name:m.name,description:m.description});n.set(p,"data.client.javascript.plugins",E),f(null,p)}},addBody:function(u,p,g){u.stackInfo?u.stackInfo.traceChain?function(f,m,E){for(var A=f.stackInfo.traceChain,S=[],I=A.length,T=0;T<I;T++){var R=h(f,A[T],m);S.push(R)}n.set(f,"data.body",{trace_chain:S}),E(null,f)}(u,p,g):function(f,m,E){if(l(f)){var A=h(f,f.stackInfo,m);n.set(f,"data.body",{trace:A}),E(null,f)}else{var S=f.stackInfo,I=r.guessErrorClass(S.message),T=d(S,I[0],m),R=I[1];f.message=T+": "+R,o(f,m,E)}}(u,p,g):o(u,p,g)},addScrubber:function(u){return function(p,g,f){if(u){var m=g.scrubFields||[],E=g.scrubPaths||[];p.data=u(p.data,m,E)}f(null,p)}}}},function(t,s,i){var n,r,c;(function(o,l){r=[i(25)],(c=typeof(n=function(h){var d=/(^|@)\S+:\d+/,u=/^\s*at .*(\S+:\d+|\(native\))/m,p=/^(eval@)?(\[native code])?$/;return{parse:function(g){if(g.stacktrace!==void 0||g["opera#sourceloc"]!==void 0)return this.parseOpera(g);if(g.stack&&g.stack.match(u))return this.parseV8OrIE(g);if(g.stack)return this.parseFFOrSafari(g);throw new Error("Cannot parse given Error object")},extractLocation:function(g){if(g.indexOf(":")===-1)return[g];var f=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(g.replace(/[()]/g,""));return[f[1],f[2]||void 0,f[3]||void 0]},parseV8OrIE:function(g){return g.stack.split(`
`).filter(function(f){return!!f.match(u)},this).map(function(f){f.indexOf("(eval ")>-1&&(f=f.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var m=f.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),E=m.match(/ (\(.+\)$)/);m=E?m.replace(E[0],""):m;var A=this.extractLocation(E?E[1]:m),S=E&&m||void 0,I=["eval","<anonymous>"].indexOf(A[0])>-1?void 0:A[0];return new h({functionName:S,fileName:I,lineNumber:A[1],columnNumber:A[2],source:f})},this)},parseFFOrSafari:function(g){return g.stack.split(`
`).filter(function(f){return!f.match(p)},this).map(function(f){if(f.indexOf(" > eval")>-1&&(f=f.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),f.indexOf("@")===-1&&f.indexOf(":")===-1)return new h({functionName:f});var m=/((.*".+"[^@]*)?[^@]*)(?:@)/,E=f.match(m),A=E&&E[1]?E[1]:void 0,S=this.extractLocation(f.replace(m,""));return new h({functionName:A,fileName:S[0],lineNumber:S[1],columnNumber:S[2],source:f})},this)},parseOpera:function(g){return!g.stacktrace||g.message.indexOf(`
`)>-1&&g.message.split(`
`).length>g.stacktrace.split(`
`).length?this.parseOpera9(g):g.stack?this.parseOpera11(g):this.parseOpera10(g)},parseOpera9:function(g){for(var f=/Line (\d+).*script (?:in )?(\S+)/i,m=g.message.split(`
`),E=[],A=2,S=m.length;A<S;A+=2){var I=f.exec(m[A]);I&&E.push(new h({fileName:I[2],lineNumber:I[1],source:m[A]}))}return E},parseOpera10:function(g){for(var f=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,m=g.stacktrace.split(`
`),E=[],A=0,S=m.length;A<S;A+=2){var I=f.exec(m[A]);I&&E.push(new h({functionName:I[3]||void 0,fileName:I[2],lineNumber:I[1],source:m[A]}))}return E},parseOpera11:function(g){return g.stack.split(`
`).filter(function(f){return!!f.match(d)&&!f.match(/^Error created at/)},this).map(function(f){var m,E=f.split("@"),A=this.extractLocation(E.pop()),S=E.shift()||"",I=S.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;S.match(/\(([^)]*)\)/)&&(m=S.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var T=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new h({functionName:I,args:T,fileName:A[0],lineNumber:A[1],columnNumber:A[2],source:f})},this)}}})=="function"?n.apply(s,r):n)===void 0||(t.exports=c)})()},function(t,s,i){var n,r,c;(function(o,l){r=[],(c=typeof(n=function(){function h(I){return I.charAt(0).toUpperCase()+I.substring(1)}function d(I){return function(){return this[I]}}var u=["isConstructor","isEval","isNative","isToplevel"],p=["columnNumber","lineNumber"],g=["fileName","functionName","source"],f=u.concat(p,g,["args"],["evalOrigin"]);function m(I){if(I)for(var T=0;T<f.length;T++)I[f[T]]!==void 0&&this["set"+h(f[T])](I[f[T]])}m.prototype={getArgs:function(){return this.args},setArgs:function(I){if(Object.prototype.toString.call(I)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=I},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(I){if(I instanceof m)this.evalOrigin=I;else{if(!(I instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new m(I)}},toString:function(){var I=this.getFileName()||"",T=this.getLineNumber()||"",R=this.getColumnNumber()||"",b=this.getFunctionName()||"";return this.getIsEval()?I?"[eval] ("+I+":"+T+":"+R+")":"[eval]:"+T+":"+R:b?b+" ("+I+":"+T+":"+R+")":I+":"+T+":"+R}},m.fromString=function(I){var T=I.indexOf("("),R=I.lastIndexOf(")"),b=I.substring(0,T),w=I.substring(T+1,R).split(","),C=I.substring(R+1);if(C.indexOf("@")===0)var v=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(C,""),N=v[1],B=v[2],x=v[3];return new m({functionName:b,args:w||void 0,fileName:N,lineNumber:B||void 0,columnNumber:x||void 0})};for(var E=0;E<u.length;E++)m.prototype["get"+h(u[E])]=d(u[E]),m.prototype["set"+h(u[E])]=function(I){return function(T){this[I]=!!T}}(u[E]);for(var A=0;A<p.length;A++)m.prototype["get"+h(p[A])]=d(p[A]),m.prototype["set"+h(p[A])]=function(I){return function(T){if(R=T,isNaN(parseFloat(R))||!isFinite(R))throw new TypeError(I+" must be a Number");var R;this[I]=Number(T)}}(p[A]);for(var S=0;S<g.length;S++)m.prototype["get"+h(g[S])]=d(g[S]),m.prototype["set"+h(g[S])]=function(I){return function(T){this[I]=String(T)}}(g[S]);return m})=="function"?n.apply(s,r):n)===void 0||(t.exports=c)})()},function(t,s,i){var n=i(0);function r(c,o){n.isFunction(c[o])&&(c[o]=c[o].toString())}t.exports={itemToPayload:function(c,o,l){var h=c.data;c._isUncaught&&(h._isUncaught=!0),c._originalArgs&&(h._originalArgs=c._originalArgs),l(null,h)},addPayloadOptions:function(c,o,l){var h=o.payload||{};h.body&&delete h.body,c.data=n.merge(c.data,h),l(null,c)},addTelemetryData:function(c,o,l){c.telemetryEvents&&n.set(c,"data.body.telemetry",c.telemetryEvents),l(null,c)},addMessageWithError:function(c,o,l){if(c.message){var h="data.body.trace_chain.0",d=n.get(c,h);if(d||(h="data.body.trace",d=n.get(c,h)),d){if(!d.exception||!d.exception.description)return n.set(c,h+".exception.description",c.message),void l(null,c);var u=n.get(c,h+".extra")||{},p=n.merge(u,{message:c.message});n.set(c,h+".extra",p)}l(null,c)}else l(null,c)},userTransform:function(c){return function(o,l,h){var d=n.merge(o),u=null;try{n.isFunction(l.transform)&&(u=l.transform(d.data,o))}catch(p){return l.transform=null,c.error("Error while calling custom transform() function. Removing custom transform().",p),void h(null,o)}n.isPromise(u)?u.then(function(p){p&&(d.data=p),h(null,d)},function(p){h(p,o)}):h(null,d)}},addConfigToPayload:function(c,o,l){if(!o.sendConfig)return l(null,c);var h=n.get(c,"data.custom")||{};h._rollbarConfig=o,c.data.custom=h,l(null,c)},addConfiguredOptions:function(c,o,l){var h=o._configuredOptions;r(h,"transform"),r(h,"checkIgnore"),r(h,"onSendCallback"),delete h.accessToken,c.data.notifier.configured_options=h,l(null,c)},addDiagnosticKeys:function(c,o,l){var h=n.merge(c.notifier.client.notifier.diagnostic,c.diagnostic);if(n.get(c,"err._isAnonymous")&&(h.is_anonymous=!0),c._isUncaught&&(h.is_uncaught=c._isUncaught),c.err)try{h.raw_error={message:c.err.message,name:c.err.name,constructor_name:c.err.constructor&&c.err.constructor.name,filename:c.err.fileName,line:c.err.lineNumber,column:c.err.columnNumber,stack:c.err.stack}}catch(d){h.raw_error={failed:String(d)}}c.data.notifier.diagnostic=n.merge(c.data.notifier.diagnostic,h),l(null,c)}}},function(t,s,i){var n=i(0);t.exports={checkIgnore:function(r,c){return!n.get(c,"plugins.jquery.ignoreAjaxErrors")||!n.get(r,"body.message.extra.isAjax")}}},function(t,s,i){var n=i(0);function r(o,l,h){if(!o)return!h;var d,u,p=o.frames;if(!p||p.length===0)return!h;for(var g=l.length,f=p.length,m=0;m<f;m++){if(d=p[m].filename,!n.isType(d,"string"))return!h;for(var E=0;E<g;E++)if(u=l[E],new RegExp(u).test(d))return!0}return!1}function c(o,l,h,d){var u,p,g=!1;h==="blocklist"&&(g=!0);try{if(u=g?l.hostBlockList:l.hostSafeList,p=n.get(o,"body.trace_chain")||[n.get(o,"body.trace")],!u||u.length===0||p.length===0||!p[0])return!g;for(var f=p.length,m=0;m<f;m++)if(r(p[m],u,g))return!0}catch(A){g?l.hostBlockList=null:l.hostSafeList=null;var E=g?"hostBlockList":"hostSafeList";return d.error("Error while reading your configuration's "+E+" option. Removing custom "+E+".",A),!g}return!1}t.exports={checkLevel:function(o,l){var h=o.level,d=n.LEVELS[h]||0,u=l.reportLevel;return!(d<(n.LEVELS[u]||0))},userCheckIgnore:function(o){return function(l,h){var d=!!l._isUncaught;delete l._isUncaught;var u=l._originalArgs;delete l._originalArgs;try{n.isFunction(h.onSendCallback)&&h.onSendCallback(d,u,l)}catch(p){h.onSendCallback=null,o.error("Error while calling onSendCallback, removing",p)}try{if(n.isFunction(h.checkIgnore)&&h.checkIgnore(d,u,l))return!1}catch(p){h.checkIgnore=null,o.error("Error while calling custom checkIgnore(), removing",p)}return!0}},urlIsNotBlockListed:function(o){return function(l,h){return!c(l,h,"blocklist",o)}},urlIsSafeListed:function(o){return function(l,h){return c(l,h,"safelist",o)}},messageIsIgnored:function(o){return function(l,h){var d,u,p,g,f,m;try{if(!(p=h.ignoredMessages)||p.length===0||(m=function(E){var A=E.body,S=[];if(A.trace_chain)for(var I=A.trace_chain,T=0;T<I.length;T++){var R=I[T];S.push(n.get(R,"exception.message"))}return A.trace&&S.push(n.get(A,"trace.exception.message")),A.message&&S.push(n.get(A,"message.body")),S}(l)).length===0)return!0;for(g=p.length,d=0;d<g;d++)for(f=new RegExp(p[d],"gi"),u=0;u<m.length;u++)if(f.test(m[u]))return!1}catch{h.ignoredMessages=null,o.error("Error while reading your configuration's ignoredMessages option. Removing custom ignoredMessages.")}return!0}}}},function(t,s,i){t.exports={version:"2.26.1",endpoint:"api.rollbar.com/api/1/item/",logLevel:"debug",reportLevel:"debug",uncaughtErrorLevel:"error",maxItems:0,itemsPerMin:60}},function(t,s,i){t.exports={scrubFields:["pw","pass","passwd","password","secret","confirm_password","confirmPassword","password_confirmation","passwordConfirmation","access_token","accessToken","X-Rollbar-Access-Token","secret_key","secretKey","secretToken","cc-number","card number","cardnumber","cardnum","ccnum","ccnumber","cc num","creditcardnumber","credit card number","newcreditcardnumber","new credit card","creditcardno","credit card no","card#","card #","cc-csc","cvc","cvc2","cvv2","ccv2","security code","card verification","name on credit card","name on card","nameoncard","cardholder","card holder","name des karteninhabers","ccname","card type","cardtype","cc type","cctype","payment type","expiration date","expirationdate","expdate","cc-exp","ccmonth","ccyear"]}},function(t,s,i){var n=i(0);function r(o){this.queue=[],this.options=n.merge(o);var l=this.options.maxTelemetryEvents||100;this.maxQueueSize=Math.max(0,Math.min(l,100))}function c(o,l){return l||{error:"error",manual:"info"}[o]||"info"}r.prototype.configure=function(o){var l=this.options;this.options=n.merge(l,o);var h=this.options.maxTelemetryEvents||100,d=Math.max(0,Math.min(h,100)),u=0;this.maxQueueSize>d&&(u=this.maxQueueSize-d),this.maxQueueSize=d,this.queue.splice(0,u)},r.prototype.copyEvents=function(){var o=Array.prototype.slice.call(this.queue,0);if(n.isFunction(this.options.filterTelemetry))try{for(var l=o.length;l--;)this.options.filterTelemetry(o[l])&&o.splice(l,1)}catch{this.options.filterTelemetry=null}return o},r.prototype.capture=function(o,l,h,d,u){var p={level:c(o,h),type:o,timestamp_ms:u||n.now(),body:l,source:"client"};d&&(p.uuid=d);try{if(n.isFunction(this.options.filterTelemetry)&&this.options.filterTelemetry(p))return!1}catch{this.options.filterTelemetry=null}return this.push(p),p},r.prototype.captureEvent=function(o,l,h,d){return this.capture(o,l,h,d)},r.prototype.captureError=function(o,l,h,d){var u={message:o.message||String(o)};return o.stack&&(u.stack=o.stack),this.capture("error",u,l,h,d)},r.prototype.captureLog=function(o,l,h,d){return this.capture("log",{message:o},l,h,d)},r.prototype.captureNetwork=function(o,l,h,d){l=l||"xhr",o.subtype=o.subtype||l,d&&(o.request=d);var u=this.levelFromStatus(o.status_code);return this.capture("network",o,u,h)},r.prototype.levelFromStatus=function(o){return o>=200&&o<400?"info":o===0||o>=400?"error":"info"},r.prototype.captureDom=function(o,l,h,d,u){var p={subtype:o,element:l};return h!==void 0&&(p.value=h),d!==void 0&&(p.checked=d),this.capture("dom",p,"info",u)},r.prototype.captureNavigation=function(o,l,h){return this.capture("navigation",{from:o,to:l},"info",h)},r.prototype.captureDomContentLoaded=function(o){return this.capture("navigation",{subtype:"DOMContentLoaded"},"info",void 0,o&&o.getTime())},r.prototype.captureLoad=function(o){return this.capture("navigation",{subtype:"load"},"info",void 0,o&&o.getTime())},r.prototype.captureConnectivityChange=function(o,l){return this.captureNetwork({change:o},"connectivity",l)},r.prototype._captureRollbarItem=function(o){if(this.options.includeItemsInTelemetry)return o.err?this.captureError(o.err,o.level,o.uuid,o.timestamp):o.message?this.captureLog(o.message,o.level,o.uuid,o.timestamp):o.custom?this.capture("log",o.custom,o.level,o.uuid,o.timestamp):void 0},r.prototype.push=function(o){this.queue.push(o),this.queue.length>this.maxQueueSize&&this.queue.shift()},t.exports=r},function(t,s,i){var n=i(0),r=i(33),c=i(4),o=i(2),l=i(34),h={network:!0,networkResponseHeaders:!1,networkResponseBody:!1,networkRequestHeaders:!1,networkRequestBody:!1,networkErrorOnHttp5xx:!1,networkErrorOnHttp4xx:!1,networkErrorOnHttp0:!1,log:!0,dom:!0,navigation:!0,connectivity:!0,contentSecurityPolicy:!0,errorOnContentSecurityPolicy:!1};function d(g,f,m,E,A){var S=g[f];g[f]=m(S),E&&E[A].push([g,f,S])}function u(g,f){for(var m;g[f].length;)(m=g[f].shift())[0][m[1]]=m[2]}function p(g,f,m,E,A){this.options=g;var S=g.autoInstrument;g.enabled===!1||S===!1?this.autoInstrument={}:(n.isType(S,"object")||(S=h),this.autoInstrument=n.merge(h,S)),this.scrubTelemetryInputs=!!g.scrubTelemetryInputs,this.telemetryScrubber=g.telemetryScrubber,this.defaultValueScrubber=function(I){for(var T=[],R=0;R<I.length;++R)T.push(new RegExp(I[R],"i"));return function(b){var w=function(v){if(!v||!v.attributes)return null;for(var N=v.attributes,B=0;B<N.length;++B)if(N[B].key==="name")return N[B].value;return null}(b);if(!w)return!1;for(var C=0;C<T.length;++C)if(T[C].test(w))return!0;return!1}}(g.scrubFields),this.telemeter=f,this.rollbar=m,this.diagnostic=m.client.notifier.diagnostic,this._window=E||{},this._document=A||{},this.replacements={network:[],log:[],navigation:[],connectivity:[]},this.eventRemovers={dom:[],connectivity:[],contentsecuritypolicy:[]},this._location=this._window.location,this._lastHref=this._location&&this._location.href}p.prototype.configure=function(g){this.options=n.merge(this.options,g);var f=g.autoInstrument,m=n.merge(this.autoInstrument);g.enabled===!1||f===!1?this.autoInstrument={}:(n.isType(f,"object")||(f=h),this.autoInstrument=n.merge(h,f)),this.instrument(m),g.scrubTelemetryInputs!==void 0&&(this.scrubTelemetryInputs=!!g.scrubTelemetryInputs),g.telemetryScrubber!==void 0&&(this.telemetryScrubber=g.telemetryScrubber)},p.prototype.instrument=function(g){!this.autoInstrument.network||g&&g.network?!this.autoInstrument.network&&g&&g.network&&this.deinstrumentNetwork():this.instrumentNetwork(),!this.autoInstrument.log||g&&g.log?!this.autoInstrument.log&&g&&g.log&&this.deinstrumentConsole():this.instrumentConsole(),!this.autoInstrument.dom||g&&g.dom?!this.autoInstrument.dom&&g&&g.dom&&this.deinstrumentDom():this.instrumentDom(),!this.autoInstrument.navigation||g&&g.navigation?!this.autoInstrument.navigation&&g&&g.navigation&&this.deinstrumentNavigation():this.instrumentNavigation(),!this.autoInstrument.connectivity||g&&g.connectivity?!this.autoInstrument.connectivity&&g&&g.connectivity&&this.deinstrumentConnectivity():this.instrumentConnectivity(),!this.autoInstrument.contentSecurityPolicy||g&&g.contentSecurityPolicy?!this.autoInstrument.contentSecurityPolicy&&g&&g.contentSecurityPolicy&&this.deinstrumentContentSecurityPolicy():this.instrumentContentSecurityPolicy()},p.prototype.deinstrumentNetwork=function(){u(this.replacements,"network")},p.prototype.instrumentNetwork=function(){var g=this;function f(E,A){E in A&&n.isFunction(A[E])&&d(A,E,function(S){return g.rollbar.wrap(S)})}if("XMLHttpRequest"in this._window){var m=this._window.XMLHttpRequest.prototype;d(m,"open",function(E){return function(A,S){return n.isType(S,"string")&&(this.__rollbar_xhr?(this.__rollbar_xhr.method=A,this.__rollbar_xhr.url=S,this.__rollbar_xhr.status_code=null,this.__rollbar_xhr.start_time_ms=n.now(),this.__rollbar_xhr.end_time_ms=null):this.__rollbar_xhr={method:A,url:S,status_code:null,start_time_ms:n.now(),end_time_ms:null}),E.apply(this,arguments)}},this.replacements,"network"),d(m,"setRequestHeader",function(E){return function(A,S){return this.__rollbar_xhr||(this.__rollbar_xhr={}),n.isType(A,"string")&&n.isType(S,"string")&&(g.autoInstrument.networkRequestHeaders&&(this.__rollbar_xhr.request_headers||(this.__rollbar_xhr.request_headers={}),this.__rollbar_xhr.request_headers[A]=S),A.toLowerCase()==="content-type"&&(this.__rollbar_xhr.request_content_type=S)),E.apply(this,arguments)}},this.replacements,"network"),d(m,"send",function(E){return function(A){var S=this;function I(){if(S.__rollbar_xhr&&(S.__rollbar_xhr.status_code===null&&(S.__rollbar_xhr.status_code=0,g.autoInstrument.networkRequestBody&&(S.__rollbar_xhr.request=A),S.__rollbar_event=g.captureNetwork(S.__rollbar_xhr,"xhr",void 0)),S.readyState<2&&(S.__rollbar_xhr.start_time_ms=n.now()),S.readyState>3)){S.__rollbar_xhr.end_time_ms=n.now();var T=null;if(S.__rollbar_xhr.response_content_type=S.getResponseHeader("Content-Type"),g.autoInstrument.networkResponseHeaders){var R=g.autoInstrument.networkResponseHeaders;T={};try{var b,w;if(R===!0){var C=S.getAllResponseHeaders();if(C){var v,N,B=C.trim().split(/[\r\n]+/);for(w=0;w<B.length;w++)b=(v=B[w].split(": ")).shift(),N=v.join(": "),T[b]=N}}else for(w=0;w<R.length;w++)T[b=R[w]]=S.getResponseHeader(b)}catch{}}var x=null;if(g.autoInstrument.networkResponseBody)try{x=S.responseText}catch{}var H=null;(x||T)&&(H={},x&&(g.isJsonContentType(S.__rollbar_xhr.response_content_type)?H.body=g.scrubJson(x):H.body=x),T&&(H.headers=T)),H&&(S.__rollbar_xhr.response=H);try{var Y=S.status;Y=Y===1223?204:Y,S.__rollbar_xhr.status_code=Y,S.__rollbar_event.level=g.telemeter.levelFromStatus(Y),g.errorOnHttpStatus(S.__rollbar_xhr)}catch{}}}return f("onload",S),f("onerror",S),f("onprogress",S),"onreadystatechange"in S&&n.isFunction(S.onreadystatechange)?d(S,"onreadystatechange",function(T){return g.rollbar.wrap(T,void 0,I)}):S.onreadystatechange=I,S.__rollbar_xhr&&g.trackHttpErrors()&&(S.__rollbar_xhr.stack=new Error().stack),E.apply(this,arguments)}},this.replacements,"network")}"fetch"in this._window&&d(this._window,"fetch",function(E){return function(A,S){for(var I=new Array(arguments.length),T=0,R=I.length;T<R;T++)I[T]=arguments[T];var b,w=I[0],C="GET";n.isType(w,"string")?b=w:w&&(b=w.url,w.method&&(C=w.method)),I[1]&&I[1].method&&(C=I[1].method);var v={method:C,url:b,status_code:null,start_time_ms:n.now(),end_time_ms:null};if(I[1]&&I[1].headers){var N=r(I[1].headers);v.request_content_type=N.get("Content-Type"),g.autoInstrument.networkRequestHeaders&&(v.request_headers=g.fetchHeaders(N,g.autoInstrument.networkRequestHeaders))}return g.autoInstrument.networkRequestBody&&(I[1]&&I[1].body?v.request=I[1].body:I[0]&&!n.isType(I[0],"string")&&I[0].body&&(v.request=I[0].body)),g.captureNetwork(v,"fetch",void 0),g.trackHttpErrors()&&(v.stack=new Error().stack),E.apply(this,I).then(function(B){v.end_time_ms=n.now(),v.status_code=B.status,v.response_content_type=B.headers.get("Content-Type");var x=null;g.autoInstrument.networkResponseHeaders&&(x=g.fetchHeaders(B.headers,g.autoInstrument.networkResponseHeaders));var H=null;return g.autoInstrument.networkResponseBody&&typeof B.text=="function"&&(H=B.clone().text()),(x||H)&&(v.response={},H&&(typeof H.then=="function"?H.then(function(Y){Y&&g.isJsonContentType(v.response_content_type)?v.response.body=g.scrubJson(Y):v.response.body=Y}):v.response.body=H),x&&(v.response.headers=x)),g.errorOnHttpStatus(v),B})}},this.replacements,"network")},p.prototype.captureNetwork=function(g,f,m){return g.request&&this.isJsonContentType(g.request_content_type)&&(g.request=this.scrubJson(g.request)),this.telemeter.captureNetwork(g,f,m)},p.prototype.isJsonContentType=function(g){return!!(g&&n.isType(g,"string")&&g.toLowerCase().includes("json"))},p.prototype.scrubJson=function(g){return JSON.stringify(c(JSON.parse(g),this.options.scrubFields))},p.prototype.fetchHeaders=function(g,f){var m={};try{var E;if(f===!0){if(typeof g.entries=="function")for(var A=g.entries(),S=A.next();!S.done;)m[S.value[0]]=S.value[1],S=A.next()}else for(E=0;E<f.length;E++){var I=f[E];m[I]=g.get(I)}}catch{}return m},p.prototype.trackHttpErrors=function(){return this.autoInstrument.networkErrorOnHttp5xx||this.autoInstrument.networkErrorOnHttp4xx||this.autoInstrument.networkErrorOnHttp0},p.prototype.errorOnHttpStatus=function(g){var f=g.status_code;if(f>=500&&this.autoInstrument.networkErrorOnHttp5xx||f>=400&&this.autoInstrument.networkErrorOnHttp4xx||f===0&&this.autoInstrument.networkErrorOnHttp0){var m=new Error("HTTP request failed with Status "+f);m.stack=g.stack,this.rollbar.error(m,{skipFrames:1})}},p.prototype.deinstrumentConsole=function(){if("console"in this._window&&this._window.console.log)for(var g;this.replacements.log.length;)g=this.replacements.log.shift(),this._window.console[g[0]]=g[1]},p.prototype.instrumentConsole=function(){if("console"in this._window&&this._window.console.log){var g=this,f=this._window.console,m=["debug","info","warn","error","log"];try{for(var E=0,A=m.length;E<A;E++)S(m[E])}catch(I){this.diagnostic.instrumentConsole={error:I.message}}}function S(I){var T=f[I],R=f,b=I==="warn"?"warning":I;f[I]=function(){var w=Array.prototype.slice.call(arguments),C=n.formatArgsAsString(w);g.telemeter.captureLog(C,b),T&&Function.prototype.apply.call(T,R,w)},g.replacements.log.push([I,T])}},p.prototype.deinstrumentDom=function(){("addEventListener"in this._window||"attachEvent"in this._window)&&this.removeListeners("dom")},p.prototype.instrumentDom=function(){if("addEventListener"in this._window||"attachEvent"in this._window){var g=this.handleClick.bind(this),f=this.handleBlur.bind(this);this.addListener("dom",this._window,"click","onclick",g,!0),this.addListener("dom",this._window,"blur","onfocusout",f,!0)}},p.prototype.handleClick=function(g){try{var f=l.getElementFromEvent(g,this._document),m=f&&f.tagName,E=l.isDescribedElement(f,"a")||l.isDescribedElement(f,"button");m&&(E||l.isDescribedElement(f,"input",["button","submit"]))?this.captureDomEvent("click",f):l.isDescribedElement(f,"input",["checkbox","radio"])&&this.captureDomEvent("input",f,f.value,f.checked)}catch{}},p.prototype.handleBlur=function(g){try{var f=l.getElementFromEvent(g,this._document);f&&f.tagName&&(l.isDescribedElement(f,"textarea")?this.captureDomEvent("input",f,f.value):l.isDescribedElement(f,"select")&&f.options&&f.options.length?this.handleSelectInputChanged(f):l.isDescribedElement(f,"input")&&!l.isDescribedElement(f,"input",["button","submit","hidden","checkbox","radio"])&&this.captureDomEvent("input",f,f.value))}catch{}},p.prototype.handleSelectInputChanged=function(g){if(g.multiple)for(var f=0;f<g.options.length;f++)g.options[f].selected&&this.captureDomEvent("input",g,g.options[f].value);else g.selectedIndex>=0&&g.options[g.selectedIndex]&&this.captureDomEvent("input",g,g.options[g.selectedIndex].value)},p.prototype.captureDomEvent=function(g,f,m,E){if(m!==void 0)if(this.scrubTelemetryInputs||l.getElementType(f)==="password")m="[scrubbed]";else{var A=l.describeElement(f);this.telemetryScrubber?this.telemetryScrubber(A)&&(m="[scrubbed]"):this.defaultValueScrubber(A)&&(m="[scrubbed]")}var S=l.elementArrayToString(l.treeToArray(f));this.telemeter.captureDom(g,S,m,E)},p.prototype.deinstrumentNavigation=function(){var g=this._window.chrome;!(g&&g.app&&g.app.runtime)&&this._window.history&&this._window.history.pushState&&u(this.replacements,"navigation")},p.prototype.instrumentNavigation=function(){var g=this._window.chrome;if(!(g&&g.app&&g.app.runtime)&&this._window.history&&this._window.history.pushState){var f=this;d(this._window,"onpopstate",function(m){return function(){var E=f._location.href;f.handleUrlChange(f._lastHref,E),m&&m.apply(this,arguments)}},this.replacements,"navigation"),d(this._window.history,"pushState",function(m){return function(){var E=arguments.length>2?arguments[2]:void 0;return E&&f.handleUrlChange(f._lastHref,E+""),m.apply(this,arguments)}},this.replacements,"navigation")}},p.prototype.handleUrlChange=function(g,f){var m=o.parse(this._location.href),E=o.parse(f),A=o.parse(g);this._lastHref=f,m.protocol===E.protocol&&m.host===E.host&&(f=E.path+(E.hash||"")),m.protocol===A.protocol&&m.host===A.host&&(g=A.path+(A.hash||"")),this.telemeter.captureNavigation(g,f)},p.prototype.deinstrumentConnectivity=function(){("addEventListener"in this._window||"body"in this._document)&&(this._window.addEventListener?this.removeListeners("connectivity"):u(this.replacements,"connectivity"))},p.prototype.instrumentConnectivity=function(){if("addEventListener"in this._window||"body"in this._document)if(this._window.addEventListener)this.addListener("connectivity",this._window,"online",void 0,function(){this.telemeter.captureConnectivityChange("online")}.bind(this),!0),this.addListener("connectivity",this._window,"offline",void 0,function(){this.telemeter.captureConnectivityChange("offline")}.bind(this),!0);else{var g=this;d(this._document.body,"ononline",function(f){return function(){g.telemeter.captureConnectivityChange("online"),f&&f.apply(this,arguments)}},this.replacements,"connectivity"),d(this._document.body,"onoffline",function(f){return function(){g.telemeter.captureConnectivityChange("offline"),f&&f.apply(this,arguments)}},this.replacements,"connectivity")}},p.prototype.handleCspEvent=function(g){var f="Security Policy Violation: blockedURI: "+g.blockedURI+", violatedDirective: "+g.violatedDirective+", effectiveDirective: "+g.effectiveDirective+", ";g.sourceFile&&(f+="location: "+g.sourceFile+", line: "+g.lineNumber+", col: "+g.columnNumber+", "),f+="originalPolicy: "+g.originalPolicy,this.telemeter.captureLog(f,"error"),this.handleCspError(f)},p.prototype.handleCspError=function(g){this.autoInstrument.errorOnContentSecurityPolicy&&this.rollbar.error(g)},p.prototype.deinstrumentContentSecurityPolicy=function(){"addEventListener"in this._document&&this.removeListeners("contentsecuritypolicy")},p.prototype.instrumentContentSecurityPolicy=function(){if("addEventListener"in this._document){var g=this.handleCspEvent.bind(this);this.addListener("contentsecuritypolicy",this._document,"securitypolicyviolation",null,g,!1)}},p.prototype.addListener=function(g,f,m,E,A,S){f.addEventListener?(f.addEventListener(m,A,S),this.eventRemovers[g].push(function(){f.removeEventListener(m,A,S)})):E&&(f.attachEvent(E,A),this.eventRemovers[g].push(function(){f.detachEvent(E,A)}))},p.prototype.removeListeners=function(g){for(;this.eventRemovers[g].length;)this.eventRemovers[g].shift()()},t.exports=p},function(t,s,i){function n(c){return typeof c!="string"&&(c=String(c)),c.toLowerCase()}function r(c){this.map={},c instanceof r?c.forEach(function(o,l){this.append(l,o)},this):Array.isArray(c)?c.forEach(function(o){this.append(o[0],o[1])},this):c&&Object.getOwnPropertyNames(c).forEach(function(o){this.append(o,c[o])},this)}r.prototype.append=function(c,o){c=n(c),o=function(h){return typeof h!="string"&&(h=String(h)),h}(o);var l=this.map[c];this.map[c]=l?l+", "+o:o},r.prototype.get=function(c){return c=n(c),this.has(c)?this.map[c]:null},r.prototype.has=function(c){return this.map.hasOwnProperty(n(c))},r.prototype.forEach=function(c,o){for(var l in this.map)this.map.hasOwnProperty(l)&&c.call(o,this.map[l],l,this)},r.prototype.entries=function(){var c=[];return this.forEach(function(o,l){c.push([l,o])}),function(o){return{next:function(){var l=o.shift();return{done:l===void 0,value:l}}}}(c)},t.exports=function(c){return typeof Headers>"u"?new r(c):new Headers(c)}},function(t,s,i){function n(o){return(o.getAttribute("type")||"").toLowerCase()}function r(o){if(!o||!o.tagName)return"";var l=[o.tagName];o.id&&l.push("#"+o.id),o.classes&&l.push("."+o.classes.join("."));for(var h=0;h<o.attributes.length;h++)l.push("["+o.attributes[h].key+'="'+o.attributes[h].value+'"]');return l.join("")}function c(o){if(!o||!o.tagName)return null;var l,h,d,u,p={};p.tagName=o.tagName.toLowerCase(),o.id&&(p.id=o.id),(l=o.className)&&typeof l=="string"&&(p.classes=l.split(/\s+/));var g=["type","name","title","alt"];for(p.attributes=[],u=0;u<g.length;u++)h=g[u],(d=o.getAttribute(h))&&p.attributes.push({key:h,value:d});return p}t.exports={describeElement:c,descriptionToString:r,elementArrayToString:function(o){for(var l,h,d=3,u=[],p=0,g=o.length-1;g>=0;g--){if(l=r(o[g]),h=p+u.length*d+l.length,g<o.length-1&&h>=83){u.unshift("...");break}u.unshift(l),p+=l.length}return u.join(" > ")},treeToArray:function(o){for(var l,h=[],d=0;o&&d<5&&(l=c(o)).tagName!=="html";d++)h.unshift(l),o=o.parentNode;return h},getElementFromEvent:function(o,l){return o.target?o.target:l&&l.elementFromPoint?l.elementFromPoint(o.clientX,o.clientY):void 0},isDescribedElement:function(o,l,h){if(o.tagName.toLowerCase()!==l.toLowerCase())return!1;if(!h)return!0;o=n(o);for(var d=0;d<h.length;d++)if(h[d]===o)return!0;return!1},getElementType:n}},function(t,s,i){var n=i(36);t.exports=n},function(t,s){t.exports=function(i){var n,r,c,o,l,h,d,u,p,g,f,m,E,A=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function S(R){return R<10?"0"+R:R}function I(){return this.valueOf()}function T(R){return A.lastIndex=0,A.test(R)?'"'+R.replace(A,function(b){var w=c[b];return typeof w=="string"?w:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+R+'"'}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+S(this.getUTCMonth()+1)+"-"+S(this.getUTCDate())+"T"+S(this.getUTCHours())+":"+S(this.getUTCMinutes())+":"+S(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=I,Number.prototype.toJSON=I,String.prototype.toJSON=I),typeof i.stringify!="function"&&(c={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i.stringify=function(R,b,w){var C;if(n="",r="",typeof w=="number")for(C=0;C<w;C+=1)r+=" ";else typeof w=="string"&&(r=w);if(o=b,b&&typeof b!="function"&&(typeof b!="object"||typeof b.length!="number"))throw new Error("JSON.stringify");return function v(N,B){var x,H,Y,Z,ce,Ae=n,ie=B[N];switch(ie&&typeof ie=="object"&&typeof ie.toJSON=="function"&&(ie=ie.toJSON(N)),typeof o=="function"&&(ie=o.call(B,N,ie)),typeof ie){case"string":return T(ie);case"number":return isFinite(ie)?String(ie):"null";case"boolean":case"null":return String(ie);case"object":if(!ie)return"null";if(n+=r,ce=[],Object.prototype.toString.apply(ie)==="[object Array]"){for(Z=ie.length,x=0;x<Z;x+=1)ce[x]=v(x,ie)||"null";return Y=ce.length===0?"[]":n?`[
`+n+ce.join(`,
`+n)+`
`+Ae+"]":"["+ce.join(",")+"]",n=Ae,Y}if(o&&typeof o=="object")for(Z=o.length,x=0;x<Z;x+=1)typeof o[x]=="string"&&(Y=v(H=o[x],ie))&&ce.push(T(H)+(n?": ":":")+Y);else for(H in ie)Object.prototype.hasOwnProperty.call(ie,H)&&(Y=v(H,ie))&&ce.push(T(H)+(n?": ":":")+Y);return Y=ce.length===0?"{}":n?`{
`+n+ce.join(`,
`+n)+`
`+Ae+"}":"{"+ce.join(",")+"}",n=Ae,Y}}("",{"":R})}),typeof i.parse!="function"&&(i.parse=(g={"\\":"\\",'"':'"',"/":"/",t:"	",n:`
`,r:"\r",f:"\f",b:"\b"},f={go:function(){l="ok"},firstokey:function(){u=p,l="colon"},okey:function(){u=p,l="colon"},ovalue:function(){l="ocomma"},firstavalue:function(){l="acomma"},avalue:function(){l="acomma"}},m={go:function(){l="ok"},ovalue:function(){l="ocomma"},firstavalue:function(){l="acomma"},avalue:function(){l="acomma"}},E={"{":{go:function(){h.push({state:"ok"}),d={},l="firstokey"},ovalue:function(){h.push({container:d,state:"ocomma",key:u}),d={},l="firstokey"},firstavalue:function(){h.push({container:d,state:"acomma"}),d={},l="firstokey"},avalue:function(){h.push({container:d,state:"acomma"}),d={},l="firstokey"}},"}":{firstokey:function(){var R=h.pop();p=d,d=R.container,u=R.key,l=R.state},ocomma:function(){var R=h.pop();d[u]=p,p=d,d=R.container,u=R.key,l=R.state}},"[":{go:function(){h.push({state:"ok"}),d=[],l="firstavalue"},ovalue:function(){h.push({container:d,state:"ocomma",key:u}),d=[],l="firstavalue"},firstavalue:function(){h.push({container:d,state:"acomma"}),d=[],l="firstavalue"},avalue:function(){h.push({container:d,state:"acomma"}),d=[],l="firstavalue"}},"]":{firstavalue:function(){var R=h.pop();p=d,d=R.container,u=R.key,l=R.state},acomma:function(){var R=h.pop();d.push(p),p=d,d=R.container,u=R.key,l=R.state}},":":{colon:function(){if(Object.hasOwnProperty.call(d,u))throw new SyntaxError("Duplicate key '"+u+'"');l="ovalue"}},",":{ocomma:function(){d[u]=p,l="okey"},acomma:function(){d.push(p),l="avalue"}},true:{go:function(){p=!0,l="ok"},ovalue:function(){p=!0,l="ocomma"},firstavalue:function(){p=!0,l="acomma"},avalue:function(){p=!0,l="acomma"}},false:{go:function(){p=!1,l="ok"},ovalue:function(){p=!1,l="ocomma"},firstavalue:function(){p=!1,l="acomma"},avalue:function(){p=!1,l="acomma"}},null:{go:function(){p=null,l="ok"},ovalue:function(){p=null,l="ocomma"},firstavalue:function(){p=null,l="acomma"},avalue:function(){p=null,l="acomma"}}},function(R,b){var w,C,v=/^[\u0020\t\n\r]*(?:([,:\[\]{}]|true|false|null)|(-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)|"((?:[^\r\n\t\\\"]|\\(?:["\\\/trnfb]|u[0-9a-fA-F]{4}))*)")/;l="go",h=[];try{for(;w=v.exec(R);)w[1]?E[w[1]][l]():w[2]?(p=+w[2],m[l]()):(C=w[3],p=C.replace(/\\(?:u(.{4})|([^u]))/g,function(N,B,x){return B?String.fromCharCode(parseInt(B,16)):g[x]}),f[l]()),R=R.slice(w[0].length)}catch(N){l=N}if(l!=="ok"||/[^\u0020\t\n\r]/.test(R))throw l instanceof SyntaxError?l:new SyntaxError("JSON");return typeof b=="function"?function N(B,x){var H,Y,Z=B[x];if(Z&&typeof Z=="object")for(H in p)Object.prototype.hasOwnProperty.call(Z,H)&&((Y=N(Z,H))!==void 0?Z[H]=Y:delete Z[H]);return b.call(B,x,Z)}({"":p},""):p}))}},function(t,s,i){function n(r,c,o){if(c.hasOwnProperty&&c.hasOwnProperty("addEventListener")){for(var l=c.addEventListener;l._rollbarOldAdd&&l.belongsToShim;)l=l._rollbarOldAdd;var h=function(p,g,f){l.call(this,p,r.wrap(g),f)};h._rollbarOldAdd=l,h.belongsToShim=o,c.addEventListener=h;for(var d=c.removeEventListener;d._rollbarOldRemove&&d.belongsToShim;)d=d._rollbarOldRemove;var u=function(p,g,f){d.call(this,p,g&&g._rollbar_wrapped||g,f)};u._rollbarOldRemove=d,u.belongsToShim=o,c.removeEventListener=u}}t.exports=function(r,c,o){if(r){var l,h,d="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(l=0;l<d.length;++l)r[h=d[l]]&&r[h].prototype&&n(c,r[h].prototype,o)}}},function(t,s,i){var n=i(0),r=i(5);function c(f,m){return[f,n.stringify(f,m)]}function o(f,m){var E=f.length;return E>2*m?f.slice(0,m).concat(f.slice(E-m)):f}function l(f,m,E){E=E===void 0?30:E;var A,S=f.data.body;if(S.trace_chain)for(var I=S.trace_chain,T=0;T<I.length;T++)A=o(A=I[T].frames,E),I[T].frames=A;else S.trace&&(A=o(A=S.trace.frames,E),S.trace.frames=A);return[f,n.stringify(f,m)]}function h(f,m){return m&&m.length>f?m.slice(0,f-3).concat("..."):m}function d(f,m,E){return[m=r(m,function A(S,I,T){switch(n.typeName(I)){case"string":return h(f,I);case"object":case"array":return r(I,A,T);default:return I}}),n.stringify(m,E)]}function u(f){return f.exception&&(delete f.exception.description,f.exception.message=h(255,f.exception.message)),f.frames=o(f.frames,1),f}function p(f,m){var E=f.data.body;if(E.trace_chain)for(var A=E.trace_chain,S=0;S<A.length;S++)A[S]=u(A[S]);else E.trace&&(E.trace=u(E.trace));return[f,n.stringify(f,m)]}function g(f,m){return n.maxByteSize(f)>m}t.exports={truncate:function(f,m,E){E=E===void 0?524288:E;for(var A,S,I,T=[c,l,d.bind(null,1024),d.bind(null,512),d.bind(null,256),p];A=T.shift();)if(f=(S=A(f,m))[0],(I=S[1]).error||!g(I.value,E))return I;return I},raw:c,truncateFrames:l,truncateStrings:d,maybeTruncateValue:h}}])})})(ap);const rp=Ku(en),op="production",cp="e489e79559354d9c987f4f7474b427a5",lp="53",hp="webpack:///./",up="master",{UseMockup:dp,FilterError:pi,ListPlayerDevIds:pp}=GameCore.Configs.Rollbar;class gp extends Phaser.Plugins.BasePlugin{enable;rollbar;events=[];setup(){this.rollbar=new rp({accessToken:cp,checkIgnore:this.checkIgnore,onSendCallback:this.beforeSend,captureUncaught:!0,scrubTelemetryInputs:!0,captureUnhandledRejections:!0,autoInstrument:{dom:!1,navigation:!1},payload:{environment:op,client:{javascript:{code_version:lp}},server:{root:hp,branch:up}}}),this.enable=!0,this.sendTestException()}configure(e){this.rollbar&&this.rollbar.configure(e)}sendTestException(){const e=this.game.facebook.getPlayerID();pp.includes(e)&&this.rollbar.debug(new Error("Test rollbar"),{playerID:e})}beforeSend=(e,t,s)=>{dp&&this.showPopupError(s)};checkIgnore=(e,t,s)=>{try{return this.isErrorIgnore(t)?(console.warn(t),!0):!1}catch{return!1}};showPopupError=e=>{const t=e?.body?.trace?.exception;t&&this.events.push(t);const s=e?.body?.trace?.frames||[];this.events.push(...s);let i=document.getElementById("popup-error");i||(i=document.createElement("div"),i.id="popup-error",document.body.appendChild(i)),i.innerHTML=`<div style="color: #fff; display: flex; flex-flow: column; align-items: center; ">
      <pre id="json" style="overflow: auto; background-color: rgb(195 112 97 / 80%); padding: 10px; max-height: 80vh; max-width: 90vw; border: 5px solid #545454;">${JSON.stringify(this.events,null,2)}</pre>
      <button id="close" style="cursor: pointer; padding: 10px 20px; border-radius: 100px;">Close</button>
      </div>`,i.style="top: 0px; z-index: 10000; width: 100vw; max-height: 100vh; position: absolute; display: flex; align-items: center; justify-content: center;";const n=document.getElementById("close");n&&(n.onclick=this.closePopup)};closePopup=()=>{this.events=[{}],document.getElementById("popup-error")?.remove()};isErrorIgnore=e=>{if(!e||e.length===0)return!1;let t=!1;const s=e[0];return s instanceof Object&&(t=this.isIgnoreByCode(s)||this.isIgnoreByMessage(s)),t};isIgnoreByCode=e=>{if(GameCore.Utils.Object.hasOwn(e,"code")){const{code:t}=e,{accepted:s,ignored:i}=pi.Codes;if(typeof t=="string"){if(s.indexOf(t)>=0)return!1;if(i.indexOf(t)>=0)return!0}}else if(GameCore.Utils.Object.hasOwn(e,"name")){const{name:t}=e,{accepted:s,ignored:i}=pi.Codes;if(typeof t=="string"){if(s.indexOf(t)>=0)return!1;if(i.indexOf(t)>=0)return!0}}return!1};isIgnoreByMessage=e=>{if(GameCore.Utils.Object.hasOwn(e,"message")){const{message:t}=e,{accepted:s,ignored:i}=pi.Messages;if(typeof t=="string"){if(s.indexOf(t)>=0)return!1;if(i.indexOf(t)>=0)return!0}}return!1};addExtraState=()=>{try{if(!GameCore.Utils.Object.hasOwn(window,"game")||!GameCore.Utils.Object.hasOwn(window.game,"storage")||!GameCore.Utils.Object.hasOwn(window.game.storage,"getState"))return;const{getState:e}=window.game.storage,t=e(),{player:s,match:i,...n}=t||{};this.rollbar.configure({payload:{player:s,match:i,other:n}})}catch(e){console.warn("%c addExtraState: ","font-size:12px;background-color: #42b983;color:#fff;",e)}};sendException(e,t){if(e){if(!this.enable){console.error(e);return}this.rollbar&&(this.addExtraState(),this.rollbar.error(e,t))}}}class fp extends Phaser.Events.EventEmitter{emit(e,t){return super.emit(e,t)}}class Ep extends Phaser.GameObjects.Container{zone;background;constructor(e,t,s,i){super(e),this.setName(t),this.setVisible(!1);const{width:n,height:r}=this.scene.world.getWorldSize();this.setSize(s||n,i||r),this.addZone(),this.addBackground()}open(e){GameCore.Utils.Valid.isObject(e)&&(this.setDataEnabled(),this.setData(e)),this.setBlockInputOutsideEnabled(!0),this.scene.screen.bringToTop(this.name),!this.visible&&(this.setVisible(!0),this.logPageviewOnOpen(),this.logEventOpen())}close(){(this.scene.screen.get(P.UNITS_SCREEN)?.visible===!1||this.name===P.UNITS_SCREEN)&&this.setBlockInputOutsideEnabled(!1),this.visible&&(this.setVisible(!1),this.logPageviewOnClose())}incY(e){this.y+=e,this.background.y-=e}incX(e){this.x+=e,this.background.x-=e}incScale(e){this.scale+=e,this.background.scale-=e^e*(100/e)}setBlockInputOutsideEnabled(e){this.scene.input.setTopOnly(e)}addZone(){this.zone=this.scene.add.zone(0,0,this.width,this.height),this.zone.setInteractive({}),this.add(this.zone)}addBackground(){const e="screen-background";if(!this.scene.textures.exists(e)){const t=this.width+2,s=this.height+2,i=this.scene.add.graphics();i.fillStyle(0,1),i.fillRect(0,0,t,s),i.generateTexture(e,t,s),i.destroy()}this.background=this.scene.add.image(0,0,e),this.add(this.background)}logPageviewOnOpen(){this.scene.analytics.pageview(this.name)}logPageviewOnClose(){this.scene.analytics.pageview(this.scene.scene.key)}logEventOpen(){this.scene.analytics.event(G.SCREEN_OPEN,{screen_name:this.getScreenName()})}getScreenName(){return GameCore.Utils.String.toUpperCamelCase(this.name.toLowerCase())}}GameCore.Screen=Ep;GameCore.Screens={Events:Du};let mp=class extends Phaser.Plugins.ScenePlugin{events;boot(){this.events=new fp,this.registryScreenFactory()}get(e){const t=this.scene.children.getByName(e);return t===null?null:t}add(e,t,s,i){let n=this.get(e);return n||(n=this.scene.add.screen(e,t,s,i),this.events.emit(GameCore.Screens.Events.CREATED,n),n)}open(e,t){const s=this.get(e);return s?(s.open(t),s.emit(GameCore.Screens.Events.OPEN,s),this.events.emit(GameCore.Screens.Events.OPEN,s),console.log("Screen open",e,t),!0):!1}close(e){const t=this.get(e);return t?(t.close(),t.emit(GameCore.Screens.Events.CLOSE,t),this.events.emit(GameCore.Screens.Events.CLOSE,t),console.log("Screen close",e),!0):!1}bringToTop(e){const t=this.scene.children.getByName(e);t&&this.scene.children.bringToTop(t)}registryScreenFactory(){Phaser.GameObjects.GameObjectFactory.register("screen",this.createScreen)}createScreen(e,t,s,i){const n=new t(this.scene,e,s,i);return Phaser.Display.Align.In.Center(n,this.scene.gameZone),this.existing(n),n}};var tn={},Ap={get exports(){return tn},set exports(a){tn=a}};(function(a){(function(e,t){a.exports=t()})(Bo,function(){var e=Object.prototype.toString;function t(d,u){return d==null?!1:Object.prototype.hasOwnProperty.call(d,u)}function s(d){if(!d||r(d)&&d.length===0)return!0;if(typeof d!="string"){for(var u in d)if(t(d,u))return!1;return!0}return!1}function i(d){return e.call(d)}function n(d){return typeof d=="object"&&i(d)==="[object Object]"}var r=Array.isArray||function(d){return e.call(d)==="[object Array]"};function c(d){return typeof d=="boolean"||i(d)==="[object Boolean]"}function o(d){var u=parseInt(d);return u.toString()===d?u:d}function l(d){d=d||{};var u=function(E){return Object.keys(u).reduce(function(A,S){return S==="create"||typeof u[S]=="function"&&(A[S]=u[S].bind(u,E)),A},{})},p;d.includeInheritedProps?p=function(){return!0}:p=function(E,A){return typeof A=="number"&&Array.isArray(E)||t(E,A)};function g(E,A){if(p(E,A))return E[A]}var f;d.includeInheritedProps?f=function(E,A){typeof A!="string"&&typeof A!="number"&&(A=String(A));var S=g(E,A);if(A==="__proto__"||A==="prototype"||A==="constructor"&&typeof S=="function")throw new Error("For security reasons, object's magic properties cannot be set");return S}:f=function(E,A){return g(E,A)};function m(E,A,S,I){if(typeof A=="number"&&(A=[A]),!A||A.length===0)return E;if(typeof A=="string")return m(E,A.split(".").map(o),S,I);var T=A[0],R=f(E,T);return A.length===1?((R===void 0||!I)&&(E[T]=S),R):(R===void 0&&(typeof A[1]=="number"?E[T]=[]:E[T]={}),m(E[T],A.slice(1),S,I))}return u.has=function(E,A){if(typeof A=="number"?A=[A]:typeof A=="string"&&(A=A.split(".")),!A||A.length===0)return!!E;for(var S=0;S<A.length;S++){var I=o(A[S]);if(typeof I=="number"&&r(E)&&I<E.length||(d.includeInheritedProps?I in Object(E):t(E,I)))E=E[I];else return!1}return!0},u.ensureExists=function(E,A,S){return m(E,A,S,!0)},u.set=function(E,A,S,I){return m(E,A,S,I)},u.insert=function(E,A,S,I){var T=u.get(E,A);I=~~I,r(T)||(T=[],u.set(E,A,T)),T.splice(I,0,S)},u.empty=function(E,A){if(!s(A)&&E!=null){var S,I;if(S=u.get(E,A)){if(typeof S=="string")return u.set(E,A,"");if(c(S))return u.set(E,A,!1);if(typeof S=="number")return u.set(E,A,0);if(r(S))S.length=0;else if(n(S))for(I in S)p(S,I)&&delete S[I];else return u.set(E,A,null)}}},u.push=function(E,A){var S=u.get(E,A);r(S)||(S=[],u.set(E,A,S)),S.push.apply(S,Array.prototype.slice.call(arguments,2))},u.coalesce=function(E,A,S){for(var I,T=0,R=A.length;T<R;T++)if((I=u.get(E,A[T]))!==void 0)return I;return S},u.get=function(E,A,S){if(typeof A=="number"&&(A=[A]),!A||A.length===0)return E;if(E==null)return S;if(typeof A=="string")return u.get(E,A.split("."),S);var I=o(A[0]),T=f(E,I);return T===void 0?S:A.length===1?T:u.get(E[I],A.slice(1),S)},u.del=function(A,S){if(typeof S=="number"&&(S=[S]),A==null||s(S))return A;if(typeof S=="string")return u.del(A,S.split("."));var I=o(S[0]);if(f(A,I),!p(A,I))return A;if(S.length===1)r(A)?A.splice(I,1):delete A[I];else return u.del(A[I],S.slice(1));return A},u}var h=l();return h.create=l,h.withInheritedProps=l({includeInheritedProps:!0}),h})})(Ap);var oa=tn.get;function Sp(a,e){return a===e}function yp(a,e,t){t=t||Sp;var s=oa(a(),e);return function(n){return function(){var r=oa(a(),e);if(!t(s,r)){var c=s;s=r,n(r,c,e)}}}}var Tp=yp;const Ip=Tp;function ms(a){return ms=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ms(a)}function Cp(a,e){if(ms(a)!=="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var s=t.call(a,e||"default");if(ms(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function Rp(a){var e=Cp(a,"string");return ms(e)==="symbol"?e:String(e)}function _p(a,e,t){return e=Rp(e),e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function ca(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,s)}return t}function la(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ca(Object(t),!0).forEach(function(s){_p(a,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):ca(Object(t)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(t,s))})}return a}function Ee(a){return"Minified Redux error #"+a+"; visit https://redux.js.org/Errors?code="+a+" for the full message or use the non-minified dev environment for full errors. "}var ha=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),gi=function(){return Math.random().toString(36).substring(7).split("").join(".")},$s={INIT:"@@redux/INIT"+gi(),REPLACE:"@@redux/REPLACE"+gi(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+gi()}};function vp(a){if(typeof a!="object"||a===null)return!1;for(var e=a;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(a)===e}function cc(a,e,t){var s;if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(Ee(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(Ee(1));return t(cc)(a,e)}if(typeof a!="function")throw new Error(Ee(2));var i=a,n=e,r=[],c=r,o=!1;function l(){c===r&&(c=r.slice())}function h(){if(o)throw new Error(Ee(3));return n}function d(f){if(typeof f!="function")throw new Error(Ee(4));if(o)throw new Error(Ee(5));var m=!0;return l(),c.push(f),function(){if(m){if(o)throw new Error(Ee(6));m=!1,l();var A=c.indexOf(f);c.splice(A,1),r=null}}}function u(f){if(!vp(f))throw new Error(Ee(7));if(typeof f.type>"u")throw new Error(Ee(8));if(o)throw new Error(Ee(9));try{o=!0,n=i(n,f)}finally{o=!1}for(var m=r=c,E=0;E<m.length;E++){var A=m[E];A()}return f}function p(f){if(typeof f!="function")throw new Error(Ee(10));i=f,u({type:$s.REPLACE})}function g(){var f,m=d;return f={subscribe:function(A){if(typeof A!="object"||A===null)throw new Error(Ee(11));function S(){A.next&&A.next(h())}S();var I=m(S);return{unsubscribe:I}}},f[ha]=function(){return this},f}return u({type:$s.INIT}),s={dispatch:u,subscribe:d,getState:h,replaceReducer:p},s[ha]=g,s}function wp(a){Object.keys(a).forEach(function(e){var t=a[e],s=t(void 0,{type:$s.INIT});if(typeof s>"u")throw new Error(Ee(12));if(typeof t(void 0,{type:$s.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Ee(13))})}function lc(a){for(var e=Object.keys(a),t={},s=0;s<e.length;s++){var i=e[s];typeof a[i]=="function"&&(t[i]=a[i])}var n=Object.keys(t),r;try{wp(t)}catch(c){r=c}return function(o,l){if(o===void 0&&(o={}),r)throw r;for(var h=!1,d={},u=0;u<n.length;u++){var p=n[u],g=t[p],f=o[p],m=g(f,l);if(typeof m>"u")throw l&&l.type,new Error(Ee(14));d[p]=m,h=h||m!==f}return h=h||n.length!==Object.keys(o).length,h?d:o}}function hc(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++)e[t]=arguments[t];return e.length===0?function(s){return s}:e.length===1?e[0]:e.reduce(function(s,i){return function(){return s(i.apply(void 0,arguments))}})}function Lp(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++)e[t]=arguments[t];return function(s){return function(){var i=s.apply(void 0,arguments),n=function(){throw new Error(Ee(15))},r={getState:i.getState,dispatch:function(){return n.apply(void 0,arguments)}},c=e.map(function(o){return o(r)});return n=hc.apply(void 0,c)(i.dispatch),la(la({},i),{},{dispatch:n})}}}function uc(a){var e=function(s){var i=s.dispatch,n=s.getState;return function(r){return function(c){return typeof c=="function"?c(i,n,a):r(c)}}};return e}var dc=uc();dc.withExtraArgument=uc;const bp=dc;function He(a){for(var e=arguments.length,t=Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+a+(t.length?" "+t.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Nt(a){return!!a&&!!a[oe]}function Mt(a){var e;return!!a&&(function(t){if(!t||typeof t!="object")return!1;var s=Object.getPrototypeOf(t);if(s===null)return!0;var i=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===Bp}(a)||Array.isArray(a)||!!a[ma]||!!(!((e=a.constructor)===null||e===void 0)&&e[ma])||yn(a)||Tn(a))}function kt(a,e,t){t===void 0&&(t=!1),ts(a)===0?(t?Object.keys:Xt)(a).forEach(function(s){t&&typeof s=="symbol"||e(s,a[s],a)}):a.forEach(function(s,i){return e(i,s,a)})}function ts(a){var e=a[oe];return e?e.i>3?e.i-4:e.i:Array.isArray(a)?1:yn(a)?2:Tn(a)?3:0}function zt(a,e){return ts(a)===2?a.has(e):Object.prototype.hasOwnProperty.call(a,e)}function Pp(a,e){return ts(a)===2?a.get(e):a[e]}function pc(a,e,t){var s=ts(a);s===2?a.set(e,t):s===3?a.add(t):a[e]=t}function gc(a,e){return a===e?a!==0||1/a==1/e:a!=a&&e!=e}function yn(a){return Up&&a instanceof Map}function Tn(a){return xp&&a instanceof Set}function Ot(a){return a.o||a.t}function In(a){if(Array.isArray(a))return Array.prototype.slice.call(a);var e=Ec(a);delete e[oe];for(var t=Xt(e),s=0;s<t.length;s++){var i=t[s],n=e[i];n.writable===!1&&(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(e[i]={configurable:!0,writable:!0,enumerable:n.enumerable,value:a[i]})}return Object.create(Object.getPrototypeOf(a),e)}function Cn(a,e){return e===void 0&&(e=!1),Rn(a)||Nt(a)||!Mt(a)||(ts(a)>1&&(a.set=a.add=a.clear=a.delete=Op),Object.freeze(a),e&&kt(a,function(t,s){return Cn(s,!0)},!0)),a}function Op(){He(2)}function Rn(a){return a==null||typeof a!="object"||Object.isFrozen(a)}function je(a){var e=rn[a];return e||He(18,a),e}function Dp(a,e){rn[a]||(rn[a]=e)}function sn(){return As}function fi(a,e){e&&(je("Patches"),a.u=[],a.s=[],a.v=e)}function zs(a){nn(a),a.p.forEach(Np),a.p=null}function nn(a){a===As&&(As=a.l)}function ua(a){return As={p:[],l:As,h:a,m:!0,_:0}}function Np(a){var e=a[oe];e.i===0||e.i===1?e.j():e.g=!0}function Ei(a,e){e._=e.p.length;var t=e.p[0],s=a!==void 0&&a!==t;return e.h.O||je("ES5").S(e,a,s),s?(t[oe].P&&(zs(e),He(4)),Mt(a)&&(a=Xs(e,a),e.l||qs(e,a)),e.u&&je("Patches").M(t[oe].t,a,e.u,e.s)):a=Xs(e,t,[]),zs(e),e.u&&e.v(e.u,e.s),a!==fc?a:void 0}function Xs(a,e,t){if(Rn(e))return e;var s=e[oe];if(!s)return kt(e,function(c,o){return da(a,s,e,c,o,t)},!0),e;if(s.A!==a)return e;if(!s.P)return qs(a,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var i=s.i===4||s.i===5?s.o=In(s.k):s.o,n=i,r=!1;s.i===3&&(n=new Set(i),i.clear(),r=!0),kt(n,function(c,o){return da(a,s,i,c,o,t,r)}),qs(a,i,!1),t&&a.u&&je("Patches").N(s,t,a.u,a.s)}return s.o}function da(a,e,t,s,i,n,r){if(Nt(i)){var c=Xs(a,i,n&&e&&e.i!==3&&!zt(e.R,s)?n.concat(s):void 0);if(pc(t,s,c),!Nt(c))return;a.m=!1}else r&&t.add(i);if(Mt(i)&&!Rn(i)){if(!a.h.D&&a._<1)return;Xs(a,i),e&&e.A.l||qs(a,i)}}function qs(a,e,t){t===void 0&&(t=!1),!a.l&&a.h.D&&a.m&&Cn(e,t)}function mi(a,e){var t=a[oe];return(t?Ot(t):a)[e]}function pa(a,e){if(e in a)for(var t=Object.getPrototypeOf(a);t;){var s=Object.getOwnPropertyDescriptor(t,e);if(s)return s;t=Object.getPrototypeOf(t)}}function ft(a){a.P||(a.P=!0,a.l&&ft(a.l))}function Ai(a){a.o||(a.o=In(a.t))}function an(a,e,t){var s=yn(e)?je("MapSet").F(e,t):Tn(e)?je("MapSet").T(e,t):a.O?function(i,n){var r=Array.isArray(i),c={i:r?1:0,A:n?n.A:sn(),P:!1,I:!1,R:{},l:n,t:i,k:null,o:null,j:null,C:!1},o=c,l=Ss;r&&(o=[c],l=ps);var h=Proxy.revocable(o,l),d=h.revoke,u=h.proxy;return c.k=u,c.j=d,u}(e,t):je("ES5").J(e,t);return(t?t.A:sn()).p.push(s),s}function Mp(a){return Nt(a)||He(22,a),function e(t){if(!Mt(t))return t;var s,i=t[oe],n=ts(t);if(i){if(!i.P&&(i.i<4||!je("ES5").K(i)))return i.t;i.I=!0,s=ga(t,n),i.I=!1}else s=ga(t,n);return kt(s,function(r,c){i&&Pp(i.t,r)===c||pc(s,r,e(c))}),n===3?new Set(s):s}(a)}function ga(a,e){switch(e){case 2:return new Map(a);case 3:return Array.from(a)}return In(a)}function kp(){function a(n,r){var c=i[n];return c?c.enumerable=r:i[n]=c={configurable:!0,enumerable:r,get:function(){var o=this[oe];return Ss.get(o,n)},set:function(o){var l=this[oe];Ss.set(l,n,o)}},c}function e(n){for(var r=n.length-1;r>=0;r--){var c=n[r][oe];if(!c.P)switch(c.i){case 5:s(c)&&ft(c);break;case 4:t(c)&&ft(c)}}}function t(n){for(var r=n.t,c=n.k,o=Xt(c),l=o.length-1;l>=0;l--){var h=o[l];if(h!==oe){var d=r[h];if(d===void 0&&!zt(r,h))return!0;var u=c[h],p=u&&u[oe];if(p?p.t!==d:!gc(u,d))return!0}}var g=!!r[oe];return o.length!==Xt(r).length+(g?0:1)}function s(n){var r=n.k;if(r.length!==n.t.length)return!0;var c=Object.getOwnPropertyDescriptor(r,r.length-1);if(c&&!c.get)return!0;for(var o=0;o<r.length;o++)if(!r.hasOwnProperty(o))return!0;return!1}var i={};Dp("ES5",{J:function(n,r){var c=Array.isArray(n),o=function(h,d){if(h){for(var u=Array(d.length),p=0;p<d.length;p++)Object.defineProperty(u,""+p,a(p,!0));return u}var g=Ec(d);delete g[oe];for(var f=Xt(g),m=0;m<f.length;m++){var E=f[m];g[E]=a(E,h||!!g[E].enumerable)}return Object.create(Object.getPrototypeOf(d),g)}(c,n),l={i:c?5:4,A:r?r.A:sn(),P:!1,I:!1,R:{},l:r,t:n,k:o,o:null,g:!1,C:!1};return Object.defineProperty(o,oe,{value:l,writable:!0}),o},S:function(n,r,c){c?Nt(r)&&r[oe].A===n&&e(n.p):(n.u&&function o(l){if(l&&typeof l=="object"){var h=l[oe];if(h){var d=h.t,u=h.k,p=h.R,g=h.i;if(g===4)kt(u,function(S){S!==oe&&(d[S]!==void 0||zt(d,S)?p[S]||o(u[S]):(p[S]=!0,ft(h)))}),kt(d,function(S){u[S]!==void 0||zt(u,S)||(p[S]=!1,ft(h))});else if(g===5){if(s(h)&&(ft(h),p.length=!0),u.length<d.length)for(var f=u.length;f<d.length;f++)p[f]=!1;else for(var m=d.length;m<u.length;m++)p[m]=!0;for(var E=Math.min(u.length,d.length),A=0;A<E;A++)u.hasOwnProperty(A)||(p[A]=!0),p[A]===void 0&&o(u[A])}}}}(n.p[0]),e(n.p))},K:function(n){return n.i===4?t(n):s(n)}})}var fa,As,_n=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Up=typeof Map<"u",xp=typeof Set<"u",Ea=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",fc=_n?Symbol.for("immer-nothing"):((fa={})["immer-nothing"]=!0,fa),ma=_n?Symbol.for("immer-draftable"):"__$immer_draftable",oe=_n?Symbol.for("immer-state"):"__$immer_state";var Bp=""+Object.prototype.constructor,Xt=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:Object.getOwnPropertyNames,Ec=Object.getOwnPropertyDescriptors||function(a){var e={};return Xt(a).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(a,t)}),e},rn={},Ss={get:function(a,e){if(e===oe)return a;var t=Ot(a);if(!zt(t,e))return function(i,n,r){var c,o=pa(n,r);return o?"value"in o?o.value:(c=o.get)===null||c===void 0?void 0:c.call(i.k):void 0}(a,t,e);var s=t[e];return a.I||!Mt(s)?s:s===mi(a.t,e)?(Ai(a),a.o[e]=an(a.A.h,s,a)):s},has:function(a,e){return e in Ot(a)},ownKeys:function(a){return Reflect.ownKeys(Ot(a))},set:function(a,e,t){var s=pa(Ot(a),e);if(s?.set)return s.set.call(a.k,t),!0;if(!a.P){var i=mi(Ot(a),e),n=i?.[oe];if(n&&n.t===t)return a.o[e]=t,a.R[e]=!1,!0;if(gc(t,i)&&(t!==void 0||zt(a.t,e)))return!0;Ai(a),ft(a)}return a.o[e]===t&&(t!==void 0||e in a.o)||Number.isNaN(t)&&Number.isNaN(a.o[e])||(a.o[e]=t,a.R[e]=!0),!0},deleteProperty:function(a,e){return mi(a.t,e)!==void 0||e in a.t?(a.R[e]=!1,Ai(a),ft(a)):delete a.R[e],a.o&&delete a.o[e],!0},getOwnPropertyDescriptor:function(a,e){var t=Ot(a),s=Reflect.getOwnPropertyDescriptor(t,e);return s&&{writable:!0,configurable:a.i!==1||e!=="length",enumerable:s.enumerable,value:t[e]}},defineProperty:function(){He(11)},getPrototypeOf:function(a){return Object.getPrototypeOf(a.t)},setPrototypeOf:function(){He(12)}},ps={};kt(Ss,function(a,e){ps[a]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),ps.deleteProperty=function(a,e){return ps.set.call(this,a,e,void 0)},ps.set=function(a,e,t){return Ss.set.call(this,a[0],e,t,a[0])};var Fp=function(){function a(t){var s=this;this.O=Ea,this.D=!0,this.produce=function(i,n,r){if(typeof i=="function"&&typeof n!="function"){var c=n;n=i;var o=s;return function(f){var m=this;f===void 0&&(f=c);for(var E=arguments.length,A=Array(E>1?E-1:0),S=1;S<E;S++)A[S-1]=arguments[S];return o.produce(f,function(I){var T;return(T=n).call.apply(T,[m,I].concat(A))})}}var l;if(typeof n!="function"&&He(6),r!==void 0&&typeof r!="function"&&He(7),Mt(i)){var h=ua(s),d=an(s,i,void 0),u=!0;try{l=n(d),u=!1}finally{u?zs(h):nn(h)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(f){return fi(h,r),Ei(f,h)},function(f){throw zs(h),f}):(fi(h,r),Ei(l,h))}if(!i||typeof i!="object"){if((l=n(i))===void 0&&(l=i),l===fc&&(l=void 0),s.D&&Cn(l,!0),r){var p=[],g=[];je("Patches").M(i,l,p,g),r(p,g)}return l}He(21,i)},this.produceWithPatches=function(i,n){if(typeof i=="function")return function(l){for(var h=arguments.length,d=Array(h>1?h-1:0),u=1;u<h;u++)d[u-1]=arguments[u];return s.produceWithPatches(l,function(p){return i.apply(void 0,[p].concat(d))})};var r,c,o=s.produce(i,n,function(l,h){r=l,c=h});return typeof Promise<"u"&&o instanceof Promise?o.then(function(l){return[l,r,c]}):[o,r,c]},typeof t?.useProxies=="boolean"&&this.setUseProxies(t.useProxies),typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=a.prototype;return e.createDraft=function(t){Mt(t)||He(8),Nt(t)&&(t=Mp(t));var s=ua(this),i=an(this,t,void 0);return i[oe].C=!0,nn(s),i},e.finishDraft=function(t,s){var i=t&&t[oe],n=i.A;return fi(n,s),Ei(void 0,n)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!Ea&&He(20),this.O=t},e.applyPatches=function(t,s){var i;for(i=s.length-1;i>=0;i--){var n=s[i];if(n.path.length===0&&n.op==="replace"){t=n.value;break}}i>-1&&(s=s.slice(i+1));var r=je("Patches").$;return Nt(t)?r(t,s):this.produce(t,function(c){return r(c,s)})},a}(),_e=new Fp,Gp=_e.produce;_e.produceWithPatches.bind(_e);_e.setAutoFreeze.bind(_e);_e.setUseProxies.bind(_e);_e.applyPatches.bind(_e);_e.createDraft.bind(_e);_e.finishDraft.bind(_e);const ke=Gp,Hp={currentSceneKey:"",prevSceneKey:""},Yp=(a=Hp,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{sceneKey:i}=s;switch(e.type){case Mo:t.currentSceneKey=i,t.prevSceneKey=a.currentSceneKey;break}});kp();const mc={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},currentGameMode:"",isRequestingDetectGameMode:!0},Si=mc,Kp=(a=mc,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{gameMode:i,contextId:n,contextType:r,entryPointData:c,isRequestingDetectGameMode:o}=s;switch(e.type){case bo:t.contextId=n,t.contextType=r,t.entryPointData=c;break;case ku:t.contextId=n,t.contextType=r,t.processed=!0;break;case Po:t.currentGameMode=i,t.isRequestingDetectGameMode=!1;break;case Oo:t.isRequestingDetectGameMode=o;break}}),Vp={data:{}},Wp=(a=Vp,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{opponentId:i}=s;if(typeof i=="string")switch(e.type){case Do:a.data[i]?t.data[i].sent=!0:t.data[i]={sent:!0};break;case No:a.data[i]?t.data[i].sent=!1:t.data[i]={sent:!1};break}}),jp={token:"",isRequesting:!1},$p=(a=jp,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{token:i}=s;switch(e.type){case vo:t.isRequesting=!0;break;case wo:t.token=i,t.isRequesting=!1;break}}),zp={[pn]:$p},Xp={coinBaseValue:0,coinSuffixValue:0},qp=(a=Xp,e)=>ke(a,t=>{const{type:s,payload:i}=e;if(!i)return;const{coinBaseValue:n,coinSuffixValue:r}=i;switch(s){case zo:t.coinBaseValue=n,t.coinSuffixValue=r;break}}),Zp={[Xo]:qp},Ac={settings:{...Zt},userGuideDisplays:0,customFields:{selectedLevel:0,playerUnitData:"",playerLevelProgress:0,meleeUnlockedUnitLevel:0,rangedUnlockedUnitLevel:0,coinBaseValue:0,coinSuffixValue:0,freeCoinsLastUsedTime:0,offlineRewardLastCheck:0,unitScreenAdWatchedCount:{MELEE:{},RANGED:{}}}},Qp={ASID:"",playerId:"",name:"",photo:"",locale:"",connectedPlayers:{},data:{settings:Zt,customFields:Ac.customFields,userGuideDisplays:0},isUserNew:!0},Jp=(a=Qp,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{name:i,value:n,data:r={},score:c,connectedPlayers:o=[],profile:l}=s;switch(e.type){case Jo:{const{playerId:h,name:d,photo:u,locale:p,data:g}=s;if(t.playerId=h,t.name=d,t.photo=u,t.locale=p,GameCore.Utils.Valid.isObject(g)){const f=g;t.data=Me(a.data,f)}g.userGuideDisplays>0&&(t.isUserNew=!1)}break;case sc:{const{playerId:h,name:d,photo:u,locale:p,ASID:g}=l;t.ASID=g,t.playerId=h,t.name=d,t.photo=u,t.locale=p}break;case tc:t.data.score=c;break;case ic:if(!GameCore.Utils.Object.hasOwn(t.data.settings,i))break;t.data.settings[i]=n;break;case ec:t.data=Me(a.data,r),r.userGuideDisplays>0&&(t.isUserNew=!1);break;case nc:{if(o.length<=0)break;const h=GameCore.Utils.Object.keyBy(o,"playerId");t.connectedPlayers=Me(a.connectedPlayers,h)}break}}),eg={[ii]:Jp},tg={data:{},profileIds:[]},sg=(a=tg,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{data:i=[]}=s;switch(e.type){case An:{const n=GameCore.Utils.Object.keyBy(i,"playerId"),r=Object.keys(n);t.data=Me({...a.data},n),t.profileIds=GameCore.Utils.Array.unique([...a.profileIds,...r])}break}}),ig={[Sn]:sg},Sc="match",ng="MATCH_GAMEPLAY_INITIALIZE",ag="MATCH_GAMEPLAY_START",rg="MATCH_GAMEPLAY_FINISH",og="MATCH_GAMEPLAY_UPDATE",cg="MATCH_GAMEPLAY_RESCUE",lg="MATCH_GAMEPLAY_TYPE_UPDATE",hg="MATCH_STATS_DATA_CLEAR",yc="MATCH_STATS_DATA_UPDATE",Tc="MATCH_STATS_CURRENT_UPDATE",ug="MATCH_STATS_CONTEXT_REQUEST",dg="MATCH_STATS_CONTEXT_RECEIVED",pg="MATCH_SINGLE_CREATE_REQUEST",gg="MATCH_SINGLE_DETAIL_REQUEST",fg="MATCH_SINGLE_MOVE_UPDATED",Eg="MATCH_SINGLE_DATA_RECEIVED",mg="MATCH_SINGLE_DATA_CLEAR",Ag="MATCH_CHALLENGE_JOIN_REQUEST",Sg="MATCH_CHALLENGE_CREATE_REQUEST",yg="MATCH_CHALLENGE_FINISH_REQUEST",Tg="MATCH_CHALLENGE_CONTINUE_REQUEST",Ic="MATCH_CHALLENGE_DATA_RECEIVED",Ig="MATCH_CHALLENGE_DATA_CLEAR",Cg="MATCH_GROUP_CREATE_REQUEST",Rg="MATCH_GROUP_FINISH_REQUEST",_g="MATCH_ONLINE_CREATE_REQUEST",Cc="MATCH_ONLINE_DATA_RECEIVED",vg="MATCH_ONLINE_STATS_UPDATE",wg="MATCH_ONLINE_FINISH_REQUEST",Lg="MATCH_ONLINE_DATA_CLEAR",ot={mode:"",status:Wt,rescued:0,startAt:0,finishAt:0,type:"level"},bg=(a=ot,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{mode:i,status:n,type:r}=s;switch(e.type){case ng:t.status=Wt,t.mode=ot.mode,t.rescued=ot.rescued,t.startAt=ot.startAt,t.finishAt=ot.finishAt,t.opponentInfo=ot.opponentInfo,t.type=ot.type;break;case ag:t.mode=i,t.status=Es,t.rescued=ot.rescued,t.startAt=Date.now();break;case og:t.mode=typeof i=="string"?i:a.mode,t.status=n||a.status;break;case rg:t.status=js,t.finishAt=Date.now();break;case cg:t.rescued+=1;break;case lg:t.type=r;break}}),At={single:{_id:"",data:{fen:""},playerId:"",status:Wt},group:{status:Wt,opponentInfo:{playerId:"",name:"",photo:""}},challenge:{_id:"",status:Wt,whitePlayerId:"",blackPlayerId:"",opponentInfo:{playerId:"",name:"",photo:""}},online:{_id:"",status:Wt,players:{}},updateAt:0,isRequesting:!1},Pg=(a=At,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{match:i,opponentInfo:n,players:r}=s;switch(e.type){case pg:case gg:case Ag:case yg:case _g:t.isRequesting=!0;break;case fg:t.single={...a.single,...i},t.updateAt=Date.now();break;case Eg:t.isRequesting=!1,t.single=i||At.single;break;case mg:t.isRequesting=!1,t.single=At.single;break;case Sg:case Tg:t.isRequesting=!0,t.challenge.opponentInfo=n;break;case Ic:t.isRequesting=!1,t.challenge={...i||At.challenge},t.challenge.opponentInfo=a.challenge.opponentInfo;break;case Ig:t.isRequesting=!1,t.challenge=At.challenge;break;case Cg:t.group.status=Es,n&&(t.group.opponentInfo=n);break;case Rg:t.group.status=js;break;case Lg:t.online.status=At.online.status,t.online.players=At.online.players;break;case Cc:t.online.status=Es,t.online.players=r;break;case wg:t.online.status=js;break}}),yi={current:{updateAt:0},data:{updateAt:0},isRequesting:!1},Og=(a=yi,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{playerId:i,stats:n,match:r,current:c,players:o,leaders:l}=s;switch(e.type){case hg:delete t.data[i],t.current=yi.current;break;case ug:t.data=yi.data,t.isRequesting=!0;break;case dg:t.data=n,t.isRequesting=!1;break;case yc:t.data[i]=n;break;case Tc:t.current=Me({...a.current},n);break;case Cc:Object.keys(o).forEach(h=>{t.data[h]={score:0}});break;case vg:l.forEach(h=>{const{playerId:d,score:u,rank:p}=h;t.data[d]={score:u,rank:p}});break;case Ic:{const{blackPlayerId:h,blackPlayerScore:d,whitePlayerId:u,whitePlayerScore:p,whitePlayerLevel:g,blackPlayerLevel:f}=r||{};if(!h||!u)break;c&&(t.current=c),t.data[h]={score:d,level:f},t.data[u]={score:p,level:g}}break}}),Dg={[Sc]:lc({gameplay:bg,match:Pg,stats:Og})},Rc="offline-reward",_c="OFFLINE_REWARD_CHECKING",vc="OFFLINE_REWARD_RECEIVED",wc="OFFLINE_REWARD_RECEIVED_CHECKED",Ng={checked:!1,valueReceived:-1,hasShowReward:!1},Mg=(a=Ng,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{value:i}=s;switch(e.type){case _c:t.checked=!0;break;case vc:t.valueReceived=i;break;case wc:t.hasShowReward=!0}}),kg={[Rc]:Mg},Ug="leaderboards",xg="LEADERBOARD_DATA_REQUEST",Bg="LEADERBOARD_DATA_UPDATE",Fg="LEADERBOARD_DATA_CLEAR",St={leaderboardId:"",type:"",limit:0,offset:0,leaders:{},isRequesting:!1},Gg=(a=St,e)=>ke(a,t=>{const{payload:s}=e;if(!s)return;const{leaderboardId:i,type:n,limit:r,offset:c,leaders:o}=s;switch(e.type){case xg:a.type!==n&&c===0&&(t.leaders=St.leaders),t.isRequesting=!0,t.leaderboardId=i,t.type=n,t.limit=r,t.offset=c;break;case Bg:{if(t.isRequesting=!1,a.type!==n)break;const l=GameCore.Utils.Json.clone({...a.leaders,...o}),d=Object.values(l).filter(u=>!!u.name);d.sort((u,p)=>+p.score-+u.score),d.forEach((u,p)=>{u.rank=p+1,a.leaders[u.playerId]||(t.leaders[u.playerId]=u)})}break;case Fg:t.isRequesting=!1,t.type=St.type,t.limit=St.limit,t.offset=St.offset,t.leaders=St.leaders,t.leaderboardId=St.leaderboardId;break}}),Hg={[Ug]:Gg},Yg=lc({scene:Yp,context:Kp,messages:Wp,...zp,...Zp,...eg,...ig,...kg,...Hg,...Dg}),{__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:fv}=window;let Kg=hc;const Vg=a=>{const e=Kg(Lp(bp));return cc(Yg,a,e)};class Wg extends Phaser.Plugins.BasePlugin{store;initiator;init(){this.store=Vg({})}setInitiator(e){this.initiator=e}async syncStore(){this.initiator.initContext(),await this.initiator.initPlayer()}dispatch=e=>this.store.dispatch(e);getState=()=>this.store.getState();subscribe=e=>this.store.subscribe(e);watch=(e,t)=>{const s=Ip(()=>{const i=this.getState();return e(i)});return this.subscribe(s(i=>{t(i)}))}}var on={},jg={get exports(){return on},set exports(a){on=a}};(function(a){(function(){function e(y,_,D){return y.call.apply(y.bind,arguments)}function t(y,_,D){if(!y)throw Error();if(2<arguments.length){var O=Array.prototype.slice.call(arguments,2);return function(){var U=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(U,O),y.apply(_,U)}}return function(){return y.apply(_,arguments)}}function s(y,_,D){return s=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?e:t,s.apply(null,arguments)}var i=Date.now||function(){return+new Date};function n(y,_){this.a=y,this.o=_||y,this.c=this.o.document}var r=!!window.FontFace;function c(y,_,D,O){if(_=y.c.createElement(_),D)for(var U in D)D.hasOwnProperty(U)&&(U=="style"?_.style.cssText=D[U]:_.setAttribute(U,D[U]));return O&&_.appendChild(y.c.createTextNode(O)),_}function o(y,_,D){y=y.c.getElementsByTagName(_)[0],y||(y=document.documentElement),y.insertBefore(D,y.lastChild)}function l(y){y.parentNode&&y.parentNode.removeChild(y)}function h(y,_,D){_=_||[],D=D||[];for(var O=y.className.split(/\s+/),U=0;U<_.length;U+=1){for(var V=!1,z=0;z<O.length;z+=1)if(_[U]===O[z]){V=!0;break}V||O.push(_[U])}for(_=[],U=0;U<O.length;U+=1){for(V=!1,z=0;z<D.length;z+=1)if(O[U]===D[z]){V=!0;break}V||_.push(O[U])}y.className=_.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function d(y,_){for(var D=y.className.split(/\s+/),O=0,U=D.length;O<U;O++)if(D[O]==_)return!0;return!1}function u(y){return y.o.location.hostname||y.a.location.hostname}function p(y,_,D){function O(){Q&&U&&V&&(Q(z),Q=null)}_=c(y,"link",{rel:"stylesheet",href:_,media:"all"});var U=!1,V=!0,z=null,Q=D||null;r?(_.onload=function(){U=!0,O()},_.onerror=function(){U=!0,z=Error("Stylesheet failed to load"),O()}):setTimeout(function(){U=!0,O()},0),o(y,"head",_)}function g(y,_,D,O){var U=y.c.getElementsByTagName("head")[0];if(U){var V=c(y,"script",{src:_}),z=!1;return V.onload=V.onreadystatechange=function(){z||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(z=!0,D&&D(null),V.onload=V.onreadystatechange=null,V.parentNode.tagName=="HEAD"&&U.removeChild(V))},U.appendChild(V),setTimeout(function(){z||(z=!0,D&&D(Error("Script load timeout")))},O||5e3),V}return null}function f(){this.a=0,this.c=null}function m(y){return y.a++,function(){y.a--,A(y)}}function E(y,_){y.c=_,A(y)}function A(y){y.a==0&&y.c&&(y.c(),y.c=null)}function S(y){this.a=y||"-"}S.prototype.c=function(y){for(var _=[],D=0;D<arguments.length;D++)_.push(arguments[D].replace(/[\W_]+/g,"").toLowerCase());return _.join(this.a)};function I(y,_){this.c=y,this.f=4,this.a="n";var D=(_||"n4").match(/^([nio])([1-9])$/i);D&&(this.a=D[1],this.f=parseInt(D[2],10))}function T(y){return w(y)+" "+(y.f+"00")+" 300px "+R(y.c)}function R(y){var _=[];y=y.split(/,\s*/);for(var D=0;D<y.length;D++){var O=y[D].replace(/['"]/g,"");O.indexOf(" ")!=-1||/^\d/.test(O)?_.push("'"+O+"'"):_.push(O)}return _.join(",")}function b(y){return y.a+y.f}function w(y){var _="normal";return y.a==="o"?_="oblique":y.a==="i"&&(_="italic"),_}function C(y){var _=4,D="n",O=null;return y&&((O=y.match(/(normal|oblique|italic)/i))&&O[1]&&(D=O[1].substr(0,1).toLowerCase()),(O=y.match(/([1-9]00|normal|bold)/i))&&O[1]&&(/bold/i.test(O[1])?_=7:/[1-9]00/.test(O[1])&&(_=parseInt(O[1].substr(0,1),10)))),D+_}function v(y,_){this.c=y,this.f=y.o.document.documentElement,this.h=_,this.a=new S("-"),this.j=_.events!==!1,this.g=_.classes!==!1}function N(y){y.g&&h(y.f,[y.a.c("wf","loading")]),x(y,"loading")}function B(y){if(y.g){var _=d(y.f,y.a.c("wf","active")),D=[],O=[y.a.c("wf","loading")];_||D.push(y.a.c("wf","inactive")),h(y.f,D,O)}x(y,"inactive")}function x(y,_,D){y.j&&y.h[_]&&(D?y.h[_](D.c,b(D)):y.h[_]())}function H(){this.c={}}function Y(y,_,D){var O=[],U;for(U in _)if(_.hasOwnProperty(U)){var V=y.c[U];V&&O.push(V(_[U],D))}return O}function Z(y,_){this.c=y,this.f=_,this.a=c(this.c,"span",{"aria-hidden":"true"},this.f)}function ce(y){o(y.c,"body",y.a)}function Ae(y){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+R(y.c)+";"+("font-style:"+w(y)+";font-weight:"+(y.f+"00")+";")}function ie(y,_,D,O,U,V){this.g=y,this.j=_,this.a=O,this.c=D,this.f=U||3e3,this.h=V||void 0}ie.prototype.start=function(){var y=this.c.o.document,_=this,D=i(),O=new Promise(function(z,Q){function se(){i()-D>=_.f?Q():y.fonts.load(T(_.a),_.h).then(function(he){1<=he.length?z():setTimeout(se,25)},function(){Q()})}se()}),U=null,V=new Promise(function(z,Q){U=setTimeout(Q,_.f)});Promise.race([V,O]).then(function(){U&&(clearTimeout(U),U=null),_.g(_.a)},function(){_.j(_.a)})};function nt(y,_,D,O,U,V,z){this.v=y,this.B=_,this.c=D,this.a=O,this.s=z||"BESbswy",this.f={},this.w=U||3e3,this.u=V||null,this.m=this.j=this.h=this.g=null,this.g=new Z(this.c,this.s),this.h=new Z(this.c,this.s),this.j=new Z(this.c,this.s),this.m=new Z(this.c,this.s),y=new I(this.a.c+",serif",b(this.a)),y=Ae(y),this.g.a.style.cssText=y,y=new I(this.a.c+",sans-serif",b(this.a)),y=Ae(y),this.h.a.style.cssText=y,y=new I("serif",b(this.a)),y=Ae(y),this.j.a.style.cssText=y,y=new I("sans-serif",b(this.a)),y=Ae(y),this.m.a.style.cssText=y,ce(this.g),ce(this.h),ce(this.j),ce(this.m)}var be={D:"serif",C:"sans-serif"},ns=null;function Xe(){if(ns===null){var y=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);ns=!!y&&(536>parseInt(y[1],10)||parseInt(y[1],10)===536&&11>=parseInt(y[2],10))}return ns}nt.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=i(),xe(this)};function as(y,_,D){for(var O in be)if(be.hasOwnProperty(O)&&_===y.f[be[O]]&&D===y.f[be[O]])return!0;return!1}function xe(y){var _=y.g.a.offsetWidth,D=y.h.a.offsetWidth,O;(O=_===y.f.serif&&D===y.f["sans-serif"])||(O=Xe()&&as(y,_,D)),O?i()-y.A>=y.w?Xe()&&as(y,_,D)&&(y.u===null||y.u.hasOwnProperty(y.a.c))?hi(y,y.v):hi(y,y.B):cl(y):hi(y,y.v)}function cl(y){setTimeout(s(function(){xe(this)},y),50)}function hi(y,_){setTimeout(s(function(){l(this.g.a),l(this.h.a),l(this.j.a),l(this.m.a),_(this.a)},y),0)}function ui(y,_,D){this.c=y,this.a=_,this.f=0,this.m=this.j=!1,this.s=D}var vs=null;ui.prototype.g=function(y){var _=this.a;_.g&&h(_.f,[_.a.c("wf",y.c,b(y).toString(),"active")],[_.a.c("wf",y.c,b(y).toString(),"loading"),_.a.c("wf",y.c,b(y).toString(),"inactive")]),x(_,"fontactive",y),this.m=!0,Mn(this)},ui.prototype.h=function(y){var _=this.a;if(_.g){var D=d(_.f,_.a.c("wf",y.c,b(y).toString(),"active")),O=[],U=[_.a.c("wf",y.c,b(y).toString(),"loading")];D||O.push(_.a.c("wf",y.c,b(y).toString(),"inactive")),h(_.f,O,U)}x(_,"fontinactive",y),Mn(this)};function Mn(y){--y.f==0&&y.j&&(y.m?(y=y.a,y.g&&h(y.f,[y.a.c("wf","active")],[y.a.c("wf","loading"),y.a.c("wf","inactive")]),x(y,"active")):B(y.a))}function kn(y){this.j=y,this.a=new H,this.h=0,this.f=this.g=!0}kn.prototype.load=function(y){this.c=new n(this.j,y.context||this.j),this.g=y.events!==!1,this.f=y.classes!==!1,hl(this,new v(this.c,y),y)};function ll(y,_,D,O,U){var V=--y.h==0;(y.f||y.g)&&setTimeout(function(){var z=U||null,Q=O||null||{};if(D.length===0&&V)B(_.a);else{_.f+=D.length,V&&(_.j=V);var se,he=[];for(se=0;se<D.length;se++){var ue=D[se],Se=Q[ue.c],Be=_.a,Bt=ue;if(Be.g&&h(Be.f,[Be.a.c("wf",Bt.c,b(Bt).toString(),"loading")]),x(Be,"fontloading",Bt),Be=null,vs===null)if(window.FontFace){var Bt=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),Tl=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);vs=Bt?42<parseInt(Bt[1],10):!Tl}else vs=!1;vs?Be=new ie(s(_.g,_),s(_.h,_),_.c,ue,_.s,Se):Be=new nt(s(_.g,_),s(_.h,_),_.c,ue,_.s,z,Se),he.push(Be)}for(se=0;se<he.length;se++)he[se].start()}},0)}function hl(y,_,D){var U=[],O=D.timeout;N(_);var U=Y(y.a,D,y.c),V=new ui(y.c,_,O);for(y.h=U.length,_=0,D=U.length;_<D;_++)U[_].load(function(z,Q,se){ll(y,V,z,Q,se)})}function Un(y,_){this.c=y,this.a=_}Un.prototype.load=function(y){function _(){if(V["__mti_fntLst"+O]){var z=V["__mti_fntLst"+O](),Q=[],se;if(z)for(var he=0;he<z.length;he++){var ue=z[he].fontfamily;z[he].fontStyle!=null&&z[he].fontWeight!=null?(se=z[he].fontStyle+z[he].fontWeight,Q.push(new I(ue,se))):Q.push(new I(ue))}y(Q)}else setTimeout(function(){_()},50)}var D=this,O=D.a.projectId,U=D.a.version;if(O){var V=D.c.o;g(this.c,(D.a.api||"https://fast.fonts.net/jsapi")+"/"+O+".js"+(U?"?v="+U:""),function(z){z?y([]):(V["__MonotypeConfiguration__"+O]=function(){return D.a},_())}).id="__MonotypeAPIScript__"+O}else y([])};function xn(y,_){this.c=y,this.a=_}xn.prototype.load=function(y){var _,D,O=this.a.urls||[],U=this.a.families||[],V=this.a.testStrings||{},z=new f;for(_=0,D=O.length;_<D;_++)p(this.c,O[_],m(z));var Q=[];for(_=0,D=U.length;_<D;_++)if(O=U[_].split(":"),O[1])for(var se=O[1].split(","),he=0;he<se.length;he+=1)Q.push(new I(O[0],se[he]));else Q.push(new I(O[0]));E(z,function(){y(Q,V)})};function ul(y,_){y?this.c=y:this.c=dl,this.a=[],this.f=[],this.g=_||""}var dl="https://fonts.googleapis.com/css";function pl(y,_){for(var D=_.length,O=0;O<D;O++){var U=_[O].split(":");U.length==3&&y.f.push(U.pop());var V="";U.length==2&&U[1]!=""&&(V=":"),y.a.push(U.join(V))}}function gl(y){if(y.a.length==0)throw Error("No fonts to load!");if(y.c.indexOf("kit=")!=-1)return y.c;for(var _=y.a.length,D=[],O=0;O<_;O++)D.push(y.a[O].replace(/ /g,"+"));return _=y.c+"?family="+D.join("%7C"),0<y.f.length&&(_+="&subset="+y.f.join(",")),0<y.g.length&&(_+="&text="+encodeURIComponent(y.g)),_}function fl(y){this.f=y,this.a=[],this.c={}}var Bn={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},El={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},ml={i:"i",italic:"i",n:"n",normal:"n"},Al=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Sl(y){for(var _=y.f.length,D=0;D<_;D++){var O=y.f[D].split(":"),U=O[0].replace(/\+/g," "),V=["n4"];if(2<=O.length){var z,Q=O[1];if(z=[],Q)for(var Q=Q.split(","),se=Q.length,he=0;he<se;he++){var ue;if(ue=Q[he],ue.match(/^[\w-]+$/)){var Se=Al.exec(ue.toLowerCase());if(Se==null)ue="";else{if(ue=Se[2],ue=ue==null||ue==""?"n":ml[ue],Se=Se[1],Se==null||Se=="")Se="4";else var Be=El[Se],Se=Be||(isNaN(Se)?"4":Se.substr(0,1));ue=[ue,Se].join("")}}else ue="";ue&&z.push(ue)}0<z.length&&(V=z),O.length==3&&(O=O[2],z=[],O=O?O.split(","):z,0<O.length&&(O=Bn[O[0]])&&(y.c[U]=O))}for(y.c[U]||(O=Bn[U])&&(y.c[U]=O),O=0;O<V.length;O+=1)y.a.push(new I(U,V[O]))}}function Fn(y,_){this.c=y,this.a=_}var yl={Arimo:!0,Cousine:!0,Tinos:!0};Fn.prototype.load=function(y){var _=new f,D=this.c,O=new ul(this.a.api,this.a.text),U=this.a.families;pl(O,U);var V=new fl(U);Sl(V),p(D,gl(O),m(_)),E(_,function(){y(V.a,V.c,yl)})};function Gn(y,_){this.c=y,this.a=_}Gn.prototype.load=function(y){var _=this.a.id,D=this.c.o;_?g(this.c,(this.a.api||"https://use.typekit.net")+"/"+_+".js",function(O){if(O)y([]);else if(D.Typekit&&D.Typekit.config&&D.Typekit.config.fn){O=D.Typekit.config.fn;for(var U=[],V=0;V<O.length;V+=2)for(var z=O[V],Q=O[V+1],se=0;se<Q.length;se++)U.push(new I(z,Q[se]));try{D.Typekit.load({events:!1,classes:!1,async:!0})}catch{}y(U)}},2e3):y([])};function Hn(y,_){this.c=y,this.f=_,this.a=[]}Hn.prototype.load=function(y){var _=this.f.id,D=this.c.o,O=this;_?(D.__webfontfontdeckmodule__||(D.__webfontfontdeckmodule__={}),D.__webfontfontdeckmodule__[_]=function(U,V){for(var z=0,Q=V.fonts.length;z<Q;++z){var se=V.fonts[z];O.a.push(new I(se.name,C("font-weight:"+se.weight+";font-style:"+se.style)))}y(O.a)},g(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+u(this.c)+"/"+_+".js",function(U){U&&y([])})):y([])};var at=new kn(window);at.a.c.custom=function(y,_){return new xn(_,y)},at.a.c.fontdeck=function(y,_){return new Hn(_,y)},at.a.c.monotype=function(y,_){return new Un(_,y)},at.a.c.typekit=function(y,_){return new Gn(_,y)},at.a.c.google=function(y,_){return new Fn(_,y)};var Yn={load:s(at.load,at)};a.exports?a.exports=Yn:(window.WebFont=Yn,window.WebFontConfig&&at.load(window.WebFontConfig))})()})(jg);const $g=on;class zg extends Phaser.Loader.File{payload;constructor(e,t){super(e,{type:"webfont",key:t.type}),this.payload=t}load(){const{type:e}=this.payload;let t;switch(e){case"google":t=this.getGoogleFontConfig(this.payload);break;case"local":t=this.getLocalFontConfig(this.payload);break}$g.load(t)}getGoogleFontConfig(e){const{character:t,fontName:s,fontWeight:i=400}=e;return{google:{families:[`${s}:${i}`],text:t},active:()=>{this.loader.nextFile(this,!0)},timeout:15e3}}getLocalFontConfig(e){const{fontName:t,fontType:s}=e,i=document.createElement("style");document.head.appendChild(i);const n=i.sheet;if(n){const c=`@font-face { font-family: "${t}"; src: url("assets/fonts/${t}${s==="opentype"?".otf":".ttf"}") format("${s}"); }`;n.insertRule(c,0)}return{custom:{families:[t]},active:()=>{this.loader.nextFile(this,!0)},timeout:15e3}}}class Xg extends Phaser.Plugins.ScenePlugin{addFont(e){const t=new zg(this.scene.load,e);this.scene.load.addFile(t)}}class qg extends Phaser.Plugins.BasePlugin{portraitRatio;portraitWidth;portraitHeight;landscapeRatio;landscapeWidth;landscapeHeight;worldWidth;worldHeight;worldRatio;autoResize;disableLandscape;fullSizeOnLandscape;forcePixelRatio;configure(e){const{autoResize:t,portraitRatio:s,portraitWidth:i,portraitHeight:n,landscapeWidth:r,landscapeHeight:c,landscapeRatio:o,disableLandscape:l,fullSizeOnLandscape:h}=e;this.autoResize=t,this.disableLandscape=l,this.fullSizeOnLandscape=h,this.portraitRatio=s,this.portraitWidth=i,this.portraitHeight=n,this.landscapeRatio=o,this.landscapeWidth=r,this.landscapeHeight=c,this.initWorldSize(),this.addEventResize()}resize(e){e&&e>0&&(this.forcePixelRatio=e);const{width:t,height:s}=this.getCanvasSizeFixedRatio(this.worldRatio);this.resizeCanvas(t,s),this.game.scene.scenes.forEach(i=>{const n=i.cameras.main;if(!n)return;const r=this.getZoomRatio(),{width:c,height:o}=this.getWorldSize();n.setZoom(r),n.centerOn(c/2,o/2)})}resizeCanvas(e,t){this.game.canvas.width=e,this.game.canvas.height=t,this.game.scale.resize(e,t)}getWorldSize(){return{width:this.worldWidth,height:this.worldHeight}}initWorldSize(){this.worldWidth=this.portraitWidth,this.worldHeight=this.portraitHeight;const e=this.getScreenRatio();if(this.isScreenSmallerRatio(this.portraitRatio))this.worldHeight=this.worldWidth/this.getScreenRatio();else if(this.disableLandscape)this.isScreenSmallerRatio(this.portraitRatio)&&(this.worldHeight=this.worldWidth/e);else if(this.worldWidth=this.landscapeWidth,this.worldHeight=this.landscapeHeight,this.landscapeRatio>e&&(this.worldHeight=this.worldWidth/e),this.fullSizeOnLandscape){this.worldRatio=this.worldWidth/this.worldHeight,this.landscapeRatio=e;const{width:t,height:s}=this.getCanvasSizeFixedRatio(this.landscapeRatio),i=this.getZoomRatio();this.worldWidth=t/i,this.worldHeight=s/i}this.worldRatio=this.worldWidth/this.worldHeight,console.info("🚀 > this.worldRatio",this.worldRatio)}getZoomRatio(){const{width:e}=this.getWorldSize(),{width:t}=this.getCanvasSizeFixedRatio(this.worldRatio);return t/e}getPixelRatio(){if(this.forcePixelRatio>0)return this.forcePixelRatio;if(GameCore.Utils.Device.isDesktop())return 2;let e=GameCore.Utils.Device.pixelRatio();return e>2&&(e=2),e}getPhysicPixels(e,t){return e*t}getCanvasSizeFixedRatio(e){const t=this.getPixelRatio();let s=this.getScreenWidth()*t,i=this.getScreenHeight()*t;return this.isScreenSmallerRatio(e)?i=s/e:s=i*e,{width:s,height:i}}getScreenRatio(){return this.getScreenWidth()/this.getScreenHeight()}getScreenHeight(){const{body:e,documentElement:t}=document,{clientHeight:s}=e,{clientHeight:i}=t;return Math.max(i,s)||0}getScreenWidth(){const{body:e,documentElement:t}=document,{clientWidth:s}=e,{clientWidth:i}=t;return Math.max(i,s)||0}isScreenSmallerRatio(e){return this.getScreenRatio()<e}isGameWorldSmallerRatio(e){const{width:t,height:s}=this.getWorldSize();return t/s<=e}addEventResize(){this.autoResize&&window.addEventListener("resize",this.handleResize)}handleResize=Ts(()=>{this.resize()},300);isLandscape(){return this.worldRatio>this.portraitRatio}isUsingLandscapeBackground(){return this.worldRatio>.796}}class Zg{contextId;contextType;entryPointData;constructor(e,t,s){this.contextId=e||Si.contextId,this.contextType=t||Si.contextType,this.entryPointData=s||Si.entryPointData}toObject(){return{contextId:this.contextId,contextType:this.contextType,entryPointData:this.entryPointData}}}class Qg extends Error{constructor(e,t){super(e,t),this.name="InvalidPlayerId",this.message=e||"The playerId is not valid",this.payload=t}}const Zs=new fs("10","Your Friend",M.AVATAR.FILE).toObject(),Jg=a=>a.context,ef=a=>a.context.currentGameMode,tf=a=>a.context.isRequestingDetectGameMode,Cs=j([Jg],a=>a),vn=j([ef],a=>a),sf=j([tf],a=>a),nf=(a,e,t)=>({type:bo,payload:{contextId:a,contextType:e,entryPointData:t}}),Lc=()=>(a,e)=>{const t=e(),s=Cs(t),{player:i}=window.game,n=i.getPlayerId(),{contextId:r,entryPointData:c}=s,{type:o,matchId:l,playerId:h,opponentId:d=Zs.playerId,tournamentContextId:u}=c||{},p=n===h,g=d===Zs.playerId||[d,h].indexOf(n)>=0;let f=Nu;r&&(o===void 0||o===ia)&&(f=sa),o===ia&&u&&(f=sa),r&&o===Uu&&!p&&(f=$t),l&&r&&g&&o===si&&(f=$t),r&&o===ko&&!p&&(f=$t),r&&o===xu&&(f=Mu),a(af(f))},af=a=>e=>{e({type:Po,payload:{gameMode:a}})},rf=a=>({type:Oo,payload:{isRequestingDetectGameMode:a}}),of={COINS:"coins",SETTINGS:"settings",GAME_DATA:"gameData",USER_GUIDE_DISPLAYS:"userGuideDisplays",FREE_COINS_LAST_USED_TIME:"freeCoinsLastUsedTime",OFFLINE_REWARD_LAST_CHECK:"offlineRewardLastCheck"};let bc=!1,wn=!1;const Pc=a=>{bc=a},cf=()=>{wn=lf()},lf=()=>{const a=GameCore.Utils.Device,{vibrate:e}=window.navigator;return a.isAndroid()&&typeof e=="function"||a.isMobileWeb()&&typeof e=="function"||a.isIOS()},Ti=()=>wn,Et=a=>{try{if(!bc||!wn)return!1;const e=GameCore.Utils.Device;return(e.isAndroid()||e.isMobileWeb())&&hf(a),!0}catch{return!1}},hf=a=>{window.navigator.vibrate(0),window.navigator.vibrate(a)},{MaxLevel:Aa}=GameCore.Configs.Gameplay;class uf{game;constructor(e){this.game=e}initContext=()=>{const e=window.GameSDK.context.getID(),t=window.GameSDK.context.getType(),s=window.GameSDK.getEntryPointData(),i=new Zg(e,t,s),{contextId:n,contextType:r,entryPointData:c}=i.toObject();this.game.storage.dispatch(nf(n,r,c))};initPlayer=async()=>{const{player:e,storage:t}=this.game,s=this.getPlayerInfo(),i=Object.values(of),n=await FBInstant.player.getDataAsync(i),r=new En(n),c=r.toObject();c.settings.music===!0&&window.game.audio.playMusic(),c.settings.vibrate===!0&&Pc(!0),c.gameData.playerLevelProgress&&c.gameData.playerLevelProgress>=Aa&&(c.gameData.playerLevelProgress=Aa-1);const{baseValue:o,suffix:l}=c.coins;t.dispatch(Zo(o,l)),e.receiveData(s,r.convertToPlayerData())};getPlayerInfo=()=>{try{const e=window.GameSDK.player.getID();let t=window.GameSDK.player.getName();const s=window.GameSDK.player.getPhoto(),i=window.GameSDK.getLocale();if(!GameCore.Utils.Valid.isString(e))throw new Qg(null,{playerId:e});return GameCore.Utils.Valid.isString(t)||(t="You"),new fs(e,t,s,i).toObject()}catch{return new fs("123","You").toObject()}}}class df extends Phaser.Plugins.BasePlugin{Text;Texture;currentLocale;supportedLanguages;data;configure(e){this.applyOptions(e)}getCurrentLanguage(){return this.currentLocale}switchLanguage(e="en"){const t=this.getCorrectLocale(e);this.currentLocale=t,this.Text=this.data[t].Text,this.Texture=this.data[t].Texture}getText(e){if(typeof e=="object"){const{key:t,variables:s=[],locale:i=this.currentLocale}=e,n=this.getCorrectLocale(i),r=this.data[n].Text[t];return this.replaceVariables(r,s)}return this.Text[e]}getTexture(e){if(typeof e=="object"){const{key:t,variables:s=[],locale:i=this.currentLocale}=e,n=this.getCorrectLocale(i),r=this.data[n].Texture[t];return this.replaceVariables(r,s)}return this.Texture[e]}isSupportLanguage(e){return this.supportedLanguages.indexOf(e)>=0}applyOptions(e){const{data:t,locale:s="en",upperCaseText:i=!1}=e;this.data=t,this.supportedLanguages=Object.keys(t);const n=this.getCorrectLocale(s);if(this.currentLocale=n,this.Text=t[n].Text,this.Texture=t[n].Texture,i)for(const r in this.Text)this.Text[r]=this.Text[r].toUpperCase()}replaceVariables(e,t){const s=t.length;if(s==0)return e;let i=0;return e.replace(/{.*}/,function(){return String(t[Math.min(i++,s-1)])})}getCorrectLocale(e){let t=e.split("_")[0];return this.isSupportLanguage(t)||(t="en"),t}}const pf={START_FIGHT:"START FIGHT",COLLECT:"Collect",SETTINGS:"Settings",SOUND_FX:"Sound Fx",MUSIC:"Music",VIBRATION:"Vibration",QUICK_FIGHT:"Quick Fight",SPEED:"Speed",LEADERBOARD:"Leaderboard",RANK:"Rank",PHOTO:"Photo",NAME:"Name",LEVEL:"Level",CHARACTER_LIST:"Character List",DINOSAURS:"Dinosaurs",WARRIORS:"Warriors",BUY:"BUY",FREE:"FREE",LOCKED:"Locked",BATTLE:"Battle",FRIENDS:"Friends",REVENGE:"Revenge",RANKING:"Ranking",HISTORY:"History",CHALLENGE_FRIENDS:`CHALLENGE
FRIENDS`,GLOBAL:"Global",WIN:"WIN",LOSE:"LOSE",FULL:"FULL",NEW_CHARACTER:"New Character",SHARE:"SHARE",SHARE_CAPITAL:"Share",VICTORY:"VICTORY",YOU_EARNED:"YOU EARNED",LEVEL_COMPLETED_BONUS_X:"Level Completed Bonus x",SPIN:"SPIN!",CLAIM:"CLAIM",CONTINUE:"Continue",FAILED:"FAILED",OFFLINE_COINS_REWARDS:"OFFLINE COINS REWARDS",X2_COINS:"X2 COINS",UNAVAILABLE:"UNAVAILABLE",REPLAY:"REPLAY",BACK_TO_SINGLEPLAY:`BACK TO
 SINGLEPLAY`,LOADING:"Loading...",VS:"VS",NO_ADS_TO_DISPLAY:"No ads to display!",WATCH_A_VIDEO:"Watch a video to get free unit!",LOADING_ADS:"Loading ads...",SORRY_NO_REWARDS:`Sorry, No Rewards!
You have cancelled the ad!`,DISPLAY_ADS_FAILED:"Display Ads Failed",UNABLE_TO_DISPLAY_ADS:`Unable to display ads.
Please try again later.`,LEADERBOARD_IS_EMPTY:"Leaderboard is empty!",NO_MATCHES_AVAILABLE:"No matches available!",GET_NOW:"GET NOW!",GET:"GET",RESET_DATA:"Reset Data",RESET_DESC:`This will reset your data and
 you will lose all your
 progress. Are you sure you
 want to continue?`,YES:"Yes",NO:"No",START_OVER_TITLE:"Completed",START_OVER_DESC:"Are you sure to start over?"},gf={TITLE:"icons/title"},ff={Text:pf,Texture:gf},Ef={START_FIGHT:"НАЧАТЬ БОЙ",COLLECT:"Собрать",SETTINGS:"Настройки",SOUND_FX:"Звуковые",MUSIC:"Музыка",VIBRATION:"Вибрация",QUICK_FIGHT:"Быстрый Бой",SPEED:"Скорость",LEADERBOARD:"Таблица Лидеров",RANK:"Ранг",PHOTO:"Фото",NAME:"Имя",LEVEL:"Уровень",CHARACTER_LIST:"Список Персонажей",DINOSAURS:"Динозавры",WARRIORS:"Воины",BUY:"КУПИТЬ",FREE:"БЕСПЛАТНО",LOCKED:"Заблокировано",BATTLE:"Бой",FRIENDS:"Друзья",REVENGE:"Месть",RANKING:"Рейтинг",HISTORY:"История",CHALLENGE_FRIENDS:`Бросьте вызов
друзьям`,GLOBAL:"Глобальный",WIN:"ПОБЕДА",LOSE:"ПОРАЖЕНИЕ",FULL:"ПОЛНЫЙ",NEW_CHARACTER:"Новый Персонаж",SHARE:"ПОДЕЛИТЬСЯ",SHARE_CAPITAL:"Поделиться",VICTORY:"ПОБЕДА",YOU_EARNED:"ВЫ ЗАРАБОТАЛИ",LEVEL_COMPLETED_BONUS_X:"Бонус За Завершение Уровня x",SPIN:"ВРАЩЕНИЕ!",CLAIM:"СОБРАТЬ",CONTINUE:"Продолжить",FAILED:"НЕУДАЧА",OFFLINE_COINS_REWARDS:"НАГРАДЫ В ОФФЛАЙНЕ",X2_COINS:"X2 МОНЕТ",UNAVAILABLE:"НЕДОСТУПЕН",REPLAY:"ПОВТОР",BACK_TO_SINGLEPLAY:`ВЕРНУТЬСЯ В
 ОДИНОЧНУЮ ИГРУ`,LOADING:"Загрузка...",VS:"ПРОТИВ",NO_ADS_TO_DISPLAY:`Нет Объявлений
Для Отображения`,WATCH_A_VIDEO:`Посмотрите Видео, Чтобы
Получить Бесплатный Юнит!`,LOADING_ADS:"Загрузка Объявлений...",SORRY_NO_REWARDS:`Извините, наград нет!
Вы отменили рекламу!`,DISPLAY_ADS_FAILED:"Отобразить рекламу не удалось",UNABLE_TO_DISPLAY_ADS:`Невозможно показать рекламу.
Пожалуйста, попробуйте
позже.`,LEADERBOARD_IS_EMPTY:"Таблица лидеров пуста!",NO_MATCHES_AVAILABLE:"Нет доступных совпадений!",GET_NOW:"ПОЛУЧИТЬ СЕЙЧАС!",GET:"ПОЛУЧИТЬ",RESET_DATA:"Сбросить данные",RESET_DESC:`Это действие приведет к сбросу
 всех ваших данных и прогресса.
 Вы уверены, что хотите
 продолжить?`,YES:"Да",NO:"Нет",START_OVER_TITLE:"Завершен",START_OVER_DESC:`Вы уверены, что начнете
 сначала?`},mf={TITLE:"icons/title"},Af={Text:Ef,Texture:mf},Sf={START_FIGHT:"バトルスタート",COLLECT:"集める",SETTINGS:"設定",SOUND_FX:"効果音",MUSIC:"BGM",VIBRATION:"振動",QUICK_FIGHT:"クイックバトル",SPEED:"スピード",LEADERBOARD:"リーダーボード",RANK:"ランク",PHOTO:"写真",NAME:"名前",LEVEL:"レベル",CHARACTER_LIST:"キャラクターリスト",DINOSAURS:"恐竜",WARRIORS:"戦士",BUY:"購入する",FREE:"無料",LOCKED:"ロック",BATTLE:"バトル",FRIENDS:"フレンド",REVENGE:"リベンジ",RANKING:"ランキング",HISTORY:"歴史",CHALLENGE_FRIENDS:"フレンドに挑戦",GLOBAL:"ブローバル",WIN:"勝利",LOSE:"敗北",FULL:"フル",NEW_CHARACTER:"新しいキャラクター",SHARE:"シェア",SHARE_CAPITAL:"シェア",VICTORY:"勝利",YOU_EARNED:"獲得",LEVEL_COMPLETED_BONUS_X:"レベル完了ボーナス x",SPIN:"スピン",CLAIM:"受け取る",CONTINUE:"続ける",FAILED:"失敗",OFFLINE_COINS_REWARDS:"オフラインコイン報酬",X2_COINS:"X2 コイン",UNAVAILABLE:"利用不可",REPLAY:"リプレイ",BACK_TO_SINGLEPLAY:"シングルプレイに戻る",LOADING:"読み込んでいます...",VS:"VS",NO_ADS_TO_DISPLAY:"表示できる広告はありません",WATCH_A_VIDEO:`動画を視聴して無料
ユニットを獲得する！`,LOADING_ADS:"広告を読み込んでいます...",SORRY_NO_REWARDS:`リワードはありません！
広告をキャンセルしました！`,DISPLAY_ADS_FAILED:"広告の表示に失敗",UNABLE_TO_DISPLAY_ADS:`広告を表示できませんでした。
また後で試してください。`,LEADERBOARD_IS_EMPTY:"リーダーボードが空です！",NO_MATCHES_AVAILABLE:"利用可能な試合がありません",GET_NOW:"取得",GET:"取得",RESET_DATA:"データリセット",RESET_DESC:`これを行うとデータがリセットされ,
進捗状況がすべて失われます.
続けますか？`,YES:"はい",NO:"いいえ",START_OVER_TITLE:"完了",START_OVER_DESC:`本当に最初からやり直して
よろしいですか？`},yf={TITLE:"icons/title-jp"},Tf={Text:Sf,Texture:yf},If={START_FIGHT:"开战",COLLECT:"收集",SETTINGS:"设置",SOUND_FX:"音效",MUSIC:"音乐",VIBRATION:"振动",QUICK_FIGHT:"快速战斗",SPEED:"速度",LEADERBOARD:"排行榜",RANK:"阶级",PHOTO:"头像",NAME:"名字",LEVEL:"等级",CHARACTER_LIST:"角色列表",DINOSAURS:"恐龙",WARRIORS:"战士",BUY:"购买",FREE:"免费",LOCKED:"锁定",BATTLE:"对战",FRIENDS:"好友",REVENGE:"复仇",RANKING:"排名",HISTORY:"历史",CHALLENGE_FRIENDS:"挑战好友",GLOBAL:"全球",WIN:"获胜",LOSE:"战败",FULL:"已满",NEW_CHARACTER:"新角色",SHARE:"分享",SHARE_CAPITAL:"分享",VICTORY:"胜利",YOU_EARNED:"你赢得了",LEVEL_COMPLETED_BONUS_X:"关卡完成奖励X",SPIN:"转",CLAIM:"领取",CONTINUE:"继续",FAILED:"失败",OFFLINE_COINS_REWARDS:"离线金币奖励",X2_COINS:"X2金币",UNAVAILABLE:"不可用",REPLAY:"回放",BACK_TO_SINGLEPLAY:"返回单人模式",LOADING:"加载中……",VS:"对",NO_ADS_TO_DISPLAY:"无广告可展示",WATCH_A_VIDEO:"观看视频免费获得战力！",LOADING_ADS:"载入广告中……",SORRY_NO_REWARDS:`抱歉，没有奖励！
你已经取消了广告！`,DISPLAY_ADS_FAILED:"广告显示失败",UNABLE_TO_DISPLAY_ADS:"无法显示广告。请稍后重试。",LEADERBOARD_IS_EMPTY:"排行榜为空！",NO_MATCHES_AVAILABLE:"没有可用的比赛",GET_NOW:"今すぐ入手",GET:"得到",RESET_DATA:"重置数据",RESET_DESC:`这将重置您的数据，您将失去
所有进度。 你确定你要继续吗？`,YES:"是的",NO:"不",START_OVER_TITLE:"已完成",START_OVER_DESC:"你确定想要重来吗？"},Cf={TITLE:"icons/title"},Rf={Text:If,Texture:Cf},_f={START_FIGHT:"COMEÇAR LUTA",COLLECT:"COLETAR",SETTINGS:"DEFINIÇÕES",SOUND_FX:"EFEITOS DE SOM",MUSIC:"MÚSICA",VIBRATION:"VIBRAÇÃO",QUICK_FIGHT:"LUTA RÁPIDA",SPEED:"VELOC",LEADERBOARD:"CLASSIFICAÇÃO",RANK:"CLAS",PHOTO:"FOTO",NAME:"NOME",LEVEL:"NÍVEL",CHARACTER_LIST:"LISTA DE PERSONAGENS",DINOSAURS:"DINOSSAUROS",WARRIORS:"GUERREIROS",BUY:"COMPRAR",FREE:"GRÁTIS",LOCKED:"BLOQUEADO",BATTLE:"BATALHA",FRIENDS:"AMIGOS",REVENGE:"VINGANÇA",RANKING:"CLASSIFICAÇÃO",HISTORY:"HISTÓRIA",CHALLENGE_FRIENDS:"DESAFIA OS TEUS AMIGOS",GLOBAL:"GLOBAL",WIN:"VITÓRIA",LOSE:"DERROTA",FULL:"COMPLETO",NEW_CHARACTER:"NOVA PERSONAGEM!",SHARE:"PARTILHAR",SHARE_CAPITAL:"PARTILHAR",VICTORY:"VITÓRIA",YOU_EARNED:"GANHASTE",LEVEL_COMPLETED_BONUS_X:"BÓNUS DE NÍVEL COMPLETADO x",SPIN:"GIRAR",CLAIM:"REIVINDICAR",CONTINUE:"CONTINUAR",FAILED:"FALHOU",OFFLINE_COINS_REWARDS:"RECOMPENSAS OFFLINE",X2_COINS:"MOEDAS x2",UNAVAILABLE:"NÃO DISPONÍVEL",REPLAY:"REPETIÇÃO",BACK_TO_SINGLEPLAY:"VOLTAR AO JOGO INDIVIDUAL",LOADING:"A CARREGAR...",VS:"VS",NO_ADS_TO_DISPLAY:"SEM ANÚNCIOS A EXIBIR",WATCH_A_VIDEO:"VÊ UM VÍDEO PARA RECEBER UMA UNIDADE GRÁTIS!",LOADING_ADS:"A CARREGAR ANÚNCIOS...",SORRY_NO_REWARDS:`Desculpa, não há recompensas! 
Cancelaste o anúncio!`,DISPLAY_ADS_FAILED:"Falha na exibição de anúncios",UNABLE_TO_DISPLAY_ADS:`Não é possível exibir anúncios. 
Por favor, tenta novamente
 mais tarde.`,LEADERBOARD_IS_EMPTY:"Placar está vazio!",NO_MATCHES_AVAILABLE:"Nenhum jogo disponível",GET_NOW:"OBTER",GET:"OBTER",RESET_DATA:"Redefinir dados",RESET_DESC:`Isso redefinirá seus dados e
 você perderá todo o progresso.
 Você tem certeza que quer
 continuar?`,YES:"SIM",NO:"NÃO",START_OVER_TITLE:"Concluído",START_OVER_DESC:`Tens a certeza que queres
 começar de novo?`},vf={TITLE:"icons/title"},wf={Text:_f,Texture:vf},Lf={START_FIGHT:"EMPEZAR PELEA",COLLECT:"RECOGER",SETTINGS:"CONFIGURACIÓN",SOUND_FX:"EFECTOS DE SONIDO",MUSIC:"MÚSICA",VIBRATION:"VIBRACIÓN",QUICK_FIGHT:"PELEA RÁPIDA",SPEED:"VELOC",LEADERBOARD:"TABLA DE CLASIFICACIÓN",RANK:"CLASIF",PHOTO:"FOTO",NAME:"NOMBRE",LEVEL:"NIVEL",CHARACTER_LIST:"LISTA DE PERSONAJES",DINOSAURS:"DINOSAURIOS",WARRIORS:"GUERREROS",BUY:"COMPRAR",FREE:"GRATIS",LOCKED:"BLOQUEADO",BATTLE:"BATALLA",FRIENDS:"AMIGOS",REVENGE:"VENGANZA",RANKING:"CLASIFICACIÓN",HISTORY:"HISTORIA",CHALLENGE_FRIENDS:"DESAFÍA A TUS AMIGOS",GLOBAL:"GLOBAL",WIN:"VICTORIA",LOSE:"DERROTA",FULL:"LLENO",NEW_CHARACTER:"¡NUEVO PERSONAJE!",SHARE:"COMPARTIR",SHARE_CAPITAL:"COMPARTIR",VICTORY:"VICTORIA",YOU_EARNED:"HAS GANADO",LEVEL_COMPLETED_BONUS_X:"BONO DE NIVEL COMPLETADO x",SPIN:"GIRAR",CLAIM:"RECLAMAR",CONTINUE:"CONTINUAR",FAILED:"FRACASO",OFFLINE_COINS_REWARDS:"RECOMPENSAS OFFLINE",X2_COINS:"MONEDAS X2",UNAVAILABLE:"NO DISPONIBLE",REPLAY:"REPETICIÓN",BACK_TO_SINGLEPLAY:"VOLVER AL JUEGO INDIVIDUAL",LOADING:"CARGANDO...",VS:"vs",NO_ADS_TO_DISPLAY:"SIN ANUNCIOS QUE MOSTRAR",WATCH_A_VIDEO:"¡MIRA UN VÍDEO PARA RECIBIR UNA UNIDAD GRATIS!",LOADING_ADS:"CARGANDO ANUNCIOS...",SORRY_NO_REWARDS:`Lo sentimos, no hay
 recompensas. ¡Has cancelado
 el anuncio!`,DISPLAY_ADS_FAILED:`Error en la visualización de
 anuncios`,UNABLE_TO_DISPLAY_ADS:`No se pueden mostrar anuncios. 
Por favor, inténtalo de nuevo
 más tarde.`,LEADERBOARD_IS_EMPTY:"¡Tabla de líderes está vacía!",NO_MATCHES_AVAILABLE:"No hay partidas disponibles",GET_NOW:"OBTENER",GET:"OBTENER",RESET_DATA:"Reiniciar datos",RESET_DESC:`Esto restablecerá sus datos y
 perderá todo el progreso. Estás
 seguro de que quieres
 continuar?`,YES:"SÍ",NO:"NO",START_OVER_TITLE:"Completo",START_OVER_DESC:`¿Estás seguro de que quieres
 empezar de nuevo?`},bf={TITLE:"icons/title"},Pf={Text:Lf,Texture:bf},Of={START_FIGHT:"DÖVÜŞE BAŞLA",COLLECT:"TOPLA",SETTINGS:"AYARLAR",SOUND_FX:"SES",MUSIC:"MÜZİK",VIBRATION:"TİTREŞİM",QUICK_FIGHT:"HIZLI DÖVÜŞ",SPEED:"HIZ",LEADERBOARD:"LİDERLİK TABLOSU",RANK:"SIRA",PHOTO:"FOTO",NAME:"AD",LEVEL:"SEVİYE",CHARACTER_LIST:"KARAKTER LİSTESİ",DINOSAURS:"DİNOZORLAR",WARRIORS:"SAVAŞÇILAR",BUY:"SATIN AL",FREE:"ÜCRETSİZ",LOCKED:"KİLİTLİ",BATTLE:"DÖVÜŞ",FRIENDS:"ARKADAŞLAR",REVENGE:"İNTİKAM",RANKING:"SIRALAMA",HISTORY:"GEÇMİŞ",CHALLENGE_FRIENDS:"ARKADAŞLARINA MEYDAN OKU",GLOBAL:"GENEL",WIN:"GALİBİYET",LOSE:"YENİLGİ",FULL:"TAM",NEW_CHARACTER:"YENİ KARAKTER",SHARE:"PAYLAŞ",SHARE_CAPITAL:"PAYLAŞ",VICTORY:"ZAFER",YOU_EARNED:"KAZANCIN",LEVEL_COMPLETED_BONUS_X:"SEVİYE TAMAMLAMA BONUSU x",SPIN:"DÖNDÜR",CLAIM:"TALEP ET",CONTINUE:"DEVAM",FAILED:"BAŞARISIZ",OFFLINE_COINS_REWARDS:"ÇEVRİMDIŞI PARA ÖDÜLLERİ",X2_COINS:"X2 PARA",UNAVAILABLE:"KULLANILAMIYOR",REPLAY:"YENİDEN OYNAT",BACK_TO_SINGLEPLAY:"TEKLİ OYUNA DÖN",LOADING:"YÜKLENİYOR…",VS:"VS",NO_ADS_TO_DISPLAY:"GÖRÜNTÜLENECEK REKLAM YOK",WATCH_A_VIDEO:"ÜCRETSİZ BİRİM ALMAK İÇİN VİDEO İZLE!",LOADING_ADS:"REKLAM YÜKLENİYOR...",SORRY_NO_REWARDS:`Üzgünüm, Ödül Yok!
 Reklamı iptal ettin!`,DISPLAY_ADS_FAILED:"Reklam Görüntülenemedi",UNABLE_TO_DISPLAY_ADS:`Reklam gösterilemiyor. 
Lütfen daha sonra tekrar dene.`,LEADERBOARD_IS_EMPTY:"Lider tablosu boş!",NO_MATCHES_AVAILABLE:"Eşleşme yok",GET_NOW:"AL",GET:"ŞİMDİ AL",RESET_DATA:"Veriyi sıfırla",RESET_DESC:`Bu, verilerinizi sıfırlayacak ve
 tüm ilerlemenizi
 kaybedeceksiniz. Devam etmek
 istediğine emin misin?`,YES:"EVET",NO:"HAYIR",START_OVER_TITLE:"Tamamlandı",START_OVER_DESC:`Baştan başlayacağından emin
 misin?`},Df={TITLE:"icons/title"},Nf={Text:Of,Texture:Df},Mf={START_FIGHT:"COMBATTRE",COLLECT:"RECEVOIR",SETTINGS:"PARAMÈTRES",SOUND_FX:"EFFETS AUDIO",MUSIC:"MUSIQUE",VIBRATION:"VIBRATIONS",QUICK_FIGHT:"COMBAT RAPIDE",SPEED:"VITESSE",LEADERBOARD:"CLASSEMENT",RANK:"PLACE",PHOTO:"PHOTO",NAME:"NOM",LEVEL:"NIVEAU",CHARACTER_LIST:"LISTE DES UNITÉS",DINOSAURS:"DINOSAURES",WARRIORS:"GUERRIERS",BUY:"ACHETER",FREE:"GRATUIT",LOCKED:"VERROUILLÉ",BATTLE:"COMBATS",FRIENDS:"AMIS",REVENGE:"VENGEANCES",RANKING:"CLASSEMENT",HISTORY:"HISTORIQUE",CHALLENGE_FRIENDS:"DÉFIER DES AMIS",GLOBAL:"MONDIAL",WIN:"VICTOIRE",LOSE:"DÉFAITE",FULL:"PLEIN",NEW_CHARACTER:"NOUVELLE UNITÉ",SHARE:"PARTAGER",SHARE_CAPITAL:"PARTAGER",VICTORY:"VICTOIRE",YOU_EARNED:"VOUS AVEZ GAGNÉ",LEVEL_COMPLETED_BONUS_X:"BONUS DE NIVEAU TERMINÉ x",SPIN:"LANCER",CLAIM:"RECEVOIR",CONTINUE:"CONTINUER",FAILED:"ÉCHEC",OFFLINE_COINS_REWARDS:"RÉCOMPENSE HORS LIGNE",X2_COINS:"PIÈCES X2",UNAVAILABLE:"INDISPONIBLE",REPLAY:"RECOMMENCER",BACK_TO_SINGLEPLAY:"REVENIR EN MODE SOLO",LOADING:"CHARGEMENT...",VS:"VS",NO_ADS_TO_DISPLAY:"AUCUNE PUB DISPONIBLE",WATCH_A_VIDEO:"REGARDEZ UNE VIDÉO ET RECEVEZ UNE UNITÉ GRATUITEMENT !",LOADING_ADS:"CHARGEMENT DES PUBS...",SORRY_NO_REWARDS:`Vous avez interrompu la
 pub ! Aucune récompense !`,DISPLAY_ADS_FAILED:"Échec de l'affichage des pubs",UNABLE_TO_DISPLAY_ADS:`Erreur lors de l'affichage des
 publicités. Réessayez
 ultérieurement.`,LEADERBOARD_IS_EMPTY:"Le tableau des leaders est vide !",NO_MATCHES_AVAILABLE:"Aucune correspondance disponible",GET_NOW:"OBTENIR",GET:"OBTENIR",RESET_DATA:"Réinitialiser",RESET_DESC:`Cela réinitialisera vos données
 et vous perdrez toute
 progression. Es-tu sur de
 vouloir continuer?`,YES:"OUI",NO:"NON",START_OVER_TITLE:"Terminé",START_OVER_DESC:`Voulez-vous vraiment
 recommencer ?`},kf={TITLE:"icons/title"},Uf={Text:Mf,Texture:kf},xf={START_FIGHT:"MULAI TARUNG",COLLECT:"KUMPUL",SETTINGS:"PENGATURAN",SOUND_FX:"EFEK SUARA",MUSIC:"MUSIK",VIBRATION:"GETARAN",QUICK_FIGHT:"TARUNG CEPAT",SPEED:"KECEP",LEADERBOARD:"PAPAN PERINGKAT",RANK:"RANK",PHOTO:"FOTO",NAME:"NAMA",LEVEL:"LEVEL",CHARACTER_LIST:"DAFTAR KARAKTER",DINOSAURS:"DINOSAURUS",WARRIORS:"PEJUANG",BUY:"BELI",FREE:"GRATIS",LOCKED:"TERKUNCI",BATTLE:"PERTEMPURAN",FRIENDS:"TEMAN",REVENGE:"PEMBALASAN",RANKING:"PERINGKAT",HISTORY:"RIWAYAT",CHALLENGE_FRIENDS:"TANTANG TEMAN",GLOBAL:"GLOBAL",WIN:"MENANG",LOSE:"KALAH",FULL:"PENUH",NEW_CHARACTER:"KARAKTER BARU",SHARE:"BAGIKAN",SHARE_CAPITAL:"BAGIKAN",VICTORY:"KEMENANGAN",YOU_EARNED:"KAMU MENDAPAT",LEVEL_COMPLETED_BONUS_X:"BONUS LEVEL SELESAI x",SPIN:"PUTAR",CLAIM:"KLAIM",CONTINUE:"LANJUT",FAILED:"GAGAL",OFFLINE_COINS_REWARDS:"HADIAH KOIN OFFLINE",X2_COINS:"X2 KOIN",UNAVAILABLE:"TIDAK TERSEDIA",REPLAY:"ULANGI PERMAINAN",BACK_TO_SINGLEPLAY:"KEMBALI KE MAIN TUNGGAL",LOADING:"MEMUAT...",VS:"VS",NO_ADS_TO_DISPLAY:"TIDAK ADA IKLAN UNTUK DITONTON",WATCH_A_VIDEO:"TONTON VIDEO UNTUK MENDAPAT UNIT GRATIS!",LOADING_ADS:"MEMUAT IKLAN...",SORRY_NO_REWARDS:`Maaf, Tak Ada Hadiah!
 Kamu membatalkan iklan!`,DISPLAY_ADS_FAILED:"Tonton Iklan Gagal",UNABLE_TO_DISPLAY_ADS:`Tidak bisa menonton iklan. 
Silakan coba lagi nanti.`,LEADERBOARD_IS_EMPTY:"Papan peringkat kosong!",NO_MATCHES_AVAILABLE:"Tidak ada pertandingan tersedia",GET_NOW:"AMBIL",GET:"AMBIL",RESET_DATA:"Setel ulang data",RESET_DESC:`Ini akan mengatur ulang data Anda
 dan Anda akan kehilangan semua
 kemajuan. Apakah anda yakin ingin
 melanjutkan?`,YES:"YA",NO:"TIDAK",START_OVER_TITLE:"Selesai",START_OVER_DESC:`Yakin ingin memulai dari
 awal?`},Bf={TITLE:"icons/title"},Ff={Text:xf,Texture:Bf},Gf={START_FIGHT:"KAMPFBEGINN",COLLECT:"SAMMELN",SETTINGS:"EINSTELLUNGEN",SOUND_FX:"SOUND",MUSIC:"MUSIK",VIBRATION:"VIBRATION",QUICK_FIGHT:"SCHNELLER KAMPF",SPEED:"GESCH",LEADERBOARD:"BESTENLISTE",RANK:"RANG",PHOTO:"FOTO",NAME:"NAME",LEVEL:"LEVEL",CHARACTER_LIST:"CHARAKTERLISTE",DINOSAURS:"DINOSAURIER",WARRIORS:"KRIEGER",BUY:"KAUFEN",FREE:"KOSTENLOS",LOCKED:"GESPERRT",BATTLE:"KAMPF",FRIENDS:"FREUNDE",REVENGE:"RACHE",RANKING:"RANGLISTE",HISTORY:"VERLAUF",CHALLENGE_FRIENDS:"FREUNDE HERAUSFORDERN",GLOBAL:"GLOBAL",WIN:"SIEG",LOSE:"NIEDERLAGE",FULL:"VOLL",NEW_CHARACTER:"NEUER CHARAKTER",SHARE:"TEILEN",SHARE_CAPITAL:"TEILEN",VICTORY:"SIEG",YOU_EARNED:"VERDIENT",LEVEL_COMPLETED_BONUS_X:"LEVELABSCHLUSS-BONUS x",SPIN:"DREHEN",CLAIM:"EINFORDERN",CONTINUE:"WEITER",FAILED:"GESCHEITERT",OFFLINE_COINS_REWARDS:"OFFLINE-BELOHNUNGEN",X2_COINS:"X2 MÜNZEN",UNAVAILABLE:"NICHT VERFÜGBAR",REPLAY:"WIEDERHOLEN",BACK_TO_SINGLEPLAY:"ZURÜCK ZUM EINZELSPIELER",LOADING:"LÄDT …",VS:"VS",NO_ADS_TO_DISPLAY:"KEINE ANZEIGEN VERFÜGBAR",WATCH_A_VIDEO:`VIDEO ANSCHAUEN, UM
 KOSTENLOSE EINHEIT ZU
 ERHALTEN!`,LOADING_ADS:"ANZEIGEN WERDEN GELADEN …",SORRY_NO_REWARDS:`Leider keine Belohnungen!
 Du hast die Anzeige
 abgebrochen!`,DISPLAY_ADS_FAILED:`Abspielen von Anzeigen
 gescheitert`,UNABLE_TO_DISPLAY_ADS:`Anzeigen können nicht
 abgespielt werden. Bitte
 versuche es später noch einmal.`,LEADERBOARD_IS_EMPTY:"Die Bestenliste ist leer!",NO_MATCHES_AVAILABLE:"Keine Spiele verfügbar",GET_NOW:"BEKOMMEN",GET:"BEKOMMEN",RESET_DATA:"Zurücksetzen",RESET_DESC:`Dadurch werden Ihre Daten
 zurückgesetzt und Sie verlieren
 jeglichen Fortschritt. Bist du dir
 sicher, dass du weitermachen
 willst?`,YES:"JA",NO:"NEIN",START_OVER_TITLE:"Abgeschlossen",START_OVER_DESC:"Willst du neu starten?"},Hf={TITLE:"icons/title"},Yf={Text:Gf,Texture:Hf},Kf={START_FIGHT:"INIZIA IL DUELLO",COLLECT:"RACCOGLI",SETTINGS:"IMPOSTAZIONI",SOUND_FX:"SOUND FX",MUSIC:"MUSICA",VIBRATION:"VIBRAZIONE",QUICK_FIGHT:"LOTTA VELOCE",SPEED:"VELOC",LEADERBOARD:"CLASSIFICA",RANK:"RANGO",PHOTO:"FOTO",NAME:"NOME",LEVEL:"LIVELLO",CHARACTER_LIST:"ELENCO PERSONAGGI",DINOSAURS:"DINOSAURI",WARRIORS:"GUERRIERI",BUY:"ACQUISTA",FREE:"LIBERA",LOCKED:"BLOCCATO",BATTLE:"BATTAGLIA",FRIENDS:"AMICI",REVENGE:"VENDETTA",RANKING:"CLASSIFICA",HISTORY:"CRONOLOGIA",CHALLENGE_FRIENDS:"SFIDA I TUOI AMICI",GLOBAL:"GLOBALE",WIN:"VITTORIA",LOSE:"SCONFITTA",FULL:"COMPLETATO",NEW_CHARACTER:"NUOVO PERSONAGGIO",SHARE:"CONDIVIDI",SHARE_CAPITAL:"CONDIVIDI",VICTORY:"VITTORIA",YOU_EARNED:"HAI GUADAGNATO",LEVEL_COMPLETED_BONUS_X:"LIVELLO COMPLETATO BONUS x",SPIN:"RUOTA",CLAIM:"RIVENDICA",CONTINUE:"CONTINUA",FAILED:"FALLITO",OFFLINE_COINS_REWARDS:"RICOMPENSE OFFLINE",X2_COINS:"X2 MONETE",UNAVAILABLE:"NON DISPONIBILE",REPLAY:"GIOCA ANCORA",BACK_TO_SINGLEPLAY:"TORNA AL GIOCATORE SINGOLO",LOADING:"CARICAMENTO…",VS:"VS",NO_ADS_TO_DISPLAY:`NESSUN ANNUNCIO DA
 VISUALIZZARE`,WATCH_A_VIDEO:`GUARDA UN VIDEO PER
 OTTENERE UN'UNITÀ GRATUITA!`,LOADING_ADS:"CARICAMENTO ANNUNCI...",SORRY_NO_REWARDS:`Spiacente, nessuna ricompensa!
 Hai cancellato l'annuncio!`,DISPLAY_ADS_FAILED:`Visualizzazione annunci non
 riuscita`,UNABLE_TO_DISPLAY_ADS:`Impossibile visualizzare gli
 annunci. Riprova più tardi.`,LEADERBOARD_IS_EMPTY:"La classifica è vuota!",NO_MATCHES_AVAILABLE:"Nessuna partita disponibile",GET_NOW:"OTTIENI",GET:"OTTIENI",RESET_DATA:"Reimposta i dati",RESET_DESC:`Questo ripristinerà i tuoi dati
 e perderai tutti i progressi. Sei
 sicuro di voler continuare?`,YES:"SÌ",NO:"NO",START_OVER_TITLE:"Completato",START_OVER_DESC:`Sei sicuro di voler
 ricominciare da capo?`},Vf={TITLE:"icons/title"},Wf={Text:Kf,Texture:Vf},jf={en:ff,ru:Af,ja:Tf,zh:Rf,pt:wf,es:Pf,tr:Nf,fr:Uf,id:Ff,de:Yf,it:Wf};class $f extends df{configure(e){super.configure({data:jf,locale:"en",upperCaseText:!1,...e})}}const ne=a=>a[Sc],zf=a=>ne(a).gameplay.mode,Xf=a=>ne(a).gameplay.status,qf=a=>ne(a).gameplay.rescued,Zf=a=>ne(a).gameplay.startAt,Qf=a=>ne(a).gameplay.finishAt,Jf=a=>ne(a).gameplay.type;j([zf],a=>a);j([Xf],a=>a);j([qf],a=>a);j([Zf],a=>a);j([Qf],a=>a);const eE=j([Jf],a=>a);class tE extends GameCore.Analytics.BaseAnalytics{isGamePlaying=!1;isGameStartLog=!1;constructor(e,t){super("GLanceAnalytics",{...t},"#E35360"),this.selfLog=!1}processEvent(e,t,s){if(e==G.LOAD_COMPLETE){window.sendCustomAnalyticsEvent(G.GLANCE_GAME_LOAD,{});return}}processGameEnd(e,t,s=-1e5){let i;const n=this.getCurrentGameType(),r={score:e,highScore:t};s!==-1e5&&n==="level"?i={...r,level:s}:i=r,window.sendCustomAnalyticsEvent(G.GLANCE_GAME_END,i)}processGameStart(e,t=-1e5){if(!this.isGameStartLog){this.isGameStartLog=!0,window.sendCustomAnalyticsEvent(G.GLANCE_GAME_START,{});return}let s;const i=this.getCurrentGameType(),n={score:0,highScore:e};t!==-1e5&&i==="level"?s={...n,level:t}:s=n,window.sendCustomAnalyticsEvent(G.GLANCE_GAME_REPLAY,s)}processGameLevel(e){window.sendCustomAnalyticsEvent(G.GLANCE_GAME_LEVEL,{level:e})}processPageView(e){}processLevelStart(e){if(!this.isGamePlaying){const t=window.game.player.getBestScore();this.processGameStart(t,e),this.isGamePlaying=!0}this.isGamePlaying&&this.getCurrentGameType()==="level"&&this.processGameLevel(e)}processLevelFail(e,t){if(!this.isGamePlaying)return;const s=t||0,i=window.game.player.getBestScore(),n=Math.max(i,s);this.processGameEnd(s,n,e),this.isGamePlaying=!1}processLevelComplete(e,t){if(this.getCurrentGameType()!=="level")return;const i=t||0;window.sendCustomAnalyticsEvent(G.GLANCE_GAME_LEVEL_COMPLETED,{level:e,score:i})}processGameMilestone(e,t={},s=0,i=0){const n=window.game.player.getBestScore();sendCustomAnalyticsEvent(G.GLANCE_GAME_MILESTONE,{type:e,meta:t,level:s,score:i,highScore:Math.max(n,i)})}processGameLifeEnd(e,t=0,s=0){const i=window.game.player.getBestScore();sendCustomAnalyticsEvent(G.GLANCE_GAME_LIFE_END,{remainingLife:e,level:t,score:s,highScore:Math.max(i,s)})}processIngameTransactions(e,t={},s=0,i=0){const n=window.game.player.getBestScore();sendCustomAnalyticsEvent(G.GLANCE_INGAME_TRANSACTIONS,{transactionType:e,meta:t,level:s,score:i,highScore:Math.max(n,i)})}getCurrentGameType(){const{storage:e}=window.game,t=e.getState();let s=eE(t);if(s!=="endless"&&s!=="level"){//! INVALID GAME TYPE
console.warn("Invalid game type detected. Game type must be either endless or level!"),s="level"}return s}}const sE=[G.SCREEN_OPEN];class Ev extends GameCore.Analytics.BaseAnalytics{game;trackingId;currentPath="/";constructor(e,t){super("GoogleAnalytics",{...t},"#E35335");const{trackingId:s}=t;this.game=e;const{consoleLog:i}=GameCore.Configs.Analytics.GoogleAnalytics||{};this.selfLog=!!i,this.trackingId=s}processEvent(e,t,s){if(sE.indexOf(e)>=0)return;const i=this.formatEventName(e);let n=t?{...t}:{};n=s?{...n,value:s}:n,n={...n,page_path:this.currentPath,send_to:"GA"},gtag("event",i,n)}processLevelStart(e,t,s){this.processEvent(G.LEVEL_START,{level:e,score:t,level_name:s})}processLevelRescue(e,t,s){this.processEvent(G.LEVEL_RESCUE,{level:e,score:t,level_name:s})}processLevelFail(e,t,s){this.processEvent(G.LEVEL_END,{level:e,score:t,level_name:s,success:!1})}processLevelComplete(e,t,s){this.processEvent(G.LEVEL_END,{level:e,score:t,level_name:s,success:!0})}processShowInterstitialAd(e){this.processEvent(G.AD_SHOW,{ad_type:"interstitial",screen_name:`${e}`}),this.processEvent(G.AD_IMPRESSION,{ad_format:"Interstitial"})}processShowRewardedVideoAd(e){this.processEvent(G.AD_SHOW,{ad_type:"rewarded_video",screen_name:`${e}`}),this.processEvent(G.AD_IMPRESSION,{ad_format:"Rewarded"})}processShowAdFail(e,t){const s=e===GameCore.Ads.Types.REWARDED?"rewarded_video":"interstitial";this.processEvent(G.AD_SHOW_FAILED,{ad_type:s,screen_name:`${t}`})}processPageView(e){const s=`/${this.getGameplayMode()}/${e}`;this.currentPath=s,gtag("event","page_view",{page_path:this.currentPath,send_to:["GA",this.trackingId]})}getGameplayMode(){const{storage:e}=this.game,t=e.getState();return vn(t)}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}}const{CheaterIds:iE}=GameCore.Configs.Gameplay;class nE extends Phaser.Scene{create(){this.facebook.progressLoading.loadingProgressFbBootScene(),this.startGame()}startGame=async()=>{try{await this.auth.requestToken(),await this.storage.syncStore();const{playerId:e}=this.player.getPlayer();window.clientInformation||(window.clientInformation={}),iE.includes(e)&&(window.clientInformation.playerIsCheater=!0),this.configureRollbar(),this.detectGameMode(),this.initAnalytics(),this.analytics.event(G.LOAD_START),this.scene.launch(K.GLOBAL_SCENE),this.scene.start(K.LOAD_SCENE),this.analytics.pageview(K.LOAD_SCENE)}catch(e){me(e)}finally{this.facebook.progressLoading.finishLoadingProgressFbBootScene(),this.scene.sleep(K.BOOT_SCENE)}};configureRollbar(){if(!this.rollbar)return;const e=this.player.getPlayer();this.rollbar.configure({payload:{person:{id:e.playerId,name:e.name}}})}detectGameMode(){this.storage.dispatch(Lc())}initAnalytics(){this.analytics.add(new tE(this.game,{}))}}const J={NORMAL:"NORMAL",BATTLE:"BATTLE",TUTORIAL:"TUTORIAL"},Ie=Io(),L={DEFAULT_8_BIT:{KEY:"default-8bit-resources",PATH:`./assets/textures/${Ie}x/`,JSON:`./assets/textures/${Ie}x/default-8bit-resources.json`,FRAME:{BLANK:"blank",CHALLENGE_BACK_EFFECT:"challenge-screen/back-effect",CHALLENGE_FX:"challenge-screen/fx",CHALLENGE_GLOW:"challenge-screen/glow",CHALLENGE_GRADE_BLUE:"challenge-screen/grade-blue",CHALLENGE_GRADE_RED:"challenge-screen/grade-red",CHALLENGE_ICON_ENERGY:"challenge-screen/icon-energy",CHALLENGE_SHAPE:"challenge-screen/shape",CHALLENGE_VS:"challenge-screen/vs",RESULT_SCREEN_FX_WIN:"result-screen/win-fx",RESULT_SCREEN_FX_LOSE:"result-screen/lose-fx",RESULT_SCREEN_GOLD_ICON:"result-screen/golds",RESULT_SCREEN_GREEN_BUTTON:"result-screen/green-button",RESULT_SCREEN_SINGLE_COIN_ICON:"result-screen/mini-gold",RESULT_SCREEN_LEVEL_COMPLETE_TEXT:"result-screen/level-complete",RESULT_SCREEN_CONTINUE_TEXT:"result-screen/continue",RESULT_SCREEN_WIN_TEXT:"result-screen/victory",RESULT_SCREEN_CLAIM_TEXT:"result-screen/claim",RESULT_SCREEN_EARN_TEXT:"result-screen/you-earned",RESULT_SCREEN_RIBBON_WIN:"result-screen/ribbon-green",RESULT_SCREEN_RIBBON_LOSE:"result-screen/ribbon-red",RESULT_SCREEN_YELLOW_BUTTON:"result-screen/yellow-button",RESULT_SCREEN_GREEN_BUTTON_RESULT:"result-screen/green-button-result",UNIT_UNLOCK_GLOW:"unit-unlock/glow",UNIT_UNLOCK_BG:"unit-unlock/bg",UNIT_UNLOCK_BG_1:"unit-unlock/bg-1",UNIT_UNLOCK_FRAME:"unit-unlock/frame",UNIT_UNLOCK_ICON_BATTLE:"unit-unlock/icon-battle",UNIT_UNLOCK_ICON_HEART:"unit-unlock/icon-heart",UNIT_UNLOCK_ROTATE:"unit-unlock/rotate",UNIT_REWARD_ELLIPSE_FX:"unit-reward/ellipse-fx",UNIT_REWARD_FX:"unit-reward/fx",UNIT_REWARD_GLOW:"unit-reward/glow",UNIT_REWARD_GIFT:"unit-reward/gift",UNIT_REWARD_GIFT_GLOW:"unit-reward/gift-glow",UNIT_REWARD_NO_THANKS_TEXT:"unit-reward/no-thanks-text",UNIT_REWARD_GIFT_AD:"unit-reward/gift-ad",UNIT_REWARD_PARTICLE:"unit-reward/particle",TEXT_LOADING:"loading",PRELOADER:"preloader/dual-ring",LEADERBOARD_BG_DARK:"leaderboards/bg-dark",LEADERBOARD_BG_LIGHT:"leaderboards/bg-light",LEADERBOARD_BG_LOSE:"leaderboards/bg-lose",LEADERBOARD_BG_WIN:"leaderboards/bg-win",LEADERBOARD_TAB_BG:"leaderboards/tab-bg",LEADERBOARD_TAB_LINE:"leaderboards/tab-focus",LEADERBOARD_AVATAR:"leaderboards/avatar",LEADERBOARD_RANK_GOLD:"leaderboards/rank-gold",LEADERBOARD_RANK_SILVER:"leaderboards/rank-silver",LEADERBOARD_RANK_COPPER:"leaderboards/rank-copper",LEADERBOARD_BUTTON_GREEN:"leaderboards/green-button",RIBBON_GREEN:"ribbon/green",ICON_AD:"icons/ad-icon",ICON_VIBRATION:"icons/vib",ICON_MUSIC:"icons/music",ICON_SOUND:"icons/sound",ICON_SHARE:"icons/share",ICON_BATTLE:"icons/battle",ICON_TITLE:"icons/title",ICON_TITLE_JP:"icons/title-jp",ICON_ALERT:"icons/alert",ICON_BACK_TO:"icons/back-to",ICON_REPLAY:"icons/replay",ICON_QUICK_FIGHT:"icons/quick-fight",BUTTON_CLOSE:"buttons/close",BUTTON_GREEN:"buttons/green",BUTTON_GREEN_LONG:"buttons/green-long",BUTTON_RED:"buttons/red",OFFLINE_REWARD_ADS:"offline-reward/ads",OFFLINE_REWARD_CLOSE_BTN:"offline-reward/close-btn",OFFLINE_REWARD_GOLD:"offline-reward/gold",OFFLINE_REWARD_GOLDS:"offline-reward/golds",OFFLINE_REWARD_GREEN_BTN:"offline-reward/green-btn",OFFLINE_REWARD_PARTICLE_1:"offline-reward/particle-1",OFFLINE_REWARD_PARTICLE_2:"offline-reward/particle-2",OFFLINE_REWARD_RIBBON:"offline-reward/ribbon",OFFLINE_REWARD_TICKET:"offline-reward/ticket",OFFLINE_REWARD_YELLOW_BTN:"offline-reward/yellow-btn",UNIT_SCREEN_AD_BUTTON:"unit-screen/ad-button",UNIT_SCREEN_AD_COUNT_BG:"unit-screen/ad-count-bg",UNIT_SCREEN_AD_ICON:"unit-screen/ad-icon",UNIT_SCREEN_BAR:"unit-screen/bar",UNIT_SCREEN_BG:"unit-screen/bg",UNIT_SCREEN_COIN_ICON:"unit-screen/coin-icon",UNIT_SCREEN_FRAME_1:"unit-screen/frame-1",UNIT_SCREEN_FRAME_LOCKED:"unit-screen/frame-locked",UNIT_SCREEN_ICON_BATTLE:"unit-screen/icon-battle",UNIT_SCREEN_ICON_HEART:"unit-screen/icon-heart",UNIT_SCREEN_ICON_LOCK:"unit-screen/icon-lock",UNIT_SCREEN_SLIDEBAR_BG:"unit-screen/slidebar-bg",UNIT_SCREEN_TAB_BG:"unit-screen/tab-bg",UNIT_SCREEN_TAB_FOCUS:"unit-screen/tab-focus",WHEEL_ARROW:"reward-wheel/arrow",WHEEL_LUCKY_SPIN:"reward-wheel/lucky-spin"}},DEFAULT:{KEY:"default-resources",TEXTURE:`./assets/textures/${Ie}x/default-resources.png`,JSON:`./assets/textures/${Ie}x/default-resources.json`,FRAME:{BLANK:"blank",RIBBON_BLUE:"ribbon/blue",PROGRESS_BAR_MID:"progress/bar-mid",PROGRESS_BG_LEFT:"progress/bg-left",PROGRESS_BG_MID:"progress/bg-mid",PROGRESS_BG_RIGHT:"progress/bg-right",PROGRESS_BAR_LEFT:"progress/bar-left",PROGRESS_BAR_RIGHT:"progress/bar-right",SETTINGS_SWITCH_ON:"settings/switch-on",SETTINGS_SWITCH_OFF:"settings/switch-off",TITLE_LINE:"settings/title-line",DASHBOARD_UNITBAR_BOTTOM_BG:"dashboard/unitbar-bottom-bg"}},EFFECTS:{KEY:"effects-resources",PATH:`./assets/textures/${Ie}x/`,JSON:`./assets/textures/${Ie}x/effects-resources.json`,FRAME:{BLANK:"blank",FX_COMET:"comet",FX_SPARK:"spark",FX_CIRCLE:"circle",FX_CIRCLE_LIGHT:"circle-light",FX_GLOW_LIGHT:"glow-light",FX_GLOW_SMALL:"glow-small",FX_STAR_WHITE:"star-white",FX_STAR_YELLOW:"star-yellow",FX_WHITE_GLOW:"white-glow",FX_CONFETTI_SMALL_1:"confetti/small-1",FX_CONFETTI_SMALL_2:"confetti/small-2",FX_CONFETTI_SMALL_3:"confetti/small-3",FX_CONFETTI_SMALL_4:"confetti/small-4",FX_CONFETTI_HEXAGON:"confetti/hexagon-",FX_FIREWORKS_SMALL:"fireworks/small",FX_FIREWORKS_BIG_0:"fireworks/big-explosive-0",FX_FIREWORKS_BIG_1:"fireworks/big-explosive-1",FX_FIREWORKS_SOAR_LINE:"fireworks/soar-line",FX_FIREWORKS_SOAR_CIRCLE:"fireworks/soar-circle",ANIMATION_STAR_X:"star-x/star-",ANIMATION_STAR_Y:"star-y/star-",PREFIX_ANIMATION_RIBBON_CONFETTI_A:"ribbon/falling-confetti/confetti-a/confetti-a-",PREFIX_ANIMATION_RIBBON_CONFETTI_B:"ribbon/falling-confetti/confetti-b/confetti-b-",PREFIX_ANIMATION_RIBBON_CONFETTI_C:"ribbon/falling-confetti/confetti-c/confetti-c-",PREFIX_ANIMATION_RIBBON_CONFETTI_D:"ribbon/falling-confetti/confetti-d/confetti-d-"}},ANIMATION_SCENE:{KEY:"effects-resources",PATH:`./assets/textures/${Ie}x/`,JSON:`./assets/textures/${Ie}x/animation-scene-resources.json`,FRAME:{BLANK:"blank",COIN:"coins/coin",COIN_SMALL:"coins/coin-small",COIN_SMALL_GREY:"coins/coin-small-grey",ANIMATION_STAR_X:"star-x/star-",ANIMATION_STAR_Y:"star-y/star-",FX_SPARK_YELLOW:"yellow-spark",FX_CONFETTI_RIBBON:"ribbon/ribbon",PREFIX_ANIMATION_RIBBON_CONFETTI_A:"ribbon/falling-confetti/confetti-a/confetti-a-",PREFIX_ANIMATION_RIBBON_CONFETTI_B:"ribbon/falling-confetti/confetti-b/confetti-b-",PREFIX_ANIMATION_RIBBON_CONFETTI_C:"ribbon/falling-confetti/confetti-c/confetti-c-",PREFIX_ANIMATION_RIBBON_CONFETTI_D:"ribbon/falling-confetti/confetti-d/confetti-d-"}},GAMEPLAY:{KEY:"gameplay-resources",TEXTURE:`./assets/textures/${Ie}x/gameplay-resources.png`,JSON:`./assets/textures/${Ie}x/gameplay-resources.json`,FRAME:{BLANK:"blank",GUIDE_HAND:"hand-guide/hand",GUIDE_ARROW_START:"hand-guide/arrow-start",GUIDE_ARROW_END:"hand-guide/arrow-end",GUIDE_ARROW_MIDDLE:"hand-guide/arrow-middle",HP_BAR_BG:"hp-bar/bg",TOOL_RESET:"dev-tool/reset",TOOL_EDIT:"dev-tool/edit",TOOL_ATTACK:"dev-tool/attack",TOOL_UNIT:"dev-tool/unit",ROCK:"projectiles/rock",JAVELIN:"projectiles/javelin",BOOMERANG:"projectiles/boomerang",MACE:"projectiles/mace",ARROW_1:"projectiles/arrow-1",ARROW_2:"projectiles/arrow-2",BOLT_1:"projectiles/bolt-1",BOLT_2:"projectiles/bolt-2",FIRE_RING:"projectiles/fire-ring",BLUE_FIRE:"projectiles/blue-fire",GREEN_FIRE:"projectiles/level11/green-fire-1",GREEN_FIRE_PREFIX:"projectiles/level11/green-fire-",DASHBOARD_AD_ICON:"dashboard/ad-icon",DASHBOARD_FREE_GOLD:"dashboard/btn-free-gold",DASHBOARD_FREE_GOLD_OFF:"dashboard/btn-free-gold-off",DASHBOARD_FREE_GOLD_GLOW:"dashboard/btn-free-gold-glow",DASHBOARD_COINBAR_COIN:"dashboard/coin-bar-coin",DASHBOARD_COINBAR_BG:"dashboard/coin-bar-bg",DASHBOARD_MINI_COIN:"dashboard/coin-mini",DASHBOARD_UNIT_LIST:"dashboard/btn-unit-list",DASHBOARD_UNITBAR_BG:"dashboard/unitbar-bg",DASHBOARD_UNITBAR_STAMPS:"dashboard/unitbar-stamps",DASHBOARD_UNITBAR_ARCHER:"dashboard/unitbar-archer",DASHBOARD_UNITBAR_DINO:"dashboard/unitbar-dino",DASHBOARD_START_BTN:"dashboard/btn-start",DASHBOARD_SETTINGS_BTN:"dashboard/btn-settings",DASHBOARD_LEADERBOARD_BTN:"dashboard/btn-leaderboard",DASHBOARD_BATTLE_BTN:"dashboard/btn-battle",DASHBOARD_SPEED_BTN_OFF:"dashboard/btn-speed-off",DASHBOARD_SPEED_BTN_ON:"dashboard/btn-speed-on",DASHBOARD_HPBAR_BG:"dashboard/bar/bg",DASHBOARD_HPBAR_FRONT:"dashboard/bar/bg-front",DASHBOARD_HPBAR_RED_LEFT:"dashboard/bar/red-bar/bar-left",DASHBOARD_HPBAR_RED_RIGHT:"dashboard/bar/red-bar/bar-right",DASHBOARD_HPBAR_RED_MID:"dashboard/bar/red-bar/bar-mid",DASHBOARD_HPBAR_RED:"dashboard/bar/red-bar/full-bar",DASHBOARD_HPBAR_RED_HEART:"dashboard/bar/red-bar/icon-heart-red",DASHBOARD_HPBAR_BLUE_LEFT:"dashboard/bar/blue-bar/bar-left",DASHBOARD_HPBAR_BLUE_RIGHT:"dashboard/bar/blue-bar/bar-right",DASHBOARD_HPBAR_BLUE_MID:"dashboard/bar/blue-bar/bar-mid",DASHBOARD_HPBAR_BLUE:"dashboard/bar/blue-bar/full-bar",DASHBOARD_HPBAR_BLUE_HEART:"dashboard/bar/blue-bar/icon-heart-blue",DASHBOARD_BATTLE_BUTTON_GREEN:"dashboard/btn-battle-green",DASHBOARD_BATTLE_ICON:"dashboard/icon-battle",DASHBOARD_MESSAGE_ICON:"dashboard/icon-message",DASHBOARD_AVATAR_FRAME_BLUE:"dashboard/avatar-frame-blue",DASHBOARD_AVATAR_FRAME_RED:"dashboard/avatar-frame-red",DASHBOARD_VS:"dashboard/vs",DASHBOARD_UNITBAR_BG_LANDSCAPE:"dashboard/unitbar-bg-landscape",DASHBOARD_AD_ICON_LANDSCAPE:"dashboard/ad-icon-landscape",DASHBOARD_START_BTN_LANDSCAPE:"dashboard/btn-start-landscape",PURPLE_EFFECT:"effect-text/purple-effect",EFFECT_WIN_GLOW:"effect-text/win/glow",EFFECT_WIN_SHAPE_ABOVE:"effect-text/win/shape-above",EFFECT_WIN_SHAPE_BELOW:"effect-text/win/shape-below",EFFECT_LOSE_GLOW:"effect-text/lose/glow",EFFECT_LOSE_SHAPE_ABOVE:"effect-text/lose/shape-above",EFFECT_LOSE_SHAPE_BELOW:"effect-text/lose/shape-below"}},UNITS:{KEY:"units-resources",PATH:`./assets/textures/${Ie}x/`,JSON:`./assets/textures/${Ie}x/units-resources.json`,FRAME:{DINO_MALE_DOUX_PREFIX:"dino/male/doux/doux-",DINO_MALE_KIRA_PREFIX:"dino/male/kira/kira-",DINO_MALE_LOKI_PREFIX:"dino/male/loki/loki-",DINO_MALE_MORT_PREFIX:"dino/male/mort/mort-",DINO_MALE_NICO_PREFIX:"dino/male/nico/nico-",DINO_MALE_OLAF_PREFIX:"dino/male/olaf/olaf-",DINO_MALE_TARD_PREFIX:"dino/male/tard/tard-",DINO_MALE_VITA_PREFIX:"dino/male/vita/vita-",DINO_FEMALE_DOUX_PREFIX:"dino/female/doux/doux-",DINO_FEMALE_KIRA_PREFIX:"dino/female/kira/kira-",DINO_FEMALE_LOKI_PREFIX:"dino/female/loki/loki-",DINO_FEMALE_MORT_PREFIX:"dino/female/mort/mort-",DINO_FEMALE_NICO_PREFIX:"dino/female/nico/nico-",DINO_FEMALE_OLAF_PREFIX:"dino/female/olaf/olaf-",DINO_FEMALE_TARD_PREFIX:"dino/female/tard/tard-",DINO_FEMALE_VITA_PREFIX:"dino/female/vita/vita-",LOCKED:{MELEE:{1:"dino-locked/lv01-velociraptor",2:"dino-locked/lv02-saurolophus",3:"dino-locked/lv03-pachysaurus",4:"dino-locked/lv04-triceratops",5:"dino-locked/lv05-stegosaurus",6:"dino-locked/lv06-ankylosaurus",7:"dino-locked/lv07-baroptiloraptor",8:"dino-locked/lv08-tyrannosaurus",9:"dino-locked/lv09-dilophosaurus",10:"dino-locked/lv10-triceradonosaurus",11:"dino-locked/lv11-spinosaurus-rex"},RANGED:{1:"warriors-locked/lv01-rockthrower",2:"warriors-locked/lv02-javelineer",3:"warriors-locked/lv03-boomeranger",4:"warriors-locked/lv04-macer",5:"warriors-locked/lv05-artemis",6:"warriors-locked/lv06-william",7:"warriors-locked/lv07-blanchette",8:"warriors-locked/lv08-phantom",9:"warriors-locked/lv09-oracle",10:"warriors-locked/lv10-shaman",11:"warriors-locked/lv11-seraph"}},UNLOCKED:{MELEE:{1:"dino-unlocked/lv01-velociraptor",2:"dino-unlocked/lv02-saurolophus",3:"dino-unlocked/lv03-pachysaurus",4:"dino-unlocked/lv04-triceratops",5:"dino-unlocked/lv05-stegosaurus",6:"dino-unlocked/lv06-ankylosaurus",7:"dino-unlocked/lv07-baroptiloraptor",8:"dino-unlocked/lv08-tyrannosaurus",9:"dino-unlocked/lv09-dilophosaurus",10:"dino-unlocked/lv10-triceradonosaurus",11:"dino-unlocked/lv11-spinosaurus-rex"},RANGED:{1:"warriors-unlocked/lv01-rockthrower",2:"warriors-unlocked/lv02-javelineer",3:"warriors-unlocked/lv03-boomeranger",4:"warriors-unlocked/lv04-macer",5:"warriors-unlocked/lv05-artemis",6:"warriors-unlocked/lv06-william",7:"warriors-unlocked/lv07-blanchette",8:"warriors-unlocked/lv08-phantom",9:"warriors-unlocked/lv09-oracle",10:"warriors-unlocked/lv10-shaman",11:"warriors-unlocked/lv11-seraph"}}}},UNITS_SPRITES:{KEY:"units-sprite-resources",PATH:`./assets/textures/${Ie}x/`,JSON:`./assets/textures/${Ie}x/units-sprite-resources.json`,FRAME:{MELEE:{1:{MAIN_TEXTURE:"melee-1/idle/idle-00",ATTACK_PREFIX:"melee-1/attack/attack-",DIE_PREFIX:"melee-1/die/die-",IDLE_PREFIX:"melee-1/idle/idle-",RUN_PREFIX:"melee-1/run/run-"}},RANGED:{1:{MAIN_TEXTURE:"ranged-1/idle/idle-00",ATTACK_PREFIX:"ranged-1/attack/attack-",DIE_PREFIX:"ranged-1/die/die-",IDLE_PREFIX:"ranged-1/idle/idle-"}}}},UNITS_SPINES:{MELEE:{1:{KEY:"velociraptor-spine",jsonPATH:"./assets/spines/units/melee-1/velociraptor.json",atlasPATH:"./assets/spines/units/melee-1/velociraptor.atlas"},2:{KEY:"saurolophus-spine",jsonPATH:"./assets/spines/units/melee-2/saurolophus.json",atlasPATH:"./assets/spines/units/melee-2/saurolophus.atlas"},3:{KEY:"pachysaurus-spine",jsonPATH:"./assets/spines/units/melee-3/pachysaurus.json",atlasPATH:"./assets/spines/units/melee-3/pachysaurus.atlas"},4:{KEY:"triceratops-spine",jsonPATH:"./assets/spines/units/melee-4/triceratops.json",atlasPATH:"./assets/spines/units/melee-4/triceratops.atlas"},5:{KEY:"stegosaurus-spine",jsonPATH:"./assets/spines/units/melee-5/stegosaurus.json",atlasPATH:"./assets/spines/units/melee-5/stegosaurus.atlas"},6:{KEY:"ankyntrosaurus-spine",jsonPATH:"./assets/spines/units/melee-6/ankyntrosaurus.json",atlasPATH:"./assets/spines/units/melee-6/ankyntrosaurus.atlas"},7:{KEY:"baroptiloraptor-spine",jsonPATH:"./assets/spines/units/melee-7/baroptiloraptor.json",atlasPATH:"./assets/spines/units/melee-7/baroptiloraptor.atlas"},8:{KEY:"tyrannosaurus-spine",jsonPATH:"./assets/spines/units/melee-8/tyrannosaurus.json",atlasPATH:"./assets/spines/units/melee-8/tyrannosaurus.atlas"},9:{KEY:"dilophosaurus-spine",jsonPATH:"./assets/spines/units/melee-9/dilophosaurus.json",atlasPATH:"./assets/spines/units/melee-9/dilophosaurus.atlas"},10:{KEY:"triceradonosaurus-spine",jsonPATH:"./assets/spines/units/melee-10/triceradonosaurus.json",atlasPATH:"./assets/spines/units/melee-10/triceradonosaurus.atlas"},11:{KEY:"spinosaurus-rex-spine",jsonPATH:"./assets/spines/units/melee-11/spinosaurus-rex.json",atlasPATH:"./assets/spines/units/melee-11/spinosaurus-rex.atlas"}},RANGED:{1:{KEY:"rockthrower-spine",jsonPATH:"./assets/spines/units/ranged-1/rockthrower.json",atlasPATH:"./assets/spines/units/ranged-1/rockthrower.atlas"},2:{KEY:"javelineer-spine",jsonPATH:"./assets/spines/units/ranged-2/javelineer.json",atlasPATH:"./assets/spines/units/ranged-2/javelineer.atlas"},3:{KEY:"boomeranger-spine",jsonPATH:"./assets/spines/units/ranged-3/boomeranger.json",atlasPATH:"./assets/spines/units/ranged-3/boomeranger.atlas"},4:{KEY:"macer-spine",jsonPATH:"./assets/spines/units/ranged-4/macer.json",atlasPATH:"./assets/spines/units/ranged-4/macer.atlas"},5:{KEY:"artemis-spine",jsonPATH:"./assets/spines/units/ranged-5/artemis.json",atlasPATH:"./assets/spines/units/ranged-5/artemis.atlas"},6:{KEY:"william-spine",jsonPATH:"./assets/spines/units/ranged-6/william.json",atlasPATH:"./assets/spines/units/ranged-6/william.atlas"},7:{KEY:"blanchette-spine",jsonPATH:"./assets/spines/units/ranged-7/blanchette.json",atlasPATH:"./assets/spines/units/ranged-7/blanchette.atlas"},8:{KEY:"phantom-spine",jsonPATH:"./assets/spines/units/ranged-8/phantom.json",atlasPATH:"./assets/spines/units/ranged-8/phantom.atlas"},9:{KEY:"oracle-spine",jsonPATH:"./assets/spines/units/ranged-9/oracle.json",atlasPATH:"./assets/spines/units/ranged-9/oracle.atlas"},10:{KEY:"shaman-spine",jsonPATH:"./assets/spines/units/ranged-10/shaman.json",atlasPATH:"./assets/spines/units/ranged-10/shaman.atlas"},11:{KEY:"seraph-spine",jsonPATH:"./assets/spines/units/ranged-11/seraph.json",atlasPATH:"./assets/spines/units/ranged-11/seraph.atlas"}}},SPINE_EFFECTS:{FX_MERGE:{KEY:"fx-merge-spine",jsonPATH:"./assets/spines/effects/merge/fx_merge.json",atlasPATH:"./assets/spines/effects/merge/fx_merge.atlas"}}};GameCore.Utils.Valid.isDebugger()&&(L.EFFECTS.FRAME={...L.ANIMATION_SCENE.FRAME,...L.EFFECTS.FRAME});const W={FIELD_BACKGROUND:0,BACKGROUND:1,FIREWORKS:5,FIELD_SQUARE:10,FIELD_SQUARE_RECT:11,MANAGER_BASE_DEPTH:20,ENCOURAGING:31,MESSAGE:33,POPUP:40,DEPTH_ON_DRAG:70,UNIT_HP_BAR:71,DMG_POPUP_NUMBER:80,BUTTON:90,ITEM:91,EFFECT:95,PRIORITY:100,TUTORIAL_OBJECT:101,DEBUG:110,ON_TOP:1e4},{KEY:Ii,FRAME:Ci}=L.GAMEPLAY;class aE extends Phaser.GameObjects.Container{arrowStart;arrowEnd;arrowMiddle;expandTween;constructor(e){super(e),this.name="AdjustableArrow",this.addArrowStart(),this.addArrowEnd(),this.addArrowMiddle(),this.setDepth(W.EFFECT),this.scene.add.existing(this)}addArrowStart(){this.arrowStart=this.scene.make.image({key:Ii,frame:Ci.GUIDE_ARROW_START,origin:{x:0,y:.5}}),this.arrowStart.setWorldSize(20,26),this.add(this.arrowStart)}addArrowEnd(){this.arrowEnd=this.scene.make.image({key:Ii,frame:Ci.GUIDE_ARROW_END,origin:{x:1,y:.5}}),this.arrowEnd.setWorldSize(4,13),this.add(this.arrowEnd)}addArrowMiddle(){this.arrowMiddle=this.scene.make.image({key:Ii,frame:Ci.GUIDE_ARROW_MIDDLE,origin:{x:.5,y:.5}}),this.arrowMiddle.setWorldSize(1,13),this.add(this.arrowMiddle)}changeArrowLength(e){const t=e-this.arrowStart.width-this.arrowEnd.width;this.arrowMiddle.setWorldSize(t,this.arrowMiddle.height),this.arrowEnd.setPosition(-t/2,0),this.arrowStart.setPosition(t/2,0)}runArrowExpandTween(e,t,s){const i=s-this.arrowStart.width-this.arrowEnd.width;this.arrowEnd.setPosition(-i/2,0),this.arrowStart.setPosition(-i/2,0),this.arrowMiddle.setWorldSize(0,this.arrowMiddle.height),this.expandTween=this.scene.tweens.addCounter({from:0,to:100,duration:e,completeDelay:t,ease:Phaser.Math.Easing.Cubic.Out,onUpdate:n=>{const r=n.getValue(),c=i*r/100;this.arrowMiddle.setWorldSize(c,this.arrowMiddle.height);const o=-i/2+c/2;this.arrowMiddle.setPosition(o,0);const l=-i/2+c;this.arrowStart.setPosition(l,0)},onComplete:()=>{this.setAlpha(0)},onStop:()=>{this.setAlpha(0)}})}killExpandTween(){this.expandTween?.stop()}}const{KEY:rE,FRAME:oE}=L.GAMEPLAY;class Oc extends Phaser.GameObjects.Container{hand;arrow;toGlobalX=0;toGlobalY=0;constructor(e){super(e),this.name="DragTutorialHand",this.addHand(),this.addArrow(),this.bringToTop(this.hand),this.scene.add.existing(this)}addHand(){this.hand=this.scene.make.image({key:rE,frame:oE.GUIDE_HAND,origin:{x:0,y:0}}),this.hand.setWorldSize(65.5,55.5),this.add(this.hand)}addArrow(){this.arrow=new aE(this.scene),this.arrow.setAlpha(0)}setTarget(e,t){this.toGlobalX=e,this.toGlobalY=t}playAnimation(e=0,t=800){const s=1/this.scene.world.getPixelRatio();this.hand.angle=0;const i=this.toGlobalX-this.x,n=this.toGlobalY-this.y,r=this.x+i/2,c=this.y+n/2,o=Math.sqrt(i*i+n*n)*.8;this.arrow.setPosition(r,c),this.arrow.rotation=Math.atan2(n,i),this.arrow.setAlpha(0),this.arrow.killExpandTween(),this.hand.setPosition(0,0),this.hand.setAlpha(1),this.scene?.tweens.add({delay:e,targets:this.arrow,ease:Phaser.Math.Easing.Cubic.Out,onStart:()=>{this.arrow.runArrowExpandTween(1200,200,o)},props:{alpha:{start:0,value:.5,duration:200}}}),this.scene?.tweens.add({delay:e,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:0,value:1,duration:200},x:{from:0,to:i,duration:1200},y:{from:0,to:n,duration:1200}},onComplete:()=>{this.scene?.tweens.add({targets:[this.hand],delay:200,duration:200,completeDelay:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:0},onComplete:()=>{this.hand.x=0,this.hand.y=0,this.hand.scale=s,this.playAnimation(e,t)}})}})}stopAnimation(){this.scene.tweens.killTweensOf(this.hand),this.scene.tweens.killTweensOf(this.arrow)}kill(){this.arrow.kill(),super.kill()}revive(){this.arrow.revive(),super.revive()}destroy(e){this.arrow.destroy(e),super.destroy(e)}preDestroy(){this.scene.tweens.killTweensOf(this.hand),this.scene.tweens.killTweensOf(this.arrow)}}const mt={STATUS:{READY:"ready",RUNNING:"running",STOPPED:"stopped"}},{STATUS:Ft}=mt;class Te{state;scene;constructor(e){this.scene=e}init(){this.setState(Ft.READY)}start(){this.isRunning()||this.setState(Ft.RUNNING)}stop(){this.isRunning()&&this.setState(Ft.STOPPED)}setState(e){this.state=e}isReady(){return this.state===Ft.READY}isRunning(){return this.state===Ft.RUNNING}isStopped(){return this.state===Ft.STOPPED}}const{HintWaitTime:cE}=GameCore.Configs.Gameplay;class lE extends Te{scene;hand;autoTimeEvent;isDragging=!1;constructor(e){super(e),this.scene=e,this.createHand()}init(){super.init()}start(){this.isRunning()||(super.start(),this.listenEvent(),this.startAutoHint())}stop(){this.isRunning()&&(super.stop(),this.isDragging=!1,this.stopListenEvent(),this.stopAutoHint())}createHand(){this.hand=new Oc(this.scene),this.hand.kill(),this.hand.setDepth(W.PRIORITY)}startAutoHint(){this.autoTimeEvent=this.scene.time.delayedCall(cE,this.handleAutomaticallyHint)}handleAutomaticallyHint=()=>{const{unitManager:e}=this.scene,t=e.getSameCoupleUnits();if(!t){this.startAutoHint();return}this.hand.stopAnimation(),this.hand.revive(),this.hand.setPosition(t.unit1.x,t.unit1.y),this.hand.setTarget(t.unit2.x,t.unit2.y),this.hand.playAnimation(500)};listenEvent(){this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,this.handlePlayerInteract),this.scene.input.on(Phaser.Input.Events.DRAG_START,this.handlePlayerDragging),this.scene.input.on(Phaser.Input.Events.DRAG_END,this.handlePlayerEndDrag)}stopListenEvent(){this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.handlePlayerInteract),this.scene.input.off(Phaser.Input.Events.DRAG_START,this.handlePlayerDragging),this.scene.input.off(Phaser.Input.Events.DRAG_END,this.handlePlayerEndDrag)}handlePlayerDragging=()=>{this.isDragging||(this.isDragging=!0,this.stopAutoHint())};handlePlayerEndDrag=()=>{this.isDragging=!1,this.startAutoHint()};handlePlayerInteract=()=>{this.stopAutoHint(),!this.isDragging&&this.startAutoHint()};stopAutoHint(){this.hand.kill(),this.hand.stopAnimation(),this.autoTimeEvent?.remove()}}const{KEY:Oe,FRAME:De}=L.UNITS_SPRITES,{KEY:hE,FRAME:uE}=L.GAMEPLAY,Ve={END:2,START:0,EVENT:5,DISPOSE:3,COMPLETE:4,INTERRUPT:1},te={MELEE:{RUN:"run",DIE:"die",IDLE:"idle",ATTACK:"attack",CUSTOM_EVENTS:{FINISHED_ATTACKING:"finished_attacking"}},RANGED:{DIE:"die",IDLE:"idle",ATTACK:"attack",ATTACK_ABOVE:"attack_above",ATTACK_BELOW:"attack_below",CUSTOM_EVENTS:{FINISHED_ATTACKING:"finished_attacking"}}},Qs={GREEN_FIRE:{KEY:"confetti-hexagon-animation",TEXTURE:hE,PREFIX:uE.GREEN_FIRE_PREFIX,FRAME_RATE:30,START:1,END:3,ZERO_PAD:0}},ge={MELEE:{1:{ATTACK:{KEY:"velociraptor-attack",TEXTURE:Oe,PREFIX:De.MELEE[1].ATTACK_PREFIX,FRAME_RATE:30,EVENT_FRAME:9,START:0,END:20,ZERO_PAD:2},DIE:{KEY:"velociraptor-die",TEXTURE:Oe,PREFIX:De.MELEE[1].DIE_PREFIX,FRAME_RATE:20,START:0,END:19,ZERO_PAD:2},IDLE:{KEY:"velociraptor-idle",TEXTURE:Oe,PREFIX:De.MELEE[1].IDLE_PREFIX,FRAME_RATE:30,START:0,END:39,ZERO_PAD:2},RUN:{KEY:"velociraptor-move",TEXTURE:Oe,PREFIX:De.MELEE[1].RUN_PREFIX,FRAME_RATE:40,START:0,END:20,ZERO_PAD:2}}},RANGED:{1:{ATTACK_ABOVE:{KEY:"rockthrower-attack",TEXTURE:Oe,PREFIX:De.RANGED[1].ATTACK_PREFIX,FRAME_RATE:30,EVENT_FRAME:16,START:0,END:29,ZERO_PAD:2},ATTACK_BELOW:{KEY:"rockthrower-attack",TEXTURE:Oe,PREFIX:De.RANGED[1].ATTACK_PREFIX,FRAME_RATE:30,EVENT_FRAME:16,START:0,END:29,ZERO_PAD:2},DIE:{KEY:"rockthrower-die",TEXTURE:Oe,PREFIX:De.RANGED[1].DIE_PREFIX,FRAME_RATE:24,START:0,END:23,ZERO_PAD:2},IDLE:{KEY:"rockthrower-idle",TEXTURE:Oe,PREFIX:De.RANGED[1].IDLE_PREFIX,FRAME_RATE:24,START:0,END:23,ZERO_PAD:2}}},ALIEN:{1:{ATTACK:{KEY:"velociraptor-attack",TEXTURE:Oe,PREFIX:De.MELEE[1].ATTACK_PREFIX,FRAME_RATE:30,START:0,END:29,ZERO_PAD:2},DIE:{KEY:"velociraptor-die",TEXTURE:Oe,PREFIX:De.MELEE[1].DIE_PREFIX,FRAME_RATE:20,START:0,END:19,ZERO_PAD:2},IDLE:{KEY:"velociraptor-idle",TEXTURE:Oe,PREFIX:De.MELEE[1].IDLE_PREFIX,FRAME_RATE:40,START:0,END:39,ZERO_PAD:2},RUN:{KEY:"velociraptor-move",TEXTURE:Oe,PREFIX:De.MELEE[1].RUN_PREFIX,FRAME_RATE:25,START:0,END:24,ZERO_PAD:2}}}},{KEY:dE,TEXTURE:pE,FRAME_RATE:gE,START:fE,END:EE,PREFIX:mE,ZERO_PAD:AE}=ge.ALIEN[1].ATTACK;class SE extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:gE,frames:e.generateFrameNames(pE,{prefix:mE,start:fE,end:EE,zeroPad:AE}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,dE,t)}}const{KEY:yE,TEXTURE:TE,FRAME_RATE:IE,START:CE,END:RE,PREFIX:_E,ZERO_PAD:vE}=ge.ALIEN[1].DIE;class wE extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:IE,frames:e.generateFrameNames(TE,{prefix:_E,start:CE,end:RE,zeroPad:vE}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,yE,t)}}const{KEY:LE,TEXTURE:bE,FRAME_RATE:PE,START:OE,END:DE,PREFIX:NE,ZERO_PAD:ME}=ge.ALIEN[1].IDLE;class kE extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:PE,frames:e.generateFrameNames(bE,{prefix:NE,start:OE,end:DE,zeroPad:ME}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,LE,t)}}const{KEY:UE,TEXTURE:xE,FRAME_RATE:BE,START:FE,END:GE,PREFIX:HE,ZERO_PAD:YE}=ge.ALIEN[1].RUN;class KE extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:BE,frames:e.generateFrameNames(xE,{prefix:HE,start:FE,end:GE,zeroPad:YE}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,UE,t)}}const{KEY:VE,TEXTURE:WE,FRAME_RATE:jE,START:$E,END:zE,PREFIX:XE,ZERO_PAD:qE}=ge.MELEE[1].ATTACK;class ZE extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:jE,frames:e.generateFrameNames(WE,{prefix:XE,start:$E,end:zE,zeroPad:qE}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,VE,t)}}const{KEY:QE,TEXTURE:JE,FRAME_RATE:em,START:tm,END:sm,PREFIX:im,ZERO_PAD:nm}=ge.MELEE[1].DIE;class am extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:em,frames:e.generateFrameNames(JE,{prefix:im,start:tm,end:sm,zeroPad:nm}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,QE,t)}}const{KEY:rm,TEXTURE:om,FRAME_RATE:cm,START:lm,END:hm,PREFIX:um,ZERO_PAD:dm}=ge.MELEE[1].IDLE;class pm extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:cm,frames:e.generateFrameNames(om,{prefix:um,start:lm,end:hm,zeroPad:dm}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,rm,t)}}const{KEY:gm,TEXTURE:fm,FRAME_RATE:Em,START:mm,END:Am,PREFIX:Sm,ZERO_PAD:ym}=ge.MELEE[1].RUN;class Tm extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:Em,frames:e.generateFrameNames(fm,{prefix:Sm,start:mm,end:Am,zeroPad:ym}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,gm,t)}}const{KEY:Im,TEXTURE:Cm,FRAME_RATE:Rm,START:_m,END:vm,PREFIX:wm,ZERO_PAD:Lm}=Qs.GREEN_FIRE;class bm extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:Rm,frames:e.generateFrameNames(Cm,{prefix:wm,start:_m,end:vm,zeroPad:Lm}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,Im,t)}}const{KEY:Pm,TEXTURE:Om,FRAME_RATE:Dm,START:Nm,END:Mm,PREFIX:km,ZERO_PAD:Um}=ge.RANGED[1].ATTACK_ABOVE;class xm extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:Dm,frames:e.generateFrameNames(Om,{prefix:km,start:Nm,end:Mm,zeroPad:Um}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,Pm,t)}}const{KEY:Bm,TEXTURE:Fm,FRAME_RATE:Gm,START:Hm,END:Ym,PREFIX:Km,ZERO_PAD:Vm}=ge.RANGED[1].DIE;class Wm extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:Gm,frames:e.generateFrameNames(Fm,{prefix:Km,start:Hm,end:Ym,zeroPad:Vm}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,Bm,t)}}const{KEY:jm,TEXTURE:$m,FRAME_RATE:zm,START:Xm,END:qm,PREFIX:Zm,ZERO_PAD:Qm}=ge.RANGED[1].IDLE;class Jm extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:zm,frames:e.generateFrameNames($m,{prefix:Zm,start:Xm,end:qm,zeroPad:Qm}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,jm,t)}}class eA extends Te{scene;constructor(e){super(e),this.scene=e}addLevel11ProjectileAnimation(){if(!this.scene.anims.exists(Qs.GREEN_FIRE.KEY)){const e=new bm(this.scene.anims);this.scene.anims.add(Qs.GREEN_FIRE.KEY,e)}}addAlienAnimation(){const{ATTACK:e,DIE:t,IDLE:s}=ge.ALIEN[1];if(!this.scene.anims.exists(s.KEY)){const i=new kE(this.scene.anims);this.scene.anims.add(s.KEY,i)}if(!this.scene.anims.exists(e.KEY)){const i=new KE(this.scene.anims);this.scene.anims.add(e.KEY,i)}if(!this.scene.anims.exists(s.KEY)){const i=new SE(this.scene.anims);this.scene.anims.add(s.KEY,i)}if(!this.scene.anims.exists(t.KEY)){const i=new wE(this.scene.anims);this.scene.anims.add(t.KEY,i)}}addMeleeLevel1Animation(){const{ATTACK:e,DIE:t,IDLE:s,RUN:i}=ge.MELEE[1];if(!this.scene.anims.exists(e.KEY)){const n=new ZE(this.scene.anims);this.scene.anims.add(e.KEY,n)}if(!this.scene.anims.exists(t.KEY)){const n=new am(this.scene.anims);this.scene.anims.add(t.KEY,n)}if(!this.scene.anims.exists(s.KEY)){const n=new pm(this.scene.anims);this.scene.anims.add(s.KEY,n)}if(!this.scene.anims.exists(i.KEY)){const n=new Tm(this.scene.anims);this.scene.anims.add(i.KEY,n)}}addRangedLevel1Animation(){const{ATTACK_ABOVE:e,DIE:t,IDLE:s}=ge.RANGED[1];if(!this.scene.anims.exists(e.KEY)){const i=new xm(this.scene.anims);this.scene.anims.add(e.KEY,i)}if(!this.scene.anims.exists(t.KEY)){const i=new Wm(this.scene.anims);this.scene.anims.add(t.KEY,i)}if(!this.scene.anims.exists(s.KEY)){const i=new Jm(this.scene.anims);this.scene.anims.add(s.KEY,i)}}checkIfAnimationIsAdded(e){return this.scene.anims.exists(e)}addMeleeUnitAnimationBasedOnLevel(e){switch(e){case 1:this.addMeleeLevel1Animation();break;default:this.addAlienAnimation()}}addRangedUnitAnimationBasedOnLevel(e){switch(e){case 1:this.addRangedLevel1Animation();break;default:this.addAlienAnimation()}}}const F={MELEE_UNIT_TYPE:"melee",RANGED_UNIT_TYPE:"ranged",ALIEN_UNIT_TYPE:"alien",MELEE_ATTACK_RANGE:40,MELEE_MOVEMENT_SPEED:100,MELEE_ATTACK_INTERVAL:800,RANGED_ATTACK_INTERVAL:1100,RANGED_PROJECTILE_SPEED:600,BASE_UNIT_COIN:2,UNIT_COIN_SCALE:1.6,COINS_PER_ATTACK:1,ATTACK_COIN_SCALE:1.6,MULTIPLY_REWARD_ROUND:6,MULTIPLY_REWARD_BATTLE:2,UNIT_SIZE_SCALE:1,UNIT_PRICE_CUSTOM_MODIFIER:[[1,1],[3,5],[10,2],[25,1.5],[40,1.5]],ATTACK_CUSTOM_MODIFIER:[[1,1],[9,2],[30,1.2]],AD_WATCH_REQUIREMENT:[0,1,2,3,4,5,7,9,12,15,20],BUYING_UNIT_LEVEL:[1,51,151,251]},{MULTIPLY_REWARD_ROUND:tA,UNIT_COIN_SCALE:Ri,BASE_UNIT_COIN:sA,COINS_PER_ATTACK:iA,ATTACK_COIN_SCALE:_i,MULTIPLY_REWARD_BATTLE:nA}=F;class aA extends Te{scene;unitModifier;currentUnitModifier;attackModifier;currentAttackModifier;totalCoinsByAttack;constructor(e){super(e),this.scene=e,this.initModifier()}initModifier(){this.unitModifier=new q(1),this.attackModifier=new q(1),this.currentUnitModifier=new q(1)}init(){super.init(),this.totalCoinsByAttack=new q(0)}getUnitPrice(e){const t=e||0,s=new q(sA),i=s.clone();return i.multiply(t),i.multiply(this.unitModifier),i.biggerThan(s)?i:s}getAttackCoinByUnit(e,t){const s=(e.level-1)*.75+iA,i=this.attackModifier.clone();i.multiply(s);const n=t.currentHp,r=e.attackPower;return n<r&&(i.multiply(n),i.divide(r)),i.biggerThan(new q(1))?i:new q(1)}setUnitModifier(e,t=1){if(e<=50){const s=Math.pow(Ri,e);this.currentUnitModifier=new q(1),this.currentUnitModifier.multiply(s)}else{const s=Math.pow(Ri,50),i=Math.floor(e/50),n=e%50;this.currentUnitModifier=new q(1);for(let c=0;c<i;c++)this.currentUnitModifier.multiply(s);const r=Math.pow(Ri,n);this.currentUnitModifier.multiply(r)}this.currentUnitModifier.multiply(t),this.unitModifier=this.currentUnitModifier}getUnitModifier(){return this.unitModifier}setAttackModifier(e,t=1){if(e<=50){const s=Math.pow(_i,e);this.currentAttackModifier=new q(1),this.currentAttackModifier.multiply(s)}else{const s=Math.pow(_i,50),i=Math.floor(e/50),n=e%50;this.currentAttackModifier=new q(1);for(let c=0;c<i;c++)console.log("Attack modifier: ",this.attackModifier.toString()),this.currentAttackModifier.multiply(s),this.currentAttackModifier.multiply(1.5),console.log("Attack modifier: ",this.attackModifier.toString());const r=Math.pow(_i,n);this.currentAttackModifier.multiply(r)}this.currentAttackModifier.multiply(t),this.attackModifier=this.currentAttackModifier}getAttackModifier(){return this.attackModifier}addCoinsByAttack(e){this.totalCoinsByAttack.add(e)}getTotalCoinsByAttack(){return this.totalCoinsByAttack.clone()}getRewardCoinsByAttackCoins(){const{gameMode:e}=this.scene,t=this.totalCoinsByAttack.clone();return t.multiply(tA),e===J.BATTLE&&t.multiply(nA),t}}const{UNIT_PRICE_CUSTOM_MODIFIER:vi,ATTACK_CUSTOM_MODIFIER:wi}=F;class rA extends Te{scene;currentGameMode;unitLevelsUpdated;customUnitModifier;attackLevelsUpdated;customAttackModifier;constructor(e){super(e),this.scene=e,this.intData()}intData(){this.currentGameMode=J.NORMAL,this.unitLevelsUpdated=[!1],this.customUnitModifier=0,this.attackLevelsUpdated=[!1],this.customAttackModifier=0,GameCore.Utils.Valid.isDebugger()&&localStorage.clear(),this.initDataToolDev()}init(){const{levelManager:e}=this.scene;(this.scene.gameMode!==this.currentGameMode||e.isInLevelBuilderLevel())&&(this.currentGameMode=this.scene.gameMode,this.unitLevelsUpdated=[!1],this.customUnitModifier=0,this.attackLevelsUpdated=[!1],this.customAttackModifier=0)}initDataToolDev(){if(!GameCore.Utils.Valid.isDebugger())return;if(!bt("DevCustomUnitMod")){const s={};vi.forEach(i=>{s[i[0]]=i[1]}),Pt("DevCustomUnitMod",s)}if(!bt("DevCustomAttackMod")){const s={};wi.forEach(i=>{s[i[0]]=i[1]}),Pt("DevCustomAttackMod",s)}}addCustomUnitModifier(e){this.customUnitModifier+=e}updateCustomUnitModifierByLevel(e){if(this.updateCustomUnitModSuccessByDevTool(e))return;for(let s=0;s<vi.length;s++){const i=vi[s],n=i[0],r=i[1];if(n>e)break;this.unitLevelsUpdated[n]||(this.addCustomUnitModifier(r),this.unitLevelsUpdated[n]=!0)}const{coinManager:t}=this.scene;t.setUnitModifier(e,this.customUnitModifier)}updateCustomUnitModSuccessByDevTool(e){if(!GameCore.Utils.Valid.isDebugger())return!1;const t=bt("DevCustomUnitMod");if(!GameCore.Utils.Valid.isObject(t))return!1;let s=0;for(const[r,c]of Object.entries(t)){const o=parseInt(r),l=c;if(o>e)break;o===e&&(s=l),this.unitLevelsUpdated[o]||(this.addCustomUnitModifier(l),this.unitLevelsUpdated[o]=!0)}const{coinManager:i,devToolManager:n}=this.scene;return i.setUnitModifier(e,this.customUnitModifier),n.setCurrentUnitModText(s,i.getUnitModifier()),!0}editCurrentLevelUnitMod(e){const{levelManager:t}=this.scene,s=t.getCurrentLevelId(),i=bt("DevCustomUnitMod");if(GameCore.Utils.Valid.isObject(i)){const r=i[s];this.customUnitModifier=this.customUnitModifier-r+e,Pt("DevCustomUnitMod",{[s]:e})}else this.addCustomUnitModifier(e),this.unitLevelsUpdated[s]=!0,Pt("DevCustomUnitMod",{[s]:e});const{coinManager:n}=this.scene;return n.setUnitModifier(s,this.customUnitModifier),n.getUnitModifier()}addCustomAttackModifier(e){this.customAttackModifier+=e}updateCustomAttackModifierByLevel(e){if(this.updateCustomAttackModSuccessByDevTool(e))return;for(let s=0;s<wi.length;s++){const i=wi[s],n=i[0],r=i[1];if(n>e)break;this.attackLevelsUpdated[n]||(this.addCustomAttackModifier(r),this.attackLevelsUpdated[n]=!0)}const{coinManager:t}=this.scene;t.setAttackModifier(e,this.customAttackModifier)}updateCustomAttackModSuccessByDevTool(e){if(!GameCore.Utils.Valid.isDebugger())return!1;const t=bt("DevCustomAttackMod");if(!GameCore.Utils.Valid.isObject(t))return!1;let s=0;for(const[r,c]of Object.entries(t)){const o=parseInt(r),l=c;if(o>e)break;o===e&&(s=l),this.attackLevelsUpdated[o]||(this.addCustomAttackModifier(l),this.attackLevelsUpdated[o]=!0)}const{coinManager:i,devToolManager:n}=this.scene;return i.setAttackModifier(e,this.customAttackModifier),n.setCurrentAttackModText(s,i.getAttackModifier()),!0}editCurrentLevelAttackMod(e){const{levelManager:t}=this.scene,s=t.getCurrentLevelId(),i=bt("DevCustomAttackMod");if(GameCore.Utils.Valid.isObject(i)){const r=i[s];this.customAttackModifier=this.customAttackModifier-r+e,Pt("DevCustomAttackMod",{[s]:e})}else this.addCustomAttackModifier(e),this.attackLevelsUpdated[s]=!0,Pt("DevCustomAttackMod",{[s]:e});const{coinManager:n}=this.scene;return n.setAttackModifier(s,this.customAttackModifier),n.getAttackModifier()}}class Le{scene;config;isStarted;tween;constructor(e,t){if(t.targets.length<1)return;this.buildConfig(e,t);const{scene:s}=this.config.targets[0];s instanceof Phaser.Scene&&(this.scene=s,this.isStarted=!1,this.tween=s.tweens.create(this.config))}buildConfig(e,t){this.config=Me(e,t)}play(){if(this.tween){if(this.isStarted&&this.tween.hasStarted){this.restart();return}this.tween.play(!0),this.isStarted=!0}}restart(){this.tween?.restart()}stop(){this.tween?.stop()}remove(){this.tween?.remove()}next(e){return this.tween?(this.tween.off(Phaser.Tweens.Events.TWEEN_COMPLETE,e),this.tween.once(Phaser.Tweens.Events.TWEEN_COMPLETE,e),this.tween):null}}const oA={targets:[],props:{alpha:{duration:500,value:{start:0,from:0,to:1},ease:Phaser.Math.Easing.Cubic.Out},scale:{duration:1e3,value:{start:.8,from:.8,to:1},ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}}};class Dc extends Le{baseScales;constructor(e){super(oA,e)}}const cA={targets:[],duration:1e3,ease:Phaser.Math.Easing.Quadratic.InOut,props:{scale:.2}};class cn extends Le{spline;constructor(e){super(cA,e);const{curve:t}=this.config;t&&(this.spline=new Phaser.Curves.Spline(t),this.tween?.on(Phaser.Tweens.Events.TWEEN_START,this.createCounter))}createCounter=(e,t)=>{const{onCurveUpdate:s}=this.config,i=typeof s=="function"?s:null;t.forEach((n,r)=>{if(!this.scene)return;const{duration:c,delay:o}=e.data[r],l=new Phaser.Math.Vector2;this.scene.tweens.addCounter({delay:o,duration:c,ease:Phaser.Math.Easing.Quadratic.InOut,onUpdate:h=>{this.spline.getPoint(h.getValue(),l),n.x=l.x,n.y=l.y,i&&i(n)}})})}}const k={PRIMARY:{KEY:"LilitaOne-ru",TEXTURE:"./assets/fonts/LilitaOne-ru.png",DATA:"./assets/fonts/LilitaOne-ru.xml"},SYSTEM_FAMILY_FONT:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',FONT_FAMILY:"LilitaOne"},X={CONGRATULATION:"congratulation",DAILY_REWARD:"daily_reward",DIAMONDS_DROP:"diamonds_drop",DIAMONDS_EAT:"diamonds_eat",FIREWORKS_BIG:"fireworks_big",FIREWORKS_SOAR:"fireworks_soar",FIREWORKS_SMALL:"fireworks_small",GEM_DROP:"gem_drop",GAME_OVER_SCENE:"game_over_scene",MISSION_COMPLETED:"mission_completed",MISSION_REWARD:"mission_reward",MOVE_WRONG:"move_wrong",START_LEVEL:"start_level",POPUP_OFF:"popup_off",POPUP_SHOW:"popup_show",SCORE_COUNTER:"score_counter",START_GAME:"start_game",YOU_LOSE:"you_lose",YOU_WIN:"you_win",NEXT_ROUND_EFFECT:"next-round-effect",LOSE_SOUND:"lose-sound",THUNDER_SOUND:"thunder-sound",CLOSE_CLICK:"close-click",BUTTON_CLICK:"button-click",UNIT_DRAG_END:"drag-unit-end",UNIT_DRAG_START:"drag-unit-start",START_BATTLE:"start-battle",MELEE_ATTACK:"melee-attack",ARROW_SHOOT:"arrow-shoot",UNIT_DAMAGED:"unit-damaged",UNIT_MERGE:"unit-merge",WIN_BATTLE:"win-battle",TURN_SWITCH:"turn-switch",UNIT_UNLOCK:"unit-unlock",COIN_SPAWN_SOUND:"coin-spawn",COIN_INCREASE_REPEATEDLY_SOUND:"coin-increase-repeatedly",GIFT_CHARGE:"gift-charge",GIFT_EXPLODE:"gift-explode",GIFT_REVEAL:"gift-reveal"},{KEY:lA,FRAME:Sa}=L.EFFECTS;class Nc extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,lA,Sa.FX_STAR_YELLOW),this.createEmitZone(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:Sa.FX_COMET,emitZone:{source:this.emitZone,type:"random"},speed:20,timeScale:1,frequency:100,alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},scale:{start:e*2,end:e*.1,ease:Phaser.Math.Easing.Expo.Out},lifespan:2666})}run(e,t,s,i,n){this.stop(),this.reset(),this.emitZone.setSize(i,n),this.emitZone.setPosition(t-i/2,s-n/2),this.emitter.setQuantity(e),this.emitter.start()}explode(e,t,s){this.emitter||this.reset(),this.emitter.explode(e,t,s)}stop(){this.emitter?.killAll(),this.emitter?.stop()}reset(){this.createEmitters()}}const{KEY:hA,FRAME:ya}=L.EFFECTS;class Mc extends Phaser.GameObjects.Particles.ParticleEmitterManager{deathZone;emitter;constructor(e){super(e,hA,ya.FX_SPARK),this.createDeathZone(),this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createDeathZone(){this.deathZone=new Phaser.Geom.Circle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:ya.FX_SPARK,speed:{min:10,max:1200},scale:{start:e*1.33,end:0},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},deathZone:{source:this.deathZone,type:"onLeave"},lifespan:3e3})}explode(e,t,s,i){this.setActive(!0),this.setVisible(!0),this.deathZone.radius=i,this.deathZone.setPosition(t,s),this.emitter.explode(e,t,s)}stop(){this.emitter.forEachAlive(e=>{e.lifeCurrent=0},this)}}const{FX_MERGE:uA}=L.SPINE_EFFECTS,{KEY:ct,FRAME:lt}=L.GAMEPLAY;class dA extends Te{scene;textObjects;activeTextObjects;mergeEffect;curveAnimation;rewardUnitCurveAnimation;sample;starTail;fullTextTween;resultWinAnimation;resultLoseAnimation;sparkExplosive;constructor(e){super(e),this.scene=e,this.createMergeEffect(),this.createTextObjects(),this.createCurveAnimation(),this.createFullText(),this.createResultWinEffect(),this.createResultLoseEffect()}stop(){this.isRunning()&&(super.stop(),this.stopMergeEffect(),this.stopTextEffect(),this.resetFullFloatText())}playMergeEffect(e){const{x:t,y:s}=e.getWorldPosition();this.mergeEffect.setActive(!0),this.mergeEffect.setVisible(!0),this.mergeEffect.setPosition(t,s);const i=this.mergeEffect.getAnimationList();this.mergeEffect.play(i[0],!1,!1),this.scene.audio.playSound(X.UNIT_MERGE,{volume:.5})}createMergeEffect(){this.mergeEffect=this.scene.add.spine(0,0,uA.KEY,"animation"),this.mergeEffect.setName("MergeEffect"),this.mergeEffect.setDepth(W.EFFECT),this.mergeEffect.setScale(.5,.5),this.mergeEffect.setActive(!1),this.mergeEffect.setVisible(!1)}stopMergeEffect(){this.mergeEffect.setActive(!1),this.mergeEffect.setVisible(!1)}createTextObjects(){this.textObjects=this.scene.add.group({runChildUpdate:!1}),this.activeTextObjects=this.scene.add.group({runChildUpdate:!1})}getTextEffectObject(){const e=this.textObjects.getMatching("active",!1)[0];return e||this.createTextEffect()}createTextEffect(){const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(18),origin:{x:.5,y:.5}});return e.setDepth(W.DMG_POPUP_NUMBER),this.textObjects.add(e),e}hideAllTextEffects(){this.textObjects.getChildren().forEach(e=>{e instanceof Phaser.GameObjects.BitmapText&&e.active&&e.visible&&(this.activeTextObjects.add(e),e.kill())})}showAllTextEffects(){this.activeTextObjects.getChildren().forEach(e=>{e instanceof Phaser.GameObjects.BitmapText&&e.revive()}),this.activeTextObjects.clear()}stopTextEffect(){this.textObjects.getChildren().forEach(e=>{e instanceof Phaser.GameObjects.Text&&(e.kill(),e.setAlpha(1),this.scene.tweens.killTweensOf(e))})}createCurveAnimation(){this.sample=this.scene.make.image({key:ct,frame:lt.BLANK}),this.sample.setVisible(!1);const e=new Nc(this.scene);e.setDepth(W.EFFECT),this.starTail=e}runCurveAnimation(e,t,s,i){const n={x:e,y:t},r={x:s,y:i},c=100;this.curveAnimation=new cn({targets:[this.sample],delay:this.scene.tweens.stagger(80,{}),duration:1e3,curve:[[n.x,n.y],[n.x-Phaser.Math.RND.between(-c,c),n.y+Phaser.Math.RND.between(-140,-100)],[r.x,r.y]],onComplete:()=>{this.runSparksExplosive(s,i)},onCurveUpdate:o=>{const h=o.x+Phaser.Math.RND.between(-16,16),d=o.y+Phaser.Math.RND.between(-16,16);this.starTail.explode(1,h,d)}}),this.curveAnimation.play()}runCurveAnimationRewardUnit(e,t,s,i,n){const r={x:e,y:t},c={x:s.x,y:s.y},o=n||1,l=100;this.rewardUnitCurveAnimation=new cn({targets:[this.sample],delay:this.scene.tweens.stagger(80,{}),duration:1e3,curve:[[r.x,r.y],[r.x-Phaser.Math.RND.between(-l,l),r.y+Phaser.Math.RND.between(-140,-100)],[c.x,c.y]],onComplete:()=>{this.runSparksExplosive(c.x,c.y);const{unitManager:h}=this.scene;i==="MELEE"&&h.createPlayerMelee(s.rowId,s.colId,o),i==="RANGED"&&h.createPlayerArcher(s.rowId,s.colId,o),this.scene.updateUI()},onStop:()=>{const{unitManager:h}=this.scene;i==="MELEE"&&h.createPlayerMelee(s.rowId,s.colId,o),i==="RANGED"&&h.createPlayerArcher(s.rowId,s.colId,o),this.scene.updateUI()},onCurveUpdate:h=>{const u=h.x+Phaser.Math.RND.between(-16,16),p=h.y+Phaser.Math.RND.between(-16,16);this.isRewardCurveAnimationRunning()&&this.starTail.explode(1,u,p)}}),this.rewardUnitCurveAnimation.play()}runSparksExplosive=(e,t)=>{const s=this.scene;this.sparkExplosive=new Mc(s),this.sparkExplosive.setDepth(W.EFFECT),this.sparkExplosive.explode(100,e,t,50)};createFullText(){const e=this.scene.add.container(0,0);e.setDepth(W.EFFECT);const t=this.scene.make.image({key:ct,frame:lt.PURPLE_EFFECT});t.setOrigin(.5,.5),t.setWorldSize(263.5,79.5),e.add(t);const s=this.scene.make.text({text:this.scene.lang.Text.FULL,style:{fontSize:"25px",color:"#FFFFFF",fontFamily:k.FONT_FAMILY}});s.setHighQuality(),Phaser.Display.Align.In.Center(s,t,-3,-5),e.add(s),e.kill(),Phaser.Display.Align.In.Center(e,this.scene.gameZone,0,30),this.fullTextTween=new Dc({targets:[e],onStart:()=>{e.revive()},onComplete:()=>{this.scene.tweens.add({targets:[e],duration:300,delay:200,alpha:0})}})}playFullFloatText(){this.fullTextTween.play()}resetFullFloatText(){this.fullTextTween.stop()}createResultWinEffect(){const e=this.scene.add.container(0,0);e.setDepth(W.EFFECT);const t=this.scene.make.image({key:ct,frame:lt.EFFECT_WIN_GLOW});t.setWorldSize(276.5,58.5),e.add(t);const s=this.scene.make.text({text:this.scene.lang.Text.WIN,style:{fontSize:"25px",color:"#FFFFFF",fontFamily:k.FONT_FAMILY}});s.setHighQuality(),Phaser.Display.Align.In.Center(s,t),e.add(s);const i=this.scene.make.image({key:ct,frame:lt.EFFECT_WIN_SHAPE_ABOVE});i.setWorldSize(87.5,18.5),e.add(i),Phaser.Display.Align.In.TopCenter(i,t,0,5);const n=this.scene.make.image({key:ct,frame:lt.EFFECT_WIN_SHAPE_BELOW});n.setWorldSize(147,23.5),e.add(n),Phaser.Display.Align.In.BottomCenter(n,t,0,8),e.kill(),this.scene.world.isLandscape()?Phaser.Display.Align.In.Center(e,this.scene.gameZone,0,-20):Phaser.Display.Align.In.Center(e,this.scene.gameZone,0,-80),this.resultWinAnimation=this.scene.tweens.add({paused:!0,targets:[e],onActive:()=>{e.revive(),e.setAlpha(1),e.setScale(1),t.setAlpha(0),s.setAlpha(0),i.setAlpha(0),n.setAlpha(0),this.scene.add.tween({targets:[t,s],duration:400,alpha:{start:0,to:1},ease:Phaser.Math.Easing.Quadratic.In}),this.scene.add.tween({targets:[i,n],duration:300,alpha:{start:0,to:1}}),this.scene.add.tween({targets:[i],duration:300,delay:200,y:{start:-10,to:-25},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.add.tween({targets:[n],duration:300,delay:200,y:{start:10,to:25},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.add.tween({targets:[e],duration:600,delay:1e3,scale:{from:1,to:1.2},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.tweens.add({targets:[e],duration:300,delay:1300,alpha:0})}})}playResultWinAnimation(){this.resultWinAnimation.play()}createResultLoseEffect(){const e=this.scene.add.container(0,0);e.setDepth(W.EFFECT);const t=this.scene.make.image({key:ct,frame:lt.EFFECT_LOSE_GLOW});t.setWorldSize(253.5,55),e.add(t);const s=this.scene.make.text({text:this.scene.lang.Text.LOSE,style:{fontSize:"25px",color:"#FFFFFF",fontFamily:k.FONT_FAMILY}});s.setHighQuality(),Phaser.Display.Align.In.Center(s,t),e.add(s);const i=this.scene.make.image({key:ct,frame:lt.EFFECT_LOSE_SHAPE_ABOVE});i.setWorldSize(86,22.5),e.add(i),Phaser.Display.Align.In.TopCenter(i,t,0,5);const n=this.scene.make.image({key:ct,frame:lt.EFFECT_LOSE_SHAPE_BELOW});n.setWorldSize(126.5,25.5),e.add(n),Phaser.Display.Align.In.BottomCenter(n,t,0,8),e.kill(),this.scene.world.isLandscape()?Phaser.Display.Align.In.Center(e,this.scene.gameZone,0,-20):Phaser.Display.Align.In.Center(e,this.scene.gameZone,0,-80),this.resultLoseAnimation=this.scene.tweens.add({paused:!0,targets:[e],onActive:()=>{e.revive(),e.setAlpha(1),e.setScale(1),t.setAlpha(0),s.setAlpha(0),i.setAlpha(0),n.setAlpha(0),this.scene.add.tween({targets:[t,s],duration:400,alpha:{start:0,to:1},ease:Phaser.Math.Easing.Quadratic.In}),this.scene.add.tween({targets:[i,n],duration:300,alpha:{start:0,to:1}}),this.scene.add.tween({targets:[i],duration:300,delay:200,y:{start:-10,to:-25},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.add.tween({targets:[n],duration:300,delay:200,y:{start:10,to:25},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.add.tween({targets:[e],duration:600,delay:1e3,scale:{from:1,to:.8},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.tweens.add({targets:[e],duration:300,delay:1300,alpha:0})}})}playResultLoseAnimation(){this.resultLoseAnimation.play()}isRewardCurveAnimationRunning(){return!this.rewardUnitCurveAnimation||!this.rewardUnitCurveAnimation.tween?!1:this.rewardUnitCurveAnimation&&this.rewardUnitCurveAnimation.tween.isPlaying()}stopRewardCurveAnimation(){this.isRewardCurveAnimationRunning()&&(this.rewardUnitCurveAnimation.stop(),this.starTail?.stop(),this.sparkExplosive?.stop())}}class Ta extends Phaser.GameObjects.Container{placementArea;areaRect;scene;rowId;colId;isTaken;constructor(e,t,s,i){super(e,t,s),this.scene=e,this.createAreaRect(i),this.createPlacementArea(i),this.addEventListener(),this.scene.add.existing(this),this.setDepth(W.FIELD_SQUARE)}createPlacementArea(e){this.placementArea=this.scene.add.zone(0,0,e,e),this.add(this.placementArea)}createAreaRect(e){this.areaRect=this.scene.add.rectangle(0,0,e,e,16368767,1),this.add(this.areaRect),this.areaRect.setDepth(W.FIELD_SQUARE_RECT)}updateAreaRect(e){this.areaRect.setFillStyle(e)}setSquarePosition(e,t){this.rowId=e,this.colId=t,this.isTaken=!1}setTaken(e){this.isTaken=e}addEventListener(){this.placementArea.setInteractive({useHandCursor:!0}),this.placementArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{console.log(this.rowId,this.colId)})}}const Li=[{KEY_PORTRAIT:M.BG_TREE.KEY,KEY_LANDSCAPE:M.BG_LANDSCAPE_TREE.KEY,BG_EXTENSION_COLOR:8102725,SQUARE_COLOR:11452994,SQUARE_HIGHT_LIGHT_COLOR:9692964,SQUARE_HIGHT_LIGHT_BORDER_COLOR:14089889},{KEY_PORTRAIT:M.BG_DESERT.KEY,KEY_LANDSCAPE:M.BG_LANDSCAPE_DESERT.KEY,BG_EXTENSION_COLOR:16761714,SQUARE_COLOR:16368767,SQUARE_HIGHT_LIGHT_COLOR:16766227,SQUARE_HIGHT_LIGHT_BORDER_COLOR:16773290},{KEY_PORTRAIT:M.BG_ICE.KEY,KEY_LANDSCAPE:M.BG_LANDSCAPE_ICE.KEY,BG_EXTENSION_COLOR:15330021,SQUARE_COLOR:13952244,SQUARE_HIGHT_LIGHT_COLOR:6402815,SQUARE_HIGHT_LIGHT_BORDER_COLOR:16777215},{KEY_PORTRAIT:M.BG_CRYSTAL.KEY,KEY_LANDSCAPE:M.BG_LANDSCAPE_CRYSTAL.KEY,BG_EXTENSION_COLOR:3224690,SQUARE_COLOR:5792413,SQUARE_HIGHT_LIGHT_COLOR:6195962,SQUARE_HIGHT_LIGHT_BORDER_COLOR:11848191},{KEY_PORTRAIT:M.BG_VOLCANO.KEY,KEY_LANDSCAPE:M.BG_LANDSCAPE_VOLCANO.KEY,BG_EXTENSION_COLOR:13383207,SQUARE_COLOR:7886462,SQUARE_HIGHT_LIGHT_COLOR:12016072,SQUARE_HIGHT_LIGHT_BORDER_COLOR:15310583}],{STATUS:pA}=mt,{LEVEL_PROGRESS:Ia}=ye,qe={x:30.5,y:158},Gt={x:30.5,y:-246},gA=50;class fA extends Te{scene;fieldBackground;playerPlacementSquares;enemyPlacementSquares;firstHightLineZone;secondHightLineZone;fieldBackgroundExtension;constructor(e){super(e),this.scene=e,this.enemyPlacementSquares=[],this.playerPlacementSquares=[],this.scene.world.isUsingLandscapeBackground()&&(qe.x=323,qe.y=55,Gt.x=323,Gt.y=-77),this.createBattlefield(),this.createHightLineZone()}init(){super.init(),this.updateField(),this.resetPlacementSquareStatus()}start(){this.isRunning()||(this.showPlacementSquares(),this.setState(pA.RUNNING))}updateField(){const e=this.getCurrentLevel(),t=this.getBgData(e);if(this.scene.world.isUsingLandscapeBackground()){this.updateBackgroundElement(t);return}this.updateFieldBackground(t),this.updatePlacementSquares(t),this.updateHightLightSquares(t)}getCurrentLevel(){const{currentLevelData:e=null}=this.scene.levelManager;let t=e?e.level_id:1;if(!e){const s=this.scene.player.getCustomData(Ia);s&&(t=s>0?s+1:1)}return t}getBgData(e){const t=Math.floor(e/10)%Object.keys(Li).length,s=Li[t],n=this.scene.world.isUsingLandscapeBackground()?s.KEY_LANDSCAPE:s.KEY_PORTRAIT;return this.scene.textures.exists(n)?s:Li[0]}updateFieldBackground(e){const s=this.scene.world.isUsingLandscapeBackground()?e.KEY_LANDSCAPE:e.KEY_PORTRAIT;this.fieldBackground.setTexture(s),this.fieldBackgroundExtension.setFillStyle(e.BG_EXTENSION_COLOR)}updatePlacementSquares(e){this.playerPlacementSquares.forEach(t=>{t.updateAreaRect(e.SQUARE_COLOR)}),this.enemyPlacementSquares.forEach(t=>{t.updateAreaRect(e.SQUARE_COLOR)})}updateHightLightSquares(e){this.firstHightLineZone.setFillStyle(e.SQUARE_HIGHT_LIGHT_COLOR),this.firstHightLineZone.setStrokeStyle(2,e.SQUARE_HIGHT_LIGHT_BORDER_COLOR),this.secondHightLineZone.setFillStyle(e.SQUARE_HIGHT_LIGHT_COLOR),this.secondHightLineZone.setStrokeStyle(2,e.SQUARE_HIGHT_LIGHT_BORDER_COLOR)}createHightLineZone(){const{displayWidth:e,scale:t}=this.fieldBackground,s=t*this.scene.world.getPixelRatio(),i={x:qe.x*s,y:qe.y*s},n=e-i.x*2;this.firstHightLineZone=this.scene.add.rectangle(0,0,n/5,n/5,16777215,1),this.firstHightLineZone.setStrokeStyle(2,16776960),this.firstHightLineZone.setDepth(W.FIELD_SQUARE_RECT),this.firstHightLineZone.kill(),this.secondHightLineZone=this.scene.add.rectangle(0,0,n/5,n/5,16777215,1),this.secondHightLineZone.setStrokeStyle(2,16776960),this.secondHightLineZone.setDepth(W.FIELD_SQUARE),this.secondHightLineZone.kill()}createBattlefield(){const e=this.getCurrentLevel(),t=this.getBgData(e);this.createFieldBackground(t),this.createPlacementSquares(t)}createFieldBackground(e){const s=this.scene.world.isUsingLandscapeBackground()?e.KEY_LANDSCAPE:e.KEY_PORTRAIT;this.createBackground(s),this.handleBackgroundTopOffset(),this.createBackgroundExtension(e.BG_EXTENSION_COLOR)}createBackground(e){const{displayWidth:t}=this.scene.gameZone;this.fieldBackground=this.scene.make.image({key:e}),this.fieldBackground.setOrigin(0,1),this.fieldBackground.setScale(t/this.fieldBackground.width),this.fieldBackground.setDepth(W.FIELD_BACKGROUND)}handleBackgroundTopOffset(){const{displayHeight:e}=this.scene.gameZone,t=qe.y-(this.fieldBackground.displayHeight-e);let s=gA-t;if(s<0&&(s=0),this.scene.world.isUsingLandscapeBackground()){this.fieldBackground.setOrigin(.275,0),this.fieldBackground.setWorldSize(1920/2,1080/2);return}this.fieldBackground.setPosition(0,e+s)}createBackgroundExtension(e){const{displayWidth:t,displayHeight:s}=this.scene.gameZone,i=this.fieldBackground.getBottomLeft();this.fieldBackgroundExtension=this.scene.add.rectangle(i.x,i.y,t,s,e),this.fieldBackgroundExtension.setOrigin(0,0)}createPlacementSquares(e){this.createPlayerPlacementSquares(e.SQUARE_COLOR),this.createEnemyPlacementSquares(e.SQUARE_COLOR)}createEnemyPlacementSquares(e){const{displayWidth:t,scaleX:s,scaleY:i}=this.fieldBackground,n=s*this.scene.world.getPixelRatio(),r=i*this.scene.world.getPixelRatio(),c={x:qe.x*n,y:qe.y*n},o={x:qe.x*r,y:qe.y*r},{x:l,y:h}=c,{x:d,y:u}=o,p=t-l*2,g=t-d*2,f=p<g?p:g,m={x:p<g?c.x:o.x,y:Math.abs(h)<Math.abs(u)?h:u},E=this.fieldBackground.getTopLeft();E.x+=m.x,E.y+=m.y;let A=1;for(let S=0;S<3;S++)for(let I=0;I<5;I++){const T=new Ta(this.scene,E.x+I*f/5+f/10,E.y+S*f/5+f/10,f/5);T.updateAreaRect(e),T.setSquarePosition(S+1,I+1),T.setAlpha(A),A=A===1?0:1,this.enemyPlacementSquares.push(T)}}createPlayerPlacementSquares(e){const{displayWidth:t,scaleX:s,scaleY:i}=this.fieldBackground,n=s*this.scene.world.getPixelRatio(),r=i*this.scene.world.getPixelRatio(),c={x:Gt.x*n,y:Gt.y*n},o={x:Gt.x*r,y:Gt.y*r},{x:l,y:h}=c,{x:d,y:u}=o,p=t-l*2,g=t-d*2,f=p<g?p:g,m={x:p<g?c.x:o.x,y:Math.abs(h)<Math.abs(u)?h:u},E=this.fieldBackground.getBottomLeft();E.x+=m.x,E.y+=m.y;let A=1;for(let S=0;S<3;S++)for(let I=0;I<5;I++){const T=new Ta(this.scene,E.x+I*f/5+f/10,E.y-S*f/5-f/10,f/5);T.updateAreaRect(e),T.setSquarePosition(3-S,I+1),T.setAlpha(A),A=A===1?0:1,this.playerPlacementSquares.push(T)}}hidePlacementSquares(){this.playerPlacementSquares.forEach(e=>e.kill()),this.enemyPlacementSquares.forEach(e=>e.kill())}showPlacementSquares(){this.playerPlacementSquares.forEach(e=>e.revive()),this.enemyPlacementSquares.forEach(e=>e.revive())}getPlayerPlacementSquare(e,t){return this.playerPlacementSquares.filter(i=>i.rowId===e&&i.colId===t)[0]}getEnemyPlacementSquare(e,t){return this.enemyPlacementSquares.filter(i=>i.rowId===e&&i.colId===t)[0]}getSquareBasedOnPosition(e,t){for(let s=0;s<this.playerPlacementSquares.length;s++){const i=this.playerPlacementSquares[s];if(i.placementArea.getBounds().contains(e,t))return i}return null}getSquareBasedOnIndex(e,t){for(let s=0;s<this.playerPlacementSquares.length;s++){const i=this.playerPlacementSquares[s];if(i.rowId===e&&i.colId===t)return i}return null}tryGettingAvailablePlacement(e,t){const s=this.getSquareBasedOnIndex(e,t);return s&&!s.isTaken?s:null}getAvailablePlacement(){let e=null;for(let t=0;t<this.playerPlacementSquares.length;t++){const s=this.playerPlacementSquares[t];if(!s.isTaken)return e=s,e}return e}resetPlacementSquareStatus(){this.playerPlacementSquares.forEach(e=>e.isTaken=!1)}getRemainingAvailablePlacement(){return this.playerPlacementSquares.filter(t=>!t.isTaken).length}updateBackgroundElement(e){if(!this.scene.world.isUsingLandscapeBackground())return;const s=document.getElementById("background-image");if(!s)return;const i=this.scene.player.getCustomData(Ia);if(typeof i!="number"||i<0){s.src=M.BG_LANDSCAPE_TREE.FILE;return}let n=M.BG_LANDSCAPE_TREE.FILE;switch(Math.floor((i+1)/10)%5){case 0:n=M.BG_LANDSCAPE_TREE.FILE;break;case 1:n=M.BG_LANDSCAPE_DESERT.FILE;break;case 2:n=M.BG_LANDSCAPE_ICE.FILE;break;case 3:n=M.BG_LANDSCAPE_CRYSTAL.FILE;break;case 4:n=M.BG_LANDSCAPE_VOLCANO.FILE;break}s.onload=()=>{this.updateFieldBackground(e),this.updatePlacementSquares(e),this.updateHightLightSquares(e),s.onload=()=>{}},s.src=n}}const{STATUS:EA}=mt,{MELEE_UNIT_TYPE:yt,RANGED_UNIT_TYPE:Tt}=F,{LEVEL_PROGRESS:Ls}=ye;class mA extends Te{scene;playerLevel;currentLevelId;currentLevelData;enemyData;playerData;constructor(e){super(e),this.scene=e}init(){const{gameMode:e}=this.scene;this.enemyData=[],e===J.NORMAL&&(this.updatePlayerLevel(),this.loadLevel()),e===J.BATTLE&&(this.createBattleOpponentData(),this.setBattleOpponentLevel())}start(){this.isRunning()||this.setState(EA.RUNNING)}setCurrentLevelId(e){this.currentLevelId=e}updatePlayerLevel(){const e=this.scene.player.getCustomData(Ls),t=e&&GameCore.Utils.Valid.isNumber(e)&&e>0;this.playerLevel=t?e:0}loadLevel(){try{if(this.scene.game.cache.json.exists("level-builder-json")){this.loadLevelBuilderLevel();return}this.setCurrentLevelId(this.playerLevel?this.playerLevel+1:1),console.log("🤖 ? this.playerLevel",this.playerLevel);const e=this.playerLevel?this.playerLevel:0,t=Math.floor(e/100)*100+1,s=t+99,i=(1e4+t).toString().substring(1),n=(1e4+s).toString().substring(1),r=this.scene.cache.json.get(`levels-${i}-${n}`),c=this.currentLevelId-t;c>=r.levels.length&&this.setCurrentLevelId(r.levels.length-1),this.currentLevelData=r.levels[c],console.log(this.currentLevelData),this.createEnemyData()}catch(e){console.warn(e)}}createEnemyData(){this.currentLevelData.enemy_row1.split("-").forEach((e,t)=>{if(e!=="0"){const s=e.charAt(0)==="m"?yt:Tt,i=parseInt(e.substring(1)),n=1,r=t+1;this.enemyData.push({type:s,level:i,positionRow:n,positionColumn:r})}}),this.currentLevelData.enemy_row2.split("-").forEach((e,t)=>{if(e!=="0"){const s=e.charAt(0)==="m"?yt:Tt,i=parseInt(e.substring(1)),n=2,r=t+1;this.enemyData.push({type:s,level:i,positionRow:n,positionColumn:r})}}),this.currentLevelData.enemy_row3.split("-").forEach((e,t)=>{if(e!=="0"){const s=e.charAt(0)==="m"?yt:Tt,i=parseInt(e.substring(1)),n=3,r=t+1;this.enemyData.push({type:s,level:i,positionRow:n,positionColumn:r})}})}createBattleOpponentData(){const e=this.scene.game.battle.getOpponentInfo();if(console.log(e),!e)return;const{unitData:t}=e;this.enemyData=[],t.split("/").reverse().forEach((i,n)=>{i.split("-").forEach((r,c)=>{if(r!=="0"){const o=r.charAt(0)==="m"?yt:Tt,l=parseInt(r.substring(1)),h=n+1,d=c+1;this.enemyData.push({type:o,level:l,positionRow:h,positionColumn:d})}})})}setBattleOpponentLevel(){const e=this.scene.game.battle.getOpponentInfo();if(!e){this.currentLevelId=1;return}const{playerLevel:t}=e;this.currentLevelId=t}loadLevelBuilderLevel(){const e=this.scene.cache.json.get("level-builder-json");this.currentLevelId=e.level_id;try{this.currentLevelData=e}catch(t){console.log(t)}this.createData()}createData(){this.createEnemyData(),this.createPlayerData()}createPlayerData(){this.playerData=[];const e=this.currentLevelData;if(!e)return;const t=new q(e.coins.baseValue,e.coins.suffix,!0);this.scene.coin.receiveCoins(t.baseValue,t.suffix),e.player_row1.split("-").forEach((s,i)=>{if(s!=="0"){const n=s.charAt(0)==="m"?yt:Tt,r=parseInt(s.substring(1)),c=1,o=i+1;this.playerData.push({type:n,level:r,positionRow:c,positionColumn:o})}}),e.player_row2.split("-").forEach((s,i)=>{if(s!=="0"){const n=s.charAt(0)==="m"?yt:Tt,r=parseInt(s.substring(1)),c=2,o=i+1;this.playerData.push({type:n,level:r,positionRow:c,positionColumn:o})}}),e.player_row3.split("-").forEach((s,i)=>{if(s!=="0"){const n=s.charAt(0)==="m"?yt:Tt,r=parseInt(s.substring(1)),c=3,o=i+1;this.playerData.push({type:n,level:r,positionRow:c,positionColumn:o})}})}isInLevelBuilderLevel(){return this.scene.gameMode!==J.NORMAL?!1:GameCore.Utils.Object.hasOwn(this.currentLevelData,"player_row1")}updateHighestCurrentLevel(){this.isInLevelBuilderLevel()||this.playerLevel<this.currentLevelId&&this.scene.player.setCustomData(Ls,this.currentLevelId)}getCurrentLevelId(){return this.currentLevelId}getModifierLevel(){const{gameMode:e}=this.scene;if(e===J.NORMAL)return this.currentLevelId;if(e===J.BATTLE){const t=this.scene.player.getCustomData(Ls);return GameCore.Utils.Valid.isNumber(t)?Math.min(this.currentLevelId,t+1):1}throw new Error("Case not implemented.")}getPlayerLevel(){if(this.isInLevelBuilderLevel())return this.currentLevelId;const e=this.scene.player.getCustomData(Ls);return GameCore.Utils.Valid.isNumber(e)?e+1:1}loadAllLevels(){this.scene.cache.json.get("levels").levels.forEach((t,s)=>{this.currentLevelData=t,console.log(s),this.createEnemyData()})}}const Js={FREE_COINS:{ID:"free-coins"},SPEED_UP:{ID:"speed-up"}},{STATUS:Ca}=mt,{enable:AA}=GameCore.Configs.Gameplay.Powers.FreeCoins,{enable:SA}=GameCore.Configs.Gameplay.Powers.SpeedUp;class yA extends Te{scene;items={};readyStateItems={};playingStateItems={};itemActive;isSpeedUp;constructor(e){super(e),this.scene=e,this.isSpeedUp=!1,this.createItems()}init(){this.setState(Ca.READY),this.deactivateItems();const{objects:e}=this.scene.layoutManager;e.freeCoinsItem.startCountdown()}stop(){this.isRunning()&&(this.deactivateItems(),this.setState(Ca.STOPPED))}activeItem=e=>{this.isRunning()&&this.items[e]&&(this.deactivateItems(),this.itemActive=e,this.items[e].activeItem())};deactivateItem=e=>{this.items[e]&&(this.itemActive="",this.items[e].deactivateItem())};deactivateItems(){for(const e in this.items)this.deactivateItem(e)}createItems(){this.createFreeCoinsButton(),this.createSpeedUpButton()}createFreeCoinsButton(){if(!AA)return;const{objects:e}=this.scene.layoutManager;this.items[Js.FREE_COINS.ID]=e.freeCoinsItem}createSpeedUpButton(){if(!SA)return;const{objects:e}=this.scene.layoutManager;this.items[Js.SPEED_UP.ID]=e.speedUpItem}getAllItems(){return Object.values(this.items)}getItemsForReadyState(){return Object.values(this.readyStateItems)}getItemsForPlayingState(){return Object.values(this.playingStateItems)}isGameSpeedUp(){return this.isSpeedUp||!1}forceReturnToNormalSpeed(){this.scene.unitManager.resetSpeedAllUnits()}checkForSpeedSetting(){const{objects:e}=this.scene.layoutManager,t=!!this.scene.player.getPlayerSetting("speedUp");e.speedUpItem.visible&&(t?this.scene.unitManager.speedUpAllUnits():this.scene.unitManager.resetSpeedAllUnits())}syncSpeedSetting(){const{objects:e}=this.scene.layoutManager,t=!!this.scene.player.getPlayerSetting("speedUp");e.speedUpItem.visible&&(t?e.speedUpItem.speedUpGameplay():e.speedUpItem.returnToNormalSpeed())}}const{UNIT_SIZE_SCALE:Ra}=F;class TA extends Te{scene;isDirtyDepth;spineUnits=[];spineContainer;constructor(e){super(e),this.scene=e,this.isDirtyDepth=!1,this.spineUnits=[],this.spineContainer=this.scene.add.spineContainer(0,0),this.spineContainer.setDepth(W.MANAGER_BASE_DEPTH)}init(){super.init(),this.spineUnits=[],this.spineContainer.removeAll()}update(e){this.isRunning()&&(this.spineUnits.forEach(t=>{const s=t.getSpineDisplay();if(!s)return;s.depth!==t.depth&&(s.setDepth(t.depth),this.isDirtyDepth=!0);const{x:i,y:n}=t.getWorldPosition();s.setPosition(i,n+25)}),e&&this.isDirtyDepth&&this.sortSpineContainerByDepth())}sortSpineContainerByDepth(){this.spineContainer.sort("depth",(e,t)=>e.depth-t.depth)}sortSpineContainerByName(){this.spineContainer.sort("name",(e,t)=>e.name.localeCompare(t.name))}sortSpineContainerByLevel(){this.spineContainer.sort("level",(e,t)=>e.level-t.level)}addSpines(e){this.isRunning()&&e.forEach(t=>{if(this.spineUnits.some(i=>i===t))return;const s=t.getSpineDisplay();s&&(s instanceof Phaser.GameObjects.Sprite||(s.level=t.level,t.display.setSpineScale(Ra*.5,Ra*.5),this.spineUnits.push(t),this.spineContainer.add(s)))})}removeSpine(e){const t=e.getSpineDisplay();t&&(this.spineUnits=this.spineUnits.filter(s=>s!==e),this.spineContainer.remove(t,!1))}bringToTopOnDrag(e){const t=e.getSpineDisplay();t&&this.spineContainer.bringToTop(t)}hideAllSpines(){this.spineContainer.setActive(!1),this.spineContainer.setVisible(!1)}showAllSpines(){this.spineContainer.setActive(!0),this.spineContainer.setVisible(!0)}}class ss{scene;constructor(e){this.scene=e}}const{LEVEL_PROGRESS:kc,SELECTED_LEVEL:_a}=ye,IA=()=>async(a,e)=>{const{player:t,rollbar:s,analytics:i,globalScene:n}=window.game;try{const r=e(),c=Cs(r),o=vn(r),l=t.getPlayer(),{entryPointData:h}=c,{type:d}=h||{};l.isUserNew&&i.event(G.NEW_USER);const u=t.getCustomData(_a),p=t.getCustomData(kc),g=typeof p=="number"&&p>=0;if(!u){let f=1;g&&(f=p+1),t.setCustomData(_a,f)}o===$t&&(n.screen.open(P.NOTIFY_SCREEN,{message:n.lang.Text.LOADING,loading:!0}),g&&p>=2?d===si?await a(await Uc()):d===ko&&await a(await CA()):(await a(await rf(!0)),console.info("🚀 > setRequestDetectGameMode",!0)))}catch(r){s.sendException(r)}finally{n.screen.close(P.NOTIFY_SCREEN),n.events.emit(Ks.SWITCH,K.GAME_SCENE)}},Uc=()=>async(a,e)=>{try{const t=e(),s=Cs(t),{player:i,battle:n}=window.game,r=i.getPlayer(),{entryPointData:c}=s,{matchId:o,opponentId:l,playerId:h}=c||{},d=i.getCustomData(kc);if(typeof d!="number"||d<2||!([l,h].indexOf(r.playerId)>=0))return;r.playerId===h?await n.continueBattle(o,l):await n.continueBattle(o,h)}catch(t){console.error(t)}},CA=()=>async(a,e)=>{try{const t=e(),s=Cs(t),{player:i,battle:n}=window.game,r=i.getPlayer(),{entryPointData:c}=s,{playerId:o}=c||{};if(r.playerId===o||!o)return;await n.createBattle(o,!1)}catch(t){console.error(t)}};class Rs extends ss{constructor(e){super(e),this.scene.stopManager(),this.scene.audio.setMusicVolume(0,3e3)}ready(){}play(){}levelComplete(){}levelFail(){}levelLoading(){const e=new Qt(this.scene);this.scene.stateManager.changeStateTo(e)}quit(){}update(){}}const va="offlineRewardLastCheck",Ln=a=>a[Rc],RA=a=>Ln(a).checked,_A=a=>Ln(a).valueReceived,vA=a=>Ln(a).hasShowReward,wA=j([RA],a=>a),LA=j([_A],a=>a),bA=j([vA],a=>a),{Enable:xc,MinimumTimeToActive:PA}=GameCore.Configs.OfflineReward,{LEVEL_PROGRESS:OA}=ye,DA=()=>(a,e)=>{if(!xc)return;const t=e();if(wA(t))return;a({type:_c,payload:{}});const{player:i}=window.game,n=Date.now(),r=i.getCustomData(va);if(i.setCustomData(va,n),!r)return;const c=i.getCustomData(OA);let o=0;if(c&&typeof c=="number"&&(o=c),o<3)return;const l=n-r;if(l<PA)return;const h=Math.floor(l/6e4);//! DEBUG 1HR offline coin
a(NA(h))},NA=a=>({type:vc,payload:{value:a}}),MA=()=>a=>{xc&&a({type:wc,payload:{}})},{DelayFinishGame:bi}=GameCore.Configs.Gameplay;class Bc extends ss{constructor(e){super(e);const{gameMode:t,levelManager:s,tutorialManager:i,powerManager:n}=this.scene;n.forceReturnToNormalSpeed(),t===J.BATTLE&&this.scene.game.battle.finishBattle("lose"),this.scene.audio.playSound(X.LOSE_SOUND);const r=s.getCurrentLevelId();this.scene.analytics.levelFail(r),this.scene.effectManger.playResultLoseAnimation(),i.isRunning()?this.handleTutorialCase():this.openResultScreen()}openResultScreen(){const{screenManager:e,gameMode:t}=this.scene,s=this.scene.coinManager.getTotalCoinsByAttack();this.scene.time.delayedCall(bi,async()=>{this.scene.stopManager();const{audio:i,globalScene:n,lang:r}=this.scene.game;if(this.scene.game.ads.canbeShowInterstitialAd()){let c=null;try{i.muteAll(),this.scene.scene.pause(),c=this.scene.game.globalScene.time.delayedCall(200,()=>{n.screen.open(P.NOTIFY_SCREEN,{message:r.Text.LOADING_ADS,duration:0,loading:!0})}),i.muteAll(),await this.scene.game.ads.showInterstitialAdAsync()}catch(o){console.info("🚀 > showInterstitialAdAsync",o)}finally{i.unmuteAll(),this.scene.game.ads.preloadInterstitialAdAsync().catch(()=>{}),c?.remove(),n.screen.close(P.NOTIFY_SCREEN)}}e.showResultScreen("lose",t,s)})}handleTutorialCase(){const{levelManager:e,screenManager:t,coinManager:s,gameMode:i}=this.scene,n=e.getCurrentLevelId(),r=s.getTotalCoinsByAttack(),c=n===1?bi*1.5:bi;this.scene.time.delayedCall(c,async()=>{if(this.scene.stopManager(),n===1){this.scene.coin.plusCoins(r.baseValue,r.suffix),this.scene.prepareRound();return}t.showResultScreen("lose",i,r)})}ready(){const e=new oi(this.scene);this.scene.stateManager.changeStateTo(e)}play(){}levelFail(){}levelComplete(){}levelLoading(){const e=new Qt(this.scene);this.scene.stateManager.changeStateTo(e)}quit(){const e=new Rs(this.scene);this.scene.stateManager.changeStateTo(e)}update(){}}class Fc extends ss{isLevelOver;constructor(e){super(e),this.isLevelOver=!1;const{fieldManager:t,unitManager:s,uiManager:i,spineManager:n,effectManger:r,powerManager:c}=this.scene;this.scene.accessibilityManager.stop(),t.hidePlacementSquares(),n.sortSpineContainerByName(),r.stopRewardCurveAnimation(),s.savePlayerUnits(),s.setReadyAllUnits(),s.runChildUpdateGroups(!0),s.disableDragOnPlayerUnits(),i.showUIForPlayingState(),c.checkForSpeedSetting(),this.scene.audio.setMusicVolume(.04,1e3)}ready(){const e=new oi(this.scene);this.scene.stateManager.changeStateTo(e)}play(){}levelFail(){const e=new Bc(this.scene);this.scene.stateManager.changeStateTo(e)}levelComplete(){const e=new bn(this.scene);this.scene.stateManager.changeStateTo(e)}levelLoading(){}quit(){const e=new Rs(this.scene);this.scene.stateManager.changeStateTo(e)}update(){if(this.isLevelOver)return;const{uiManager:e,spineManager:t}=this.scene,s=e.getCurrentEnemyHp()<=0,i=e.getCurrentPlayerHp()<=0;if(s){this.scene.gameOver("win"),this.isLevelOver=!0;return}if(i&&!s){this.scene.gameOver("lose"),this.isLevelOver=!0;return}t.update(!1)}}class kA extends ss{constructor(e){super(e);const{uiManager:t,unitManager:s,coinManager:i,spineManager:n,levelManager:r,screenManager:c,tutorialManager:o,difficultyManager:l,powerManager:h}=this.scene;this.scene.initManager(),this.scene.startManager();const d=s.getPlayerUnits(),u=s.getEnemyUnits();n.addSpines([...u,...d]),s.enableDragOnPlayerUnits(),s.runChildUpdateGroups(!0);const p=r.getCurrentLevelId(),g=r.getModifierLevel(),f=r.getPlayerLevel();console.log("🤖 ? currentLevelId",p),console.log("🤖 ? modifierLevel",g),console.log("🤖 ? playerLevel",f),i.setUnitModifier(f),i.setAttackModifier(g),l.updateCustomUnitModifierByLevel(f),l.updateCustomAttackModifierByLevel(g),this.scene.storage.dispatch(DA()),c.closeLoadingScreen(),this.scene.gameMode===J.BATTLE?(s.hideAllUnits(),this.scene.time.delayedCall(450,()=>{c.showChallengeSplashScreen(),t.showUIForReadyState(),this.scene.updateUI()})):(this.scene.audio.setMusicVolume(.4,3e3),t.showUIForReadyState(),this.scene.updateUI()),o.showTutorial(),h.syncSpeedSetting(),this.scene.audio.playMusic(),this.logLevelStart()}logLevelStart(){const{battle:e,storage:t,levelManager:s}=this.scene,i=this.scene.gameMode===J.BATTLE,n=this.scene.isContextChallenge(),r=s.getCurrentLevelId();if(i&&n){const c=e.getOpponentInfo(),o=t.getState(),{entryPointData:l}=Cs(o),{playerId:h,opponentId:d=Zs.playerId}=l||{},u=[d,h].indexOf(c?.playerId)>-1;if(console.info("🚀 > isOwnerContext",u),u){this.scene.analytics.levelStart(r);return}}this.scene.analytics.levelStart(r)}ready(){}play(){const e=new Fc(this.scene);this.scene.stateManager.changeStateTo(e)}levelFail(){}levelComplete(){}levelLoading(){if(!this.scene.levelManager.isInLevelBuilderLevel())return;const e=new Qt(this.scene);this.scene.stateManager.changeStateTo(e)}quit(){const e=new Rs(this.scene);this.scene.stateManager.changeStateTo(e)}update(){this.scene.spineManager.update(!0)}}const oi=kA,{LEVEL_PROGRESS:UA,PLAYER_UNIT_DATA:wa}=ye;class xA extends ss{isRequesting=!1;constructor(e){super(e),this.run()}async run(){const{uiManager:e,screenManager:t,layoutManager:s}=this.scene;this.scene.initGameMode(),s.layout.alignUI(),e.showUIForLevelLoadingState(),this.autoUpgradeUnitData();const i=this.getCurrentLevel();if(console.info("🚀 > currentLevel",i),i>1){const n=this.scene.gameMode===J.BATTLE,r=await this.scene.isChallengeMode();if(!n&&r&&(await this.scene.storage.dispatch(await Uc()),this.scene.initGameMode(),this.scene.gameMode===J.BATTLE)){this.scene.quit(),this.scene.restartScene();return}}if(this.loadLevelsJson(),this.scene.gameMode===J.BATTLE){const n=this.scene.game.globalScene;n.screen.close(P.LEADER_BOARD_SCREEN),n.screen.close(P.BATTLE_SCREEN),this.loadOpponentUnits()}if(this.isRequesting){t.showLoadingScreen();const n=this.scene.scene.get(K.LOAD_SCENE);n.scene.wake(),n.load.once(Phaser.Loader.Events.COMPLETE,this.handleLoadComplete),n.load.start()}else this.scene.time.delayedCall(0,this.handleLoadComplete)}autoUpgradeUnitData(){const e=this.scene.player.getCustomData(wa);if(!e||typeof e!="string")return;const s=this.scene.scene.get(K.LOAD_SCENE).upgradePlayerUnits(e);s!==e&&this.scene.player.setCustomData(wa,s)}handleLoadComplete=()=>{this.scene.prepareRound();const e=this.scene.scene.get(K.LOAD_SCENE);e.scene.sleep(),e.lazyLoadResource()};loadOpponentUnits(){const e=this.scene.game.battle.getOpponentInfo();if(!e)return;const{unitData:t}=e;console.info("🚀 > OpponentUnitData",t);const s=this.scene.scene.get(K.LOAD_SCENE);this.isRequesting=!0,s.loadUnits("spine",t)}getCurrentLevel(){const e=this.scene.player.getCustomData(UA),t=GameCore.Utils.Valid.isNumber(e)?e:1;return t>0?t:0}loadLevelsJson(){const e=this.getCurrentLevel();this.loadLevelJsonByLevel(e),this.reloadNextLevelJson(e)}reloadNextLevelJson(e){const t=e+1;t%100===0&&this.loadLevelJsonByLevel(t,!1)}loadLevelJsonByLevel(e,t=!0){const s=this.getJsonKey(e);if(this.scene.cache.json.exists(s))return;t&&(this.isRequesting=!0),this.scene.scene.get(K.LOAD_SCENE).load.json(s,`assets/json/${s}.json`)}getJsonKey(e){const t=Math.floor(e/100)*100+1,s=t+99,i=(1e4+t).toString().substring(1),n=(1e4+s).toString().substring(1);return`levels-${i}-${n}`}ready(){const e=new oi(this.scene);this.scene.stateManager.changeStateTo(e)}play(){}levelFail(){}levelComplete(){}levelLoading(){}quit(){const e=new Rs(this.scene);this.scene.stateManager.changeStateTo(e)}update(){}}const Qt=xA,{DelayFinishGame:La}=GameCore.Configs.Gameplay;class BA extends ss{constructor(e){super(e);const{gameMode:t,levelManager:s,tutorialManager:i,powerManager:n}=this.scene;n.forceReturnToNormalSpeed();const r=s.getCurrentLevelId(),c=r>=1598;t===J.NORMAL&&!c&&s.updateHighestCurrentLevel(),t===J.BATTLE&&this.scene.game.battle.finishBattle("win"),c||(this.scene.audio.playSound(X.WIN_BATTLE),this.scene.effectManger.playResultWinAnimation()),this.scene.analytics.levelComplete(r),this.scene.analytics.gameMilestone("reach_milestone",{milestone:r},0,0),i.isRunning()?this.handleTutorialCase():this.openResultScreen()}openResultScreen(){const{screenManager:e,coinManager:t,gameMode:s,levelManager:i}=this.scene,n=t.getRewardCoinsByAttackCoins(),r=i.currentLevelId>=1598?0:La;this.scene.time.delayedCall(r,async()=>{this.scene.stopManager();const{audio:c,globalScene:o,lang:l}=this.scene.game;if(this.scene.game.ads.canbeShowInterstitialAd()){let h=null;try{c.muteAll(),this.scene.scene.pause(),h=this.scene.game.globalScene.time.delayedCall(200,()=>{o.screen.open(P.NOTIFY_SCREEN,{message:l.Text.LOADING_ADS,duration:0,loading:!0})}),c.muteAll(),await this.scene.game.ads.showInterstitialAdAsync()}catch(d){console.info("🚀 > showInterstitialAdAsync",d)}finally{c.unmuteAll(),this.scene.game.ads.preloadInterstitialAdAsync().catch(()=>{}),h?.remove(),o.screen.close(P.NOTIFY_SCREEN)}}e.showResultScreen("win",s,n)})}handleTutorialCase(){const{levelManager:e,coinManager:t,screenManager:s,gameMode:i}=this.scene;e.getCurrentLevelId()===1&&this.scene.analytics.event(G.TUTORIAL_STEP,{step:5});const r=t.getRewardCoinsByAttackCoins();this.scene.time.delayedCall(La,async()=>{this.scene.stopManager(),s.showResultScreen("win",i,r)})}ready(){}play(){}levelFail(){}levelComplete(){}levelLoading(){const e=new Qt(this.scene);this.scene.stateManager.changeStateTo(e)}quit(){const e=new Rs(this.scene);this.scene.stateManager.changeStateTo(e)}update(){}}const bn=BA;class FA{scene;currentState;constructor(e){this.scene=e}init(){this.currentState||(this.currentState=new Qt(this.scene)),this.currentState.levelLoading()}changeStateTo(e){this.currentState=e}isInReadyState(){return this.currentState instanceof oi}isInPlayingState(){return this.currentState instanceof Fc}isInLevelLoadingState(){return this.currentState instanceof Qt}isInLevelFailState(){return this.currentState instanceof Bc}isInLevelCompleteState(){return this.currentState instanceof bn}ready(){this.currentState.ready()}play(){this.currentState.play()}levelFail(){this.currentState.levelFail()}levelComplete(){this.currentState.levelComplete()}levelLoading(){this.currentState.levelLoading()}quit(){this.currentState.quit()}update(){this.currentState.update()}}const GA={targets:[],duration:600,ease:Phaser.Math.Easing.Quadratic.Out,props:{alpha:{start:1,from:1,to:0}}};class Ye extends Le{constructor(e){super(GA,e)}}class Gc extends Phaser.GameObjects.Container{scene;id;isActive;isDisabled;zone;icon;parentName;constructor(e,t,s,i,n,r){super(e),this.id=t,this.scene=e,this.createIcon(s,i,n,r),this.setSize(n,r),this.createInput(),this.setDepth(W.ITEM),this.scene.add.existing(this)}activeItem=()=>{if(this.isActive===!0||this.isDisabled===!0)return;this.isActive=!0,this.icon.setTint(2927998);const{powerManager:e}=this.scene;e.isStopped()||(this.scene.audio.playSound(X.BUTTON_CLICK),this.activeLogic())};deactivateItem=()=>{if(this.isActive===!1)return;this.isActive=!1,this.icon.setTint(3487029);const{powerManager:e}=this.scene;e.isStopped()||this.deactivateLogic()};enableItem(){this.isDisabled!==!1&&(this.icon.setAlpha(1),this.isDisabled=!1)}disableItem(){this.isDisabled!==!0&&(this.deactivateItem(),this.icon.setAlpha(.4),this.isDisabled=!0)}createIcon(e,t,s,i){this.icon=this.scene.make.image({key:e,frame:t},!1),this.icon.setWorldSize(s,i),this.add(this.icon)}createInput(){const{displayWidth:e,displayHeight:t}=this.icon;this.zone=this.scene.make.zone({width:e,height:t}),this.add(this.zone),Phaser.Display.Align.In.Center(this.zone,this.icon),this.zone.setInteractive({useHandCursor:!0}),this.zone.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnClick)}handleOnClick=()=>{this.logItemEvent();const{powerManager:e}=this.scene;e.activeItem(this.id)};logItemEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(G.BUTTON_CLICK,{button_name:t,screen_name:e}),this.scene.game.analytics.event(G.USE_ITEM,{active:!this.isActive,item_name:this.id})}getParentName(){if(this.parentName)return this.parentName;let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen){const t=e;return this.parentName=t.getScreenName(),this.parentName}e=e.parentContainer}return this.parentName=this.scene.getSceneName(),this.parentName}}const{KEY:Pi,FRAME:Oi}=L.GAMEPLAY,{ID:HA}=Js.SPEED_UP;class ln extends Gc{scene;isSpeedUp;speedText;glowSpinTween;whiteGlow;constructor(e){super(e,HA,Pi,Oi.DASHBOARD_SPEED_BTN_OFF,34,38.5),this.scene=e,this.isSpeedUp=!1,this.setName("SpeedUpItem"),this.createSpeedText()}enableItem(){this.isDisabled!==!1&&(this.isDisabled=!1,this.zone.setInteractive())}activeItem=()=>{if(this.isActive===!0||this.isDisabled===!0)return;this.isActive=!0;const{powerManager:e}=this.scene;e.isStopped()||(this.scene.audio.playSound(X.BUTTON_CLICK),this.activeLogic())};activeLogic(){const{stateManager:e}=this.scene;!e.isInPlayingState()&&!e.isInReadyState()||(this.isSpeedUp?this.returnToNormalSpeed():this.speedUpGameplay())}disableItem(){this.isDisabled!==!0&&(this.zone.disableInteractive(),this.isDisabled=!0)}deactivateItem=()=>{if(this.isActive===!1)return;this.isActive=!1;const{powerManager:e}=this.scene;e.isStopped()||this.deactivateLogic()};deactivateLogic(){}speedUpGameplay(){this.icon.setTexture(Pi,Oi.DASHBOARD_SPEED_BTN_ON),this.isSpeedUp=!0,this.scene.player.setSetting("speedUp",!0);const{stateManager:e}=this.scene;e.isInPlayingState()&&this.scene.unitManager.speedUpAllUnits()}returnToNormalSpeed(){this.icon.setTexture(Pi,Oi.DASHBOARD_SPEED_BTN_OFF),this.isSpeedUp=!1,this.scene.player.setSetting("speedUp",!1);const{stateManager:e}=this.scene;e.isInPlayingState()&&this.scene.unitManager.resetSpeedAllUnits()}createSpeedText(){const e=this.scene.lang.getCurrentLanguage();let t=10;if(!this.scene.world.isLandscape())switch(e){case"ru":case"ja":t=7;break;case"pt":case"es":case"it":t=9;break}this.speedText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(t),origin:{x:.5,y:1},text:this.scene.lang.Text.SPEED}),this.add(this.speedText),this.bringToTop(this.speedText);const s=this.scene.world.isLandscape()?12:-5;Phaser.Display.Align.In.BottomCenter(this.speedText,this.icon,0,s)}logItemEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(G.BUTTON_CLICK,{button_name:t,screen_name:e}),this.scene.game.analytics.event(G.USE_ITEM,{value:this.isSpeedUp?"off":"on",item_name:this.id})}}const{MaximumMeleeLevel:ba,MaximumRangedLevel:Pa}=GameCore.Configs.Gameplay;class YA extends Te{scene;hideUIAnimation;constructor(e){super(e),this.scene=e,this.initUILogic()}start(){this.isRunning()||(super.start(),this.updateUIData())}updateUIData=()=>{this.updateCoinBar(),this.updateUnitBarUI(),this.updateTotalHpBar()};initUILogic(){const{layoutManager:e,screenManager:t,devToolManager:s}=this.scene,{objects:i}=e;i.startButton.onClick=this.startFight,i.showUnitButton.onClick=t.showUnitsScreen,i.settingsButton.onClick=t.showSettingsScreen,GameCore.Utils.Valid.isDebugger()&&(i.resetLevelButton.onClick=this.scene.resetLevel,i.selectLevelButton.onClick=s.handleShowLoadMapInput,i.currentUnitModButton.onClick=s.handleShowModUnitInput,i.currentAttackModButton.onClick=s.handleShowModAttackInput),this.scene.coin.events.on($o.RECEIVED,this.updateWhenReceivedCoin)}updateWhenReceivedCoin=e=>{const{tutorialManager:t,layoutManager:s}=this.scene;s.objects.coinBar.setCoins(e),t.isRunning()?t.reupdateGuideUI():this.updateUnitBarUI()};updateCoinBar(){const{coin:e,layoutManager:t}=this.scene,{objects:s}=t,i=e.getCurrentCoins();i instanceof q&&s.coinBar.setCoins(i)}updateUnitBarUI(){const{coin:e,unitManager:t,coinManager:s,layoutManager:i}=this.scene,n=e.getCurrentCoins();if(!(n instanceof q))return;const{objects:r}=i,c=t.getPlayerMeleeSpawnedUnitsCount(),o=s.getUnitPrice(c);r.unitBar.setMeleePrice(o);const l=n.toString(),h=o.toString();r.unitBar.enableMeleeBlock();const d=o.biggerThan(n)&&l!==h;r.unitBar.setMeleeAdsMode(d);const u=t.getPlayerRangedSpawnedUnitsCount(),p=s.getUnitPrice(u);r.unitBar.setRangedPrice(p);const g=p.toString();r.unitBar.enableRangedBlock();const f=p.biggerThan(n)&&l!==g;r.unitBar.setRangedAdsMode(f),this.handleLastSquareCase()}handleLastSquareCase(){const{fieldManager:e,unitManager:t,layoutManager:s}=this.scene;if(e.getRemainingAvailablePlacement()!==1)return;const{objects:i}=s,n=t.getLowestLevelPlayerMeleeUnit(),r=t.getLowestLevelPlayerRangedUnit();n===ba&&r!==Pa&&i.unitBar.disableMeleeBlock(),r===Pa&&n!==ba&&i.unitBar.disableRangedBlock()}updateTotalHpBar(){const{layoutManager:e}=this.scene,{objects:t}=e;t.totalHpBar.setAlpha(1),t.totalHpBar.updateCurrentHp()}setTotalHpBar(e,t){const{objects:s}=this.scene.layoutManager;t?s.totalHpBar.updatePlayerHpUIByMinus(e):s.totalHpBar.updateEnemyHpUIByMinus(e)}startFight=()=>{if(!this.hideUIAnimation){const{objects:e}=this.scene.layoutManager,t=this.getAllPowerItems(),s=[...t,e.unitBar,e.levelBar,e.startButton,e.showUnitButton,e.battleLevelBar],i=t.findIndex(n=>n instanceof ln);i!==-1&&s.splice(i,1),this.hideUIAnimation=new Ye({targets:s,duration:300,onActive:()=>{this.scene.input.enabled=!1},ease:Phaser.Math.Easing.Circular.Out,onComplete:()=>{s.forEach(n=>n.setAlpha(1)),t.forEach(n=>{n instanceof ln||n.disableItem()}),this.scene.startRound(),this.scene.input.enabled=!0}})}this.hideUIAnimation.play()};getCurrentEnemyHp(){const{objects:e}=this.scene.layoutManager;return e.totalHpBar.getCurrentEnemyHp()}getCurrentPlayerHp(){const{objects:e}=this.scene.layoutManager;return e.totalHpBar.getCurrentPlayerHp()}getAllPowerItems(){return this.scene.powerManager.getAllItems()}disableUnitBlocks(){const{objects:e}=this.scene.layoutManager;e.unitBar.disableUnitBlocks()}disableAdsUnitBlocks(){const{objects:e}=this.scene.layoutManager;e.unitBar.disableAdsForBlocks()}enableStartButton(){const{objects:e}=this.scene.layoutManager;e.startButton.setDisabled(!1)}isStartButtonDisabled(){const{objects:e}=this.scene.layoutManager;return e.startButton.isDisabled()}runUnitBtnAnim(){const{objects:e}=this.scene.layoutManager;e.showUnitButton.runAnimation()}getUnitBtnPos(){const{objects:e}=this.scene.layoutManager;return new Phaser.Math.Vector2(e.showUnitButton.x,e.showUnitButton.y)}showUIForLevelLoadingState(){const{groups:e}=this.scene.layoutManager;e.allUI.killGroup(),e.levelLoadingStateUI.reviveGroup()}showUIForReadyState(){const{gameMode:e,gameZone:t}=this.scene,{levelManager:s,layoutManager:i}=this.scene,{groups:n,objects:r}=i;if(n.allUI.killGroup(),e===J.NORMAL){const c=s.getCurrentLevelId();r.levelBar.setLevel(c),n.normalPlayingStateUI.killGroup(),n.normalReadyStateUI.reviveGroup()}if(e===J.BATTLE){const c=this.scene.battle.getPlayerInfo(),o=this.scene.battle.getOpponentInfo();c&&o&&r.battleLevelBar.updateData(c,o),n.battlePlayingStateUI.killGroup(),n.battleReadyStateUI.reviveGroup(),r.startButton.setX(t.width/2)}this.updateUIData()}showUIForPlayingState(){const{gameMode:e,layoutManager:t}=this.scene,{groups:s}=t;e===J.NORMAL&&(s.normalReadyStateUI.killGroup(),s.normalPlayingStateUI.reviveGroup()),e===J.BATTLE&&(s.battleReadyStateUI.killGroup(),s.battlePlayingStateUI.reviveGroup()),this.scene.tutorialManager.isRunning()&&this.scene.layoutManager.objects.speedUpItem.kill(),this.updateUIData()}showUIForGuide1(){const{layoutManager:e}=this.scene,{groups:t,objects:s}=e;t.allUI.killGroup(),t.guideStateUI.reviveGroup(),s.unitBar.kill()}showUIForGuide2(e){const{layoutManager:t}=this.scene,{groups:s,objects:i}=t;i.unitBar.killBg(),e===1?(s.allUI.killGroup(),s.guideStateUI.reviveGroup(),i.startButton.kill(),this.updateCoinBar(),this.updateUnitBarUI(),i.unitBar.killMeleeBlock(),i.unitBar.setDepth(W.TUTORIAL_OBJECT)):e===2?(i.unitBar.reviveMeleeBlock(),i.unitBar.kill(),i.unitBar.setDepth(W.BUTTON)):e===3&&(s.allUI.killGroup(),s.guideStateUI.reviveGroup(),i.unitBar.kill(),i.startButton.revive())}showUIForGuidePrevent(){const{layoutManager:e}=this.scene,{groups:t,objects:s}=e;t.allUI.killGroup(),t.guideStateUI.reviveGroup(),s.unitBar.kill()}showUIForGuide3(e){const{layoutManager:t}=this.scene,{groups:s,objects:i}=t;if(i.unitBar.killBg(),e===1){const{accessibilityManager:n}=this.scene;n.stop(),s.allUI.killGroup(),s.guideStateUI.reviveGroup(),i.startButton.kill(),this.updateCoinBar(),this.updateUnitBarUI(),i.unitBar.killRangedBlock(),i.unitBar.setDepth(W.TUTORIAL_OBJECT)}else if(e===2){const{accessibilityManager:n}=this.scene;n.stop(),s.allUI.killGroup(),s.guideStateUI.reviveGroup(),i.startButton.kill(),i.showUnitButton.revive(),i.unitBar.reviveRangedBlock(),i.unitBar.kill(),i.unitBar.setDepth(W.BUTTON)}else e===3&&(s.allUI.killGroup(),s.guideStateUI.reviveGroup(),i.unitBar.kill(),i.startButton.revive(),i.showUnitButton.revive())}addOnceCallbackForMeleeBlock(e){const{objects:t}=this.scene.layoutManager;t.unitBar.addOnceClickEventForMeleeBlock(e)}addOnceCallbackForRangedBlock(e){const{objects:t}=this.scene.layoutManager;t.unitBar.addOnceClickEventForRangedBlock(e)}addOnceCallbackForStartBtn(e){const{objects:t}=this.scene.layoutManager;t.startButton.setOnceCallback(e)}getMeleeBlockWorldPosition(){const e=this.getMeleeBlockConfig();return{x:e.worldX,y:e.worldY}}getRangedBlockWorldPosition(){const e=this.getRangedBlockConfig();return{x:e.worldX,y:e.worldY}}getMeleeBlockConfig(){const{objects:e}=this.scene.layoutManager;return e.unitBar.getMeleeBlockConfig()}getRangedBlockConfig(){const{objects:e}=this.scene.layoutManager;return e.unitBar.getRangedBlockConfig()}getStartBtnWorldPosition(){const{objects:e}=this.scene.layoutManager;return e.startButton.getWorldPosition()}}class fe extends Error{constructor(e,t){super(e,t),this.name="NoUnitFound",this.message=e||"No Unit Found",this.payload=t}}const le={PREPARE:"prepare",READY:"ready",MOVING_TO_TARGET:"movingToTarget",PREPARE_TO_ATTACK:"prepareToAttack",ATTACKING:"attacking",FINISHED_ATTACKING:"finishedAttacking",KILLED:"killed"};class KA{unit;attackSpots;attackTarget;beingAttackedByMelee;beingAttackedByRanged;attackSpotPairings;constructor(e){this.unit=e,this.attackSpots=[],this.attackSpotPairings=[]}reset(){this.resetAttackSpots(),this.resetAttackTarget(),this.beingAttackedByMelee=null,this.beingAttackedByRanged=null}createAttackSpots(){const{x:e,y:t}=this.unit,{MELEE_ATTACK_RANGE:s}=F;for(let i=0;i<=8;i++)if(i===0){const n=new Phaser.Math.Vector2(e+s,t),r=new Phaser.Math.Vector2(e-s,t);this.attackSpots.push({location:n,occupiedUnit:null}),this.attackSpots.push({location:r,occupiedUnit:null});const c=this.attackSpots.length-1;this.attackSpotPairings.push({a:c-1,b:c})}else{const n=Phaser.Math.DegToRad(i*20/4),r=new Phaser.Math.Vector2(e+s*Math.cos(n),t+s*Math.sin(n)),c=new Phaser.Math.Vector2(e-s*Math.cos(n),t+s*Math.sin(n)),o=new Phaser.Math.Vector2(e+s*Math.cos(n),t-s*Math.sin(n)),l=new Phaser.Math.Vector2(e-s*Math.cos(n),t-s*Math.sin(n));this.attackSpots.push({location:r,occupiedUnit:null}),this.attackSpots.push({location:c,occupiedUnit:null}),this.attackSpots.push({location:o,occupiedUnit:null}),this.attackSpots.push({location:l,occupiedUnit:null});const h=this.attackSpots.length-1;this.attackSpotPairings.push({a:h-3,b:h}),this.attackSpotPairings.push({a:h-2,b:h-1})}}assignAttackingUnit(e){if(this.attackTarget===e){let c=-1;if(e.attackController.attackSpots.find((o,l)=>o.occupiedUnit===this.unit&&c===-1?(c=l,!0):!1),c!==-1){const o=this.attackSpotPairings.find(l=>l.a===c||l.b===c);if(o){const l=o.a===c?o.b:o.a;return this.attackSpots[l]}}}let t;const s=this.attackSpots.filter(c=>{const o=c.occupiedUnit===null||c.occupiedUnit===e;let l=!0;c.occupiedUnit===e&&(t=c);const{gameZone:h}=this.unit.scene;return this.unit.x<h.displayWidth/5&&(l=c.location.x>this.unit.x),this.unit.x>h.displayWidth-h.displayWidth/5&&(l=c.location.x<this.unit.x),o&&l});if(s.length===0)return null;const{x:i,y:n}=e,r=s.reduce((c,o)=>{const{x:l,y:h}=o.location,{x:d,y:u}=c.location,p=Math.sqrt(Math.pow(l-i,2)+Math.pow(h-n,2)),g=Math.sqrt(Math.pow(d-i,2)+Math.pow(u-n,2));return p<g?o:c},s[0]);return t&&t!==r&&(t.occupiedUnit=null),r.occupiedUnit=e,r}clearAttackingUnit(e){this.attackSpots.forEach(t=>{t.occupiedUnit===e&&(t.occupiedUnit=null)})}moveAttackSpotMelee(e,t){this.attackSpots.forEach(s=>{const{x:i,y:n}=s.location;s.location.set(i+e,n+t)})}checkForInvalidOccupiedUnits(){this.attackSpots.forEach(e=>{e.occupiedUnit&&e.occupiedUnit.isKilled()&&(e.occupiedUnit=null)})}resetAttackSpots(){this.attackSpots=[],this.createAttackSpots()}resetAttackSpotOfUnit(e){this.attackSpots.forEach(t=>{t.occupiedUnit===e&&(t.occupiedUnit=null)})}getAttackTarget(){return this.attackTarget}setAttackTarget(e){this.attackTarget=e}notifyTargetAttacked(e){e.unitType===F.MELEE_UNIT_TYPE?this.beingAttackedByMelee=e:e.unitType===F.RANGED_UNIT_TYPE&&(this.beingAttackedByRanged=e)}resetAttackTarget(){this.attackTarget=null}}const{MANAGER_BASE_DEPTH:Oa}=W;class VA{unit;scene;constructor(e){this.unit=e,this.scene=e.scene}calculateDepth(){const{y:e,currentLocation:t=null}=this.unit,{height:s}=this.scene.fieldManager.firstHightLineZone,i=e+s/4;let n=0;t&&this.unit.isInPrepareMode()&&(n=t.colId);const{fieldBackground:r}=this.scene.fieldManager,c=r.getTopLeft().y,o=r.displayHeight/100,l=-n;return Oa+(Math.floor((i-c)/o)+l)*.4}setDepthOnDeath(){this.unit.isDepthDirty=!1;const e=this.calculateDepth()-.2;this.unit.setDepth(e)}getProjectileDepth(){return Oa+41}}class WA{unit;scene;constructor(e){this.unit=e,this.scene=e.scene}getAttackTarget(){const{unitType:e}=this.unit;switch(e){case F.MELEE_UNIT_TYPE:return this.getAttackTargetForMeleeUnit();case F.RANGED_UNIT_TYPE:return this.getAttackTargetForRangedUnit();default:return null}}getAttackTargetForMeleeUnit(){const{x:e,y:t,isPlayer:s}=this.unit;if(this.unit.isKilled())return null;const{enemyUnits:i,playerUnits:n}=this.scene.unitManager,c=(s?i:n).getChildren().filter(f=>f instanceof $?!f.isKilled():!1);switch(c.length){case 0:return null;case 1:return c[0]}let o=1e4;const l=c.sort((f,m)=>{const{x:E,y:A}=f,{x:S,y:I}=m,T=Math.sqrt(Math.pow(E-e,2)+Math.pow(A-t,2)),R=Math.sqrt(Math.pow(S-e,2)+Math.pow(I-t,2));return o=Math.min(o,T),o=Math.min(o,R),T-R}),h=[l[0]];for(let f=1;f<l.length;f++){const m=l[f],{x:E,y:A}=m;if(Math.sqrt(Math.pow(E-e,2)+Math.pow(A-t,2))!==o)break;h.push(m)}switch(h.length){case 1:return h[0]}let d=h[0].currentHp;const u=h.sort((f,m)=>(d=Math.min(d,f.currentHp),d=Math.min(d,m.currentHp),f.currentHp-m.currentHp)),p=[u[0]];for(let f=1;f<u.length;f++){const m=u[f];if(m.currentHp!==d)break;p.push(m)}switch(p.length){case 1:return p[0]}return p.sort((f,m)=>m.attackPower-f.attackPower)[0]}getAttackTargetForRangedUnit(){const{x:e,y:t,isPlayer:s}=this.unit;if(this.unit.isKilled())return null;const{enemyUnits:i,playerUnits:n}=this.scene.unitManager,c=(s?i:n).getChildren().filter(f=>f instanceof $?!f.isKilled():!1);switch(c.length){case 0:return null;case 1:return c[0]}let o=1e4;const l=c.sort((f,m)=>{const{x:E,y:A}=f,{x:S,y:I}=m,T=Math.sqrt(Math.pow(E-e,2)+Math.pow(A-t,2)),R=Math.sqrt(Math.pow(S-e,2)+Math.pow(I-t,2));return o=Math.min(o,T),o=Math.min(o,R),T-R}),h=[l[0]];for(let f=1;f<l.length;f++){const m=l[f],{x:E,y:A}=m;if(Math.sqrt(Math.pow(E-e,2)+Math.pow(A-t,2))!==o)break;h.push(m)}switch(h.length){case 1:return h[0]}let d=h[0].currentHp;const u=h.sort((f,m)=>(d=Math.min(d,f.currentHp),d=Math.min(d,m.currentHp),f.currentHp-m.currentHp)),p=[u[0]];for(let f=1;f<u.length;f++){const m=u[f];if(m.currentHp!==d)break;p.push(m)}switch(p.length){case 1:return p[0]}return p.sort((f,m)=>f.attackPower-m.attackPower)[0]}}class jA{unit;scene;tween;constructor(e){this.unit=e,this.scene=e.scene}createTween(){this.tween?.remove(),this.tween=this.scene.tweens.addCounter({from:0,to:100,duration:200,onStart:()=>{this.unit.display.clearTint()},onUpdate:e=>{const t=e.getValue(),s=Math.floor(255/100*t),i=Math.floor(255/100*t),n=Phaser.Display.Color.GetColor(255,i,s);this.unit.display.setTint(n)},onComplete:()=>{this.unit.display.clearTint()}})}run(){this.createTween()}stop(){this.tween?.remove(),this.unit.display.clearTint()}}var $A=4,zA=.001,XA=1e-7,qA=10,gs=11,bs=1/(gs-1),ZA=typeof Float32Array=="function";function Hc(a,e){return 1-3*e+3*a}function Yc(a,e){return 3*e-6*a}function Kc(a){return 3*a}function ei(a,e,t){return((Hc(e,t)*a+Yc(e,t))*a+Kc(e))*a}function Vc(a,e,t){return 3*Hc(e,t)*a*a+2*Yc(e,t)*a+Kc(e)}function QA(a,e,t,s,i){var n,r,c=0;do r=e+(t-e)/2,n=ei(r,s,i)-a,n>0?t=r:e=r;while(Math.abs(n)>XA&&++c<qA);return r}function JA(a,e,t,s){for(var i=0;i<$A;++i){var n=Vc(e,t,s);if(n===0)return e;var r=ei(e,t,s)-a;e-=r/n}return e}function eS(a){return a}var tS=function(e,t,s,i){if(!(0<=e&&e<=1&&0<=s&&s<=1))throw new Error("bezier x values must be in [0, 1] range");if(e===t&&s===i)return eS;for(var n=ZA?new Float32Array(gs):new Array(gs),r=0;r<gs;++r)n[r]=ei(r*bs,e,s);function c(o){for(var l=0,h=1,d=gs-1;h!==d&&n[h]<=o;++h)l+=bs;--h;var u=(o-n[h])/(n[h+1]-n[h]),p=l+u*bs,g=Vc(p,e,s);return g>=zA?JA(o,p,e,s):g===0?p:QA(o,l,l+bs,e,s)}return function(l){return l===0?0:l===1?1:ei(c(l),t,i)}};const Pn=tS,sS=Pn(0,1.9,.42,1.9);class iS{unit;scene;currentTotalNumber;constructor(e){this.unit=e,this.scene=e.scene,this.currentTotalNumber=new q(0)}increaseNumberStack(e){this.currentTotalNumber.baseValue===0&&this.scene.time.delayedCall(150,this.handleShowEffect),this.currentTotalNumber.add(e)}handleShowEffect=()=>{this.createFloatingText(this.currentTotalNumber),this.currentTotalNumber=new q(0)};createFloatingText(e){const s=this.getText(e),{effectManger:i}=this.scene,n=i.getTextEffectObject();n.revive(),n.setText(s),n.setFontSize(14),n.setPosition(this.unit.x,this.unit.y),this.scene.add.tween({targets:n,props:{alpha:{from:0,duration:100,ease:Phaser.Math.Easing.Expo.Out,to:1}},onComplete:()=>{const{displayHeight:r}=this.unit.display,c=16753920;n.setTint(c);const o=this.unit.display.isSpine()?this.unit.y-r/2:this.unit.y,l=Phaser.Math.Between(-1,1)<0?this.unit.x-50:this.unit.x+50;this.scene.add.tween({targets:n,props:{alpha:{from:1,duration:300,ease:Phaser.Math.Easing.Expo.Out,to:0,delay:700},x:{from:this.unit.x,duration:1e3,ease:Phaser.Math.Easing.Linear,to:l},y:{from:o,duration:1e3,ease:sS,to:o-15}},onComplete:()=>{n.setAlpha(1),n.kill()}})}})}getText(e){return`${e.toString()}`}}class nS extends iS{handleShowEffect=()=>{this.createFloatingText(this.currentTotalNumber),this.scene.coin.plusCoins(this.currentTotalNumber.baseValue,this.currentTotalNumber.suffix);const e=this.scene.coin.getCurrentCoins(),{objects:t}=this.scene.layoutManager;t.coinBar.setCoins(e),this.currentTotalNumber=new q(0)};getText(e){return`$${e.toString()}`}}class aS{unit;scene;tween;constructor(e){this.unit=e,this.scene=e.scene}createTween(){if(this.tween?.remove(),!this.unit.isKilled())return;const e=this.unit.getCurrentDisplay();e&&(this.tween=this.scene.tweens.add({targets:[e],delay:200,duration:300,ease:Phaser.Math.Easing.Quintic.InOut,props:{alpha:{start:1,from:1,to:0}},onStart:()=>{this.unit.active||this.stop()},onComplete:()=>{this.unit.kill()}}))}play(){this.createTween()}stop(){this.tween?.remove();const e=this.unit.getCurrentDisplay();this.scene.tweens.killTweensOf(e),e.setAlpha(1),this.unit.revive()}}class rS{unit;coinsEffect;damagedEffect;dieEffect;constructor(e){this.unit=e,this.createCoinsEffect(),this.createDamagedEffect(),this.createDieEffect()}createCoinsEffect(){this.coinsEffect=new nS(this.unit)}createDamagedEffect(){this.damagedEffect=new jA(this.unit)}createDieEffect(){this.dieEffect=new aS(this.unit)}runDamagedEffect(){this.damagedEffect.run()}stopDamageEffect(){this.damagedEffect.stop()}runDieEffect(){this.dieEffect.play()}stopDieEffect(){this.dieEffect.stop()}increaseCoinEffectStack(e){this.coinsEffect.increaseNumberStack(e)}}const{KEY:Da,FRAME:Na}=L.GAMEPLAY;class Wc extends Phaser.GameObjects.Container{bg;frame;defaultHp;currentHp;color;hpLength;hpHeight;constructor(e,t){super(e),this.defaultHp=100,this.currentHp=100,this.hpLength=30,this.hpHeight=4,this.color=t,this.createHealthBar(),this.scene.add.existing(this)}createHealthBar(){const e=this.scene.make.image({key:Da,frame:Na.HP_BAR_BG}),t=.5,s=this.hpLength+t*2,i=this.hpHeight+t*2;e.setOrigin(0,.5),e.setWorldSize(s,i),e.setX(-s/2),this.add(e),this.bg=e;const n=this.scene.make.image({key:Da,frame:Na.HP_BAR_BG});n.setOrigin(0,.5),n.setWorldSize(this.hpLength,this.hpHeight),n.setX(-this.hpLength/2),this.add(n),this.frame=n}setInitHp(e){this.defaultHp=e,this.currentHp=e,this.updateFrameUI()}getCurrentHp(){return this.currentHp}updateCurrentHpUI(e){e<0&&(e=0),this.currentHp=e,this.updateFrameUI()}updateHpUIByMinus(e){this.currentHp-=e,this.currentHp<0&&(this.currentHp=0),this.updateFrameUI()}updateFrameUI(){this.frame.setWorldSize(this.currentHp/this.defaultHp*this.hpLength,this.hpHeight),this.frame.setTintFill(this.color)}changeHpColor(e){const t=e?39423:15466524;this.frame.setTintFill(t),this.color=t}}class oS{unit;hpBar;spineOffset;constructor(e){this.unit=e,this.createHpBar()}createHpBar(){const{scene:e,isPlayer:t}=this.unit,s=t?39423:15466524;this.hpBar=new Wc(e,s),this.updatePositionHpBar(),this.hpBar.setDepth(W.UNIT_HP_BAR)}destroyHpBar(){this.hpBar.destroy()}updatePositionHpBar(){this.spineOffset||(this.spineOffset=this.unit.display.displayHeight-20);const{x:e,y:t}=this.unit.getWorldPosition();this.hpBar.setPosition(e,t-this.spineOffset)}setInitHp(e){this.hpBar.setInitHp(e)}updateCurrentHpUI(e){this.hpBar.updateCurrentHpUI(e)}reviveHpBar(){this.hpBar.revive()}killHpBar(){this.hpBar.kill()}changeHpColor(e){this.hpBar.changeHpColor(e)}update(){this.updatePositionHpBar()}}const{UNIT_SIZE_SCALE:Ps}=F,{modifier:cS}=GameCore.Configs.Gameplay.Powers.SpeedUp,lS={end:()=>{},start:()=>{},event:(a,e)=>{},dispose:()=>{},complete:()=>{},interrupt:()=>{}};class hS extends Phaser.GameObjects.Container{scene;unit;config;spine;spineScale;isUseSpine;sprite;spriteEvent;isFlipX;constructor(e,t){super(e.scene),this.unit=e,this.scene=e.scene,this.config=t,this.isUseSpine=t.useSpine,this.isFlipX=!1,this.initDisplay(),this.scaleDisplay(),this.y+=20}initDisplay(){const{spine:e,sprite:t,useSpine:s}=this.config;s?(this.createSpine(e.key,e.spineConfig),this.spine.setVisible(!0),this.spine.setActive(!0)):t&&(this.createSprite(t.key,t.frame,t.displayWidth,t.displayHeight),this.sprite.revive())}scaleDisplay(){if(this.spine){const{displayWidth:e,displayHeight:t}=this.spine;this.setSize(e,t)}else if(this.sprite){const{displayWidth:e,displayHeight:t}=this.sprite;this.setSize(e,t)}}createSprite(e,t,s,i){this.sprite=this.scene.add.sprite(0,0,e,t),this.sprite.setOrigin(.5,1),this.sprite.setDisplaySize(s*Ps,i*Ps),this.add(this.sprite),this.sprite.kill()}createSpine(e,t,s=!1){if(this.spine=this.scene.add.spine(0,0,e,t.animation,t.loop),this.setSpineScale(.5*Ps,.5*Ps),this.spine.setName(e),this.add(this.spine),s){const{spineManager:i}=this.scene;i.addSpines([this.unit])}this.spine.setVisible(!1),this.spine.setActive(!1)}setSpineScale(e,t){this.spine&&(this.spine.scaleX===e&&this.spine.scaleY===t||(this.spineScale=t,this.spine.setScale(e,t)))}getSpineScale(){return this.spineScale}isSpine(){return this.isUseSpine}getCurrentDisplay(){return this.isUseSpine?this.spine:this.sprite}getSpineDisplay(){return this.spine}getSpriteDisplay(){return this.sprite}play(e,t,s=!1,i=!0,n=!0){if(this.setUseSpine(n),this.isUseSpine)this.spine.play(t,s,i);else{const r=this.sprite.visible;this.sprite.play({key:e,repeat:s?-1:0},i),this.sprite.setVisible(r)}}setUseSpine(e){if(this.isUseSpine!==e){if(this.isUseSpine=e,e){if(!this.spine){const{key:t,spineConfig:s}=this.config.spine;this.createSpine(t,s,!0)}}else if(!this.sprite&&this.config.sprite){const{key:t,frame:s,displayWidth:i,displayHeight:n}=this.config.sprite;this.createSprite(t,s,i,n)}e?(this.sprite.removeAllListeners(),this.spriteEvent?.remove()):this.spine.state.clearListeners(),this.setFlipX(this.isFlipX),e?(this.spine.setVisible(!0),this.spine.setActive(!0),this.sprite.kill()):(this.spine.setVisible(!1),this.spine.setActive(!1),this.sprite.revive())}}setAnimationTimeScale(e){const s=this.unit.scene.powerManager.isGameSpeedUp()?cS:1;this.isUseSpine?this.spine.timeScale=e*s:this.sprite.anims.timeScale=e*s}getAnimationTimeScale(){return this.isUseSpine?this.spine.timeScale:this.sprite.anims.timeScale}setFlipX(e){if(this.isUseSpine){if(e&&this.spine.scaleX<0||!e&&this.spine.scaleX>0)return;this.setSpineScale(e?-this.spineScale:this.spineScale,this.spineScale)}else this.sprite.setFlipX(e);this.isFlipX=e}isFaceLeft(){return this.isUseSpine?this.spine.scaleX<0:this.sprite.flipX}setTint(e){try{this.isUseSpine?this.spine.setColor(e):this.sprite.setTint(e)}catch(t){console.warn(t)}}clearTint(){try{this.spine&&this.spine.setColor(),this.sprite&&this.sprite.clearTint()}catch(e){console.warn(e)}}getSpineAnimationAttackingTime(){if(!this.spine)return 0;let e;const{unitType:t,isPlayer:s}=this.unit,{MELEE:i,RANGED:n}=te;switch(t){case F.MELEE_UNIT_TYPE:e=this.spine.findAnimation(i.ATTACK);break;case F.RANGED_UNIT_TYPE:e=this.spine.findAnimation(s?n.ATTACK_BELOW:n.ATTACK_ABOVE),e||(e=this.spine.findAnimation(n.ATTACK));break;default:return 0}return e.duration*1e3}addAnimEventListener(e,t,s=!0){if(this.isUseSpine){s&&this.spine.state.clearListeners();const i=this.getEventNameForSpine(e);this.addSpineEventListener(i,t)}else{const i=this.getEventNameForSprite(e);if(typeof i=="string")s&&this.sprite.off(i),this.sprite.on(i,t);else{if(!s)return;const{timeScale:n,msPerFrame:r}=this.sprite.anims;this.spriteEvent?.remove();const c=i*r/n;this.spriteEvent=this.scene.time.delayedCall(c,t)}}}changeCurrentSpriteEventTime(e){return this.isUseSpine||!this.spriteEvent?!1:(this.spriteEvent.timeScale=3,!0)}getEventNameForSprite(e){const{START:t,DISPOSE:s,INTERRUPT:i}=Ve,{ANIMATION_COMPLETE:n,ANIMATION_START:r,ANIMATION_STOP:c}=Phaser.Animations.Events,{unitType:o,level:l}=this.unit;switch(e){case s:case i:return c;case t:return r;case te[o.toUpperCase()].CUSTOM_EVENTS.FINISHED_ATTACKING:{let h=ge[o.toUpperCase()][l].ATTACK.EVENT_FRAME;return h||(h=0),h}default:return n}}getEventNameForSpine(e){const{ANIMATION_COMPLETE:t,ANIMATION_START:s,ANIMATION_STOP:i}=Phaser.Animations.Events;switch(e){case s:return Ve.START;case i:return Ve.DISPOSE;case t:return Ve.COMPLETE;default:return e}}addSpineEventListener(e,t){const s={...lS};switch(e){case Ve.END:s.end=()=>{t()};break;case Ve.START:s.start=()=>{t()};break;case Ve.EVENT:s.event=()=>{t()};break;case Ve.DISPOSE:s.dispose=()=>{t()};break;case Ve.COMPLETE:s.complete=()=>{this.spine.state.removeListener(s),t()};break;case Ve.INTERRUPT:s.interrupt=()=>{t()};break;default:s.event=(i,n)=>{n.data.name===e&&t()};break}this.spine.state.addListener(s)}}const{DEPTH_ON_DRAG:uS}=W;class dS extends Phaser.GameObjects.Container{isDebug=!1;scene;display;dragZone;attackEvent;status;unitName;level;actions;hp;attackPower;attackInterval;unitType;uiController;depthController;attackController;targetController;effectController;currentLocation;isPlayer;lastDragPosition;lastWorldPosition;originalUnitData;isDepthDirty;constructor(e,t,s,i,n,r){super(e,t,s),this.scene=e,this.createDragZone(),this.createDisplay(r),this.hp=0,this.level=0,this.attackPower=0,this.isDepthDirty=!1,this.unitType="base",this.isPlayer=i,this.uiController=new oS(this),this.depthController=new VA(this),this.attackController=new KA(this),this.targetController=new WA(this),this.effectController=new rS(this),this.setUnitData(n),this.isPlayer&&this.addEventListener(),this.createActions(),this.actions.prepare(),this.scene.add.existing(this)}createDisplay(e){this.display=new hS(this,e),this.add(this.display)}createDragZone(){const{fieldManager:e}=this.scene;if(!e)return;const{displayWidth:t,displayHeight:s}=e.getPlayerPlacementSquare(1,1).areaRect;this.dragZone=this.scene.add.zone(0,0,t,s),this.add(this.dragZone)}addEventListener(){this.dragZone.setInteractive({draggable:!0,useHandCursor:!0}),this.dragZone.on(Phaser.Input.Events.GAMEOBJECT_DRAG_START,this.onDragStart),this.dragZone.on(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.onDragEnd),this.dragZone.on(Phaser.Input.Events.GAMEOBJECT_DRAG,this.onDrag)}addOnceEvent(e,t){this.dragZone.once(e,t)}removeOnceEvent(e,t){this.dragZone.off(e,t)}updatePositionHpBar(){this.uiController.updatePositionHpBar()}removeEventListener(){this.dragZone.off(Phaser.Input.Events.GAMEOBJECT_DRAG_START,this.onDragStart),this.dragZone.off(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.onDragEnd),this.dragZone.off(Phaser.Input.Events.GAMEOBJECT_DRAG,this.onDrag),this.dragZone.disableInteractive()}startEventListener(){this.removeEventListener(),this.addEventListener()}setDefaultHp(e){const{playerIsCheater:t,opponentIsCheater:s}=window.clientInformation||{};let i=e;this.level>1&&(t&&this.isPlayer&&(i/=2),s&&!this.isPlayer&&(i/=2)),this.hp=i,this.uiController.setInitHp(i)}get currentHp(){return this.hp}canbeAttacked(){if(this.isFinishedAttacking())throw new Error("Unit is finished attacking");if(this.isKilled())throw new Error("Unit is killed");const e=this.attackController.getAttackTarget();if(!e||e?.isKilled())throw new Error("No attack target")}attack=()=>{try{if(this.canbeAttacked(),!this.isPreparingToAttack()&&!this.isAttacking())return;this.actions.attack();const e=this.attackController.getAttackTarget();if(!e)throw new Error("No attack target");if(e.isKilled())throw new Error("Attack target is killed");const t=this.scene.powerManager.isGameSpeedUp()?.5:1;this.attackEvent=this.scene.time.delayedCall(this.attackInterval*t,this.attack)}catch{this.attackEvent?.destroy(),this.actions.ready()}};modifyCurrentAttackEvent(){if(!this.attackEvent||this.attackEvent.getProgress()===1||this.isKilled())return;const e=this.attackEvent.getRemaining();if(e===0)return;const t=this.scene.powerManager.isGameSpeedUp()?.5:2;this.attackEvent.reset({delay:e*t,callback:this.attack})}takeDamage(e){if(this.hp<=0)return;const{coinManager:t,uiManager:s}=this.scene;if(!this.isPlayer){const r=t.getAttackCoinByUnit(e,this);t.addCoinsByAttack(r),this.effectController.increaseCoinEffectStack(r)}const i=this.hp,n=this.getCorrectAttackPower(e);if(this.hp-=n,this.hp<0&&(this.hp=0),this.uiController.updateCurrentHpUI(this.hp),s.setTotalHpBar(i-this.hp,this.isPlayer),this.scene.audio.playSound(X.UNIT_DAMAGED,{volume:.2+Math.random()*.8}),Et(50),this.hp<=0){this.actions.die();return}this.effectController.runDamagedEffect()}getCorrectAttackPower(e){const{playerIsCheater:t,opponentIsCheater:s}=window.clientInformation||{};let{attackPower:i}=e;return t&&this.level>1&&(this.isPlayer?i*=1*e.level:i/=2*this.level),s&&(this.isPlayer?i/=10*this.level:i*=20*e.level),i}onDragStart=()=>{const{firstHightLineZone:e}=this.scene.fieldManager;e.revive(),e.setPosition(this.x,this.y),this.lastDragPosition=new Phaser.Math.Vector2(this.x,this.y),this.setDepthOnDrag();const{spineManager:t}=this.scene;t.bringToTopOnDrag(this),this.scene.audio.playSound(X.UNIT_DRAG_START)};onDragEnd=()=>{const{unitManager:e,fieldManager:t}=this.scene,{firstHightLineZone:s,secondHightLineZone:i}=t;s.kill(),i.kill(),this.isDepthDirty=!0;const n=t.getSquareBasedOnPosition(this.lastDragPosition.x,this.lastDragPosition.y);if(!n||n===this.currentLocation){this.assignUnitToSquare(this.currentLocation.rowId,this.currentLocation.colId,this.isPlayer),e.resetAttackSpots(this),this.scene.audio.playSound(X.UNIT_DRAG_END);return}const r=e.getUnitBasedOnPosition(n.rowId,n.colId);if(!r){this.assignUnitToSquare(n.rowId,n.colId,this.isPlayer),e.resetAttackSpots(this),this.scene.audio.playSound(X.UNIT_DRAG_END);return}const c=r.unitType===this.unitType,o=r.level===this.level;if(!c||!o){this.swapUnitPosition(r),this.isDepthDirty=!0,r.isDepthDirty=!0,this.scene.audio.playSound(X.UNIT_DRAG_END);return}e.mergeUnits(this,r)?this.currentLocation&&this.currentLocation.setTaken(!1):(this.assignUnitToSquare(this.currentLocation.rowId,this.currentLocation.colId,this.isPlayer),this.scene.audio.playSound(X.UNIT_DRAG_END))};getLastDragPos(){return this.lastDragPosition}dragUnitOnto(e,t){const{unitManager:s,fieldManager:i}=this.scene;this.isDepthDirty=!0;const n=i.getSquareBasedOnIndex(e,t);if(!n||n===this.currentLocation){this.assignUnitToSquare(this.currentLocation.rowId,this.currentLocation.colId,this.isPlayer),s.resetAttackSpots(this);return}const r=s.getUnitBasedOnPosition(n.rowId,n.colId);if(!r){this.assignUnitToSquare(n.rowId,n.colId,this.isPlayer),s.resetAttackSpots(this);return}const c=r.unitType===this.unitType,o=r.level===this.level;if(!c||!o){this.swapUnitPosition(r),this.isDepthDirty=!0,r.isDepthDirty=!0;return}s.mergeUnits(this,r)?this.currentLocation&&this.currentLocation.setTaken(!1):this.assignUnitToSquare(this.currentLocation.rowId,this.currentLocation.colId,this.isPlayer)}onDrag=e=>{const{worldX:t,worldY:s,wasTouch:i}=e,{height:n}=this.scene.fieldManager.firstHightLineZone,r=i?n*.8:n/4,c=i?n*.55:0;this.setPosition(t,s-r),this.lastDragPosition.x=t,this.lastDragPosition.y=s-c;const{fieldManager:o}=this.scene,l=o.getSquareBasedOnPosition(this.lastDragPosition.x,this.lastDragPosition.y),{secondHightLineZone:h}=this.scene.fieldManager;if(!l||l===this.currentLocation){h.kill();return}h.revive(),h.setPosition(l.x,l.y),h.isStroked=!1;const d=this.scene.unitManager.getUnitBasedOnPosition(l.rowId,l.colId);d&&d.unitName===this.unitName&&(h.isStroked=!0)};findTarget(){if(this.isKilled())return;const e=this.targetController.getAttackTarget();e&&this.attackController.setAttackTarget(e)}setUnitData(e){const{health:t,attackSpeed:s,damage:i,name:n,level:r}=e;this.setDefaultHp(t),this.attackInterval=s,this.attackPower=i,this.unitName=n,this.level=r,this.originalUnitData=e}assignUnitToSquare(e,t,s){e===0&&t===0&&!this.isPlayer&&(this.isDebug=!0,console.log(`%c turn on debug for: row ${e} col ${t} isPlayer ${s}`,"font-size:12px;background-color: #9E9689;color:#fff;"));const{fieldManager:i}=this.scene,n=s?i.getPlayerPlacementSquare(e,t):i.getEnemyPlacementSquare(e,t);this.currentLocation&&this.currentLocation.setTaken(!1),this.setPosition(n.x,n.y),n.setTaken(!0),this.currentLocation=n,this.attackController.resetAttackSpots()}spawnUnitOnSquare(e,t,s){const{fieldManager:i}=this.scene,n=s?i.getPlayerPlacementSquare(e,t):i.getEnemyPlacementSquare(e,t);this.setPosition(n.x,n.y),n.setTaken(!0),this.currentLocation=n,this.attackController.resetAttackSpots()}swapUnitPosition(e){const t=e.currentLocation,s=this.currentLocation;e.setPosition(s.x,s.y),this.setPosition(t.x,t.y);const{unitManager:i}=this.scene;i.resetAttackSpots(this),i.resetAttackSpots(e),e.currentLocation=s,this.currentLocation=t}setDepthOnDrag(){this.setDepth(uS)}calcDepth(){if(this.isKilled())return;const e=this.depthController.calculateDepth();e&&this.depth!==e&&this.setDepth(e)}requestAttackPosition(e){return this.attackController.assignAttackingUnit(e)}getCurrentDisplay(){return this.display.getCurrentDisplay()}getSpineDisplay(){return this.display.getSpineDisplay()}reuseUnitOnReady(){this.setActive(!0),this.isDepthDirty=!0,this.assignUnitToSquare(this.currentLocation.rowId,this.currentLocation.colId,this.isPlayer),this.setDefaultHp(this.originalUnitData.health),this.uiController.updateCurrentHpUI(this.hp),this.actions.prepare(),this.setVisible(!0)}reuseUnitFromPool(e){this.setActive(!0),this.isDepthDirty=!0,this.isPlayer!==e&&(this.uiController.changeHpColor(e),this.isPlayer=e),this.uiController.reviveHpBar();const t=this.getSpineDisplay();e?this.startEventListener():this.removeEventListener(),this.setDefaultHp(this.originalUnitData.health),this.uiController.updateCurrentHpUI(this.hp),this.actions.prepare(),t&&t.setVisible(!0),this.setVisible(!0)}handleRemoveFromScene(){this.uiController.killHpBar(),this.attackController.resetAttackSpots(),this.effectController.stopDamageEffect(),this.effectController.stopDieEffect(),this.removeEventListener(),this.setStatus(le.KILLED),this.attackEvent?.remove(),this.currentLocation&&this.currentLocation.setTaken(!1);const e=this.getSpineDisplay();if(e){const{spineManager:t}=this.scene;t.removeSpine(this),e.setVisible(!1)}this.kill()}setStatus(e){this.status=e}getStatus(){return this.status}getWorldPosition(){return this.lastWorldPosition=super.getWorldPosition(),this.lastWorldPosition}setPosition(e,t,s,i){return super.setPosition(e,t,s,i),this}isInPrepareMode(){return this.status===le.PREPARE}isReady(){return this.status===le.READY}isMovingToTarget(){return this.status===le.MOVING_TO_TARGET}isPreparingToAttack(){return this.status===le.PREPARE_TO_ATTACK}isAttacking(){return this.status===le.ATTACKING}isKilled(){return this.status===le.KILLED}isFinishedAttacking(){return this.status===le.FINISHED_ATTACKING}update(e,t){this.isDepthDirty&&(this.calcDepth(),this.isDepthDirty=!1),this.scene.stateManager.isInPlayingState()&&this.uiController.update()}}const $=dS,{KEY:pS,FRAME:gS}=L.UNITS_SPRITES,{KEY:fS}=L.UNITS_SPINES.MELEE[1];class qt extends ${constructor(e,t){super(e,0,0,t,{level:100,id:"alien",name:"Warlock",health:1,damage:1,attackSpeed:1},{spine:{key:fS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},sprite:{key:pS,frame:gS.MELEE[1].MAIN_TEXTURE,displayWidth:86.5,displayHeight:68},useSpine:!0}),this.level=1,this.unitName="Alien Lv.100",this.attackPower=1,this.setDefaultHp(999999)}createActions(){throw new Error("Method not implemented.")}findTarget(){throw new Error("Method not implemented.")}}class jc{unit;dieCommand;moveCommand;readyCommand;attackCommand;prepareCommand;constructor(e){this.unit=e,this.addDieCommand(),this.addMoveCommand(),this.addReadyCommand(),this.addAttackCommand(),this.addPrepareCommand()}prepare(){this.prepareCommand.execute()}ready(){this.unit.isKilled()||this.readyCommand.execute()}move(){this.unit.isKilled()||this.moveCommand.execute()}attack(){this.unit.isKilled()||this.attackCommand.execute()}die(){this.unit.isKilled()||this.dieCommand.execute()}}class ES{unit;constructor(e){this.unit=e}}class ze extends ES{payload;constructor(e,t){super(e),this.payload=t}execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.display.play(e,t,!0,!0),this.unit.display.setAnimationTimeScale(.5+Math.random())}}let mS=class extends ze{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.display.play(e,t,!1),this.unit.display.setAnimationTimeScale(1),this.unit.display.addAnimEventListener(te.MELEE.CUSTOM_EVENTS.FINISHED_ATTACKING,this.handleAttacked),this.unit.scene.audio.playSound(X.MELEE_ATTACK,{volume:.5,detune:Math.random()*-1e3});const i=this.unit.attackController.getAttackTarget();i&&this.unit.display.setFlipX(i.x<=this.unit.x)}handleAttacked=()=>{if(this.unit.isKilled())return;const e=this.unit.attackController.getAttackTarget();if(e){if(e.isKilled()){this.unit.display.addAnimEventListener(Phaser.Animations.Events.ANIMATION_COMPLETE,this.handleFinishedAttacking);return}e.takeDamage(this.unit),e.attackController.notifyTargetAttacked(this.unit)}};handleFinishedAttacking=()=>{this.unit.setStatus(le.FINISHED_ATTACKING)}},AS=class extends ze{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.attackEvent?.remove(),this.unit.uiController.killHpBar(),this.unit.depthController.setDepthOnDeath(),this.unit.effectController.stopDamageEffect(),this.unit.display.play(e,t,!1,!0),this.unit.display.setAnimationTimeScale(1),this.unit.display.addAnimEventListener(Phaser.Animations.Events.ANIMATION_COMPLETE,this.handleAnimationComplete)}handleAnimationComplete=()=>{this.unit.effectController.runDieEffect()}};class SS extends ze{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload,i=this.unit.attackController.getAttackTarget();i&&(this.unit.isDepthDirty=!0,this.unit.getStatus()!==s&&(this.unit.setStatus(s),this.unit.display.play(e,t,!0),this.unit.display.setAnimationTimeScale(.5+Math.random())),this.unit.display.setFlipX(i.x<this.unit.x))}}let yS=class extends ze{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.revive(),this.unit.setStatus(s),this.unit.isDepthDirty=!0,this.unit.uiController.killHpBar(),this.unit.effectController.stopDieEffect(),this.unit.display.setFlipX(!1),this.unit.display.play(e,t,!0,!0),this.unit.display.setAnimationTimeScale(.5+Math.random()),this.unit.attackController.reset()}},TS=class extends ze{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.uiController.reviveHpBar(),this.unit.display.play(e,t,!0,!0),this.unit.display.setAnimationTimeScale(.5+Math.random())}};class IS extends jc{addAttackCommand(){this.attackCommand=new mS(this.unit,{status:le.ATTACKING,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("ATTACK"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("ATTACK")})}addReadyCommand(){this.readyCommand=new TS(this.unit,{status:le.READY,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("IDLE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("IDLE")})}addMoveCommand(){this.moveCommand=new SS(this.unit,{status:le.MOVING_TO_TARGET,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("RUN"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("RUN")})}addDieCommand(){this.dieCommand=new AS(this.unit,{status:le.KILLED,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("DIE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("DIE")})}addPrepareCommand(){this.prepareCommand=new yS(this.unit,{status:le.PREPARE,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("IDLE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("IDLE")})}getSpriteAnimKeyByUnitLevel(e){try{const{level:t}=this.unit;let s=t;//! lack of sprite of higher units level
return s>=2&&(s=1),ge.MELEE[s][e].KEY}catch(t){return console.warn(t),ge.ALIEN[1].IDLE.KEY}}getSpineAnimKeyByUnitLevel(e){const t=te.MELEE[e];if(!t)throw new Error(`Can't find spine animation ${e}`);return t}}const{modifier:CS}=GameCore.Configs.Gameplay.Powers.SpeedUp;class ve extends ${movementSpeed;savedApproachXOffset;savedApproachYOffset;constructor(e,t,s,i,n,r){super(e,t,s,i,n,r),this.unitType=F.MELEE_UNIT_TYPE,this.movementSpeed=F.MELEE_MOVEMENT_SPEED,this.attackInterval=F.MELEE_ATTACK_INTERVAL;const c=this.display.getSpineAnimationAttackingTime();this.attackInterval<c&&(this.attackInterval=c),this.savedApproachXOffset=null,this.savedApproachYOffset=null}createActions(){this.actions=new IS(this)}moveToAttackPosition(e){if(this.isKilled())return;const t=this.attackController.getAttackTarget();if(!t||t?.isKilled())return;const s=t.requestAttackPosition(this);s&&(this.isDepthDirty=!0,this.executeMovement(e,s.location))}executeMovement(e,t){const{x:s,y:i}=this,r=this.scene.powerManager.isGameSpeedUp()?this.movementSpeed*CS:this.movementSpeed,c=r/1e3*e,o=Phaser.Math.Distance.Between(s,i,t.x,t.y),l=t.x-s,h=t.y-i,d=l!==0?l/o*r/1e3*e:0,u=h!==0?h/o*r/1e3*e:0;if(Phaser.Math.Distance.Between(s+d,i+u,t.x,t.y)<=c){this.setPosition(s+d,i+u),this.setStatus(le.PREPARE_TO_ATTACK),this.attackController.moveAttackSpotMelee(t.x-s,t.y-i);return}this.display.setFlipX(d<0),this.setPosition(s+d,i+u),this.attackController.moveAttackSpotMelee(d,u)}moveToTarget(e){this.moveToAttackPosition(e)}determineCounteringEnemy(){const{beingAttackedByMelee:e,beingAttackedByRanged:t}=this.attackController;let s=this.attackController.getAttackTarget();if(s?.isKilled()&&(s=null),e&&!e.isKilled())return this.attackController.setAttackTarget(e),s?.attackController.resetAttackSpotOfUnit(this),!0;if(t&&!t.isKilled()){const i=Phaser.Math.Distance.Between(this.x,this.y,t.x,t.y),n=s?Phaser.Math.Distance.Between(this.x,this.y,s.x,s.y):1e4;if(i<n)return this.attackController.setAttackTarget(t),s?.attackController.resetAttackSpotOfUnit(this),!0}return!1}setUnitData(e){super.setUnitData(e),this.unitType=F.MELEE_UNIT_TYPE}update(e,t){if(super.update(e,t),this.isKilled()||!this.scene.stateManager.isInPlayingState())return;const s=this.attackController.getAttackTarget();if(this.isReady()){(!s||s.isKilled())&&this.findTarget(),s&&this.actions.move();return}if(this.isMovingToTarget()){const i=this.determineCounteringEnemy();if(this.moveToTarget(t),i)return;if(s?.isKilled()){this.attackController.resetAttackTarget(),this.actions.ready();return}return}if(this.isPreparingToAttack()){if(s?.isKilled()){this.actions.ready();return}this.attack();return}this.isFinishedAttacking()&&(this.savedApproachXOffset=null,this.savedApproachYOffset=null,this.actions.ready())}}const{KEY:RS}=L.UNITS_SPINES.MELEE[10],{listLevelsUseSprite:_S}=GameCore.Configs.UnitsConfig.MELEE;class Ma extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:RS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},useSpine:!_S.includes(s.level)})}}const{KEY:vS}=L.UNITS_SPINES.MELEE[11],{listLevelsUseSprite:wS}=GameCore.Configs.UnitsConfig.MELEE;class ka extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:vS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},useSpine:!wS.includes(s.level)})}}const{KEY:LS,FRAME:bS}=L.UNITS_SPRITES,{KEY:PS}=L.UNITS_SPINES.MELEE[1],{listLevelsUseSprite:OS}=GameCore.Configs.UnitsConfig.MELEE;class Ua extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:PS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},sprite:{key:LS,frame:bS.MELEE[1].MAIN_TEXTURE,displayWidth:86.5,displayHeight:68},useSpine:!OS.includes(s.level)})}}const{KEY:DS}=L.UNITS_SPINES.MELEE[2],{listLevelsUseSprite:NS}=GameCore.Configs.UnitsConfig.MELEE;class xa extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:DS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},useSpine:!NS.includes(s.level)}),this.updatePositionHpBar()}}const{KEY:MS}=L.UNITS_SPINES.MELEE[3],{listLevelsUseSprite:kS}=GameCore.Configs.UnitsConfig.MELEE;class Ba extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:MS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},useSpine:!kS.includes(s.level)}),this.updatePositionHpBar()}}const{KEY:US}=L.UNITS_SPINES.MELEE[4],{listLevelsUseSprite:xS}=GameCore.Configs.UnitsConfig.MELEE;class Fa extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:US,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},useSpine:!xS.includes(s.level)}),this.updatePositionHpBar()}}const{KEY:BS}=L.UNITS_SPINES.MELEE[5],{listLevelsUseSprite:FS}=GameCore.Configs.UnitsConfig.MELEE;class Ga extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:BS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},useSpine:!FS.includes(s.level)}),this.updatePositionHpBar()}}const{KEY:GS}=L.UNITS_SPINES.MELEE[6],{listLevelsUseSprite:HS}=GameCore.Configs.UnitsConfig.MELEE;class Ha extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:GS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},useSpine:!HS.includes(s.level)}),this.updatePositionHpBar()}}const{KEY:YS}=L.UNITS_SPINES.MELEE[7],{listLevelsUseSprite:KS}=GameCore.Configs.UnitsConfig.MELEE;class Ya extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:YS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},useSpine:!KS.includes(s.level)})}}const{KEY:VS}=L.UNITS_SPINES.MELEE[8],{listLevelsUseSprite:WS}=GameCore.Configs.UnitsConfig.MELEE;class Ka extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:VS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},useSpine:!WS.includes(s.level)})}}const{KEY:jS}=L.UNITS_SPINES.MELEE[9],{listLevelsUseSprite:$S}=GameCore.Configs.UnitsConfig.MELEE;class Va extends ve{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:jS,spineConfig:{animation:te.MELEE.IDLE,loop:!0}},useSpine:!$S.includes(s.level)})}}class $c{scene;numOfPlayerSpawnedUnits;resourcePool;constructor(e){this.scene=e,this.resourcePool=new Phaser.GameObjects.Group(this.scene,{runChildUpdate:!1})}init(){this.numOfPlayerSpawnedUnits=0}returnToPool(e){this.resourcePool.add(e)}getPlayerSpawnedUnitsCount(){return this.numOfPlayerSpawnedUnits}setSpawnedUnits(e){this.numOfPlayerSpawnedUnits=e}}class zS extends $c{requestUnitByLevel(e,t,s=!1){let i=this.getUnitFromResourcePoolByLevel(e);return i?(t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,e-1)),i.reuseUnitFromPool(t),this.scene.add.existing(i),i):(i=this.createUnitByLevel(e,t,s),i)}requestUnitById(e,t,s=!1){let i=this.getUnitFromResourcePoolById(e);return i?(t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,i.level-1)),i.reuseUnitFromPool(t),this.scene.add.existing(i),i):(i=this.createUnitById(e,t,s),i)}createUnitByLevel(e,t,s=!1){let i;const n=this.getUnitDataByLevel(e);switch(n||this.scene.rollbar.sendException(new Error(`No unit data found for melee level ${e}`)),e){case 1:i=new Ua(this.scene,t,n);break;case 2:i=new xa(this.scene,t,n);break;case 3:i=new Ba(this.scene,t,n);break;case 4:i=new Fa(this.scene,t,n);break;case 5:i=new Ga(this.scene,t,n);break;case 6:i=new Ha(this.scene,t,n);break;case 7:i=new Ya(this.scene,t,n);break;case 8:i=new Ka(this.scene,t,n);break;case 9:i=new Va(this.scene,t,n);break;case 10:i=new Ma(this.scene,t,n);break;case 11:i=new ka(this.scene,t,n);break;default:return new qt(this.scene,t)}return t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,e-1)),i}createUnitById(e,t,s=!1){let i;const n=this.getUnitDataById(e);if(!n)return new qt(this.scene,t);switch(e){case"velociraptor":i=new Ua(this.scene,t,n);break;case"saurolophus":i=new xa(this.scene,t,n);break;case"pachysaurus":i=new Ba(this.scene,t,n);break;case"triceratops":i=new Fa(this.scene,t,n);break;case"stegosaurus":i=new Ga(this.scene,t,n);break;case"ankylosaurus":i=new Ha(this.scene,t,n);break;case"baroptiloraptor":i=new Ya(this.scene,t,n);break;case"tyrannosaurus":i=new Ka(this.scene,t,n);break;case"dilophosaurus":i=new Va(this.scene,t,n);break;case"triceradonosaurus":i=new Ma(this.scene,t,n);break;case"spinosaurus-rex":i=new ka(this.scene,t,n);break;default:return new qt(this.scene,t)}return t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,n.level-1)),i}getUnitDataByLevel(e){return this.scene.cache.json.get("unitData").melee[e-1]}getUnitDataById(e){return this.scene.cache.json.get("unitData").melee.find(s=>s.id===e)}getUnitFromResourcePoolByLevel(e){const s=this.resourcePool.getChildren().find(i=>i instanceof ve?i.level===e:!1);if(s instanceof $)return this.resourcePool.remove(s),s}getUnitFromResourcePoolById(e){const s=this.resourcePool.getChildren().find(i=>{if(!(i instanceof ve))return!1;const{originalUnitData:n}=i;return n.id===e});if(s instanceof $)return this.resourcePool.remove(s),s}}const{KEY:XS,FRAME:qS}=L.GAMEPLAY,{modifier:ZS}=GameCore.Configs.Gameplay.Powers.SpeedUp;class Ue extends Phaser.GameObjects.Sprite{scene;target;attacker;speed;heightOffset;upwardDirectionOffset;downwardDirectionOffset;constructor(e,t){const{attacker:s,target:i,speed:n,frame:r}=t,c=r||qS.BLANK;super(e,s.x,s.y,XS,c),this.setDisplaySize(5,5),this.scene=e,this.speed=n||F.RANGED_PROJECTILE_SPEED,this.target=i,this.attacker=s,this.heightOffset=0;const o=this.target.display;o instanceof Phaser.GameObjects.Sprite||(this.heightOffset=o.displayHeight*.4),this.rotation=Phaser.Math.Angle.Between(this.x,this.y,i.x,i.y-this.heightOffset);const{depthController:l}=this.attacker;this.setDepth(l.getProjectileDepth()),this.scene.add.existing(this)}update(e,t){const i=this.scene.powerManager.isGameSpeedUp()?this.speed*ZS:this.speed,n=i/1e3*t,r=Phaser.Math.Distance.Between(this.x,this.y,this.target.x,this.target.y-this.heightOffset);if(r<n){this.target.takeDamage(this.attacker),this.scene.unitManager.rangedProjectiles.remove(this,!0);return}const c=this.target.x-this.x,o=this.target.y-this.heightOffset-this.y,l=c/r*i/1e3*t,h=o/r*i/1e3*t;this.setPosition(this.x+l,this.y+h)}}const{FRAME:QS}=L.GAMEPLAY,{UNIT_SIZE_SCALE:JS}=F;class ey extends Ue{constructor(e,t){t.frame=QS.ROCK,super(e,t),this.setOrigin(.5,.5);const s=JS;this.setDisplaySize(7.5*s,6.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(0,-10),this.downwardDirectionOffset=new Phaser.Math.Vector2(0,-10);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.setPosition(this.attacker.x+i,this.attacker.y+n)}}const{FRAME:ty}=L.GAMEPLAY,{UNIT_SIZE_SCALE:sy}=F;class iy extends Ue{constructor(e,t){t.frame=ty.JAVELIN,super(e,t),this.setOrigin(1,.5);const s=sy;this.setDisplaySize(67*s,3.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(0,-20),this.downwardDirectionOffset=new Phaser.Math.Vector2(10,0);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,c=this.attacker.y+n;this.rotation=Phaser.Math.Angle.Between(r,c,this.target.x,this.target.y-this.heightOffset);const o=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+o,c+l)}}const{FRAME:ny}=L.GAMEPLAY,{UNIT_SIZE_SCALE:ay}=F;class ry extends Ue{isGoToLeft;constructor(e,t){t.frame=ny.BOOMERANG,super(e,t),this.setOrigin(.5,.5);const s=ay;this.setDisplaySize(12*s,27.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(0,-20),this.downwardDirectionOffset=new Phaser.Math.Vector2(0,-20);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.setPosition(this.attacker.x+i,this.attacker.y+n),this.isGoToLeft=this.attacker.display.isFaceLeft()}update(e,t){this.isGoToLeft?this.angle-=t*1.5:this.angle+=t*1.5,super.update(e,t)}}const{FRAME:oy}=L.GAMEPLAY,{UNIT_SIZE_SCALE:cy}=F;class ly extends Ue{isGoToLeft;constructor(e,t){t.frame=oy.MACE,super(e,t),this.setOrigin(.4,.4);const s=cy;this.setDisplaySize(36.5*s,14.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(20,-40),this.downwardDirectionOffset=new Phaser.Math.Vector2(10,0);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i),this.setPosition(this.attacker.x+i,this.attacker.y+n),this.isGoToLeft=this.attacker.display.isFaceLeft()}update(e,t){this.isGoToLeft?this.angle-=t*.9:this.angle+=t*.9,super.update(e,t)}}const{FRAME:hy}=L.GAMEPLAY,{UNIT_SIZE_SCALE:uy}=F;class dy extends Ue{constructor(e,t){t.frame=hy.ARROW_1,super(e,t),this.setOrigin(1,.5);const s=uy;this.setDisplaySize(38.5*s,10*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(5,-10),this.downwardDirectionOffset=new Phaser.Math.Vector2(5,-8);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,c=this.attacker.y+n;this.rotation=Phaser.Math.Angle.Between(r,c,this.target.x,this.target.y-this.heightOffset);const o=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+o,c+l)}}const{FRAME:py}=L.GAMEPLAY,{UNIT_SIZE_SCALE:gy}=F;class fy extends Ue{constructor(e,t){t.frame=py.ARROW_2,super(e,t),this.setOrigin(1,.5);const s=gy;this.setDisplaySize(37*s,11*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(15,-15),this.downwardDirectionOffset=new Phaser.Math.Vector2(15,-15);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,c=this.attacker.y+n;this.rotation=Phaser.Math.Angle.Between(r,c,this.target.x,this.target.y-this.heightOffset);const o=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+o,c+l)}}const{FRAME:Ey}=L.GAMEPLAY,{UNIT_SIZE_SCALE:my}=F;class Ay extends Ue{constructor(e,t){t.frame=Ey.BOLT_1,super(e,t),this.setOrigin(1,.5);const s=my;this.setDisplaySize(38*s,6*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(20,-30),this.downwardDirectionOffset=new Phaser.Math.Vector2(20,12);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,c=this.attacker.y+n;this.rotation=Phaser.Math.Angle.Between(r,c,this.target.x,this.target.y-this.heightOffset);const o=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+o,c+l)}}const{FRAME:Sy}=L.GAMEPLAY,{UNIT_SIZE_SCALE:yy}=F;class Ty extends Ue{constructor(e,t){t.frame=Sy.BOLT_2,super(e,t),this.setOrigin(1,.5);const s=yy;this.setDisplaySize(46*s,9.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(20,-40),this.downwardDirectionOffset=new Phaser.Math.Vector2(20,10);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,c=this.attacker.y+n;this.rotation=Phaser.Math.Angle.Between(r,c,this.target.x,this.target.y-this.heightOffset);const o=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+o,c+l)}}const{FRAME:Iy}=L.GAMEPLAY,{UNIT_SIZE_SCALE:Cy}=F;class Ry extends Ue{isGoToLeft;constructor(e,t){t.frame=Iy.FIRE_RING,super(e,t),this.setOrigin(.5,.5);const s=Cy;this.setDisplaySize(34.5*s,36*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(20,-40),this.downwardDirectionOffset=new Phaser.Math.Vector2(20,0);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i),this.setPosition(this.attacker.x+i,this.attacker.y+n),this.isGoToLeft=this.attacker.display.isFaceLeft()}update(e,t){this.isGoToLeft?this.angle-=t*.9:this.angle+=t*.9,super.update(e,t)}}const{FRAME:_y}=L.GAMEPLAY,{UNIT_SIZE_SCALE:vy}=F;class wy extends Ue{constructor(e,t){t.frame=_y.BLUE_FIRE,super(e,t),this.setOrigin(1,.5);const s=vy;this.setDisplaySize(70.5*s,33.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(40,-60),this.downwardDirectionOffset=new Phaser.Math.Vector2(50,35);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,c=this.attacker.y+n;this.rotation=Phaser.Math.Angle.Between(r,c,this.target.x,this.target.y-this.heightOffset);const o=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+o,c+l)}}const{FRAME:Ly}=L.GAMEPLAY,{UNIT_SIZE_SCALE:by}=F;class Py extends Ue{constructor(e,t){t.frame=Ly.GREEN_FIRE,super(e,t),this.setOrigin(1,.5);const s=by;this.setDisplaySize(50*s,50*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(30,-70),this.downwardDirectionOffset=new Phaser.Math.Vector2(40,0);let i=this.downwardDirectionOffset.x,n=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,n=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i),this.setPosition(this.attacker.x+i,this.attacker.y+n);const{animationManager:r}=this.scene;r.addLevel11ProjectileAnimation(),this.play(Qs.GREEN_FIRE.KEY,!0)}}class Oy{unit;scene;constructor(e){this.unit=e,this.scene=e.scene}createProjectile(e){const{level:t,speed:s,target:i}=e,n={attacker:this.unit,target:i,speed:s};let r;switch(t){case 1:r=new ey(this.unit.scene,n);break;case 2:r=new iy(this.unit.scene,n);break;case 3:r=new ry(this.unit.scene,n);break;case 4:r=new ly(this.unit.scene,n);break;case 5:r=new dy(this.unit.scene,n);break;case 6:r=new fy(this.unit.scene,n);break;case 7:r=new Ay(this.unit.scene,n);break;case 8:r=new Ty(this.unit.scene,n);break;case 9:r=new Ry(this.unit.scene,n);break;case 10:r=new wy(this.unit.scene,n);break;case 11:r=new Py(this.unit.scene,n);break;default:r=new Ue(this.unit.scene,n)}const{unitManager:c}=this.scene;c.rangedProjectiles.add(r)}}class Dy extends ze{unit;spriteBelowAnimKey;spineBelowAnimKey;constructor(e,t){super(e,{spineAnimKey:t.spineAboveAnimKey,spriteAnimKey:t.spriteAboveAnimKey,status:t.status}),this.spriteBelowAnimKey=t.spriteBelowAnimKey,this.spineBelowAnimKey=t.spineBelowAnimKey,this.unit=e}execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload,i=this.unit.attackController.getAttackTarget();if(!i){this.unit.setStatus(le.FINISHED_ATTACKING);return}this.unit.setStatus(s),this.unit.display.setAnimationTimeScale(1),this.unit.y>i.y?this.unit.display.play(this.spriteBelowAnimKey,this.spineBelowAnimKey,!1):this.unit.display.play(e,t,!1),this.unit.display.addAnimEventListener(te.RANGED.CUSTOM_EVENTS.FINISHED_ATTACKING,this.handleAttacked),this.unit.display.setFlipX(i.x<=this.unit.x)}handleAttacked=()=>{if(this.unit.isKilled())return;const e=this.unit.attackController.getAttackTarget();e&&(e.isKilled()&&this.unit.display.addAnimEventListener(Phaser.Animations.Events.ANIMATION_COMPLETE,this.handleFinishedAttacking),this.unit.projectileController.createProjectile({level:this.unit.level,target:e}),this.unit.scene.audio.playSound(X.ARROW_SHOOT,{volume:.5,detune:Math.random()*-1e3}))};handleFinishedAttacking=()=>{this.unit.setStatus(le.FINISHED_ATTACKING)}}class Ny extends ze{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.attackEvent?.remove(),this.unit.uiController.killHpBar(),this.unit.depthController.setDepthOnDeath(),this.unit.effectController.stopDamageEffect(),this.unit.display.setAnimationTimeScale(1),this.unit.display.play(e,t,!1,!0),this.unit.display.addAnimEventListener(Phaser.Animations.Events.ANIMATION_COMPLETE,this.handleAnimationComplete)}handleAnimationComplete=()=>{this.unit.effectController.runDieEffect()}}class My extends ze{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.revive(),this.unit.setStatus(s),this.unit.isDepthDirty=!0,this.unit.uiController.killHpBar(),this.unit.effectController.stopDieEffect(),this.unit.display.setFlipX(!1),this.unit.display.play(e,t,!0,!0),this.unit.display.setAnimationTimeScale(.5+Math.random()),this.unit.attackController.reset()}}class ky extends ze{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.uiController.reviveHpBar(),this.unit.display.play(e,t,!0,!0),this.unit.display.setAnimationTimeScale(.5+Math.random())}}class Wa extends jc{unit;constructor(e){super(e),this.unit=e}addAttackCommand(){this.attackCommand=new Dy(this.unit,{status:le.ATTACKING,spriteAboveAnimKey:this.getSpriteAnimKeyByUnitLevel("ATTACK_ABOVE"),spriteBelowAnimKey:this.getSpriteAnimKeyByUnitLevel("ATTACK_BELOW"),spineAboveAnimKey:this.getSpineAnimKeyByUnitLevel("ATTACK_ABOVE"),spineBelowAnimKey:this.getSpineAnimKeyByUnitLevel("ATTACK_BELOW")})}addReadyCommand(){this.readyCommand=new ky(this.unit,{status:le.READY,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("IDLE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("IDLE")})}addMoveCommand(){this.moveCommand=new ze(this.unit,{status:le.MOVING_TO_TARGET,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("IDLE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("IDLE")})}addDieCommand(){this.dieCommand=new Ny(this.unit,{status:le.KILLED,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("DIE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("DIE")})}addPrepareCommand(){this.prepareCommand=new My(this.unit,{status:le.PREPARE,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("IDLE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("IDLE")})}resetRangedAttackAnimation(){this.addAttackCommand()}getSpriteAnimKeyByUnitLevel(e){try{const{level:t}=this.unit;let s=t;//! lack of sprite of higher units level
return s>=2&&(s=1),ge.RANGED[s][e].KEY}catch(t){return console.warn(t),ge.ALIEN[1].IDLE.KEY}}getSpineAnimKeyByUnitLevel(e){const t=te.RANGED[e];if(!t)throw new Error(`Can't find spine animation ${e}`);return t}}const{FINISHED_ATTACKING:Uy}=te.RANGED.CUSTOM_EVENTS;class we extends ${projectileColor;projectileSpeed;projectileController;constructor(e,t,s,i,n,r){super(e,t,s,i,n,r),this.projectileController=new Oy(this),this.unitType=F.RANGED_UNIT_TYPE,this.attackInterval=F.RANGED_ATTACK_INTERVAL;const c=this.display.getSpineAnimationAttackingTime();this.attackInterval<c&&(this.attackInterval=c),this.projectileSpeed=F.RANGED_PROJECTILE_SPEED}createActions(){this.actions=new Wa(this)}determineCounteringEnemy(){const{beingAttackedByMelee:e,beingAttackedByRanged:t}=this.attackController;let s=this.attackController.getAttackTarget();return s?.isKilled()&&(s=null),e&&!e.isKilled()?(this.attackController.setAttackTarget(e),!0):t&&!t.isKilled()?(this.attackController.setAttackTarget(t),!0):!1}setUnitData(e){super.setUnitData(e),this.unitType=F.RANGED_UNIT_TYPE}update(e,t){if(super.update(e,t),this.isKilled()||!this.scene.stateManager.isInPlayingState())return;const s=this.attackController.getAttackTarget();if(this.isReady()){!this.determineCounteringEnemy()&&(!s||s.isKilled())&&this.findTarget(),s&&this.setStatus(le.PREPARE_TO_ATTACK);return}if(this.isPreparingToAttack()){if(s?.isKilled()){this.actions.ready();return}this.attack();return}this.isAttacking()&&s?.isKilled()&&this.display.getAnimationTimeScale()!==3&&(this.display.setAnimationTimeScale(3),this.display.changeCurrentSpriteEventTime(Uy)),this.isFinishedAttacking()&&this.actions.ready()}reuseUnitFromPool(e){super.reuseUnitFromPool(e);const t=this.actions;t instanceof Wa&&t.resetRangedAttackAnimation()}}const{KEY:xy}=L.UNITS_SPINES.RANGED[10],{listLevelsUseSprite:By}=GameCore.Configs.UnitsConfig.RANGED;class ja extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:xy,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},useSpine:!By.includes(s.level)})}}const{KEY:Fy}=L.UNITS_SPINES.RANGED[11],{listLevelsUseSprite:Gy}=GameCore.Configs.UnitsConfig.RANGED;class $a extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:Fy,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},useSpine:!Gy.includes(s.level)})}}const{KEY:Hy,FRAME:Yy}=L.UNITS_SPRITES,{KEY:Ky}=L.UNITS_SPINES.RANGED[1],{listLevelsUseSprite:Vy}=GameCore.Configs.UnitsConfig.RANGED;class za extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:Ky,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},sprite:{key:Hy,frame:Yy.RANGED[1].MAIN_TEXTURE,displayWidth:55,displayHeight:73},useSpine:!Vy.includes(s.level)})}}const{KEY:Wy}=L.UNITS_SPINES.RANGED[2],{listLevelsUseSprite:jy}=GameCore.Configs.UnitsConfig.RANGED;class Xa extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:Wy,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},useSpine:!jy.includes(s.level)})}}const{KEY:$y}=L.UNITS_SPINES.RANGED[3],{listLevelsUseSprite:zy}=GameCore.Configs.UnitsConfig.RANGED;class qa extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:$y,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},useSpine:!zy.includes(s.level)})}}const{KEY:Xy}=L.UNITS_SPINES.RANGED[4],{listLevelsUseSprite:qy}=GameCore.Configs.UnitsConfig.RANGED;class Za extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:Xy,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},useSpine:!qy.includes(s.level)})}}const{KEY:Zy}=L.UNITS_SPINES.RANGED[5],{listLevelsUseSprite:Qy}=GameCore.Configs.UnitsConfig.RANGED;class Qa extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:Zy,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},useSpine:!Qy.includes(s.level)})}}const{KEY:Jy}=L.UNITS_SPINES.RANGED[6],{listLevelsUseSprite:eT}=GameCore.Configs.UnitsConfig.RANGED;class Ja extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:Jy,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},useSpine:!eT.includes(s.level)})}}const{KEY:tT}=L.UNITS_SPINES.RANGED[7],{listLevelsUseSprite:sT}=GameCore.Configs.UnitsConfig.RANGED;class er extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:tT,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},useSpine:!sT.includes(s.level)})}}const{KEY:iT}=L.UNITS_SPINES.RANGED[8],{listLevelsUseSprite:nT}=GameCore.Configs.UnitsConfig.RANGED;class tr extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:iT,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},useSpine:!nT.includes(s.level)})}}const{KEY:aT}=L.UNITS_SPINES.RANGED[9],{listLevelsUseSprite:rT}=GameCore.Configs.UnitsConfig.RANGED;class sr extends we{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:aT,spineConfig:{animation:te.RANGED.IDLE,loop:!0}},useSpine:!rT.includes(s.level)})}}class oT extends $c{requestUnitByLevel(e,t,s=!1){let i=this.getUnitFromResourcePoolByLevel(e);return i?(t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,e-1)),i.reuseUnitFromPool(t),this.scene.add.existing(i),i):(i=this.createUnitByLevel(e,t,s),i)}requestUnitById(e,t,s=!1){let i=this.getUnitFromResourcePoolById(e);return i?(t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,i.level-1)),i.reuseUnitFromPool(t),this.scene.add.existing(i),i):(i=this.createUnitById(e,t,s),i)}createUnitByLevel(e,t,s=!1){let i;const n=this.getUnitDataByLevel(e);switch(n||this.scene.rollbar.sendException(new Error(`No unit data found for ranged level ${e}`)),e){case 1:i=new za(this.scene,t,n);break;case 2:i=new Xa(this.scene,t,n);break;case 3:i=new qa(this.scene,t,n);break;case 4:i=new Za(this.scene,t,n);break;case 5:i=new Qa(this.scene,t,n);break;case 6:i=new Ja(this.scene,t,n);break;case 7:i=new er(this.scene,t,n);break;case 8:i=new tr(this.scene,t,n);break;case 9:i=new sr(this.scene,t,n);break;case 10:i=new ja(this.scene,t,n);break;case 11:i=new $a(this.scene,t,n);break;default:return new qt(this.scene,t)}return t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,e-1)),i}createUnitById(e,t,s=!1){let i;const n=this.getUnitDataById(e);if(!n)return new qt(this.scene,t);switch(e){case"rockthrower":i=new za(this.scene,t,n);break;case"javelineer":i=new Xa(this.scene,t,n);break;case"boomeranger":i=new qa(this.scene,t,n);break;case"macer":i=new Za(this.scene,t,n);break;case"artemis":i=new Qa(this.scene,t,n);break;case"william":i=new Ja(this.scene,t,n);break;case"blanchette":i=new er(this.scene,t,n);break;case"phantom":i=new tr(this.scene,t,n);break;case"oracle":i=new sr(this.scene,t,n);break;case"shaman":i=new ja(this.scene,t,n);break;case"seraph":i=new $a(this.scene,t,n);break;default:return new qt(this.scene,t)}return t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,n.level-1)),i}getUnitDataByLevel(e){return this.scene.cache.json.get("unitData").ranged[e-1]}getUnitDataById(e){return this.scene.cache.json.get("unitData").ranged.find(s=>s.id===e)}getUnitFromResourcePoolByLevel(e){const s=this.resourcePool.getChildren().find(i=>i instanceof we?i.level===e:!1);if(s instanceof $)return this.resourcePool.remove(s),s}getUnitFromResourcePoolById(e){const s=this.resourcePool.getChildren().find(i=>{if(!(i instanceof we))return!1;const{originalUnitData:n}=i;return n.id===e});if(s instanceof $)return this.resourcePool.remove(s),s}}const{STATUS:ir}=mt,{MELEE_UNIT_TYPE:Ne,RANGED_UNIT_TYPE:We,ALIEN_UNIT_TYPE:nr}=F,{MaximumMeleeLevel:Di,MaximumRangedLevel:Ni}=GameCore.Configs.Gameplay,{MELEE_UNLOCKED:cT,RANGED_UNLOCKED:lT,PLAYER_UNIT_DATA:hT}=ye,{modifier:ar}=GameCore.Configs.Gameplay.Powers.SpeedUp;class uT extends Te{scene;meleeSpawnPool;rangedSpawnPool;playerUnits;enemyUnits;rangedProjectiles;latestUnitMergePayload;constructor(e){super(e),this.scene=e,this.createFactories(),this.createUnitGroups()}init(){super.init(),this.initSpawnPools(),this.emptyEnemyUnits(),this.emptyPlayerUnits(),this.emptyProjectiles()}start(){this.isRunning()||(this.createEnemyUnits(),this.createPlayerUnitsNormal(),this.calculatePlayerTotalUnitsUsed(),this.setState(ir.RUNNING))}stop(){this.isRunning()&&(this.stopDieEffectOfAllUnits(),this.setReadyAllUnits(),this.removeAttackEventsOfAllUnits(),this.hideAllUnits(),this.disableDragOnPlayerUnits(),this.runChildUpdateGroups(!1),this.setState(ir.STOPPED))}createFactories(){this.meleeSpawnPool=new zS(this.scene),this.rangedSpawnPool=new oT(this.scene)}createUnitGroups(){this.enemyUnits=this.scene.add.group(),this.playerUnits=this.scene.add.group(),this.rangedProjectiles=this.scene.add.group()}runChildUpdateGroups(e){this.enemyUnits.runChildUpdate=e,this.playerUnits.runChildUpdate=e,this.rangedProjectiles.runChildUpdate=e}initSpawnPools(){this.meleeSpawnPool.init(),this.rangedSpawnPool.init()}emptyEnemyUnits(){this.enemyUnits.getChildren().forEach(t=>{if(!(t instanceof $))return;t.handleRemoveFromScene();const{unitType:s}=t;s===Ne&&this.meleeSpawnPool.returnToPool(t),s===We&&this.rangedSpawnPool.returnToPool(t)}),this.enemyUnits.clear(!0,!1)}emptyPlayerUnits(){this.playerUnits.getChildren().forEach(t=>{if(!(t instanceof $))return;t.handleRemoveFromScene();const{unitType:s}=t;s===Ne&&this.meleeSpawnPool.returnToPool(t),s===We&&this.rangedSpawnPool.returnToPool(t)}),this.playerUnits.clear(!0,!1)}emptyProjectiles(){this.rangedProjectiles.clear(!0,!0)}getPlayerUnits(){return this.playerUnits.getChildren()}getEnemyUnits(){return this.enemyUnits.getChildren()}getTotalPlayerUnitsHp(){let e=0;return this.playerUnits.getChildren().forEach(t=>{t instanceof $&&(e+=t.currentHp)}),e}getTotalEnemyUnitsHp(){let e=0;return this.enemyUnits.getChildren().forEach(t=>{t instanceof $&&(e+=t.currentHp)}),e}getPlayerMeleeSpawnedUnitsCount(){return this.meleeSpawnPool.getPlayerSpawnedUnitsCount()}getPlayerRangedSpawnedUnitsCount(){return this.rangedSpawnPool.getPlayerSpawnedUnitsCount()}createPlayerArcher(e,t,s=1){if(!this.isRunning())return;const{fieldManager:i,spineManager:n}=this.scene,r=i.getRemainingAvailablePlacement()===1,c=this.checkIfBoardCanBeMerged(),o=this.getLowestLevelPlayerRangedUnit(),l=r&&!c&&o>s?o:s,h=this.createUnit({level:l,isPlayer:!0,unitType:We});h.spawnUnitOnSquare(e,t,!0),n.addSpines([h]),this.resetAttackSpots(h),this.playerUnits.add(h)}createPlayerMelee(e,t,s=1){if(!this.isRunning())return;const{fieldManager:i,spineManager:n}=this.scene,r=i.getRemainingAvailablePlacement()===1,c=this.checkIfBoardCanBeMerged(),o=this.getLowestLevelPlayerMeleeUnit(),l=r&&!c&&o>s?o:s,h=this.createUnit({level:l,isPlayer:!0,unitType:Ne});h.spawnUnitOnSquare(e,t,!0),n.addSpines([h]),this.resetAttackSpots(h),this.playerUnits.add(h)}createEnemyUnits(){const{levelManager:e}=this.scene;e.enemyData.forEach(s=>{const i=this.createUnit({level:s.level,isPlayer:!1,unitType:s.type==="melee"?Ne:We});i.spawnUnitOnSquare(s.positionRow,s.positionColumn,!1),i.actions.prepare(),this.resetAttackSpots(i),this.enemyUnits.add(i)})}createPlayerUnitsNormal(){this.playerUnits.getLength()===0?this.loadPlayerUnits():this.reusePlayerUnits();const{uiManager:e}=this.scene;this.playerUnits.getLength()>0&&e.enableStartButton()}stopDieEffectOfAllUnits(){this.enemyUnits.getChildren().forEach(e=>{e instanceof $&&e.effectController.stopDieEffect()}),this.playerUnits.getChildren().forEach(e=>{e instanceof $&&e.effectController.stopDieEffect()})}setReadyAllUnits(){const e=this.playerUnits.getChildren();e.sort((s,i)=>{if(!(s instanceof $)||!(i instanceof $))throw new fe;const{currentLocation:{rowId:n,colId:r}}=s,{currentLocation:{rowId:c,colId:o}}=i;return n===c?r-o:n-c}),e.forEach(s=>{if(!(s instanceof $))throw new fe;s.isDepthDirty=!0,s.actions.ready()});const t=this.enemyUnits.getChildren();t.sort((s,i)=>{if(!(s instanceof $)||!(i instanceof $))throw new fe;const{currentLocation:{rowId:n,colId:r}}=s,{currentLocation:{rowId:c,colId:o}}=i;return n===c?r-o:c-n}),t.forEach(s=>{if(!(s instanceof $))throw new fe;s.isDepthDirty=!0,s.actions.ready()})}removeAttackEventsOfAllUnits(){this.enemyUnits.getChildren().forEach(e=>{e instanceof $&&e.attackEvent?.remove()}),this.playerUnits.getChildren().forEach(e=>{e instanceof $&&e.attackEvent?.remove()})}getUnitBasedOnPosition(e,t){let s=null;return this.playerUnits.getChildren().forEach(i=>{if(!(i instanceof $))throw new fe;i.currentLocation.rowId===e&&i.currentLocation.colId===t&&(s=i)}),s}mergeUnits(e,t){const{effectManger:s}=this.scene,i=e.level+1,n=e.unitType,r=t.currentLocation;if(i>(n===Ne?Di:Ni))return!1;const o=this.createUnit({level:i,unitType:n,isPlayer:!0,isMerged:!0});if(!o)return this.scene.rollbar.sendException(new Error("newUnit is null")),!1;s.playMergeEffect(t),Et(50),e.handleRemoveFromScene(),t.handleRemoveFromScene(),n===Ne&&(this.meleeSpawnPool.returnToPool(e),this.meleeSpawnPool.returnToPool(t),this.playerUnits.remove(e,!0,!1),this.playerUnits.remove(t,!0,!1)),n===We&&(this.rangedSpawnPool.returnToPool(e),this.rangedSpawnPool.returnToPool(t),this.playerUnits.remove(e,!0,!1),this.playerUnits.remove(t,!0,!1)),this.latestUnitMergePayload={type:n,level:i},o.spawnUnitOnSquare(r.rowId,r.colId,!0),this.playerUnits.add(o),this.resetAttackSpots(o);const{uiManager:l,screenManager:h,spineManager:d}=this.scene;return d.addSpines([o]),l.updateUIData(),this.savePlayerUnits(),this.checkIfNewUnitIsUnlocked(i,n)&&(this.disableDragOnPlayerUnits(),this.scene.time.delayedCall(400,h.showUnitUnlockScreen)),!0}checkIfNewUnitIsUnlocked(e,t){if(t===F.MELEE_UNIT_TYPE){const s=cT,i=this.scene.player.getCustomData(s);if(!i||typeof i!="number")return this.scene.player.setCustomData(s,e),!0;if(e>i)return this.scene.player.setCustomData(s,e),!0}if(t===F.RANGED_UNIT_TYPE){const s=lT,i=this.scene.player.getCustomData(s);if(!i||typeof i!="number")return this.scene.player.setCustomData(s,e),!0;if(e>i)return this.scene.player.setCustomData(s,e),!0}return!1}reusePlayerUnits(){this.playerUnits.getChildren().forEach(t=>{if(!(t instanceof $))throw new fe;t.reuseUnitOnReady(),this.resetAttackSpots(t)})}loadPlayerUnits(){const e=this.scene.player.getCustomData(hT);if(console.log(e),!e||typeof e!="string")return;e.split("/").forEach((s,i)=>{s.split("-").forEach((r,c)=>{if(r==="0")return;let o=nr;if(r[0]==="m"?o=Ne:r[0]==="r"&&(o=We),o===nr)return;const l=this.createUnit({level:parseInt(r.substring(1)),isPlayer:!0,unitType:r[0]==="m"?Ne:We});l.spawnUnitOnSquare(i+1,c+1,!0),this.resetAttackSpots(l),this.playerUnits.add(l)})})}checkIfBoardCanBeMerged(){const e=this.playerUnits.getChildren(),t=new Map,s=new Map;e.forEach(o=>{if(!(o instanceof $))return;const{level:l,unitType:h}=o;switch(h){case Ne:{const d=t.get(l);d?t.set(l,d+1):t.set(l,1);break}case We:{const d=s.get(l);d?s.set(l,d+1):s.set(l,1);break}}});const n=Array.from(t,([o,l])=>({key:o,value:l})).some(o=>{const{key:l,value:h}=o;return h>1&&l+1<=Di}),c=Array.from(s,([o,l])=>({key:o,value:l})).some(o=>{const{key:l,value:h}=o;return h>1&&l+1<=Ni});return n||c}createUnit(e){const{id:t,level:s,unitType:i,isPlayer:n,isMerged:r}=e;!t&&!s&&this.scene.rollbar.sendException(new Error("Unit id and level is not defined"));const{fieldBackground:c}=this.scene.fieldManager,o=c.scale*this.scene.world.getPixelRatio();switch(i){case F.MELEE_UNIT_TYPE:if(t){const l=this.meleeSpawnPool.requestUnitById(t,n,r);return l.setScale(o),l}if(s){const l=this.meleeSpawnPool.requestUnitByLevel(s,n,r);return l.setScale(o),l}return this.meleeSpawnPool.requestUnitByLevel(-1,n,r);case F.RANGED_UNIT_TYPE:if(t){const l=this.rangedSpawnPool.requestUnitById(t,n,r);return l.setScale(o),l}if(s){const l=this.rangedSpawnPool.requestUnitByLevel(s,n,r);return l.setScale(o),l}return this.rangedSpawnPool.requestUnitByLevel(-1,n,r);default:return this.meleeSpawnPool.requestUnitByLevel(-1,n,r)}}preparePlayerUnits(){this.playerUnits.getChildren().forEach(t=>{if(!(t instanceof $))throw new fe;t.actions.prepare()})}enableDragOnPlayerUnits(){this.playerUnits.getChildren().forEach(e=>{e instanceof $&&e.startEventListener()})}disableDragOnPlayerUnits(){this.playerUnits.getChildren().forEach(e=>{e instanceof $&&e.removeEventListener()})}serializePlayerUnitData(){const e=this.playerUnits.getChildren();e.sort((i,n)=>{if(!(i instanceof $)||!(n instanceof $))throw new fe;const{currentLocation:{rowId:r,colId:c}}=i,{currentLocation:{rowId:o,colId:l}}=n;return r===o?c-l:r-o});let t="",s=0;for(let i=0;i<3;i++){let n="";for(let r=0;r<5;r++){const c=s>=e.length?null:e[s];if(c instanceof $){const{rowId:o,colId:l}=c.currentLocation;if(o===i+1&&l===r+1){const h=this.createUnitDataForSaving(c);n+=h,s++}else n+="0"}else n+="0";r!==4&&(n+="-")}t+=n,i!==2&&(t+="/")}return t}createUnitDataForSaving(e){if(!e)return"0";const{unitType:t,level:s}=e;return`${t===Ne?"m":"r"}${s}`}savePlayerUnits(){this.scene.levelManager.isInLevelBuilderLevel()||this.scene.updateUnitData()}calculatePlayerTotalUnitsUsed(){const e=this.playerUnits.getChildren();let t=0,s=0;e.forEach(i=>{if(!(i instanceof $))throw new fe;if(i.unitType===Ne){const n=Math.pow(2,i.level-1);t+=n}if(i.unitType===We){const n=Math.pow(2,i.level-1);s+=n}}),this.meleeSpawnPool.setSpawnedUnits(t),this.rangedSpawnPool.setSpawnedUnits(s)}getLowestLevelPlayerMeleeUnit(){const t=this.playerUnits.getChildren().filter(i=>{if(!(i instanceof $))throw new fe;return i.unitType===Ne});return t.length===0?1:t.reduce((i,n)=>{if(!(n instanceof $))throw new fe;return!i||!(i instanceof $)||n.level<i.level?n:i}).level}getLowestLevelPlayerRangedUnit(){const t=this.playerUnits.getChildren().filter(i=>{if(!(i instanceof $))throw new fe;return i.unitType===We});return t.length===0?1:t.reduce((i,n)=>{if(!(n instanceof $))throw new fe;return!i||!(i instanceof $)||n.level<i.level?n:i}).level}getUnitDataForUnlockingScreen(){const{level:e,type:t}=this.latestUnitMergePayload;return t===F.MELEE_UNIT_TYPE?this.meleeSpawnPool.getUnitDataByLevel(e):this.rangedSpawnPool.getUnitDataByLevel(e)}resetAttackSpots(e){e.attackController.resetAttackSpots()}hideAllUnits(){this.enemyUnits.children.each(e=>{e instanceof $&&(e.kill(),e.uiController.killHpBar())}),this.playerUnits.children.each(e=>{e instanceof $&&(e.kill(),e.uiController.killHpBar())})}hideAllProjectiles(){this.rangedProjectiles.killGroup()}showAllProjectiles(){this.rangedProjectiles.reviveGroup()}showAllAliveUnits(){this.enemyUnits.children.each(e=>{e instanceof $&&(e.isKilled()||e.revive())}),this.playerUnits.children.each(e=>{e instanceof $&&(e.isKilled()||e.revive())})}showAllHpBarUnits(){this.enemyUnits.children.each(e=>{e instanceof $&&(e.isKilled()||e.uiController.reviveHpBar())}),this.playerUnits.children.each(e=>{e instanceof $&&(e.isKilled()||e.uiController.reviveHpBar())})}getSameCoupleUnits(){const e=new Map,t=this.playerUnits.getChildren();for(let s=0;s<t.length;s++){const i=t[s];if(!(i instanceof $))throw new fe;const{level:n,unitType:r}=i;if(r===F.MELEE_UNIT_TYPE&&n>=Di||r===F.RANGED_UNIT_TYPE&&n>=Ni)continue;const c=`${n}${r}`,o=e.get(c);if(o)return{unit1:o,unit2:i};e.set(c,i)}return null}getFirstMeleeUnit(){const e=this.playerUnits.getChildren();for(let t=0;t<e.length;t++){const s=e[t];if(!(s instanceof $))throw new fe;const{unitType:i}=s;if(i===F.MELEE_UNIT_TYPE)return s}return null}getFirstRangedUnit(){const e=this.playerUnits.getChildren();for(let t=0;t<e.length;t++){const s=e[t];if(!(s instanceof $))throw new fe;const{unitType:i}=s;if(i===F.RANGED_UNIT_TYPE)return s}return null}speedUpAllUnits(){this.scene.powerManager.isSpeedUp=!0,this.enemyUnits.children.each(e=>{e instanceof $&&(e.display.setAnimationTimeScale(ar),e.modifyCurrentAttackEvent())}),this.playerUnits.children.each(e=>{e instanceof $&&(e.display.setAnimationTimeScale(ar),e.modifyCurrentAttackEvent())})}resetSpeedAllUnits(){this.scene.powerManager.isSpeedUp=!1,this.enemyUnits.children.each(e=>{e instanceof $&&(e.display.setAnimationTimeScale(1),e.modifyCurrentAttackEvent())}),this.playerUnits.children.each(e=>{e instanceof $&&(e.display.setAnimationTimeScale(1),e.modifyCurrentAttackEvent())})}}const dT="global",pT="friend",{ApiHost:Tv,OtherHost:gT,LeadersBoard:fT}=GameCore.Configs,{Prefix:Iv,LeaderboardId:zc,Name:ET}=fT,mT=async(a,e,t)=>zc!=""?AT(a,e):ST(e),AT=async(a,e)=>(await es(`leaderboards/${zc}/players/${a}`,{score:e},{},gT))?.data||{},ST=async a=>await(await window.GameSDK.getLeaderboardAsync(ET)).setScoreAsync(a);class yT extends Error{constructor(e,t){super(e,t),this.name="NewScoreIsBad",this.message=e||"The new score is bad",this.payload=t}}const On=(a,e)=>e.playerId,TT=(a,e)=>e.opponentId,IT=a=>ne(a).match.isRequesting,CT=a=>ne(a).match.single,RT=a=>ne(a).match.single._id,_T=a=>ne(a).match.single.score,vT=a=>ne(a).match.single.level,wT=a=>ne(a).match.single.data?.fen,LT=a=>ne(a).match.single.data?.diamond,bT=a=>ne(a).match.single.status,PT=a=>ne(a).match.single.playerId,OT=a=>ne(a).match.challenge,DT=a=>ne(a).match.challenge._id,NT=a=>ne(a).match.challenge.status,MT=a=>ne(a).match.challenge.opponentInfo,kT=a=>ne(a).match.challenge.whitePlayerId,UT=a=>ne(a).match.challenge.blackPlayerId,xT=a=>ne(a).match.group.opponentInfo,BT=a=>ne(a).match.online.players;j([IT],a=>a);j([CT],a=>a);j([RT],a=>a);j([_T],a=>a||0);j([vT],a=>a||0);j([LT],a=>a||0);j([wT],a=>a||null);j([bT],a=>a);j([PT],a=>a);const ci=j([OT],a=>a);j([DT],a=>a);j([NT],a=>a);j([MT],a=>a);j([kT],a=>a);j([UT],a=>a);j([ci,On],(a,e)=>{const{whitePlayerId:t,blackPlayerId:s}=a;return t!==e&&s===e?t:s!==e&&t===e?s:""});j([ci,On],(a,e)=>{const{whitePlayerId:t,blackPlayerId:s}=a;return t===e?t:s===e?s:Zs.playerId});j([ci,On],(a,e)=>{const{whitePlayerId:t,blackPlayerId:s,whitePlayerFinish:i,blackPlayerFinish:n}=a;return e&&t===e?i:e&&s===e?n:!1});j([ci,TT],(a,e)=>{const{whitePlayerId:t,blackPlayerId:s,whitePlayerFinish:i,blackPlayerFinish:n}=a;return e&&t===e?i:e&&s===e?n:!1});j([xT],a=>a);j([BT],a=>a);const FT=a=>ne(a).stats.data,GT=a=>ne(a).stats.current,HT=a=>ne(a).stats.isRequesting;j([FT],a=>a);j([GT],a=>a);j([HT],a=>a);const{ApiHost:Cv}=GameCore.Configs,{Match:Rv}=GameCore.Configs,YT=(a,e)=>({type:yc,payload:{playerId:a,stats:e}}),KT=a=>({type:Tc,payload:{stats:a}}),VT=(a,e)=>t=>{try{const{player:s,notification:i}=window.game,n=s.getPlayerId();mT(n,a,e).catch(d=>{me(new Error(d))});const r=s.getDiamond(),c=s.getPlayerData(),{score:o=0,level:l}=c;o<a&&s.setScore(a),i.updateData({gameProgress:{currentLevel:l},gameStatistics:{highScore:o<a?a:o},currencyBalance:{diamond:r}}),i.sendRequest();const h={score:a,level:l};t(YT(n,h)),t(KT(h``))}catch(s){if(s instanceof yT)return;me(s)}},{KEY:WT,FRAME:jT}=L.GAMEPLAY;class Xc extends Phaser.GameObjects.Container{hand;constructor(e){super(e),this.name="TapTutorialHand",this.addHand(),this.scene.add.existing(this)}addHand(){this.hand=this.scene.make.image({key:WT,frame:jT.GUIDE_HAND,origin:{x:.5,y:.5}}),this.hand.setWorldSize(65.5,55.5),this.setSize(65.5,55.5),this.add(this.hand)}playAnimation(e=0,t=800){const s=1/this.scene.world.getPixelRatio();this.hand.angle=30,this.scene?.tweens.add({delay:e,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:0,value:1,duration:200},scale:{duration:400,start:s*1.6,to:s*1.2},angle:{from:30,value:0,duration:400}},onComplete:()=>{this.scene?.tweens.add({targets:[this.hand],delay:200,duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:0},onComplete:()=>{this.hand.x=0,this.hand.y=0,this.hand.scale=s,this.playAnimation(t)}})}})}stopAnimation(){this.scene.tweens.killTweensOf(this.hand)}preDestroy(){this.scene.tweens.killTweensOf(this.hand)}}const Ce={GUIDE_ONE:"GuideOne",GUIDE_TWO:"GuideTwo",GUIDE_PREVENT:"GuidePrevent",GUIDE_THREE:"GuideThree"};class $T{manager;constructor(e){this.manager=e}setup(){this.startGuide()}startGuide=()=>{const{uiManager:e}=this.manager.scene;this.manager.scene.time.delayedCall(500,()=>{this.manager.scene.analytics.event(G.TUTORIAL_STEP,{step:1})}),e.showUIForGuide1();const t=e.getStartBtnWorldPosition();this.showTapHand(t.x,t.y),e.addOnceCallbackForStartBtn(this.closeTutorial)};showTapHand(e,t){const{tapHand:s}=this.manager;s.setDepth(W.ON_TOP),s.setPosition(e+s.width/2,t+s.height/2),s.revive(),s.stopAnimation(),s.playAnimation(300)}closeTutorial=()=>{this.manager.stopTutorial()}}class zT{manager;currentStep;targetUnit1;targetUnit2;wrongUnit;constructor(e){this.manager=e,this.currentStep=0}setup(){this.startGuide()}startGuide=()=>{const{uiManager:e,unitManager:t}=this.manager.scene,s=t.getPlayerUnits(),i=s.length;let n=!1;if(s.forEach(c=>{c.level===2&&(n=!0)}),i===2&&n){this.showStep3();return}if(i>=3){this.handleOnClick();return}this.currentStep=1,this.manager.scene.giveEnoughCoins("MELEE"),e.showUIForGuide3(1);const r=e.getMeleeBlockConfig();this.createHighlightItem(r),this.showTapHand(r.worldX,r.worldY),this.manager.scene.analytics.event(G.TUTORIAL_STEP,{step:6}),e.addOnceCallbackForMeleeBlock(this.handleOnClick),this.manager.scene.input.setTopOnly(!0)};createHighlightItem(e){const{worldX:t,worldY:s,width:i,height:n}=e,r=20;this.manager.createMask(t-i/2-r,s-n/2-r,i+r*2,n+r*2)}handleOnClick=()=>{const{uiManager:e,unitManager:t}=this.manager.scene;this.currentStep=2,this.manager.scene.input.setTopOnly(!1),this.manager.background.kill(),this.manager.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0),e.showUIForGuide3(2),this.manager.tapHand.stopAnimation(),this.manager.tapHand.kill(),this.manager.scene.analytics.event(G.TUTORIAL_STEP,{step:7});const i=t.getSameCoupleUnits(),n=t.getFirstRangedUnit();if(!i||!n){this.showStep3();return}//! Suppose on the board only have 2 melee and 1 ranged
this.targetUnit1=i.unit2,this.targetUnit2=i.unit1,this.wrongUnit=n,this.createHint()};createHint(){const{x:e,y:t}=this.targetUnit1.getWorldPosition(),{x:s,y:i}=this.targetUnit2.getWorldPosition();this.createHandAt(e,t,s,i),this.createEvents()}createEvents(){this.targetUnit1.addOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd),this.targetUnit2.addOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd),this.wrongUnit.addOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd)}createHandAt(e,t,s,i){this.manager.hand.setDepth(W.ON_TOP),this.manager.hand.setPosition(e,t),this.manager.hand.revive(),this.manager.hand.setTarget(s,i),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}handleOnDragEnd=()=>{//! can be call before real onDragEnd call
if(this.manager.hand.kill(),this.targetUnit1.removeOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd),this.targetUnit2.removeOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd),this.wrongUnit.removeOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd),this.targetUnit1.isKilled()||this.targetUnit2.isKilled()){this.manager.scene.analytics.event(G.TUTORIAL_STEP,{step:8}),this.showStep3();return}this.createHint()};showStep3(){const{uiManager:e}=this.manager.scene;this.currentStep=3,e.showUIForGuide3(3);const t=e.getStartBtnWorldPosition();this.showTapHand(t.x,t.y),this.manager.scene.analytics.event(G.TUTORIAL_STEP,{step:9}),e.addOnceCallbackForStartBtn(this.closeTutorial)}showTapHand(e,t){const{tapHand:s}=this.manager;s.setDepth(W.ON_TOP),s.setPosition(e+s.width/2,t+s.height/2),s.revive(),s.stopAnimation(),s.playAnimation(300)}closeTutorial=()=>{this.manager.scene.analytics.event(G.TUTORIAL_STEP,{step:10}),this.manager.scene.time.delayedCall(500,()=>{this.manager.scene.analytics.event(G.TUTORIAL_COMPLETE),this.manager.scene.player.incUserGuideDisplays()}),this.currentStep=0,this.manager.stopTutorial()};reupdateUI(){const{uiManager:e}=this.manager.scene;this.currentStep!==0&&e.showUIForGuide3(this.currentStep)}}class XT{manager;currentStep;guideUnit;targetSquare;constructor(e){this.manager=e,this.currentStep=0}setup(){this.startGuide()}startGuide=()=>{const{uiManager:e,unitManager:t}=this.manager.scene;if(t.getPlayerUnits().length===2){this.showStep3();return}this.currentStep=1,this.manager.scene.giveEnoughCoins("RANGED"),e.showUIForGuide2(1);const i=e.getRangedBlockConfig();this.createHighlightItem(i),this.showTapHand(i.worldX,i.worldY),this.manager.scene.analytics.event(G.TUTORIAL_STEP,{step:2}),e.addOnceCallbackForRangedBlock(this.handleOnClickRangedBlock),this.manager.scene.input.setTopOnly(!0)};createHighlightItem(e){const{worldX:t,worldY:s,width:i,height:n}=e,r=20;this.manager.createMask(t-i/2-r,s-n/2-r,i+r*2,n+r*2)}handleOnClickRangedBlock=()=>{const{uiManager:e,unitManager:t,fieldManager:s}=this.manager.scene;this.currentStep=2,this.manager.scene.input.setTopOnly(!1),this.manager.background.kill(),this.manager.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0),e.showUIForGuide2(2),this.manager.tapHand.stopAnimation(),this.manager.tapHand.kill(),this.manager.scene.analytics.event(G.TUTORIAL_STEP,{step:3});const n=t.getFirstMeleeUnit(),r=s.getSquareBasedOnIndex(1,3);if(!r||!n)throw new Error("Guide fail due to target square or unit null");if(this.guideUnit=n,this.targetSquare=r,this.guideUnit.currentLocation===this.targetSquare){this.showStep3();return}this.createHint()};handleOnDragEnd=()=>{const{unitManager:e}=this.manager.scene;this.manager.hand.kill(),e.getPlayerUnits().forEach(i=>{i.removeOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd)});const s=this.guideUnit.getLastDragPos();s&&(s.y<268||s.y>458||s.x<29||s.x>346)&&this.guideUnit.dragUnitOnto(1,3),this.showStep3()};showStep3(){const{uiManager:e}=this.manager.scene;this.currentStep=3,e.showUIForGuide2(3);const t=e.getStartBtnWorldPosition();this.showTapHand(t.x,t.y),this.manager.scene.analytics.event(G.TUTORIAL_STEP,{step:4}),e.addOnceCallbackForStartBtn(this.closeTutorial)}createHint(){const{unitManager:e}=this.manager.scene,{x:t,y:s}=this.guideUnit.getWorldPosition(),{x:i,y:n}=this.targetSquare.getWorldPosition();this.createHandAt(t,s,i,n),e.getPlayerUnits().forEach(c=>{c.addOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd)})}createHandAt(e,t,s,i){this.manager.hand.setDepth(W.ON_TOP),this.manager.hand.setPosition(e,t),this.manager.hand.revive(),this.manager.hand.setTarget(s,i),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}showTapHand(e,t){const{tapHand:s}=this.manager;s.setDepth(W.ON_TOP),s.setPosition(e+s.width/2,t+s.height/2),s.revive(),s.stopAnimation(),s.playAnimation(300)}closeTutorial=()=>{this.currentStep=0,this.manager.stopTutorial()};reupdateUI(){const{uiManager:e}=this.manager.scene;this.currentStep!==0&&e.showUIForGuide2(this.currentStep)}}class qT{manager;constructor(e){this.manager=e}setup(){this.startGuide()}startGuide=()=>{const{uiManager:e}=this.manager.scene;e.showUIForGuidePrevent();const t=e.getStartBtnWorldPosition();this.showTapHand(t.x,t.y),e.addOnceCallbackForStartBtn(this.closeTutorial)};showTapHand(e,t){const{tapHand:s}=this.manager;s.setDepth(W.ON_TOP),s.setPosition(e+s.width/2,t+s.height/2),s.revive(),s.stopAnimation(),s.playAnimation(300)}closeTutorial=()=>{this.manager.stopTutorial()};reupdateUI(){const{uiManager:e}=this.manager.scene;e.showUIForGuidePrevent()}}const{STATUS:Mi}=mt,{Tutorial:ki}=GameCore.Configs,{KEY:ZT,FRAME:QT}=L.DEFAULT;class JT extends Te{scene;tutorialId;lastTutorialId;tutorialsDisplayed;isAnalyticFirstSent=!0;hand;tapHand;background;maskGraphics;tutOne;tutTwo;tutPrevent;tutThree;constructor(e){super(e),this.scene=e,this.createHand(),this.createTapHand(),this.createBackground(),this.initTutorialData()}getLastTutorialId(){return this.lastTutorialId}initTutorialData(){this.tutorialId="",this.lastTutorialId="",this.tutorialsDisplayed=[]}init(){this.hand.kill(),this.tapHand.kill(),this.background.kill(),this.setState(Mi.READY)}start(){if(!this.isRunning()){if(this.isNothingToDisplay()){this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0);return}this.setState(Mi.RUNNING)}}stop(){if(!this.isRunning())return;this.scene.tweens.killTweensOf([this.hand,this.tapHand,this.background]),this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0),this.setState(Mi.STOPPED)}displayCount(e){return this.tutorialsDisplayed.filter(s=>s===e).length}hasDisplayedEnough(e){if(!Object.prototype.hasOwnProperty.call(ki.NumberOfTutorial,e))return!0;const t=ki.NumberOfTutorial[e];return GameCore.Utils.Valid.isNumber(t)?t===-1?!1:this.displayCount(e)>=t:!0}isNothingToDisplay(){const e=this.scene.levelManager.getCurrentLevelId();return this.scene.gameMode===J.BATTLE||e>=3?!0:Object.keys(ki.NumberOfTutorial).filter(s=>!this.hasDisplayedEnough(s)).length<1}showTutorial(){if(!this.isRunning())return;this.isAnalyticFirstSent&&(this.scene.analytics.event(G.TUTORIAL_BEGIN),this.isAnalyticFirstSent=!1);const{unitManager:e}=this.scene,t=this.scene.levelManager.getCurrentLevelId();if(t===1){if(e.getPlayerUnits().length===1&&!this.hasDisplayedEnough(Ce.GUIDE_ONE)){this.startTutorial(Ce.GUIDE_ONE);return}if(!this.hasDisplayedEnough(Ce.GUIDE_TWO)){this.startTutorial(Ce.GUIDE_TWO);return}this.startTutorial(Ce.GUIDE_PREVENT)}else t===2&&this.startTutorial(Ce.GUIDE_THREE)}startTutorial=e=>{if(!this.isRunning())return!1;if(this.isNothingToDisplay())return this.stop(),!1;if(this.hasDisplayedEnough(e))return!1;switch(this.background.kill(),this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0),console.log(e),e){case Ce.GUIDE_ONE:this.tutOne=new $T(this),this.tutOne.setup();break;case Ce.GUIDE_TWO:this.tutTwo=new XT(this),this.tutTwo.setup();break;case Ce.GUIDE_PREVENT:this.tutPrevent=new qT(this),this.tutPrevent.setup();break;case Ce.GUIDE_THREE:this.tutThree=new zT(this),this.tutThree.setup();break;default:return!1}return this.isRunning()?(this.tutorialId=e,this.lastTutorialId=e,this.tutorialsDisplayed.push(this.tutorialId),!0):!1};reupdateGuideUI(){this.tutorialId!==""&&(this.tutorialId===Ce.GUIDE_TWO?this.tutTwo.reupdateUI():this.tutorialId===Ce.GUIDE_PREVENT?this.tutPrevent.reupdateUI():this.tutorialId===Ce.GUIDE_THREE&&this.tutThree.reupdateUI())}stopTutorial(){this.tutorialId="",this.hand.kill(),this.tapHand.kill(),this.background.kill(),this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0)}createHand(){this.hand=new Oc(this.scene),this.hand.kill(),this.hand.setDepth(W.PRIORITY)}createTapHand(){this.tapHand=new Xc(this.scene),this.tapHand.kill(),this.tapHand.setDepth(W.PRIORITY)}createBackground(){this.background=this.scene.make.image({key:ZT,frame:QT.BLANK}),this.background.setInteractive({}),this.scene.input.setTopOnly(!1),this.background.setTint(0),this.background.setAlpha(.8),this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",.8),this.background.setDepth(W.PRIORITY);const{displayWidth:t,displayHeight:s}=this.scene.gameZone,i=t+100,n=s+100;this.background.setDisplaySize(i,n),Phaser.Display.Align.In.Center(this.background,this.scene.gameZone)}createMask(e,t,s,i,n=10){this.maskGraphics?.destroy(),this.maskGraphics=this.scene.make.graphics({fillStyle:{color:16711680,alpha:1}}),this.maskGraphics.setName("MaskGraphics"),this.maskGraphics.fillRoundedRect(e,t,s,i,n),this.background.setActive(!0),this.background.setVisible(!0),this.background.clearMask(!0),this.background.setMask(this.maskGraphics.createGeometryMask()),this.background.mask.invertAlpha=!0,this.runShowMaskAnimation()}createMultiMask(e){this.maskGraphics?.destroy(),this.maskGraphics=this.scene.make.graphics({fillStyle:{color:16711680,alpha:1}}),this.maskGraphics.setName("MaskGraphics"),e.forEach(t=>{this.maskGraphics.fillRoundedRect(t.x,t.y,t.width,t.height,t.radius)}),this.background.setVisible(!0),this.background.setActive(!0),this.background.clearMask(!0),this.background.setMask(this.maskGraphics.createGeometryMask()),this.background.mask.invertAlpha=!0,this.runShowMaskAnimation()}runShowMaskAnimation(){const e=[this.background];this.background.setAlpha(0),this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0),this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,duration:300,ease:Phaser.Math.Easing.Quadratic.Out,props:{alpha:{from:0,to:.8}},onUpdate:(s,i)=>{this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",i.alpha)}})}}class eI extends Phaser.GameObjects.Zone{constructor(e,t,s){super(e,0,0,t,s),this.setOrigin(0,0)}}class qc extends Phaser.Scene{unsubscribeList;gameZone;background;handleOpenScene=()=>{this.logPageviewOnOpen(),this.logEventOpen()};constructor(){super({visible:!1})}create(){this.events.on("wake",this.handleOpenScene),this.events.on("resume",this.handleOpenScene),this.events.on("create",this.handleOpenScene),this.scaleGame(),this.createGameZone()}scaleGame(){const e=this.getCamera("main"),t=this.world.getZoomRatio(),{width:s,height:i}=this.world.getWorldSize();e.setZoom(t),e.centerOn(s/2,i/2)}createGameZone(){const{width:e,height:t}=this.world.getWorldSize();this.gameZone=new eI(this,e,t)}getCamera(e){return e==="main"?this.cameras.main:this.cameras.getCamera(e)}createMask(e=1){this.getCamera("main").setBackgroundColor(`rgba(0, 0, 0, ${e})`)}fontSize(e){return e/1}createBackground(e,t,s,i){this.background?(this.background.setTexture(e),t&&this.background.setFrame(t)):this.background=this.make.image({key:e,frame:t}),this.background.setName(e);const{displayWidth:n,displayHeight:r}=this.gameZone;this.background.setDisplaySize(n,r),GameCore.Utils.Valid.isNumber(s)&&this.background.setAlpha(s),GameCore.Utils.Valid.isNumber(i)&&this.background.setTint(i),Phaser.Display.Align.In.Center(this.background,this.gameZone)}handleStateChange(e){this.unsubscribeList=[],e.forEach(t=>{const{selector:s,callback:i}=t,n=this.storage.watch(s,i);this.unsubscribeList.push(n)}),this.events.once("sleep",this.removeStateChange),this.events.once("destroy",this.removeStateChange),this.events.once("shutdown",this.removeStateChange)}removeStateChange=()=>{this.unsubscribeList.forEach(e=>e())};logPageviewOnOpen(){this.analytics.pageview(this.scene.key)}logEventOpen(){this.analytics.event(G.SCREEN_OPEN,{screen_name:this.getSceneName()})}getSceneName(){return GameCore.Utils.String.toUpperCamelCase(this.scene.key.toLowerCase())}}class tI{scene;objects;allUI;groups;constructor(e){this.scene=e,this.objects=null,this.createGroups()}setUIObjects(e){this.objects=e,this.allUI.addMultiple(this.objects.getAll())}createGroups(){this.groups={},this.allUI=this.scene.add.group(),this.groups.allUI=this.allUI}}class Zc extends tI{scene;guideStateUI;battleReadyStateUI;normalReadyStateUI;levelLoadingStateUI;battlePlayingStateUI;normalPlayingStateUI;constructor(e){super(e),this.scene=e}setUIObjects(e){super.setUIObjects(e),this.updateDepthGroups(),this.addUIObjectsToGroups()}alignUI(){this.alignMainUI(),this.alignItems(),this.alignDevTools()}alignMainUI(){if(this.objects===null)return;const{gameZone:e,fieldManager:t}=this.scene,{coinBar:s,levelBar:i,battleLevelBar:n,showUnitButton:r,settingsButton:c,unitBar:o,totalHpBar:l,startButton:h}=this.objects;Phaser.Display.Align.In.TopRight(s,e,-60,-25),Phaser.Display.Align.In.TopCenter(i,e,0,-22),Phaser.Display.Align.In.TopCenter(n,e,10,-27),Phaser.Display.Align.In.TopLeft(r,e,-5,-45),Phaser.Display.Align.In.TopLeft(c,e,-5,-2);const{y:d,displayHeight:u,scaleY:p}=t.fieldBackground,g=this.scene.world.getPixelRatio(),f=e.width/2;this.scene.world.isLandscape()||o.createStampsBanner(),o.reviveBg(),o.x=f,l.x=f,h.x=f;const m=d-u/2;l.y=m;const E=255;if(o.y=m+E*p*g,o.isBgHigherBottom()){const A=o.getGapFromContainerCenterToBottomBg();o.y=this.scene.gameZone.displayHeight-A}h.y=o.y-72}alignItems(){if(this.objects===null)return;const{gameZone:e}=this.scene,{freeCoinsItem:t,speedUpItem:s,startButton:i}=this.objects;s.setScale(1.3),Phaser.Display.Align.In.TopRight(t,e,-15,-45),Phaser.Display.Align.In.RightCenter(s,i,80,0)}alignDevTools(){if(this.objects===null||!GameCore.Utils.Valid.isDebugger())return;const{gameZone:e}=this.scene,{selectLevelButton:t,resetLevelButton:s,currentUnitModButton:i,currentAttackModButton:n}=this.objects;Phaser.Display.Align.In.BottomRight(t,e,0,-80),Phaser.Display.Align.In.BottomRight(s,e,-50,-80),Phaser.Display.Align.In.BottomLeft(i,e,0,-150),Phaser.Display.Align.In.BottomLeft(n,e,0,-100)}createGroups(){super.createGroups(),this.guideStateUI=this.scene.add.group(),this.battleReadyStateUI=this.scene.add.group(),this.normalReadyStateUI=this.scene.add.group(),this.levelLoadingStateUI=this.scene.add.group(),this.battlePlayingStateUI=this.scene.add.group(),this.normalPlayingStateUI=this.scene.add.group(),this.groups.guideStateUI=this.guideStateUI,this.groups.battleReadyStateUI=this.battleReadyStateUI,this.groups.normalReadyStateUI=this.normalReadyStateUI,this.groups.levelLoadingStateUI=this.levelLoadingStateUI,this.groups.battlePlayingStateUI=this.battlePlayingStateUI,this.groups.normalPlayingStateUI=this.normalPlayingStateUI}updateDepthGroups(){this.allUI.setDepth(W.BUTTON),this.groups.guideStateUI.setDepth(W.BUTTON),this.groups.levelLoadingStateUI.setDepth(W.BUTTON),this.groups.normalReadyStateUI.setDepth(W.BUTTON),this.groups.battleReadyStateUI.setDepth(W.BUTTON),this.groups.normalPlayingStateUI.setDepth(W.BUTTON),this.groups.battlePlayingStateUI.setDepth(W.BUTTON)}addUIObjectsToGroups(){this.objects!==null&&(this.addObjectForGuideState(),this.addObjectsToLoadingState(),this.addObjectsForReadyState(),this.addObjectsForPlayingState())}addObjectForGuideState(){this.objects!==null&&this.groups.guideStateUI.addMultiple([this.objects.unitBar,this.objects.coinBar,this.objects.levelBar,this.objects.totalHpBar,this.objects.startButton,this.objects.settingsButton])}addObjectsToLoadingState(){this.objects!==null&&this.groups.levelLoadingStateUI.addMultiple([this.objects.coinBar,this.objects.totalHpBar,this.objects.freeCoinsItem,this.objects.settingsButton,this.objects.showUnitButton])}addObjectsForReadyState(){this.objects!==null&&(this.groups.normalReadyStateUI.addMultiple([this.objects.coinBar,this.objects.unitBar,this.objects.levelBar,this.objects.totalHpBar,this.objects.startButton,this.objects.speedUpItem,this.objects.freeCoinsItem,this.objects.settingsButton,this.objects.showUnitButton]),GameCore.Utils.Valid.isDebugger()&&this.groups.normalReadyStateUI.addMultiple([this.objects.resetLevelButton,this.objects.selectLevelButton,this.objects.currentUnitModButton,this.objects.currentAttackModButton]),this.groups.battleReadyStateUI.addMultiple([this.objects.coinBar,this.objects.totalHpBar,this.objects.startButton,this.objects.speedUpItem,this.objects.freeCoinsItem,this.objects.battleLevelBar,this.objects.settingsButton,this.objects.showUnitButton]))}addObjectsForPlayingState(){this.objects!==null&&(this.groups.normalPlayingStateUI.addMultiple([this.objects.coinBar,this.objects.totalHpBar,this.objects.speedUpItem,this.objects.settingsButton]),this.groups.battlePlayingStateUI.addMultiple([this.objects.coinBar,this.objects.totalHpBar,this.objects.speedUpItem,this.objects.settingsButton]))}}class sI extends Zc{uiZone;constructor(e){super(e);const{gameZone:t}=this.scene;this.uiZone=this.scene.add.zone(0,0,400,t.height),Phaser.Display.Align.In.Center(this.uiZone,t)}alignUI(){super.alignUI()}alignMainUI(){if(this.objects===null)return;const{coinBar:e,levelBar:t,showUnitButton:s,settingsButton:i,unitBar:n,startButton:r,totalHpBar:c}=this.objects,{tutorialManager:o}=this.scene;e.setScale(.75),Phaser.Display.Align.In.TopRight(e,this.uiZone,-80,-18),t.setScale(.75),Phaser.Display.Align.In.TopCenter(t,this.uiZone,0,-18),i.setScale(.75),Phaser.Display.Align.In.TopLeft(i,this.uiZone,-40,3),s.setScale(.75),n.changeToDesktopFrame(),Phaser.Display.Align.In.BottomCenter(n,this.uiZone,-90,-30),r.changeToDesktopFrame(),o.isNothingToDisplay()?Phaser.Display.Align.In.BottomCenter(r,this.uiZone,55,-7):Phaser.Display.Align.In.BottomCenter(r,this.uiZone,0,-7),c.playerHpBar.setScale(.75),c.playerHpBar.setPosition(190,125),c.enemyHpBar.setScale(.75),c.enemyHpBar.setPosition(-190,-160),Phaser.Display.Align.In.Center(c,this.uiZone,0,0)}alignItems(){if(this.objects===null)return;const{freeCoinsItem:e,speedUpItem:t,startButton:s,showUnitButton:i}=this.objects;t.setScale(.75),e.setScale(.75),Phaser.Display.Align.In.RightCenter(e,s,e.width,-2),Phaser.Display.Align.In.BottomCenter(t,i,0,42)}alignDevTools(){if(this.objects===null||!GameCore.Utils.Valid.isDebugger())return;const{selectLevelButton:e,resetLevelButton:t,currentUnitModButton:s,currentAttackModButton:i}=this.objects;Phaser.Display.Align.In.LeftCenter(e,this.uiZone,150,-50),Phaser.Display.Align.In.LeftCenter(t,this.uiZone,150,10),Phaser.Display.Align.In.LeftCenter(s,this.uiZone,150,60),Phaser.Display.Align.In.LeftCenter(i,this.uiZone,150,120)}}const Qc=Pn(.48,1.57,.6,.83),iI={targets:[],duration:400,ease:Qc,props:{scale:"-=0.1"}};class ti extends Le{constructor(e){super(iI,e)}}class de extends Phaser.GameObjects.Container{useSound=!0;isClicked=!1;isDisable=!1;scaleUp=-1;scaleDown=-1;button;upAnimation;downAnimation;isUsePixelPerfect=!1;hitArea;hitZone;scaleDownPress;parentName;onceCallbacks;isLogEvent;constructor(e,t,s,i,n,r=!1){super(e),this.isUsePixelPerfect=r,this.onceCallbacks=[],this.isLogEvent=!0,this.setDepth(W.BUTTON),this.createButton(t,s,i,n),this.updateSize(),this.listenEvents(),this.scene.add.existing(this)}listenEvents(){this.scene.events.on(Phaser.Scenes.Events.SLEEP,this.handleSceneSleep),this.once(Phaser.GameObjects.Events.DESTROY,this.handelObjectDestroy)}handelObjectDestroy=()=>{this.scene&&this.scene.events.off(Phaser.Scenes.Events.SLEEP,this.handleSceneSleep)};handleSceneSleep=()=>{this.scene&&this.scene.tweens.killTweensOf(this)};set onClick(e){this.isUsePixelPerfect?(this.hitArea=this.button,this.hitArea.setInteractive({useHandCursor:!0,pixelPerfect:!0})):(this.hitArea=this.hitZone,this.updateSize(),this.hitArea.setInteractive({useHandCursor:!0})),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handlePointerDown),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnClick(e)),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.handlePointerOut)}set onDown(e){this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,e)}set onOut(e){this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,e)}setOnceCallback(e){this.onceCallbacks.push(e)}get isUsePixelPerFect(){return this.isUsePixelPerfect}handlePointerDown=()=>{this.isClicked||this.upAnimation?.tween?.isPlaying()||(this.isClicked=!0,this.runDownAnimation())};handleOnClick=e=>()=>{this.isClicked&&(this.upAnimation?.tween?.isPlaying()||(this.isClicked=!1,this.runUpAnimation(),this.upAnimation?.tween?.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.logButtonEvent(),this.processCallback(e),Et(50)})))};handlePointerOut=()=>{this.isClicked&&(this.upAnimation?.tween?.isPlaying()||(this.isClicked=!1,this.runUpAnimation()))};processCallback(e){this.upAnimation?.stop(),this.downAnimation?.stop(),this.scene?.tweens.killTweensOf(this),this.scaleUp!==-1&&this.setScale(this.scaleUp),e(),this.onceCallbacks.length>0&&(this.onceCallbacks.forEach(t=>t()),this.onceCallbacks=[])}setDisabled(e){this.isDisable!==e&&(e?(this.setAlpha(.5),this.hitArea?.disableInteractive()):(this.setAlpha(1),this.hitArea?.setInteractive()),this.isDisable=e)}isDisabled(){return this.isDisable}createButton(e,t,s,i){this.button=this.scene.add.image(0,0,e,t),s&&i&&this.button.setWorldSize(s,i),this.updateScaleDown();const{displayWidth:n,displayHeight:r}=this.button;this.hitZone=this.scene.make.zone({displayWidth:n,displayHeight:r}),this.add([this.button,this.hitZone])}updateSize(){const{displayWidth:e,displayHeight:t}=this.button,s=10,i=e/100*10,n=t/100*10,r=i<s?i:s,c=n<s?n:s;this.setSize(e+r,t+c),this.hitZone.setSize(e+r,t+c)}updateScaleDown(){this.scaleUp=this.scale,this.scaleDown=-1,this.scaleDownPress=this.scale-.1}runDownAnimation=()=>{this.scaleDown===-1&&(this.scaleUp=this.scale,this.scaleDown=this.scaleDownPress),this.useSound&&this.playSound(),this.downAnimation?.remove(),this.downAnimation=new ti({targets:[this],duration:150,props:{scale:this.scaleDown},onUpdate:()=>{this.hitZone.scale=this.scaleUp/this.scale}}),this.downAnimation.play()};playSound(){this.scene.audio.playSound(X.BUTTON_CLICK)}runUpAnimation(){this.scaleUp!==-1&&(this.upAnimation?.remove(),this.upAnimation=new ti({targets:[this],duration:150,props:{scale:this.scaleUp},onUpdate:()=>{this.hitZone.scale=this.scaleUp/this.scale}}),this.upAnimation.play())}addDebugData(){const e=this.getParentName(),t=this.name;Jh("ui-click",`${e}:${t}`)}logButtonEvent(){if(!this.isLogEvent)return;const e=this.getParentName(),t=this.name;this.scene.analytics.event(G.BUTTON_CLICK,{button_name:t,screen_name:e})}disableLogEvent(e){this.isLogEvent=!e}getParentName(){if(this.parentName)return this.parentName;let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen){const t=e;return this.parentName=t.getScreenName(),this.parentName}e=e.parentContainer}return this.parentName=this.scene.getSceneName(),this.parentName}}const nI={targets:[],repeat:3,duration:33,ease:Phaser.Math.Easing.Linear,props:{angle:5},yoyo:!0};class aI extends Le{targetAngle;shakeAmount;constructor(e){super(nI,e),this.config?.props&&(this.targetAngle=this.config.targets[0].angle,this.shakeAmount=this.config.props.angle-this.targetAngle,this.tween?.on(Phaser.Tweens.Events.TWEEN_REPEAT,this.handleSwitchPosition))}handleSwitchPosition=()=>{this.shakeAmount*=-.7,this.tween?.updateTo("angle",this.targetAngle+this.shakeAmount)}}class rI extends de{shakeAnim;constructor(e,t,s,i,n){super(e,t,s,i,n)}createShakeAnim(){this.shakeAnim?.remove(),this.shakeAnim=new aI({targets:[this],repeat:6,duration:50,ease:Phaser.Math.Easing.Cubic.Out,props:{angle:-20}})}runAnimation(){this.createShakeAnim(),this.shakeAnim.play(),Et(50)}stopAnimation(){this.shakeAnim&&this.shakeAnim.remove(),this.angle=0}}const oI={targets:[],yoyo:!0,repeat:-1,duration:120,ease:Phaser.Math.Easing.Circular.Out,props:{scale:{from:1,to:1.3}}};class cI extends Le{constructor(e){super(oI,e)}}class pe extends Phaser.GameObjects.Container{payload;mainText;shadowText;constructor(e,t){super(e),this.payload=t,this.createMainText(),this.createShadowText(),this.updateSize(),this.moveDown(this.shadowText),this.scene.add.existing(this)}setText(e){this.mainText.setText(e),this.shadowText.setText(e),this.updateSize()}setTintText(e,t,s,i){this.mainText.setTint(e,t,s,i)}setDropShadow(e,t,s,i=1){this.shadowText.setVisible(!0),this.shadowText.setTint(s),this.shadowText.setAlpha(i),Phaser.Display.Align.In.Center(this.shadowText,this.mainText,e,t)}updateSize(){const{width:e,height:t}=this.mainText;this.setSize(e,t)}createMainText(){const{origin:e}=this.payload;this.mainText=this.scene.make.bitmapText({font:this.payload.font,size:this.payload.size,origin:e||{x:.5,y:.5}}),this.add(this.mainText)}createShadowText(){const{origin:e}=this.payload;this.shadowText=this.scene.make.bitmapText({font:this.payload.font,size:this.payload.size,origin:e||{x:.5,y:.5},visible:!1}),this.add(this.shadowText)}setFontSize(e){this.mainText.setFontSize(e),this.shadowText.setFontSize(e),this.updateSize()}}const{KEY:rr,FRAME:Ui}=L.GAMEPLAY;class lI extends de{heartAnim;text;constructor(e){super(e,rr,Ui.DASHBOARD_START_BTN,159,63),this.setName("StartFight"),this.createText(),this.runHeartAnimation()}createText(){const e=this.scene.lang.getCurrentLanguage();let t=22,s=-6;switch(e){case"pt":case"es":case"de":case"id":t=20;break;case"ja":t=20,s=-8;break;case"tr":t=20,s=-8;break;case"it":t=18}const i=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(t)});i.setText(this.scene.lang.Text.START_FIGHT),i.setDropShadow(0,2.5,0),this.add(i),Phaser.Display.Align.In.Center(i,this,0,s),this.text=i}changeToDesktopFrame(){const e=this.scene.lang.getCurrentLanguage();let t=15;switch(e){case"pt":case"ja":case"de":case"id":case"tr":t=13;break;case"es":case"it":t=12;break}this.button.setFrame(Ui.DASHBOARD_START_BTN_LANDSCAPE),this.updateSize(),this.text.setFontSize(this.scene.fontSize(t)),this.text.setX(15);const s=this.scene.make.image({key:rr,frame:Ui.DASHBOARD_BATTLE_ICON});s.setWorldSize(26.5,23.5),s.setPosition(-45,-3),this.add(s)}runHeartAnimation(){this.heartAnim?.remove(),this.heartAnim=new cI({targets:[this],duration:180,ease:Phaser.Math.Easing.Sine.InOut,props:{scale:{from:1,to:.95}}}),this.heartAnim.play()}setDisabled(e){super.setDisabled(e),e?this.heartAnim?.stop():this.runHeartAnimation()}runUpAnimation(){this.scaleUp!==-1&&(this.upAnimation?.remove(),this.upAnimation=new ti({targets:[this],duration:150,props:{scale:this.scaleUp},onStart:()=>{this.scene.input.enabled=!1,this.heartAnim?.stop()},onUpdate:()=>{this.hitZone.scale=1/this.scale}}),this.upAnimation?.tween?.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.scene.input.enabled=!0,this.runHeartAnimation()}),this.upAnimation.play())}}const{KEY:hI,FRAME:or}=L.EFFECTS;class uI extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitter;constructor(e){super(e,hI,or.FX_STAR_YELLOW),this.scene=e,this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:or.FX_STAR_YELLOW,alpha:{start:1,end:.8},speed:{min:50,max:150},scale:{start:e*.4,end:e*1},lifespan:{min:600,max:1500}})}explode(e,t,s){this.setActive(!0),this.setVisible(!0),this.emitter.explode(e,t,s)}}const{KEY:dI,FRAME:cr}=L.EFFECTS;class pI extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitter;constructor(e){super(e,dI,cr.FX_COMET),this.scene=e,this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:cr.FX_COMET,alpha:{start:1,end:.8},speed:{min:40,max:80},scale:{start:e*.4,end:e*.7},lifespan:{min:400,max:600}})}explode(e,t,s){this.revive(),this.emitter.explode(e,t,s)}}const{KEY:gI,FRAME:fI}=L.GAMEPLAY;class EI extends Phaser.GameObjects.Container{coinGroup;containerGroup;startsExplosive;startsExplosiveSmall;startsExplosiveSmallTimer;gravity=300;constructor(e){super(e),this.setVisible(!0),this.coinGroup=this.scene.add.group({defaultKey:gI,defaultFrame:fI.DASHBOARD_COINBAR_COIN}),this.containerGroup=this.scene.add.group({classType:Phaser.GameObjects.Container}),this.startsExplosive=new uI(e),this.startsExplosive.setDepth(W.ON_TOP+1),this.startsExplosiveSmall=new pI(e),this.startsExplosiveSmall.setDepth(W.ON_TOP+1),this.scene.add.existing(this)}createConfigOne(e,t,s){const i=e/300,n=new Phaser.Math.Vector2(0,0),r=new Phaser.Math.Vector2(0,-e),c=s?-1:1,o=Phaser.Math.RND.between(-90,90),l=o<0?1:(300-Math.abs(o))/300,h=(o+90)/180*180*l*i,d=Phaser.Math.RND.between(20,h+20),u=new Phaser.Math.Vector2(1,0);u.setAngle(o*Math.PI/180);const p=Phaser.Math.RND.between(-Math.abs(o)-15,-Math.abs(o)+15),g=d*(100-Math.abs(o))/100*i,f=Phaser.Math.RND.between(g*.2,g),m=new Phaser.Math.Vector2(1,0);m.setAngle(p*Math.PI/180);const E=c*u.x*d,A=u.y*d,S=c*m.x*f,I=m.y*f-e,T=new Phaser.Math.Vector2(E,A),R=new Phaser.Math.Vector2(S,I),b=new Phaser.Curves.CubicBezier(n,T,R,r),w=Phaser.Math.RND.between(1500+d*3,2e3+d*3),C=this.coinGroup.get(0,0);return C.revive(),C.setRotation(-t.rotation),C.setWorldSize(24,22),t.add(C),{from:0,to:1,duration:w,ease:"Sine.In",onUpdate:v=>{const N=b.getPointAt(v.getValue());C.setPosition(N.x,N.y)},onComplete:v=>{if(C.kill(),v.totalProgress<1||(this.scene.audio.playSound(X.DIAMONDS_EAT),this.startsExplosiveSmallTimer&&!this.startsExplosiveSmallTimer.hasDispatched))return;this.startsExplosiveSmallTimer=this.scene.time.delayedCall(100,()=>null);const N=C.getWorldPosition();this.startsExplosiveSmall.explode(10,N.x,N.y)}}}explode(e,t,s,i,n){if(e<=0)return[];this.startsExplosive.explode(30,t,s);const r=new Phaser.Math.Vector2(i-t,n-s),c=r.length(),o=this.containerGroup.get(t,s);o.setRotation(r.angle()+Math.PI/2),o.revive(),this.add(o);let l,h=0;const d=[];for(let p=0;p<e;p++){const g=this.createConfigOne(c,o,p%2===0),f=this.scene.tweens.addCounter(g);d.push(f),g.duration>h&&(h=g.duration,l=f)}const u=()=>{d.forEach(p=>{p.complete()}),this.startsExplosive.emitters.getAt(0)?.killAll(),this.startsExplosiveSmall.emitters.getAt(0)?.killAll(),o.kill()};return l?.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{o.kill(),this.scene.events.off("sleep",u)}),this.scene.events.once("sleep",u),d}}class mI extends EI{constructor(e){super(e)}createConfigOne(e,t,s){const i=e/300,n=new Phaser.Math.Vector2(0,0),r=new Phaser.Math.Vector2(0,-e),c=s?-1:1,o=Phaser.Math.RND.between(-90,90),l=o<0?1:(300-Math.abs(o))/300,h=(o+90)/180*180*l*i,d=Phaser.Math.RND.between(20,h+20),u=new Phaser.Math.Vector2(1,0);u.setAngle(o*Math.PI/180);const p=Phaser.Math.RND.between(-Math.abs(o)-15,-Math.abs(o)+15),g=d*(100-Math.abs(o))/100*i,f=Phaser.Math.RND.between(g*.2,g),m=new Phaser.Math.Vector2(1,0);m.setAngle(p*Math.PI/180);const E=c*u.x*d,A=u.y*d,S=c*m.x*f,I=m.y*f-e,T=new Phaser.Math.Vector2(E,A),R=new Phaser.Math.Vector2(S,I),b=new Phaser.Curves.CubicBezier(n,T,R,r),w=Phaser.Math.RND.between(750+d*3,1e3+d*3),C=this.coinGroup.get(0,0);return C.revive(),C.setRotation(-t.rotation),C.setWorldSize(24,22),t.add(C),{from:0,to:1,duration:w,ease:"Sine.In",onUpdate:v=>{const N=b.getPointAt(v.getValue());C.setPosition(N.x,N.y)},onComplete:v=>{if(C.kill(),v.totalProgress<1||(this.scene.audio.playSound(X.DIAMONDS_EAT),this.startsExplosiveSmallTimer&&!this.startsExplosiveSmallTimer.hasDispatched))return;this.startsExplosiveSmallTimer=this.scene.time.delayedCall(100,()=>null);const N=C.getWorldPosition();this.startsExplosiveSmall.explode(10,N.x,N.y)}}}}class AI extends Phaser.GameObjects.Particles.Particle{scale;constructor(e){super(e)}update(e,t,s){const i=super.update(e,t,s);return this.updateScale(),this.updateVelocity(),i}setScale(e){this.scale=Phaser.Math.FloatBetween(e.min,e.max)}easeInCubic(e){return e*e*e}updateScale(){const e=this.easeInCubic(1-this.lifeT);this.scaleX=this.scale*Math.sin(e*Math.PI),this.scaleY=this.scale*Math.sin(e*Math.PI)}updateVelocity(){this.velocityX+=Math.random()*2-1}}const{KEY:SI,FRAME:yI}=L.EFFECTS,lr=yI;class TI extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,SI,lr.FX_STAR_YELLOW),this.createEmitZone(),this.createEmitters(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({frame:lr.FX_STAR_YELLOW,emitZone:{source:this.emitZone,type:"random"},deathZone:{source:this.emitZone,type:"onLeave"},frequency:200,speedX:{min:-1,max:1},speedY:{min:-9,max:-13},lifespan:{min:1e3,max:1500},scale:{min:.01,max:.015},emitCallback:t=>{t.setScale({min:e/4,max:e})},particleClass:AI})}run(e,t,s,i,n){this.stop(),this.emitZone.setSize(i,n),this.emitZone.setPosition(t-i/2,s-n/2),this.emitter.setQuantity(e),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}}const{KEY:hr,FRAME:Os}=L.GAMEPLAY,{ID:II}=Js.FREE_COINS,{duration:CI}=GameCore.Configs.Gameplay.Powers.FreeCoins,{FREE_GOLD_LAST_USED:ur}=ye;class RI extends Gc{scene;lastUsedTime;collectText;remainingTimeText;glowEffect;timer;moveTween;sparkleEffect;remainingTime;constructor(e){super(e,II,hr,Os.DASHBOARD_FREE_GOLD,47,50),this.scene=e,this.setName("FreeCoinsItem"),this.createGlowEffect(),this.createCollectText(),this.createRemainingTimeText(),this.createSparkleEffect()}playSound(){this.scene.audio.playSound(X.COIN_SPAWN_SOUND)}createRemainingTimeText(){this.remainingTimeText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(13),origin:{x:.5,y:1}}),this.remainingTimeText.setVisible(!1),this.add(this.remainingTimeText),this.bringToTop(this.remainingTimeText),Phaser.Display.Align.In.BottomCenter(this.remainingTimeText,this.icon,0,-5)}createCollectText(){let e=11;switch(this.scene.lang.getCurrentLanguage()){case"es":case"pt":e=10;break;case"de":case"it":e=9;break}this.collectText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(e),origin:{x:.5,y:1},text:this.scene.lang.Text.COLLECT}),this.collectText.setVisible(!1),this.add(this.collectText),this.bringToTop(this.collectText),Phaser.Display.Align.In.BottomCenter(this.collectText,this.icon,0,-5)}createGlowEffect(){this.glowEffect=this.scene.add.image(0,0,hr,Os.DASHBOARD_FREE_GOLD_GLOW),this.glowEffect.setOrigin(.5,.5),this.glowEffect.setVisible(!1),this.glowEffect.setWorldSize(107.5,104.8),this.add(this.glowEffect),this.moveDown(this.glowEffect),this.moveUp(this.icon),Phaser.Display.Align.In.Center(this.glowEffect,this,1,0)}createSparkleEffect(){this.sparkleEffect=new TI(this.scene),this.sparkleEffect.setDepth(W.ON_TOP)}enableItem(){this.visible&&this.isDisabled!==!1&&(this.isDisabled=!1,this.zone.setInteractive(),this.setAvailable(!0))}activeItem=()=>{if(this.isActive===!0||this.isDisabled===!0)return;this.isActive=!0;const{powerManager:e}=this.scene;e.isStopped()||(this.scene.audio.playSound(X.BUTTON_CLICK),this.activeLogic())};activeLogic(){this.rewardCoins()}disableItem(){this.isDisabled!==!0&&(this.zone.disableInteractive(),this.setAvailable(!1),this.isDisabled=!0)}deactivateItem=()=>{if(this.isActive===!1)return;this.isActive=!1;const{powerManager:e}=this.scene;e.isStopped()||this.deactivateLogic()};deactivateLogic(){this.stopTimer()}startCountdown(){if(this.stopTimer(),this.initRemainingWaitTime(),this.remainingTime==0){this.enableItem();return}this.startTimer()}startTimer(){this.setRemainingTime(this.remainingTime),this.disableItem(),this.timer=this.scene.time.addEvent({delay:1e3,callback:()=>{this.remainingTime<1e3?(this.remainingTime=0,this.setRemainingTime(0),this.enableItem(),this.stopTimer()):(this.remainingTime-=1e3,this.setRemainingTime(this.remainingTime),this.disableItem())},loop:!0})}stopTimer(){this.timer?.remove()}initRemainingWaitTime(){if(!this.lastUsedTime){const s=this.scene.player.getCustomData(ur);this.lastUsedTime=typeof s=="number"?s:-1}if(this.lastUsedTime<0){this.remainingTime=0;return}const e=Date.now(),t=CI-(e-this.lastUsedTime);this.remainingTime=t>0?t:0}rewardCoins=()=>{const e=Date.now();this.scene.player.setCustomData(ur,e),this.lastUsedTime=e;const{unitManager:t,coinManager:s,layoutManager:i}=this.scene,n=t.getPlayerMeleeSpawnedUnitsCount(),r=t.getPlayerRangedSpawnedUnitsCount(),c=s.getUnitPrice(n),o=s.getUnitPrice(r),l=Math.floor(Math.random()*2+3),h=o.biggerThan(c)?o:c;h.multiply(l);const d=new mI(this.scene),{x:u,y:p}=i.objects.coinBar;d.setDepth(W.ON_TOP),d.explode(10,this.x,this.y,u,p).forEach(f=>{f.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{const m=h.clone();m.divide(10),this.scene.coin.plusCoins(m.baseValue,m.suffix),this.scene.updateUI()})}),this.scene.time.delayedCall(600,()=>{this.scene.audio.playSound(X.COIN_INCREASE_REPEATEDLY_SOUND)}),this.disableItem(),this.startCountdown()};setAvailable(e){this.collectText.setVisible(e),this.remainingTimeText.setVisible(!e),this.glowEffect.setVisible(e),this.icon.setFrame(e?Os.DASHBOARD_FREE_GOLD:Os.DASHBOARD_FREE_GOLD_OFF),e?(this.setVisible(!0),this.runMoveTween()):(this.stopMoveTween(),this.sparkleEffect.stop())}setRemainingTime(e){const t=Math.floor(e/1e3),s=Math.floor(t/60),i=t%60,n=i<10?`0${i}`:i.toString();this.remainingTimeText.setText(`${s}:${n}`)}runMoveTween(){this.stopMoveTween();let e=0,t=0,s=-2;this.moveTween=this.scene.tweens.add({targets:[this],duration:500,repeat:-1,ease:Phaser.Math.Easing.Sine.InOut,props:{y:"-=2"},onStart:()=>{e=this.x,t=this.y},onStop:()=>{this.setPosition(e,t)},onRepeat:()=>{s=-s,this.moveTween.updateTo("y",t+s,!0),this.moveTween.data[0].duration=1e3}})}stopMoveTween(){this.moveTween?.stop(),this.moveTween?.remove()}setVisible(e){return e||this.sparkleEffect.stop(),e&&this.remainingTime<1e3&&this.sparkleEffect.run(1,this.x,this.y-2.5,this.width,this.height+5),super.setVisible(e)}}const _I={targets:[],duration:600,ease:Phaser.Math.Easing.Linear,props:{angle:{from:0,to:360}}};class vI extends Le{constructor(e){super(_I,e)}}const{KEY:wI,FRAME:LI}=L.DEFAULT_8_BIT;class _s extends Phaser.GameObjects.Image{anim;constructor(e){super(e,0,0,wI,LI.PRELOADER),this.runAnimation(),this.setWorldSize(113,113),this.scene.add.existing(this)}runAnimation(){this.anim?.remove(),this.anim=new vI({targets:[this],repeat:-1,duration:1200}),this.anim.play()}setVisible(e){return super.setVisible(e),e?this.runAnimation():this.anim.stop(),this}}const{KEY:bI,FRAME:PI}=L.DEFAULT_8_BIT;class Dn extends Phaser.GameObjects.Container{payload;loading;photo;avtFrame;loadPhotoTimer;constructor(e,t){super(e),this.scene.add.existing(this),this.payload=t;const{size:s}=this.payload;this.setSize(s,s),this.createLoading(),this.createPhoto(),this.createFrame(),this.addDefaultListeners()}loadPhoto(e,t){if(this.payload.id=e,this.payload.url=t,this.loadPhotoTimer?.remove(),!e||!t){this.setPhoto(M.AVATAR.KEY);return}const s=this.scene.textures.get(e);if(s&&s.key===e){this.handleLoadComplete(e);return}this.showLoading(!0);const{loadDelay:i=0}=this.payload||{};this.loadPhotoTimer=this.scene.time.delayedCall(i,this.handleLoadPhotoAfterDelay(e,t))}handleLoadPhotoAfterDelay=(e,t)=>()=>{const s=this.scene.textures.get(e);if(s&&s.key===e){this.handleLoadComplete(e);return}this.scene.load.once(`filecomplete-image-${e}`,this.handleLoadComplete),this.scene.load.image(e,t),this.scene.load.start()};addDefaultListeners(){this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,this.handleLoadPhotoFailed),this.on(Phaser.GameObjects.Events.DESTROY,()=>{this.loadPhotoTimer?.remove(),this.scene.load.off(Phaser.Loader.Events.FILE_LOAD_ERROR,this.handleLoadPhotoFailed)})}handleLoadComplete=e=>{if(!this.scene)return;const{id:t}=this.payload;if(!t||t!==e)return;const s=`${t}_bordered_100`,i=this.scene.textures.get(s);if(i&&i.key===s){this.setPhoto(i.key);return}if(!GameCore.Utils.Image.drawCircle({scene:this.scene,key:t,newKey:s})){this.showLoading(!1);return}this.setPhoto(s)};handleLoadPhotoFailed=e=>{e.key===this.payload.id&&this.setDefaultAvatar(e.key)};setDefaultAvatar(e){this.loadPhoto(e,M.AVATAR.FILE)}createLoading(){this.loading=new _s(this.scene),this.loading.setWorldSize(this.width*.75,this.height*.75),this.loading.setVisible(!1),this.add(this.loading)}createPhoto(){this.photo=this.scene.make.image({x:0,y:0,origin:{x:.5,y:.5},visible:!1}),this.add(this.photo)}createFrame(){this.avtFrame=this.scene.make.image({key:bI,frame:PI.LEADERBOARD_AVATAR}),this.avtFrame.setWorldSize(34,38),this.add(this.avtFrame)}showLoading(e){this.photo.setVisible(!e),this.loading.setVisible(e)}setPhoto(e){this.showLoading(!1),this.photo.setTexture(e),this.photo.setFrame(0);const{size:t}=this.payload,s=t-10;this.photo.setWorldSize(s,s),Phaser.Display.Align.In.Center(this.photo,this.avtFrame,0,-2)}}let OI=class extends Dn{constructor(e){super(e,{size:38}),this.avtFrame.kill()}handleLoadComplete=e=>{if(!this.scene)return;const{id:t}=this.payload;if(!t||t!==e)return;const s=t,i=this.scene.textures.get(s);if(i&&i.key===s){this.setPhoto(i.key);return}this.setPhoto(M.AVATAR.KEY)}};const{KEY:DI,FRAME:dr}=L.GAMEPLAY;let pr=class extends Phaser.GameObjects.Container{bg;avatar;level;constructor(e,t){super(e),this.setName("PlayerCard"),this.createAvatar(),this.createFrame(t),this.updateSize(),this.createLevelText(),this.scene.add.existing(this)}updateData(e){const{playerId:t,playerPhoto:s,playerLevel:i}=e;this.level.setText(`Lv. ${i}`),this.avatar.loadPhoto(t,s)}createFrame(e){const t=e?dr.DASHBOARD_AVATAR_FRAME_BLUE:dr.DASHBOARD_AVATAR_FRAME_RED,s=this.scene.make.image({key:DI,frame:t});s.setName("bg"),s.setWorldSize(35.5,48.5),this.add(s),this.bg=s}updateSize(){this.setSize(this.bg.displayWidth,this.bg.displayHeight)}createAvatar(){const e=new OI(this.scene);e.setName("avatar"),e.setPosition(0,-4),this.add(e),this.avatar=e}createLevelText(){const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(8),text:"Lv. 1",origin:{x:.5,y:.5}});e.setPosition(0,14),this.add(e),this.level=e}};const{KEY:NI,FRAME:MI}=L.GAMEPLAY;class kI extends Phaser.GameObjects.Container{playerFrame;opponentFrame;VS;constructor(e){super(e),this.createPlayerFrame(),this.createOpponentFrame(),this.createVS(),this.setDepth(W.BUTTON),this.scene.add.existing(this)}createPlayerFrame(){this.playerFrame=new pr(this.scene,!0),this.playerFrame.setName("playerFrame"),this.add(this.playerFrame),this.playerFrame.setPosition(28,0)}createOpponentFrame(){this.opponentFrame=new pr(this.scene,!1),this.opponentFrame.setName("opponentFrame"),this.add(this.opponentFrame),this.opponentFrame.setPosition(-28,0)}createVS(){this.VS=this.scene.make.image({key:NI,frame:MI.DASHBOARD_VS}),this.VS.setWorldSize(17,14),this.VS.setName("VS"),this.add(this.VS)}updateData(e,t){e&&this.playerFrame.updateData(e),t&&this.opponentFrame.updateData(t)}changeToDesktopFrame(){this.playerFrame.setPosition(200/this.scale,60/this.scale),this.opponentFrame.setPosition(-200/this.scale,-225/this.scale),this.VS.kill()}}const{KEY:gr,FRAME:fr}=L.GAMEPLAY;class UI extends Phaser.GameObjects.Container{bar;coinText;constructor(e){super(e),this.createBar(),this.createText(),this.createCoinIcon(),this.setDepth(W.BUTTON),this.scene.add.existing(this)}createBar(){this.bar=this.scene.make.image({key:gr,frame:fr.DASHBOARD_COINBAR_BG}),this.bar.setWorldSize(75,24.5),this.add(this.bar)}createCoinIcon(){const e=this.scene.make.image({key:gr,frame:fr.DASHBOARD_COINBAR_COIN});this.add(e),e.setWorldSize(30.5,31.5),Phaser.Display.Align.In.RightCenter(e,this,55,0)}createText(){const e=this.scene.lang.getCurrentLanguage();let t=-10,s=17;switch(e){case"tr":s=19,t=-14;break;case"ja":s=15,t=-10;break}this.coinText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(s),origin:{x:.5,y:0}}),this.add(this.coinText),Phaser.Display.Align.In.Center(this.coinText,this.bar,-5,t)}setCoins(e){this.coinText.setText(`${e.toString()}`)}}class xI extends Phaser.GameObjects.Container{text;constructor(e){super(e),this.createText(),this.setDepth(W.BUTTON),this.scene.add.existing(this)}createText(){this.text=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(20)}),this.text.setText(""),this.text.setDropShadow(0,1.5,0),this.add(this.text)}setLevel(e){this.text.setText(`${this.scene.lang.Text.LEVEL} ${e}`)}}const{KEY:Ds,FRAME:Ns}=L.GAMEPLAY;class Jc extends Wc{front;iconImage;constructor(e){super(e,0),this.updateHealthBar(),this.setFrameSize(94.5,11.5),this.createIconImage()}updateHealthBar(){this.bg.setTexture(Ds),this.bg.setFrame(Ns.DASHBOARD_HPBAR_BG),this.frame.setTexture(Ds),this.frame.setFrame(Ns.DASHBOARD_HPBAR_RED),this.frame.setOrigin(1,.5),this.frame.setX(0);const e=this.scene.make.image({key:Ds,frame:Ns.DASHBOARD_HPBAR_FRONT});e.setOrigin(0,.5),e.setWorldSize(this.hpLength,this.hpHeight),e.setX(-this.hpLength/2),this.add(e),this.front=e}createIconImage(){this.iconImage=this.scene.add.image(0,0,Ds,Ns.DASHBOARD_HPBAR_RED_HEART),this.iconImage.setWorldSize(20,19),this.iconImage.setX(-this.hpLength/2-this.iconImage.displayWidth/2+8),this.iconImage.setAngle(90),this.add(this.iconImage)}setFrameSize(e,t){this.hpLength=e,this.hpHeight=t,this.bg.setWorldSize(this.hpLength,this.hpHeight),this.bg.setX(-this.hpLength/2),this.front.setWorldSize(this.hpLength,this.hpHeight),this.front.setX(-this.hpLength/2),this.updateFrameUI(),this.frame.setX((-this.hpLength+2)/2)}updateFrameUI(){this.frame.setWorldSize(this.currentHp/this.defaultHp*(-this.hpLength+2),this.hpHeight-1)}}const{FRAME:Er}=L.GAMEPLAY;class BI extends Jc{updateHealthBar(){super.updateHealthBar(),this.frame.setFrame(Er.DASHBOARD_HPBAR_BLUE)}createIconImage(){super.createIconImage(),this.iconImage.setFrame(Er.DASHBOARD_HPBAR_BLUE_HEART)}}class FI extends Phaser.GameObjects.Container{scene;playerHpBar;enemyHpBar;constructor(e){super(e),this.scene=e,this.setDepth(W.BUTTON),this.createPlayerHpBar(),this.createEnemyHpBar(),this.setSize(300,200),this.init(),this.scene.add.existing(this)}init(){this.enemyHpBar.setInitHp(1),this.playerHpBar.setInitHp(1)}createPlayerHpBar(){this.playerHpBar=new BI(this.scene),this.playerHpBar.setAngle(-90),this.playerHpBar.setPosition(175,50),this.add(this.playerHpBar)}createEnemyHpBar(){this.enemyHpBar=new Jc(this.scene),this.enemyHpBar.setAngle(-90),this.enemyHpBar.setPosition(-175,-160),this.add(this.enemyHpBar)}updateCurrentHp(){this.updateCurrentEnemyHp(),this.updateCurrentPlayerHp()}updateCurrentPlayerHp(){const e=this.scene.unitManager.getTotalPlayerUnitsHp();this.playerHpBar.setInitHp(e)}updatePlayerHpUIByMinus(e){this.playerHpBar.updateHpUIByMinus(e)}getCurrentPlayerHp(){return this.playerHpBar.getCurrentHp()}updateCurrentEnemyHp(){const e=this.scene.unitManager.getTotalEnemyUnitsHp();this.enemyHpBar.setInitHp(e)}updateEnemyHpUIByMinus(e){this.enemyHpBar.updateHpUIByMinus(e)}getCurrentEnemyHp(){return this.enemyHpBar.getCurrentHp()}}const{KEY:rs,FRAME:ht}=L.GAMEPLAY;class mr extends Phaser.GameObjects.Container{isDisable=!1;block;clickZone;adsBanner;unitImage;priceText;coinIcon;stampText;adsMode=!1;parentName;constructor(e,t,s){super(e),this.createBlock(),this.createZone(),this.updateSize(),this.createUnitImage(t),this.createPriceText(s),this.createMiniCoinIcon(),this.createAdsBanner()}updateSize(){const{displayWidth:e,displayHeight:t}=this.block;this.setSize(e,t)}createBlock(){this.block=this.scene.add.image(0,0,rs,ht.DASHBOARD_UNITBAR_BG),this.block.setWorldSize(71,77),this.add(this.block)}createZone(){const e=this.block.displayWidth,t=39/1.7,s=this.scene.world.isLandscape()?0:t,i=this.block.displayHeight+s,n=.5-s/i/2;this.clickZone=this.scene.add.zone(0,0,e,i),this.clickZone.setOrigin(.5,n),this.add(this.clickZone)}getStampTextFontSize(){switch(this.scene.lang.getCurrentLanguage()){case"pt":case"es":case"ja":case"zh":case"fr":case"id":case"de":case"it":return 12;case"tr":return 14;default:return 16}}getAdsTextFontSize(){switch(this.scene.lang.getCurrentLanguage()){case"pt":case"es":case"tr":case"ja":case"zh":case"fr":case"id":case"it":return 12;case"de":default:return 11}}createStampsBanner(){if(this.stampText)return;const e=this.scene.make.container({}),t=this.scene.make.image({key:rs,frame:ht.DASHBOARD_UNITBAR_STAMPS});t.setWorldSize(64,39),e.setSize(64,39),e.add(t);const s=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(this.getStampTextFontSize())});s.setDropShadow(0,2,0),s.setY(-2),e.add(s),s.setText(this.scene.lang.Text.BUY),this.stampText=s,Phaser.Display.Align.In.BottomCenter(e,this.block,0,26),this.add(e)}createAdsBanner(){const e=this.scene.make.image({key:rs,frame:ht.DASHBOARD_AD_ICON});e.setOrigin(1,0),e.setDisplaySize(33,33),e.setPosition(this.block.x+this.block.displayWidth/2,this.block.y-this.block.displayHeight/2),this.add(e),e.kill(),this.adsBanner=e}createUnitImage(e){if(this.unitImage=this.scene.add.image(0,0,rs),e===F.MELEE_UNIT_TYPE){const t=ht.DASHBOARD_UNITBAR_DINO;this.unitImage.setFrame(t),this.unitImage.setDisplaySize(49,37.5)}else{const t=ht.DASHBOARD_UNITBAR_ARCHER;this.unitImage.setFrame(t),this.unitImage.setDisplaySize(35,43)}Phaser.Display.Align.In.Center(this.unitImage,this.block,0,-10),this.add(this.unitImage)}createPriceText(e){const t=this.scene.lang.getCurrentLanguage();let s=18,i=15;switch(t){case"tr":s=16;break;case"ja":s=16,i=13;break}this.priceText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(i),origin:{x:.5,y:0}}),this.priceText.setText(`${e}`),Phaser.Display.Align.In.Center(this.priceText,this.block,8,s),this.add(this.priceText)}createMiniCoinIcon(){const e=this.scene.make.image({key:rs,frame:ht.DASHBOARD_MINI_COIN});this.add(e),e.setDisplaySize(12.5,13.5),Phaser.Display.Align.In.Center(e,this,-22,20),this.coinIcon=e}setImage(e){this.unitImage.setTexture(e)}setPrice(e){const t=e.toString();this.priceText.setText(`${t}`)}set onClick(e){this.clickZone.setInteractive({useHandCursor:!0}),this.clickZone.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.logButtonEvent(),e(),Et(50)})}set onceClick(e){this.clickZone.setInteractive({useHandCursor:!0}),this.clickZone.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.logButtonEvent(),e()})}setAdsMode(e){if(this.adsMode=e,this.adsBanner.setVisible(e),this.priceText.setVisible(!e),this.coinIcon.setVisible(!e),e)this.stampText&&(this.stampText.setFontSize(this.scene.fontSize(this.getAdsTextFontSize())),this.stampText.setText(this.scene.lang.Text.FREE)),Phaser.Display.Align.In.Center(this.unitImage,this.block,0,0);else{this.stampText&&(this.stampText.setFontSize(this.scene.fontSize(this.getStampTextFontSize())),this.stampText.setText(this.scene.lang.Text.BUY));const t=this.scene.world.isLandscape()?-6:-10;Phaser.Display.Align.In.Center(this.unitImage,this.block,0,t)}}setDisabled(e){e!==this.isDisable&&(this.setAlpha(e?.5:1),this.isDisable=e)}isDisabled(){return this.isDisable}logButtonEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(G.BUTTON_CLICK,{button_name:t,screen_name:e})}getParentName(){if(this.parentName)return this.parentName;let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen){const t=e;return this.parentName=t.getScreenName(),this.parentName}e=e.parentContainer}return this.parentName=this.scene.getSceneName(),this.parentName}changeToDesktopFrame(){const e=this.scene.lang.getCurrentLanguage();let t=2;switch(e){case"tr":t=0;break}this.block.setFrame(ht.DASHBOARD_UNITBAR_BG_LANDSCAPE),this.clickZone.setSize(this.block.displayWidth,this.block.displayHeight),this.adsBanner.setFrame(ht.DASHBOARD_AD_ICON_LANDSCAPE),this.adsBanner.setPosition(this.block.x+this.block.displayWidth/2,this.block.y-this.block.displayHeight/2);const s=1/this.scene.game.world.getPixelRatio();this.unitImage.setOrigin(.5,.45),this.unitImage.setScale(s/2),this.priceText.setFontSize(this.scene.fontSize(10)),this.priceText.setPosition(8,t),this.coinIcon.setPosition(-15,8),this.coinIcon.setScale(s/1.2),this.updateSize()}}const{Ads:Ar}=GameCore.Configs;class GI extends Phaser.GameObjects.Container{scene;bg;meleeBlock;rangedBlock;adChangeMeleeTimer;adChangeRangedTimer;constructor(e){super(e),this.scene=e,this.createBg(),this.createMeleeBlock(),this.createRangedBlock(),this.setDepth(W.BUTTON),this.scene.add.existing(this)}createStampsBanner(){this.meleeBlock.createStampsBanner(),this.rangedBlock.createStampsBanner()}setMeleePrice(e){this.meleeBlock.setPrice(e)}setRangedPrice(e){this.rangedBlock.setPrice(e)}createBg(){this.bg=this.scene.make.image({key:L.DEFAULT.KEY,frame:L.DEFAULT.FRAME.DASHBOARD_UNITBAR_BOTTOM_BG}),this.bg.setWorldSize(375,195),this.bg.setY(52),this.add(this.bg)}getGapFromContainerCenterToBottomBg(){return this.bg.y+this.bg.displayHeight/2}isBgHigherBottom(){return this.bg.getWorldPosition().y+this.bg.displayHeight/2<this.scene.gameZone.displayHeight}createMeleeBlock(){this.meleeBlock=new mr(this.scene,F.MELEE_UNIT_TYPE,999),this.meleeBlock.setName("BuyMeleeUnit"),this.meleeBlock.setPosition(39,0),this.add(this.meleeBlock),this.meleeBlock.onClick=this.buyMeleeUnit}buyMeleeUnit=()=>{const{effectManger:e}=this.scene;this.checkIfFullBoard()&&e.playFullFloatText(),!e.isRewardCurveAnimationRunning()&&(this.meleeBlock.isDisable||this.scene.handleSpawnMelee())};buyRangedUnit=()=>{const{effectManger:e}=this.scene;this.checkIfFullBoard()&&(e.playFullFloatText(),this.rangedBlock.setName("BuyRangedUnit"),this.rangedBlock.setAdsMode(!1)),!e.isRewardCurveAnimationRunning()&&(this.rangedBlock.isDisable||this.scene.handleSpawnRanged())};createRangedBlock(){this.rangedBlock=new mr(this.scene,F.RANGED_UNIT_TYPE,999),this.meleeBlock.setName("BuyRangedUnit"),this.rangedBlock.setPosition(-39,0),this.add(this.rangedBlock),this.rangedBlock.onClick=this.buyRangedUnit}setMeleeAdsMode(e){if(e&&(this.scene.tutorialManager.isRunning()||!Ar.Enabled)){this.disableMeleeBlock();return}const t=this.adChangeMeleeTimer&&this.adChangeMeleeTimer.getProgress()<1,{adsMode:s}=this.meleeBlock;if(e){if(e===s){this.scene.ads.canbeShowRewardAd()||this.disableMeleeBlock();return}if(this.disableMeleeBlock(),t)return;this.adChangeMeleeTimer=this.scene.time.delayedCall(2e3,()=>{if(this.meleeBlock){const i=this.scene.ads.canbeShowRewardAd(),n=this.delayedAdMeleePriceCheck();if(this.checkIfFullBoard()||!i){this.disableMeleeBlock(),this.meleeBlock.setName("BuyMeleeUnit"),this.meleeBlock.setAdsMode(!1);return}else this.enableMeleeBlock();if(!n){this.meleeBlock.setAdsMode(!1);return}this.meleeBlock.setName("ViewAdMeleeUnit"),this.meleeBlock.setAdsMode(!0)}});return}this.adChangeMeleeTimer?.destroy(),this.enableMeleeBlock(),this.meleeBlock.setName("BuyMeleeUnit"),this.meleeBlock.setAdsMode(e)}disableMeleeBlock(){this.meleeBlock.setDisabled(!0)}enableMeleeBlock(){this.meleeBlock.setDisabled(!1)}killMeleeBlock(){this.meleeBlock.kill()}reviveMeleeBlock(){this.meleeBlock.revive()}setRangedAdsMode(e){if(e&&(this.scene.tutorialManager.isRunning()||!Ar.Enabled)){this.disableRangedBlock();return}const t=this.adChangeRangedTimer&&this.adChangeRangedTimer.getProgress()<1,{adsMode:s}=this.rangedBlock;if(e){if(e===s){this.scene.ads.canbeShowRewardAd()||this.disableRangedBlock();return}if(this.disableRangedBlock(),e&&t)return;this.adChangeRangedTimer=this.scene.time.delayedCall(2e3,()=>{if(this.rangedBlock){const i=this.scene.ads.canbeShowRewardAd(),n=this.delayedAdRangedPriceCheck();if(this.checkIfFullBoard()||!i){this.disableRangedBlock(),this.rangedBlock.setName("BuyRangedUnit"),this.rangedBlock.setAdsMode(!1);return}else this.enableRangedBlock();if(!n){this.rangedBlock.setAdsMode(!1);return}this.rangedBlock.setName("ViewAdRangedUnit"),this.rangedBlock.setAdsMode(!0)}});return}this.adChangeRangedTimer?.destroy(),this.enableRangedBlock(),this.rangedBlock.setName("BuyRangedUnit"),this.rangedBlock.setAdsMode(e)}checkIfFullBoard(){const{fieldManager:e}=this.scene;return e.getRemainingAvailablePlacement()===0}delayedAdMeleePriceCheck(){const{unitManager:e,coinManager:t}=this.scene,s=this.scene.coin.getCurrentCoins(),i=e.getPlayerMeleeSpawnedUnitsCount(),n=t.getUnitPrice(i),r=s.toString(),c=n.toString();return n.biggerThan(s)&&r!==c}delayedAdRangedPriceCheck(){const{unitManager:e,coinManager:t}=this.scene,s=this.scene.coin.getCurrentCoins(),i=e.getPlayerRangedSpawnedUnitsCount(),n=t.getUnitPrice(i),r=s.toString(),c=n.toString();return n.biggerThan(s)&&r!==c}disableRangedBlock(){this.rangedBlock.setDisabled(!0)}enableRangedBlock(){this.rangedBlock.setDisabled(!1)}killRangedBlock(){this.rangedBlock.kill()}reviveRangedBlock(){this.rangedBlock.revive()}disableUnitBlocks(){this.meleeBlock.setDisabled(!0),this.rangedBlock.setDisabled(!0)}disableAdsForBlocks(){this.meleeBlock.setName("BuyMeleeUnit"),this.rangedBlock.setName("BuyRangedUnit"),this.meleeBlock.setAdsMode(!1),this.rangedBlock.setAdsMode(!1)}addOnceClickEventForMeleeBlock(e){this.meleeBlock.onceClick=e}addOnceClickEventForRangedBlock(e){this.rangedBlock.onceClick=e}getMeleeBlockConfig(){const{x:e,y:t}=this.meleeBlock.getWorldPosition(),{width:s,height:i}=this.meleeBlock,n=this.scene.world.isLandscape()?0:10;return{worldX:e,worldY:t+n,width:s*this.scaleX,height:i*this.scaleY}}getRangedBlockConfig(){const{x:e,y:t}=this.rangedBlock.getWorldPosition(),{width:s,height:i}=this.rangedBlock,n=this.scene.world.isLandscape()?0:10;return{worldX:e,worldY:t+n,width:s*this.scaleX,height:i*this.scaleY}}killBg(){this.bg.kill()}reviveBg(){this.bg.revive()}changeToDesktopFrame(){this.bg.kill(),this.rangedBlock.changeToDesktopFrame(),this.meleeBlock.changeToDesktopFrame(),this.meleeBlock.setPosition(36,0),this.rangedBlock.setPosition(-36,0)}}const{KEY:Ht,FRAME:Yt}=L.GAMEPLAY;class HI{scene;coinBar;unitBar;levelBar;totalHpBar;startButton;settingsButton;battleLevelBar;showUnitButton;leaderboardButton;freeCoinsItem;speedUpItem;unitModButton;resetLevelButton;selectLevelButton;currentUnitModText;currentUnitModButton;currentAttackModText;currentAttackModButton;group;constructor(e){this.scene=e,this.createGroup(),this.createObjects()}getAll(){return this.group.getChildren()}createGroup(){this.group=this.scene.add.group()}createObjects(){this.createCoinBar(),this.createUnitBar(),this.createLevelBar(),this.createTotalHpBar(),this.createStartButton(),this.createBattleLevelBar(),this.createShowUnitButton(),this.createSettingsButton(),this.createFreeCoinsItem(),this.createSpeedUpItem(),this.createDevTools()}createCoinBar(){this.coinBar=new UI(this.scene),this.group.add(this.coinBar)}createUnitBar(){this.unitBar=new GI(this.scene),this.group.add(this.unitBar)}createLevelBar(){this.levelBar=new xI(this.scene),this.group.add(this.levelBar)}createTotalHpBar(){this.totalHpBar=new FI(this.scene),this.group.add(this.totalHpBar)}createStartButton(){this.startButton=new lI(this.scene),this.group.add(this.startButton)}createBattleLevelBar(){this.battleLevelBar=new kI(this.scene),this.group.add(this.battleLevelBar)}createShowUnitButton(){this.showUnitButton=new rI(this.scene,Ht,Yt.DASHBOARD_UNIT_LIST,31.5,36),this.group.add(this.showUnitButton),this.showUnitButton.setName("ShowUnitList")}createSettingsButton(){this.settingsButton=new de(this.scene,Ht,Yt.DASHBOARD_SETTINGS_BTN,32.5,39),this.group.add(this.settingsButton),this.settingsButton.setName("Settings")}createFreeCoinsItem(){this.freeCoinsItem=new RI(this.scene),this.group.add(this.freeCoinsItem)}createSpeedUpItem(){this.speedUpItem=new ln(this.scene),this.group.add(this.speedUpItem)}createDevTools(){GameCore.Utils.Valid.isDebugger()&&(this.createResetLevelButton(),this.createSelectLevelButton(),this.createUnitModButton(),this.createAttackModButton())}createResetLevelButton(){this.resetLevelButton=new de(this.scene,Ht,Yt.TOOL_RESET,40,35),this.group.add(this.resetLevelButton),this.resetLevelButton.setName("Reset")}createSelectLevelButton(){this.selectLevelButton=new de(this.scene,Ht,Yt.TOOL_EDIT,40,40),this.group.add(this.selectLevelButton),this.selectLevelButton.setName("Select"),this.selectLevelButton.setAngle(90)}createUnitModButton(){this.currentUnitModButton=new de(this.scene,Ht,Yt.TOOL_UNIT,40,38.5),this.group.add(this.currentUnitModButton),this.currentUnitModButton.setName("UnitMod"),this.currentUnitModText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(18),text:"0",origin:{x:0,y:.5}}),this.currentUnitModText.x=20,this.currentUnitModButton.add(this.currentUnitModText)}createAttackModButton(){this.currentAttackModButton=new de(this.scene,Ht,Yt.TOOL_ATTACK,40,40),this.group.add(this.currentAttackModButton),this.currentAttackModButton.setName("UnitMod"),this.currentAttackModText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(18),text:"0",origin:{x:0,y:.5}}),this.currentAttackModText.x=20,this.currentAttackModButton.add(this.currentAttackModText)}}const{STATUS:YI}=mt;class KI extends Te{scene;layout;objects;groups;constructor(e){super(e),this.scene=e,this.createObjects(),this.createLayouts(),this.createGroups()}createObjects(){this.objects=new HI(this.scene)}createLayouts(){this.scene.world.isLandscape()?this.layout=new sI(this.scene):this.layout=new Zc(this.scene),this.layout.setUIObjects(this.objects)}createGroups(){this.groups=this.layout.groups}init(){this.layout.alignUI(),this.setState(YI.READY)}}const{STATUS:VI}=mt,{MaxLevel:Sr}=GameCore.Configs.Gameplay;class WI extends Te{scene;loadMapInput;unitModifierInput;attackModifierInput;constructor(e){super(e),this.scene=e,this.createDevTools()}start(){this.isRunning()||GameCore.Utils.Valid.isDebugger()&&this.setState(VI.RUNNING)}createDevTools(){GameCore.Utils.Valid.isDebugger()&&(this.createLoadMapInput(),this.createUnitModifierInput(),this.createAttackModifierInput())}createLoadMapInput(){this.loadMapInput=this.createInput("input-level","level-id","load-level-id","Load level",this.handleStartLoadMapById)}createUnitModifierInput(){this.unitModifierInput=this.createInput("input-level","unit-mod","edit-unit-mod","Set Unit Price Modifier",this.handleEditUnitModifier)}createAttackModifierInput(){this.attackModifierInput=this.createInput("input-level","attack-mod","edit-attack-mod","Set Attack Coin Modifier",this.handleEditAttackModifier)}createInput(e,t,s,i,n){const r=document.createElement("div");return r.id=e,r.style.height="100vh",r.style.width="calc(100vw - 100px)",r.style.padding="50px",r.style.display="flex",r.style.flexFlow="column",r.style.position="absolute",r.style.justifyContent="center",r.style.backgroundColor="#000000cc",r.innerHTML=`<input id=${t} style="height: 50px;text-align: center;font-size: 30px;"></input><input type="button" id=${s} value=${i} style="height:40px">`,document.body.appendChild(r),document.getElementById(s)?.addEventListener("click",n),r.style.display="none",r}handleStartLoadMapById=()=>{try{this.loadMapInput.style.display="none";const e=document.getElementById("level-id");if(!e)return;const t=JSON.parse(e.value),s=parseInt(t)>Sr?Sr:parseInt(t);this.scene.selectLevel(s)}catch(e){console.warn(e)}};handleEditUnitModifier=()=>{try{this.unitModifierInput.style.display="none";const e=document.getElementById("unit-mod");if(!e)return;const t=JSON.parse(e.value),s=parseInt(t),{difficultyManager:i,uiManager:n}=this.scene,r=i.editCurrentLevelUnitMod(s);this.setCurrentUnitModText(t,r),n.updateUIData()}catch(e){console.warn(e)}};setCurrentUnitModText(e,t){const{objects:s}=this.scene.layoutManager;s.currentUnitModText.setText(`C: ${e*100}%
T: ${t.toString()}%`)}handleEditAttackModifier=()=>{try{this.attackModifierInput.style.display="none";const e=document.getElementById("attack-mod");if(!e)return;const t=JSON.parse(e.value),s=parseInt(t),{difficultyManager:i,uiManager:n}=this.scene,r=i.editCurrentLevelAttackMod(s);this.setCurrentAttackModText(t,r),n.updateUIData()}catch(e){console.warn(e)}};setCurrentAttackModText(e,t){const{objects:s}=this.scene.layoutManager;s.currentAttackModText.setText(`C: ${e}%
T: ${t.toString()}%`)}handleShowLoadMapInput=()=>{this.loadMapInput.style.display="flex"};handleShowModUnitInput=()=>{this.unitModifierInput.style.display="flex"};handleShowModAttackInput=()=>{this.attackModifierInput.style.display="flex"}}const jI={targets:[],duration:600,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:0,from:0,to:1}}};class li extends Le{constructor(e){super(jI,e)}}class $I extends Dn{constructor(e){super(e,{size:120}),this.avtFrame.kill()}handleLoadComplete=e=>{if(!this.scene)return;const{id:t}=this.payload;if(!t||t!==e)return;const s=t,i=this.scene.textures.get(s);if(i&&i.key===s){this.setPhoto(i.key);return}this.setPhoto(M.AVATAR.KEY)}}const{KEY:zI,FRAME:yr}=L.DEFAULT_8_BIT;class Tr extends Phaser.GameObjects.Container{bg;avatar;playerName;level;tween;constructor(e,t){super(e),this.setName("PlayerCard"),this.createAvatar(),this.createFrame(t),this.updateSize(),this.createNameText(),this.createLevelText(),this.createAnimation(),this.scene.add.existing(this)}updateData(e){const{playerId:t,playerName:s,playerPhoto:i,playerLevel:n}=e;this.playerName.setText(s||"Player"),this.level.setText(`Lv. ${n}`),this.avatar.loadPhoto(t,i||M.AVATAR.FILE)}createFrame(e){const t=e?yr.CHALLENGE_GRADE_BLUE:yr.CHALLENGE_GRADE_RED,s=this.scene.make.image({key:zI,frame:t});s.setName("bg"),s.setWorldSize(119,153.5),this.add(s),this.bg=s}updateSize(){this.setSize(this.bg.displayWidth,this.bg.displayHeight)}createAvatar(){const e=new $I(this.scene);e.setName("avatar"),e.setPosition(1,-18),this.add(e),this.avatar=e}createNameText(){const e=this.scene.make.text({text:"Player1",style:{fontSize:"13px",color:"#ffffff",stroke:"#000000",strokeThickness:2,fixedWidth:169,align:"center",fontFamily:k.SYSTEM_FAMILY_FONT},origin:{x:.5,y:.5}});e.setHighQuality(),e.setShadow(0,8,"#000000",0,!0),e.setPosition(0,45),this.add(e),this.playerName=e}createLevelText(){const e=this.scene.make.text({text:"Lv. 1",style:{fontSize:"9px",color:"#ffffff",stroke:"#000000",strokeThickness:2,fixedWidth:117,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});e.setHighQuality(),e.setShadow(0,8,"#000000",0,!0),e.setPosition(0,60),this.add(e),this.level=e}createAnimation(){this.tween=this.scene.add.tween({paused:!0,targets:[this.avatar,this.playerName,this.level],duration:800,ease:Phaser.Math.Easing.Cubic.Out,delay:this.scene.tweens.stagger(50,{start:Math.random()*50+50}),props:{alpha:{from:0,to:1}}})}runAnimation(e){this.playerName.setAlpha(0),this.level.setAlpha(0),this.avatar.setAlpha(0),this.scene.time.delayedCall(e,()=>{this.tween.play()})}}const XI={targets:[],repeat:3,duration:33,ease:Phaser.Math.Easing.Expo.InOut,props:{y:5},yoyo:!0};class qI extends Le{targetY;shakeAmount;constructor(e){super(XI,e),this.config?.props&&(this.targetY=this.config.targets[0].y,this.shakeAmount=this.config.props.y-this.targetY,this.tween?.on(Phaser.Tweens.Events.TWEEN_REPEAT,this.handleSwitchPosition))}handleSwitchPosition=()=>{this.shakeAmount*=.7,this.tween?.updateTo("y",this.targetY+this.shakeAmount)}}const{KEY:It,FRAME:Ct}=L.DEFAULT_8_BIT;class ZI extends Phaser.GameObjects.Container{glow;backEffect;energy;vs;fx1;fx2;mainTween;energyTween;fx1Tween;fx2Tween;glowTween1;glowTween2;onCompleteAnim;constructor(e){super(e),this.setName("VSComponent"),this.createShape(),this.createGlow(),this.createBackEffect(),this.createEnergy(),this.createVS(),this.createFx(),this.createAnimation(),this.scene.add.existing(this)}createShape(){const e=this.scene.make.image({key:It,frame:Ct.CHALLENGE_SHAPE});e.setName("shape"),e.setWorldSize(204,123.5),this.add(e)}createGlow(){const e=this.scene.make.image({key:It,frame:Ct.CHALLENGE_GLOW});e.setName("glow"),e.setWorldSize(518,88.5),this.add(e),this.glow=e}createBackEffect(){const e=this.scene.make.image({key:It,frame:Ct.CHALLENGE_BACK_EFFECT});e.setName("backEffect"),e.setWorldSize(230,230),this.add(e),this.backEffect=e}createEnergy(){const e=this.scene.make.image({key:It,frame:Ct.CHALLENGE_ICON_ENERGY});e.setName("energy"),e.setWorldSize(96,106.5),e.setPosition(10,5),this.add(e),this.energy=e}createVS(){const e=this.scene.make.image({key:It,frame:Ct.CHALLENGE_VS});e.setName("vs"),e.setWorldSize(40.5,37.5),this.add(e),this.vs=e}createFx(){const e=this.scene.make.image({key:It,frame:Ct.CHALLENGE_FX});e.setName("fx1"),e.setWorldSize(371.5,59),e.setPosition(0,-31),this.add(e),this.fx1=e;const t=this.scene.make.image({key:It,frame:Ct.CHALLENGE_FX});t.setName("fx2"),t.setWorldSize(371.5,59),t.setPosition(0,26),this.add(t),this.fx2=t}createAnimation(){this.createMainTween(),this.createEnergyTween(),this.createFxTween(),this.createGlowTween()}createMainTween(){const e=this.vs.scale;this.mainTween=this.scene.add.tween({paused:!0,targets:this.vs,duration:500,ease:Phaser.Math.Easing.Cubic.Out,onActive:()=>{this.vs.setTintFill(16777215),this.vs.setVisible(!0),this.vs.setAlpha(0),this.energyTween.resume()},props:{scale:{from:e*10,to:e},alpha:{from:0,to:1}},onComplete:()=>{this.scene.audio.playSound(X.THUNDER_SOUND),Et(50),this.vs.clearTint(),this.fx1Tween.resume(),this.fx2Tween.resume(),this.glowTween1.resume()}})}createEnergyTween(){const{x:e,y:t}=this.energy;this.energyTween=this.scene.add.tween({paused:!0,targets:this.energy,duration:500,ease:Phaser.Math.Easing.Expo.In,onActive:()=>{this.energy.setVisible(!0),this.energy.setAlpha(0)},props:{x:{from:e+50,to:e},y:{from:t-50,to:t},alpha:{from:0,to:1}},onComplete:()=>{new qI({targets:[this],repeat:5,duration:60,props:{y:this.y+5}}).play()}})}createFxTween(){const e=this.fx1.x;this.fx1Tween=this.scene.add.tween({paused:!0,targets:this.fx1,duration:500,ease:Phaser.Math.Easing.Cubic.Out,onActive:()=>{this.fx1.setVisible(!0)},props:{x:{from:e-100,to:e},alpha:{from:0,to:1}}});const t=this.fx2.x;this.fx2Tween=this.scene.add.tween({paused:!0,targets:this.fx2,duration:500,ease:Phaser.Math.Easing.Cubic.Out,onActive:()=>{this.fx2.setVisible(!0)},props:{x:{from:t+100,to:t},alpha:{from:0,to:1}}})}createGlowTween(){this.glowTween1=this.scene.add.tween({paused:!0,targets:[this.backEffect,this.glow],duration:500,ease:Phaser.Math.Easing.Cubic.Out,onActive:()=>{this.backEffect.setVisible(!0),this.glow.setVisible(!0)},props:{alpha:{from:0,to:1}},onComplete:()=>{this.glowTween2.resume(),this.onCompleteAnim&&this.onCompleteAnim()}}),this.glowTween2=this.scene.add.tween({paused:!0,targets:this.backEffect,duration:1e6,ease:Phaser.Math.Easing.Linear,repeat:-1,props:{rotation:{start:0,to:180}}})}runAnimation(e){this.vs.setVisible(!1),this.energy.setVisible(!1),this.fx1.setVisible(!1),this.fx2.setVisible(!1),this.glow.setVisible(!1),this.backEffect.setVisible(!1),this.scene.time.delayedCall(e,()=>{this.mainTween.resume()})}stopAnimation(){this.glowTween2.pause()}}class QI extends GameCore.Screen{playerFrame;opponentFrame;vsComponent;backgroundFadeInAnimation;bgFadeOutAnimation;fadeOutAnimation;constructor(e,t,s,i){super(e,t,s,i),this.background.setAlpha(.8),this.setDepth($e.SPLASH),this.createPlayerFrame(),this.createOpponentFrame(),this.createVsComponent()}createPlayerFrame(){this.playerFrame=new Tr(this.scene,!0),this.playerFrame.setName("playerFrame"),this.add(this.playerFrame),Phaser.Display.Align.In.Center(this.playerFrame,this,0,-this.playerFrame.height+10)}createOpponentFrame(){this.opponentFrame=new Tr(this.scene,!1),this.opponentFrame.setName("opponentFrame"),this.add(this.opponentFrame),Phaser.Display.Align.In.Center(this.opponentFrame,this,0,this.opponentFrame.height-10)}createVsComponent(){this.vsComponent=new ZI(this.scene),this.add(this.vsComponent),this.vsComponent.onCompleteAnim=()=>{this.scene.scene.resume(K.GAME_SCENE),this.scene.time.delayedCall(1e3,()=>{this.close()})}}open(){super.open(),this.scene.requestBackgroundMaskUpdate(P.CHALLENGE_SPLASH_SCREEN,this.background.alpha),this.updateData(),this.runOpenAnimation()}close(){this.setBlockInputOutsideEnabled(!1),this.visible&&(this.vsComponent.stopAnimation(),this.runExitsAnimation(100,1e3))}updateData(){const e=this.scene.battle.getPlayerInfo();console.log("🤖 ? playerInfo",e),e&&this.playerFrame.updateData(e);const t=this.scene.battle.getOpponentInfo();console.log("🤖 ? opponentInfo",t),t&&this.opponentFrame.updateData(t)}runOpenAnimation(){this.runBackgroundEntrancesAnimation(0,200),this.runPopupContentEntrancesAnimation(500,400)}runBackgroundEntrancesAnimation(e,t){this.backgroundFadeInAnimation||(this.backgroundFadeInAnimation=new li({targets:[this.background],delay:e,duration:t,props:{alpha:{start:0,from:0,to:.8}},onUpdate:(s,i)=>{const n=this.scene,r=this.scene.screen.get(P.LOADING_SCREEN);if(r&&r.visible){this.background.setAlpha(0),n.requestBackgroundMaskUpdate(P.CHALLENGE_SPLASH_SCREEN,0);return}n.requestBackgroundMaskUpdate(P.CHALLENGE_SPLASH_SCREEN,i.alpha)}})),this.backgroundFadeInAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.playerFrame.setAlpha(.8);const{scale:s}=this.playerFrame;this.scene.add.tween({targets:[this.playerFrame],props:{scale:{start:s-.05,to:s,duration:500},alpha:{start:.8,from:.8,to:1,duration:t}},ease:Phaser.Math.Easing.Expo.In}),this.playerFrame.runAnimation(e),this.opponentFrame.setAlpha(.1),this.opponentFrame.setX(this.opponentFrame.x+100),this.scene.add.tween({targets:[this.opponentFrame],props:{alpha:{start:.1,from:.1,to:1,duration:t},x:{start:this.opponentFrame.x,to:this.opponentFrame.x-100,duration:t}},ease:Phaser.Math.Easing.Expo.In}),this.opponentFrame.runAnimation(e),this.vsComponent.runAnimation(1e3)}runExitsAnimation(e,t){this.fadeOutAnimation||(this.fadeOutAnimation=new Ye({targets:[this.vsComponent,this.playerFrame,this.opponentFrame],delay:e,duration:t,props:{alpha:{from:1,to:0}},onComplete:()=>{super.close(),this.vsComponent.setAlpha(1),this.playerFrame.setAlpha(1),this.opponentFrame.setAlpha(1)}}),this.bgFadeOutAnimation=new Ye({targets:[this.background],delay:e,duration:t,props:{alpha:{start:.8,from:.8,to:0}},onUpdate:(s,i)=>{this.scene.requestBackgroundMaskUpdate(P.CHALLENGE_SPLASH_SCREEN,i.alpha)}})),this.fadeOutAnimation.play(),this.bgFadeOutAnimation.play()}}const JI={targets:[],repeat:-1,yoyo:!0,duration:33,ease:Phaser.Math.Easing.Sine.InOut,props:{x:5}};class el extends Le{posX;constructor(e){super(JI,e),this.config?.props&&(this.posX=this.config.props.x,this.tween?.on(Phaser.Tweens.Events.TWEEN_REPEAT,this.handleSwitchPosition))}handleSwitchPosition=()=>{this.posX=-this.posX,this.tween?.updateTo("x",-this.posX)}}const{KEY:eC,FRAME:tC}=L.DEFAULT_8_BIT;class Ut extends de{constructor(e){super(e,eC,tC.BUTTON_CLOSE,31.5,31.5),this.scene=e,this.setName("Close")}playSound(){this.scene.audio.playSound(X.CLOSE_CLICK,{volume:.3})}}const sC=`
precision mediump float;

uniform sampler2D uMainSampler;
// uniform vec2 uResolution; //khong co
uniform float uCameraZoom;

uniform vec2 iResolution;

uniform vec4 lightPosition;
uniform vec4 lightColor;
uniform float lightRadius;
uniform float lightAttenuation;

varying vec2 outTexCoord;
varying float outTintEffect;
varying vec4 outTint;

void main (void)
{
    vec4 pos = vec4(0.2, 0.3, 1.0, 200);

    // vec2 center = (lightPosition.xy + 1.0) * (iResolution.xy * 0.5);
    // vec2 center = lightPosition.xy
    float distToSurf = length(lightPosition.xy / uCameraZoom - gl_FragCoord.xy / uCameraZoom);
    float radius = 1.0 - distToSurf / lightRadius;
    /* if (distToSurf > 50.0) {
        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
        return; 
    } */
    /* if (radius > 0.5) {
        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
        return; 
    } */
    
    float intensity = smoothstep(0.0, 1.0, radius * lightAttenuation);
    /* if (intensity == 0.0) {
        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
        return;
    } */

    vec4 color = vec4(intensity, intensity, intensity, 0.0) * lightColor;
    gl_FragColor = vec4(color.rgb * lightColor.a, color.a);
}
`;class Ms extends Phaser.Renderer.WebGL.Pipelines.SinglePipeline{static KEY="GlowLightPipeLine";constructor(e){super({game:e,fragShader:sC})}onRender(e,t){this.set1f("uCameraZoom",t.zoom)}}const{KEY:iC,FRAME:nC}=L.DEFAULT_8_BIT;class xt extends Phaser.GameObjects.Container{config;shaderSprite;isWebGl=!0;lightRadius=0;constructor(e,t){super(e),this.config={background:0,bottomRightCorner:221341,rightEdge:423092,bottomEdge:83583,mainTopColorGradient:732242,mainBotColorGradient:155294,shadowHeight:7,bgCornerStrokeWidth:2,topInnerCornerStrokeWidth:4,botInnerCornerStrokeWidth:4,rightInnerCornerStrokeWidth:4,lightX:0,lightY:0,...t},this.scene.game.canvas.getContext("webgl")||(this.isWebGl=!1),this.isWebGl&&!this.scene.game.renderer.pipelines.pipelines.has(Ms.KEY)&&this.scene.game.renderer.pipelines.add(Ms.KEY,new Ms(this.scene.game)),this.setDepth(W.POPUP),this.createGraphicsPopup(),this.createShaderSprite(),this.createLightEffect(),this.updateSize(),this.scene.add.existing(this)}updateSize(){const{width:e,height:t}=this.config;this.setSize(e,t)}createGraphicsPopup(){const{x:e,y:t,width:s,height:i,background:n,bottomRightCorner:r,rightEdge:c,bottomEdge:o,mainBotColorGradient:l,mainTopColorGradient:h,shadowHeight:d,bgCornerStrokeWidth:u,topInnerCornerStrokeWidth:p,botInnerCornerStrokeWidth:g,rightInnerCornerStrokeWidth:f}=this.config,m=this.scene.make.graphics({}),E=new Phaser.Geom.Rectangle(e-s/2,t-i/2,s,i);m.fillStyle(0,.3),m.fillRoundedRect(E.left,E.bottom-10,E.width,10+d,{tl:0,tr:0,bl:12,br:12}),m.fillStyle(n),m.fillRoundedRect(E.left,E.top,E.width,E.height,{tl:8,tr:8,bl:12,br:12}),m.fillStyle(r),m.fillRoundedRect(E.left+u,E.bottom-50,E.width-u*2,50-u,{tl:0,tr:0,bl:30,br:8}),m.fillStyle(c),m.fillRoundedRect(E.left+u,E.top+u,E.width-u*2,E.height-u*2-g,{tl:8,tr:8,bl:30,br:12}),m.fillStyle(o),m.fillRoundedRect(E.left+u,E.bottom-50,E.width-u*2-f,50-u,{tl:8,tr:0,bl:8,br:3}),m.fillGradientStyle(h,h,l,l),m.fillRect(E.left+u,E.top+u+p+10,E.width-u*2-f,E.height-u*2-g-p-20),m.fillStyle(h),m.fillRoundedRect(E.left+u,E.top+u+p,E.width-u*2-f,10,{tl:8,tr:8,bl:0,br:0}),m.fillStyle(l),m.fillRoundedRect(E.left+u,E.bottom-u-g-10,E.width-u*2-f,7,{tl:0,tr:0,bl:3,br:0}),this.add(m)}createShaderSprite(){const{width:e,height:t}=this.config,s=this.scene.make.image({key:iC,frame:nC.BLANK});s.setWorldSize(e,t),this.add(s),this.shaderSprite=s,this.shaderSprite.kill()}createLightEffect(){if(!this.isWebGl)return;const{width:e,mainTopColorGradient:t}=this.config;this.shaderSprite.revive(),this.shaderSprite.setPipeline(Ms.KEY);const s=Phaser.Display.Color.ColorToRGBA(t),i=new Phaser.Display.Color(s.r,s.g,s.b,s.a);i.lighten(90);const n=Phaser.Display.Color.ColorToRGBA(i.color),r=this.scene.game.canvas.getContext("webgl")?.drawingBufferWidth,c=this.scene.game.canvas.getContext("webgl")?.drawingBufferHeight;if(!r||typeof r!="number"||!c||typeof c!="number")return;this.lightRadius=e/1.2,this.recalculateLightPosition();const o=1,l=1,h=.4;this.shaderSprite.pipeline.set2f("iResolution",r,c),this.shaderSprite.pipeline.set4f("lightColor",n.r/255*o,n.g/255*o,n.b/255*o,h),this.shaderSprite.pipeline.set1f("lightRadius",this.lightRadius),this.shaderSprite.pipeline.set1f("lightAttenuation",l)}turnOffLight(){this.shaderSprite.kill(),this.shaderSprite.resetPipeline()}recalculateLightPosition(){if(!this.isWebGl||!this.shaderSprite.active)return;const{lightX:e,lightY:t}=this.config,{displayWidth:s,displayHeight:i}=this.scene.gameZone,n=this.scene.game.canvas.getContext("webgl")?.drawingBufferWidth,r=this.scene.game.canvas.getContext("webgl")?.drawingBufferHeight;if(!n||typeof n!="number"||!r||typeof r!="number")return;const c=this.shaderSprite.getWorldPosition();//! if 0, 0 is center of screen, need to be adjust
const o=n*(c.x+e)/s,l=r*(i-(c.y+t))/i;this.shaderSprite.pipeline.set4f("lightPosition",o,l,1e3,this.lightRadius),this.shaderSprite.pipeline.set1f("lightRadius",this.lightRadius)}}class aC extends Phaser.GameObjects.Container{config;isEnable;maxHeight;isScrolling;boundTop;boundBottom;maskGraphics;objects;_value=0;velocity=0;isScrollingSmooth;lastScrollY;isScrollingBack;scrollingBackTo;lastScrollYCount=0;onScrollEvents=[];get marginTop(){return this.config.marginTop}get marginBottom(){return this.config.marginBottom}get acceleration(){return this.config.acceleration}get maxScrollOver(){return this.config.maxScrollOver}get scrollSmooth(){return this.config.scrollSmooth}get scrollingBackRate(){return this.config.scrollingBackRate}constructor(e,t){super(e),this.config={marginTop:0,marginBottom:0,acceleration:1400,maxScrollOver:.15,scrollSmooth:40,scrollingBackRate:5,...t};const{width:s,height:i}=t;this.isEnable=!1,this.maxHeight=0,this.lastScrollY=new Array(3).fill(0),this.setSize(s,i),this.createGroup(),this.createInput(),this.createEvents(),this.scene.add.existing(this)}onScroll(e){this.onScrollEvents.push(e)}get value(){return this._value}set value(e){const t=e-this._value;this._value=e,this.updateObject(t)}gotoTop(){this.value=this.config.marginTop}reset(){this.maxHeight=0,this.isScrolling=!1,this.isScrollingBack=!1,this.isScrollingSmooth=!1,this.gotoTop(),this.setEnable(!1)}createDebug(){const e=this.drawDebugBox(16711680,.8);console.log(e?.x,e?.y,e?.displayWidth,e?.displayHeight)}setEnable(e){this.isEnable=e,e?this.setInteractive({draggable:!0,useHandCursor:!0}):this.disableInteractive()}addItem(e){this.addAt(e),this.objects.add(e);const{y:t,height:s}=e,i=t+s+this.marginBottom-this.height/2;this.maxHeight=Math.max(this.maxHeight,i,0),this.updateObjectVisible()}addItems(e){this.addAt(e),this.objects.addMultiple(e);const t=e.map(s=>s.y+s.height+this.marginBottom-this.height/2);this.maxHeight=Math.max(this.maxHeight,Math.max(...t),0),this.updateObjectVisible()}clearItem(){this.objects.clear(!0,!0),this.reset()}getChildren(){return this.objects.getChildren().filter(e=>e.active)}createBound(e,t,s,i){this.boundTop=this.scene.make.image({key:e,frame:t}),this.boundBottom=this.scene.make.image({key:e,frame:t}),this.boundTop.setTint(i),this.boundBottom.setTint(i),this.boundTop.setAlpha(1,1,0,0),this.boundBottom.setAlpha(0,0,1,1),this.boundTop.setDepth(W.PRIORITY),this.boundBottom.setDepth(W.PRIORITY);const n=this.width,r=s,{x:c,y:o}=this.getWorldPosition();this.boundTop.setDisplaySize(n,r),this.boundBottom.setDisplaySize(n,r),this.boundTop.setY(-this.displayHeight/2+r/2+o-this.y-1),this.boundBottom.setY(this.displayHeight/2-r/2+o-this.y+1),this.boundTop.setX(c-this.x),this.boundBottom.setX(c-this.x),this.add([this.boundTop,this.boundBottom])}createMask(){this.maskGraphics?.destroy(),this.maskGraphics=this.scene.make.graphics({fillStyle:{color:255,alpha:1}}),this.maskGraphics.setName("MaskGraphics");const e=this.width,t=this.height;this.maskGraphics.fillRoundedRect(0-e/2,0-t/2,e,t,0),this.setMask(this.maskGraphics.createGeometryMask()),this.scene.events.off(Phaser.Scenes.Events.UPDATE,this.updateMask,this),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.updateMask,this)}updateMask(){const{x:e,y:t}=this.getWorldPosition();this.maskGraphics.setPosition(e,t)}createGroup(){this.objects=this.scene.make.group({})}updateObject(e){this.objects.incY(e),this.updateObjectVisible()}updateObjectVisible(){const e=this.objects.getChildren();for(let t=0;t<e.length;t++){const s=e[t];s.y+s.height<-this.height/2||s.y-s.height>this.height/2?s.setVisible(!1):s.setVisible(!0)}}createInput(){this.setInteractive({draggable:!0,useHandCursor:!0}),this.on(Phaser.Input.Events.POINTER_WHEEL,this.onMouseScroll),this.on(Phaser.Input.Events.GAMEOBJECT_DRAG,this.onTouchScroll),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onTouchDown),this.scene.input.on(Phaser.Input.Events.POINTER_UP,this.onTouchEnd,this)}createEvents(){this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=(e,t)=>{this.isScrollingSmooth&&this.velocity&&this.scrollingSmooth(t),this.isScrollingBack&&this.scrollingBack(t)};callOnScrollEvents(e,t){for(const s of this.onScrollEvents)s(this,e,t)}scrollingBack(e){const t=(this.scrollingBackTo-this.value)*e*this.scrollingBackRate/1e3;this.value+=t,Math.abs(this.scrollingBackTo-this.value)<.5&&(this.value=this.scrollingBackTo,this.stopScrollingBack()),this.callOnScrollEvents(this.value,t)}startScrollingBack(e){this.isScrollingBack=!0,this.scrollingBackTo=e}stopScrollingBack(){this.isScrollingBack=!1}scrollingSmooth(e){const t=this.velocity*e/1e3;this.value+=t;const s=Math.abs(this.velocity)/this.velocity;this.velocity-=s*this.acceleration*e/1e3,Math.abs(this.velocity)<this.acceleration*e/1e3&&this.stopScrollSmooth(),this.isReachTop()&&(this.startScrollingBack(this.marginTop),this.stopScrollSmooth()),this.isReachBottom()&&(this.startScrollingBack(-this.maxHeight),this.stopScrollSmooth()),this.callOnScrollEvents(this.value,t)}startScrollSmooth(e){this.isScrollingSmooth=!0,e&&(e*this.velocity>0?this.velocity+=e:this.velocity=e)}stopScrollSmooth(){this.isScrollingSmooth=!1,this.isScrolling=!1,this.velocity=0}isReachTop(){return this.value>this.marginTop}isReachBottom(){return-this.value>this.maxHeight}checkReachBound=()=>this.isReachTop()||this.isReachBottom();onMouseScroll=Ts((e,t,s)=>{if(!this.isEnable)return;if(this.isScrolling=!0,this.checkReachBound()){this.lastScrollY=this.lastScrollY.map(()=>0),this.isScrolling=!1;return}this.stopScrollingBack(),this.startScrollSmooth(-s*this.scrollSmooth/15)},100,{isImmediate:!0,maxWait:100});onTouchScroll=e=>{if(!this.isEnable)return;this.velocity&&this.stopScrollSmooth(),this.stopScrollingBack(),this.isScrolling=!0;const t=this.scene.game.world.getZoomRatio(),{position:s,prevPosition:i}=e,n=(s.y-i.y)/t,r=this.height*this.maxScrollOver;let c=1;if(this.lastScrollY[++this.lastScrollYCount%this.lastScrollY.length]=n,this.isReachTop()&&n>=0){const h=(r-(this.value-this.marginTop))/r;c=Math.min(c,h)}if(this.isReachBottom()&&n<=0){const h=(r-(-this.maxHeight-this.value))/r;c=Math.min(c,h)}const o=n*c,l=this.maxScrollOver*this.height;this.value+o>this.marginTop+l?this.value=this.marginTop+l:this.value+o<-this.maxHeight-l?this.value=-this.maxHeight-l:this.value+=o,this.callOnScrollEvents(this.value,o)};onTouchDown=()=>{this.isEnable&&(this.velocity&&this.stopScrollSmooth(),this.stopScrollingBack())};onTouchEnd=()=>{if(this.isReachTop()&&(this.startScrollingBack(this.marginTop),this.stopScrollSmooth()),this.isReachBottom()&&(this.startScrollingBack(-this.maxHeight),this.stopScrollSmooth()),!this.isScrolling)return;const e=this.lastScrollY.reduce((t,s)=>t+s)/this.lastScrollY.length;this.startScrollSmooth(e*this.scrollSmooth),this.lastScrollY=this.lastScrollY.map(()=>0)}}class wv extends Phaser.GameObjects.GameObject{constructor(e){super(e,"UpdateAbleObject")}updateInfo}class tl extends aC{classType;listConfigs;padding;startObjectIndex;endObjectIndex;listObjects;constructor(e,t){super(e,t),this.classType=t.classType,this.listConfigs=t.listConfigs,this.padding=t.padding?t.padding:0,this.objects.classType=this.classType,this.updateConfig(this.listConfigs)}reset(){super.reset(),this.killAndHideAll()}getChildren(){return this.listObjects.filter(e=>e!=null&&e.active)}get objHeight(){const e=this.objects.getChildren();return e.length==0?this.maxHeight=0:e[0].height}updateConfig(e){this.reset(),this.listConfigs=e,this.listObjects=new Array(e.length).fill(void 0),this.addObjectIndex(0,0);const t=this.getEndObjectIndex();this.addObjectIndex(1,t),this.startObjectIndex=this.getStartObjectIndex(),this.endObjectIndex=this.getEndObjectIndex(),this.updateMaxHeight(),this.value=this.marginTop}getConfig(){return this.listConfigs}killAndHideAll(){this.listObjects instanceof Array&&this.listObjects.map(e=>{e!==void 0&&this.objects.killAndHide(e)})}setItemPosition(e,t){const s=e.height;e.setPosition(0,s/2+(s+this.padding)*t-this.height/2)}updateMaxHeight(){return this.maxHeight=Math.max(this.listConfigs.length*(this.objHeight+this.padding)-this.padding+this.marginBottom-this.height,0)}updateObject(e){this.objects.incY(e);const t=this.getStartObjectIndex(),s=this.getEndObjectIndex();t!=this.startObjectIndex&&(t>this.startObjectIndex?this.killObjectIndex(this.startObjectIndex,t-1):this.addObjectIndex(t,this.startObjectIndex-1),this.startObjectIndex=t),s!=this.endObjectIndex&&(s<this.endObjectIndex?this.killObjectIndex(s+1,this.endObjectIndex):this.addObjectIndex(this.endObjectIndex+1,s),this.endObjectIndex=s)}killObjectIndex(e,t){for(let s=e;s<=t;s++){const i=this.listObjects[s];i&&(this.objects.killAndHide(i),this.listObjects[s]=void 0)}}addObjectIndex(e,t){for(let s=e;s<=t;s++){const{padding:i,listConfigs:n}=this;if(s>=n.length)return;const r=this.objects.getFirstDead(!0),c=r.height,o=c/2+(c+i)*s+this.value-this.height/2;r.updateInfo(n[s]),r.setPosition(0,o),r.setActive(!0),r.setVisible(!0),this.addAt(r),this.listObjects[s]=r}}getStartObjectIndex(){const{objHeight:e,padding:t}=this;return Math.max(Math.floor((0-this.value)/(e+t)),0)}getEndObjectIndex(){const{objHeight:e,padding:t,listConfigs:s}=this,i=e+t;return Math.min(Math.floor((this.height-this.value)/i),s.length)}}const rC={targets:[],props:{alpha:{start:0,to:1,duration:500,ease:Phaser.Math.Easing.Cubic.Out},scale:{start:.8,to:1,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}},delay:0};class it extends Le{constructor(e){super(rC,e)}}const{KEY:Ir,FRAME:Ze}=L.DEFAULT_8_BIT;class oC extends Phaser.GameObjects.Container{avatar;rankIcon;rankText;username;score;scoreText;background;showPopUp;showItems;payload;constructor(e,t){super(e),this.createBackground(),this.updateSize(),this.createRank(),this.createAvatar(),this.createUsername(),this.createScore(),t&&this.updateInfo(t),this.scene.add.existing(this)}updateInfo(e){this.payload={extraData:"",isHighlight:!1,...e},this.updateBackground(),this.updateAvatar(),this.updateRank(),this.updateUsername(),this.updateScore()}createBackground(){this.background=this.scene.make.image({key:Ir,frame:Ze.LEADERBOARD_BG_DARK}),this.add(this.background),this.updateBackground()}updateBackground(){const{isHighlight:e=!1}=this.payload||{};e?(this.background.setFrame(Ze.LEADERBOARD_BG_LIGHT),this.background.setWorldSize(313.5,41)):(this.background.setFrame(Ze.LEADERBOARD_BG_DARK),this.background.setWorldSize(314.5,42))}updateSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}createAvatar(){this.avatar=new Dn(this.scene,{size:42,loadDelay:300}),this.add(this.avatar),Phaser.Display.Align.In.LeftCenter(this.avatar,this.rankIcon,-40)}updateAvatar(){const{playerId:e,photo:t}=this.payload;this.avatar.loadPhoto(e,t)}createRank(){this.createRankIcon(),this.createRankText()}updateRank(){const{rank:e=99}=this.payload||{};this.updateRankIcon(e),this.updateRankText(e)}getRankIconFrame(e){let t=null;switch(e){case 1:t=Ze.LEADERBOARD_RANK_GOLD;break;case 2:t=Ze.LEADERBOARD_RANK_SILVER;break;case 3:t=Ze.LEADERBOARD_RANK_COPPER;break}return t}createRankIcon(){this.rankIcon=this.scene.make.image({key:Ir}),this.updateRankIcon(1),this.kill(),this.add(this.rankIcon),Phaser.Display.Align.In.LeftCenter(this.rankIcon,this)}updateRankIcon(e){const t=this.getRankIconFrame(e);if(!t){this.rankIcon.kill();return}this.rankIcon.revive(),this.rankIcon.setFrame(t),t==Ze.LEADERBOARD_RANK_GOLD&&this.rankIcon.setWorldSize(39,34.5),t==Ze.LEADERBOARD_RANK_SILVER&&this.rankIcon.setWorldSize(32.5,32),t==Ze.LEADERBOARD_RANK_COPPER&&this.rankIcon.setWorldSize(27,35.5)}createRankText(){this.rankText=this.scene.make.text({text:"0",style:{fontFamily:k.FONT_FAMILY,fontSize:"16px",color:"#ffffff",stroke:"#000000",strokeThickness:3}}),this.rankText.setHighQuality(),this.rankText.kill(),this.add(this.rankText),Phaser.Display.Align.In.Center(this.rankText,this.rankIcon,0,-1)}updateRankText(e){this.rankText.kill(),e>3&&this.rankText.revive(),this.rankText?.setText(`${e}`)}getShortName(e){const t=e.substring(0,7);return t.split(" ")[0]||t}createUsername(){this.username=this.scene.make.text({text:"Player",style:{fontFamily:k.SYSTEM_FAMILY_FONT,fontSize:"16px",fontStyle:"bold",color:"#ffffff"}}),this.username.setHighQuality(),Phaser.Display.Align.In.LeftCenter(this.username,this.avatar,-53),this.add(this.username)}updateUsername(){const e=this.payload.name;this.username.setText(this.getShortName(e))}createScore(){this.score=this.scene.add.container(),this.scoreText=this.scene.make.text({text:"99999",style:{fontFamily:k.FONT_FAMILY,fontSize:"16px",color:"#ffffff",stroke:"#000000",strokeThickness:2}}),this.scoreText.setOrigin(1,.5),this.scoreText.setHighQuality(),this.score.add(this.scoreText),this.add(this.score),Phaser.Display.Align.In.RightCenter(this.score,this,-10)}updateScore(){const{score:e="0"}=this.payload||{};this.scoreText.setText(`${e}`)}runShowPopUpAnimation(e,t){this.scene.tweens.killTweensOf(this),this.showPopUp=new it({targets:[this],delay:e,duration:t,props:{y:{start:this.y+70,to:this.y}}}),this.showPopUp.play()}runShowItemAnimation(e,t){const s=this.getAll();this.scene.tweens.killTweensOf(s),this.showItems=new Dc({targets:s,duration:t,delay:this.scene.tweens.stagger(50,{start:e+50}),props:{scale:{duration:1e3,getStart:i=>i.scale*.8,getEnd:i=>i.scale,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}},onStart:()=>{this.showItems.baseScales=s.map(i=>i.scale)},onStop:()=>{s.forEach((i,n)=>{i.scale=this.showItems.baseScales[n]})}}),this.showItems.play()}runShowUpAnimation(e=0,t=300){const s=e*100;this.runShowPopUpAnimation(s,t),this.runShowItemAnimation(s,t)}}const{Limit:cC}=GameCore.Configs.LeadersBoard;class lC extends Phaser.GameObjects.Container{currentPlayerId;isUpdating;scroller;constructor(e){super(e),this.scene=e;const{player:t}=this.scene;this.currentPlayerId=t.getPlayerId(),this.isUpdating=!1,this.createReuseScroller(),this.scene.add.existing(this)}createReuseScroller(){this.scroller=new tl(this.scene,{classType:oC,listConfigs:[],width:320,height:290,padding:10,marginTop:10,marginBottom:10}),this.scroller.createMask(),this.scroller.setPosition(0,0),this.add(this.scroller)}updateData(e){if(this.isUpdating)return;this.isUpdating=!0;const t=Object.values(e)||[];if(t.length<1){this.showLeaderboardIsEmpty();return}const s=t.sort((r,c)=>+c.score-+r.score),i=[];let n=1;for(const r of s){if(i.length>=cC)break;const{playerId:c,photo:o,score:l,name:h}=r;if(!c||!h)continue;const d=this.currentPlayerId===c,u={playerId:c,photo:o||M.AVATAR.FILE,name:h,rank:n,score:l,isHighlight:d};i.push(u),n++}this.scroller.updateConfig(i),this.showLeaders()}removeLeaders(){this.scroller.updateConfig([])}getLeaders(){return this.scroller.getChildren()}showLeaders(){const e=this.getLeaders(),t=Math.min(e.length,6),s=300;for(let n=0;n<t;n++){const r=e[n];r&&(r.setVisible(!0),r.runShowUpAnimation(n,s))}const i=s+t*100+50*5;this.scene.time.delayedCall(i,()=>{const n=this.scene.screen.get(P.LEADER_BOARD_SCREEN);this.isUpdating=!1,n.isSwitchable=!0,this.scroller.setEnable(!0)})}showLeaderboardIsEmpty(){const e=this.scene.screen.get(P.LEADER_BOARD_SCREEN);this.isUpdating=!1,e.isSwitchable=!0,e.board.showMessage(!0,this.scene.lang.Text.LEADERBOARD_IS_EMPTY)}}class hC extends Phaser.GameObjects.Container{constructor(e){super(e),this.createRankText(),this.createPhotoText(),this.createNameText(),this.createLevelText()}createRankText(){const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(14),text:this.scene.lang.Text.RANK,origin:{x:.2,y:.5}});this.add(e),Phaser.Display.Align.In.Center(e,this,-138)}createPhotoText(){const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(14),text:this.scene.lang.Text.PHOTO,origin:{x:.2,y:.5}});this.add(e),Phaser.Display.Align.In.Center(e,this,-94)}createNameText(){const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(14),text:this.scene.lang.Text.NAME,origin:{x:.2,y:.5}});this.add(e),Phaser.Display.Align.In.Center(e,this,-45)}createLevelText(){const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(14),text:this.scene.lang.Text.LEVEL,origin:{x:.2,y:.5}});this.add(e),Phaser.Display.Align.In.Center(e,this,135)}}const{KEY:uC,FRAME:dC}=L.DEFAULT_8_BIT,{KEY:pC,FRAME:gC}=L.DEFAULT;let fC=class extends Phaser.GameObjects.Container{background;titleText;titleRibbon;header;leaders;loading;message;messageAnimation;onClose;constructor(e){super(e),this.setName("Board"),this.createBackground(),this.createLoading(),this.createMessage(),this.createContents(),this.createCloseButton(),this.createAnimation(),this.updateSize(),this.scene.add.existing(this)}updateSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}showLoading(e){this.loading.setVisible(e),this.showMessage(!1)}showMessage(e,t){this.message.setVisible(e),t&&(this.message.setText(t),this.messageAnimation.play())}createBackground(){this.background=new xt(this.scene,{x:0,y:0,width:332,height:404.5,topInnerCornerStrokeWidth:1,rightInnerCornerStrokeWidth:3,lightY:-80}),this.add(this.background),this.setSize(this.background.width,this.background.height)}recalculateLightPosition(){this.background&&this.background.recalculateLightPosition()}createLoading(){this.loading=new _s(this.scene),this.loading.setTint(16777215),this.loading.setWorldSize(113,113),this.add(this.loading),Phaser.Display.Align.In.Center(this.loading,this.background)}createMessage(){this.message=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(18),origin:{x:.5,y:.5}}),this.message.setTint(16777215),this.add(this.message),Phaser.Display.Align.In.Center(this.message,this.background)}createContents(){this.createLeaders(),this.createTitle(),this.createHeader()}createLeaders(){this.leaders=new lC(this.scene),this.add(this.leaders),Phaser.Display.Align.In.Center(this.leaders,this.background,0,30)}createTitle(){const e=this.scene.add.container();e.setName("title");const t=this.scene.make.image({key:pC,frame:gC.RIBBON_BLUE});t.setWorldSize(239,67);const s=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(22),text:this.scene.lang.Text.LEADERBOARD});Phaser.Display.Align.In.Center(s,t,0,-10),e.add([t,s]),Phaser.Display.Align.In.TopCenter(e,this.background,0,-25),this.add(e),this.titleText=s,this.titleRibbon=t}createHeader(){const e=this.scene.add.container(),t=this.scene.make.image({key:uC,frame:dC.LEADERBOARD_TAB_BG});t.setX(1),t.setWorldSize(329,29),this.header=new hC(this.scene),e.add([t,this.header]),this.add(e),Phaser.Display.Align.In.TopCenter(this.header,e),Phaser.Display.Align.In.Center(e,this.background,-1,-125)}createCloseButton(){const e=new Ut(this.scene);Phaser.Display.Align.In.TopRight(e,this,10,10),this.add(e),e.onClick=this.handleOnCloseClick}handleOnCloseClick=()=>{this.onClose&&this.onClose()};createAnimation(){this.messageAnimation=new el({targets:[this.message],duration:60,repeat:2})}};const{Name:Cr,Limit:Rr}=GameCore.Configs.LeadersBoard;class _r extends GameCore.Screen{scene;board;tabId;offset;isSwitchable;showPopupAnimation;fadeOutAnimation;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.background.setAlpha(.7),this.setDepth($e.POPUP),this.createBoard()}open(){super.open();const e=this.scene.scene.get(K.GAME_SCENE);e instanceof ee&&e.screenManager.listenResizeEventForCalculateLight(this),this.scene.requestBackgroundMaskUpdate(P.LEADER_BOARD_SCREEN,this.background.alpha),this.runPopupAnimation(),this.isSwitchable=!1,this.selectWorldTab()}close(){super.close(),this.scene.requestBackgroundMaskUpdate(P.LEADER_BOARD_SCREEN,0)}selectFriendTab(){this.tabId=pT,this.offset=0,this.board.showLoading(!0),this.board.header.kill(),this.board.leaders.removeLeaders(),this.fetchLeaderboardData("friends")}selectWorldTab(){this.tabId=dT,this.offset=0,this.board.showLoading(!0),this.board.header.kill(),this.board.leaders.removeLeaders(),this.fetchLeaderboardData("world")}createBoard(){this.board=new fC(this.scene),this.board.onClose=this.handleCloseClick,Phaser.Display.Align.In.Center(this.board,this,0,-20),this.add(this.board);const e=this.scene.lang.getCurrentLanguage();let t=22;switch(e){case"es":t=19;break}this.board.titleText.setFontSize(t),Phaser.Display.Align.In.Center(this.board.titleText,this.board.titleRibbon,0,-10)}recalculateLightPosition(){this.board&&this.board.recalculateLightPosition()}handleCloseClick=()=>{this.runFadeOutAnimation()};async fetchLeaderboardData(e){console.info("🚀 > fetchLeaderboardData",e);const t={};try{if(!Cr)return;const s=await GameSDK.getLeaderboardAsync(Cr);let i=[];e==="world"?i=await s.getEntriesAsync(Rr,0):i=await s.getConnectedPlayerEntriesAsync(Rr,0),i.forEach(n=>{const{playerId:r,score:c,rank:o}=n,l=n.getPlayer(),h=l.getName(),d=l.getPhoto();t[r]={playerId:r,name:h,photo:d,score:c,rank:o}})}catch(s){console.warn(s)}finally{this.isSwitchable=!0,this.board.showLoading(!1),this.board.leaders.updateData(t),this.board.header.revive()}}runPopupAnimation(){this.showPopupAnimation||(this.showPopupAnimation=new it({targets:[this.board]})),this.showPopupAnimation.play()}runFadeOutAnimation(){this.visible&&(this.fadeOutAnimation||(this.fadeOutAnimation=new Ye({targets:[this.background],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.7,from:.7,to:0}},onActive:()=>{this.board.kill()},onUpdate:(e,t)=>{this.scene.requestBackgroundMaskUpdate(P.LEADER_BOARD_SCREEN,t.alpha)},onComplete:()=>{this.board.revive();const e=this.scene.scene.get(K.GAME_SCENE);e instanceof ee&&e.screenManager.removeResizeEventForCalculateLight(this),this.background.setAlpha(.7),this.scene.screen.close(this.name)}})),this.fadeOutAnimation.play())}}class EC extends Phaser.GameObjects.Container{payload;process;minProcess;maxProcess;progressBoxLeft;progressBoxBg;progressBoxRight;progressBarLeft;progressBarBg;progressBarRight;progressAnimation;constructor(e,t){super(e),this.payload=t;const s=t.width,i=39;this.setSize(s,i),this.process=0,this.minProcess=0,this.maxProcess=1,this.createProgressBox(),this.createProgressBar(),this.createContainer()}setProcess(e,t=!1){if(this.process=this.getCorrectValue(e),!this.scene||t){this.updateProcess();return}this.runProcessAnimation(e)}updateProcess(){const{displayHeight:e}=this.progressBarBg,t=this.getDisplayWidthByProcess(this.process);this.progressBarBg.setWorldSize(t,e);const{x:s}=this.progressBarBg;this.progressBarRight.setX(s+t)}getCorrectValue(e){let t=e;return isFinite(t)||(t=0),t<this.minProcess&&(t=this.minProcess),t>this.maxProcess&&(t=this.maxProcess),t}getDisplayWidthByProcess(e){const{width:t}=this;return(t-17)*e}getProcessByDisplayWidth(e){const{width:t}=this;return e/(t-17)}runProcessAnimation(e){this.progressAnimation?.remove(),this.progressAnimation=this.scene.add.tween({targets:[this.progressBarBg],duration:1e3,ease:Phaser.Math.Easing.Quadratic.InOut,props:{displayWidth:()=>{const t=this.getCorrectValue(e);return this.getDisplayWidthByProcess(t)}},onUpdate:()=>{const{x:t,displayWidth:s}=this.progressBarBg;this.progressBarRight.setX(t+s)},onComplete:()=>{this.updateProcess()}})}createProgressBox(){const{key:e,frames:t}=this.payload;this.progressBoxLeft=this.scene.make.image({key:e,frame:t.PROGRESS_BG_LEFT}),this.progressBoxLeft.setOrigin(0,.5),this.progressBoxLeft.setWorldSize(9,39),this.progressBoxRight=this.scene.make.image({key:e,frame:t.PROGRESS_BG_RIGHT}),this.progressBoxRight.setOrigin(0,.5),this.progressBoxRight.setWorldSize(9,39),this.progressBoxBg=this.scene.make.image({key:e,frame:t.PROGRESS_BG_MID}),this.progressBoxBg.setOrigin(0,.5),this.progressBoxBg.setWorldSize(9,39);const{displayHeight:s}=this.progressBoxBg,{displayWidth:i}=this,{displayWidth:n}=this.progressBoxLeft,{displayWidth:r}=this.progressBoxRight;this.progressBoxLeft.setWorldSize(n,s),this.progressBoxRight.setWorldSize(r,s),this.progressBoxBg.setWorldSize(i-(n+r),s),Phaser.Display.Align.In.Center(this.progressBoxBg,this,0,0),Phaser.Display.Align.In.LeftCenter(this.progressBoxLeft,this,0,0),Phaser.Display.Align.In.RightCenter(this.progressBoxRight,this,0,0)}createProgressBar(){const{key:e,frames:t}=this.payload;this.progressBarLeft=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_LEFT}),this.progressBarLeft.setOrigin(0,.5),this.progressBarLeft.setWorldSize(8.5,32),this.progressBarRight=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_RIGHT}),this.progressBarRight.setOrigin(0,.5),this.progressBarRight.setWorldSize(8.5,32),this.progressBarBg=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_MID}),this.progressBarBg.setOrigin(0,.5),this.progressBarBg.setWorldSize(8.5,32);const s=-2,i=-1.6,n=-7;Phaser.Display.Align.In.LeftCenter(this.progressBarBg,this,n,i),Phaser.Display.Align.In.LeftCenter(this.progressBarLeft,this,s,i),Phaser.Display.Align.In.LeftCenter(this.progressBarRight,this,s,i),this.setProcess(0,!0)}createContainer(){this.add([this.progressBoxBg,this.progressBoxLeft,this.progressBoxRight,this.progressBarBg,this.progressBarLeft,this.progressBarRight]),this.scene.add.existing(this)}}const{KEY:mC,FRAME:AC}=L.DEFAULT;class SC extends EC{loadingText;constructor(e,t){super(e,{key:mC,frames:AC,width:t}),this.createLoadingText()}createLoadingText(){this.loadingText=this.scene.add.text(0,0,`${this.scene.lang.Text.LOADING}0%`,{fontFamily:k.FONT_FAMILY,fontSize:"20px",color:"#ffffff",stroke:"#000000",strokeThickness:3,fixedWidth:13*20,align:"center"}),this.loadingText.setHighQuality(),this.loadingText.setShadow(0,12,"#000000",0,!0),this.add(this.loadingText),Phaser.Display.Align.In.Center(this.loadingText,this,0,-2)}updateProcess(){const{displayHeight:e}=this.progressBarBg,t=this.getDisplayWidthByProcess(this.process);this.progressBarBg.setWorldSize(t,e);const{x:s}=this.progressBarBg;if(this.progressBarRight.setX(s+t),this.loadingText){const i=Math.floor(this.getProcessByDisplayWidth(t)*100);this.loadingText.setText(`${this.scene.lang.Text.LOADING}${i}%`)}}runProcessAnimation(e){this.progressAnimation?.stop(),this.progressAnimation?.remove(),this.progressAnimation=this.scene.add.tween({targets:[this.progressBarBg],duration:600,ease:Phaser.Math.Easing.Circular.InOut,props:{displayWidth:()=>{const t=this.getCorrectValue(e);return this.getDisplayWidthByProcess(t)}},onUpdate:()=>{const{x:t,displayWidth:s}=this.progressBarBg;this.progressBarRight.setX(t+s);const i=Math.floor(this.getProcessByDisplayWidth(s)*100);this.loadingText.setText(`${this.scene.lang.Text.LOADING}${i}%`)},onComplete:()=>{this.updateProcess()}})}}const{KEY:yC}=L.DEFAULT_8_BIT;class TC extends GameCore.Screen{progressBar;constructor(e,t,s,i){super(e,t,s,i),this.background.setAlpha(.8),this.setDepth($e.SPLASH),this.createTitleIcon(),this.createProgressBar(),this.scene.game.scene.getScene(K.LOAD_SCENE).load.on(Phaser.Loader.Events.PROGRESS,r=>{this.progressBar.setProcess(r)})}open(e){super.open(e),this.progressBar.setProcess(0,!0),this.scene.requestBackgroundMaskUpdate(P.LOADING_SCREEN,.8),this.scene.time.delayedCall(200,()=>{this.progressBar.setProcess(.2)})}close(){this.scene.scene.resume(K.GAME_SCENE),this.scene.time.delayedCall(600,()=>{const e=this.scene;e.requestBackgroundMaskUpdate(P.LOADING_SCREEN,0);const t=this.scene.screen.get(P.BATTLE_SCREEN);t&&!t.visible&&e.requestBackgroundMaskUpdate(P.BATTLE_SCREEN,0);const s=this.scene.screen.get(P.LEADER_BOARD_SCREEN);s&&!s.visible&&e.requestBackgroundMaskUpdate(P.LEADER_BOARD_SCREEN,0),this.progressBar.setProcess(1),super.close()})}createTitleIcon(){const e=this.scene.make.image({key:yC,frame:this.scene.lang.Texture.TITLE}),t=this.scene.lang.getCurrentLanguage();let s=213.5,i=157.5;switch(t){case"ja":s=149,i=157.5}e.setWorldSize(s,i),Phaser.Display.Align.In.Center(e,this,0,-150),this.add(e)}createProgressBar(){this.progressBar=new SC(this.scene,450),this.progressBar.setScale(.6),Phaser.Display.Align.In.Center(this.progressBar,this),this.add(this.progressBar)}}const IC={targets:[],duration:300,ease:Qc,props:{scale:{from:1.2,to:1}}};class is extends Le{constructor(e){super(IC,e)}}const{KEY:vr,FRAME:wr}=L.DEFAULT_8_BIT;class CC extends de{constructor(e){super(e,vr,wr.OFFLINE_REWARD_GREEN_BTN,128.5,45.5),this.createCoinIcon(),this.createText()}createCoinIcon(){const e=this.scene.make.image({key:vr,frame:wr.OFFLINE_REWARD_GOLD});e.setWorldSize(32.5,30.5),e.setPosition(-35,0),this.add(e)}createText(){const e=this.scene.lang.getCurrentLanguage();let t=15;switch(e){case"de":case"it":t=13;break}const s=this.scene.make.text({text:this.scene.lang.Text.COLLECT,style:{fontSize:`${t}px`,stroke:"#000000",strokeThickness:2,color:"#FFFFFF",fixedWidth:13*15,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.65}});s.setHighQuality(),s.setShadow(-8,8,"#000000",0,!0),Phaser.Display.Align.In.RightCenter(s,this.button,0,0),s.setPosition(15,0),this.add(s)}}const{KEY:RC,FRAME:_C}=L.DEFAULT_8_BIT;class vC extends Phaser.GameObjects.Container{text;constructor(e){super(e),this.createIcon(),this.createCoinText(),this.scene.add.existing(this)}createIcon(){const e=this.scene.make.image({key:RC,frame:_C.OFFLINE_REWARD_GOLDS});e.setWorldSize(55,39.5),e.setPosition(50,0),this.add(e)}createCoinText(){const e=this.scene.make.text({text:"+100 coins",style:{fontSize:"35px",stroke:"#000000",strokeThickness:1,color:"#F0DB0F",fixedWidth:455,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});e.setHighQuality(),e.setShadow(-8,8,"#000000",0,!0),e.setPosition(-30,0),this.add(e),this.text=e}setText(e){this.text.setText(`+${e}`)}}const{KEY:wC,FRAME:LC}=L.DEFAULT_8_BIT;class bC extends Phaser.GameObjects.Container{constructor(e){super(e),this.createRibbon(),this.createTitle(),this.scene.add.existing(this)}createRibbon(){const e=this.scene.make.image({key:wC,frame:LC.OFFLINE_REWARD_RIBBON});e.setWorldSize(247,43.5),this.add(e)}createTitle(){const e=this.scene.make.text({text:this.scene.lang.Text.OFFLINE_COINS_REWARDS,style:{fontSize:"15px",color:"#ffffff",stroke:"#000000",strokeThickness:2,fixedWidth:195,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});e.setHighQuality(),e.setShadow(-8,8,"#000000",0,!0),e.setPosition(0,-4),this.add(e)}}class sl extends Phaser.GameObjects.Container{payload;constructor(e,t){super(e),this.payload=t,this.createGraphics(),this.scene.add.existing(this)}createGraphics(){const{lineNumber:e=16}=this.payload;for(let t=0;t<e;t++){const s=this.drawCardinalTriangle(),i=Phaser.Math.DegToRad(t*(360/e));s.setPosition(0,0),s.setRotation(i),this.scene.add.existing(s),this.add(s)}}drawCardinalTriangle(){const{color:e,radius:t,width:s}=this.payload,i=Phaser.Math.Between(t.min,t.max),n=new Phaser.GameObjects.Graphics(this.scene);n.clear();const r=[{x:0,y:0}],c=Phaser.Math.Between(s.min,s.max),o=Phaser.Math.DegToRad(c),l={x:i,y:i*Math.tan(o)};r.push(l);const h={x:i,y:i*Math.tan(o)*-1};r.push(h),n.lineStyle(1,16777215,0),n.beginPath(),n.moveTo(r[0].x,r[0].y);for(let d=1;d<r.length;d++)n.lineTo(r[d].x,r[d].y);return n.closePath(),n.strokePath(),n.fillGradientStyle(e,e,e,e,0,1,0,1),n.fillPath(),n}}const{KEY:os,FRAME:cs}=L.DEFAULT_8_BIT;class PC extends Phaser.GameObjects.Container{listParticle=[];backEffect;tween;backEffectTween;constructor(e){super(e),this.createBackEffect(),this.createTicketCoin(),this.createParticle(),this.createAnimation(),this.scene.add.existing(this)}createBackEffect(){const e=new sl(this.scene,{color:234748,width:{min:4,max:8},radius:{min:180,max:170},lineNumber:18});e.setPosition(0,110),this.add(e),this.backEffect=e}createTicketCoin(){const e=this.scene.make.image({key:os,frame:cs.OFFLINE_REWARD_TICKET});e.setWorldSize(155.5,124.5),e.setPosition(0,110),this.add(e)}createParticle(){let e=this.scene.make.image({key:os,frame:cs.OFFLINE_REWARD_PARTICLE_1});e.setWorldSize(23,23),e.setPosition(-102,110-10),this.add(e),this.listParticle.push(e),e=this.scene.make.image({key:os,frame:cs.OFFLINE_REWARD_PARTICLE_1}),e.setWorldSize(23,23),e.setPosition(78,110+46),this.add(e),this.listParticle.push(e),e=this.scene.make.image({key:os,frame:cs.OFFLINE_REWARD_PARTICLE_2}),e.setWorldSize(14.5,15),e.setPosition(-90,110+19),this.add(e),this.listParticle.push(e),e=this.scene.make.image({key:os,frame:cs.OFFLINE_REWARD_PARTICLE_2}),e.setWorldSize(14.5,15),e.setPosition(100,110),this.add(e),this.listParticle.push(e),this.listParticle.push(e)}createAnimation(){const e=this.listParticle[0].scale;this.tween=this.scene.add.tween({paused:!0,targets:this.listParticle,duration:800,ease:Phaser.Math.Easing.Cubic.Out,repeat:-1,yoyo:!0,delay:this.scene.tweens.stagger(50,{start:Math.random()*50+50}),props:{scale:{from:e,to:e*Phaser.Math.FloatBetween(.7,.9)}}}),this.backEffectTween=this.scene.add.tween({paused:!0,targets:this.backEffect,duration:1e6,ease:Phaser.Math.Easing.Linear,repeat:-1,props:{rotation:{start:0,to:180}}})}runAnimation(){this.tween.resume(),this.backEffectTween.resume()}stopAnimation(){this.tween.pause(),this.backEffectTween.pause()}}const{KEY:Lr,FRAME:br}=L.DEFAULT_8_BIT;let OC=class extends de{constructor(e){super(e,Lr,br.OFFLINE_REWARD_YELLOW_BTN,128.5,45.5),this.createCoinIcon(),this.createText()}createCoinIcon(){const e=this.scene.make.image({key:Lr,frame:br.OFFLINE_REWARD_ADS});e.setWorldSize(32,30),e.setPosition(-40,-3),this.add(e)}createText(){const e=this.scene.lang.getCurrentLanguage();let t=15;switch(e){case"pt":case"es":t=12;break;case"de":case"it":t=13;break}const s=this.scene.make.text({text:this.scene.lang.Text.X2_COINS,style:{fontSize:`${t}px`,stroke:"#000000",strokeThickness:2,color:"#FFFFFF",fixedWidth:13*15,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.65}});s.setHighQuality(),s.setShadow(-8,8,"#000000",0,!0),Phaser.Display.Align.In.RightCenter(s,this.button,0,0),s.setPosition(15,0),this.add(s)}};const{LEVEL_PROGRESS:DC,PLAYER_UNIT_DATA:NC}=ye,{Ads:xi}=GameCore.Configs;class Pr extends GameCore.Screen{rewardValue;collectButton;viewAdButton;coinIcon;contents;title;popup;popupFadeOutAnimation;showUpAnimation;contentShowUpAnimation;adsTimer;constructor(e,t,s,i){super(e,t,s,i),this.setName(t),this.setDepth($e.POPUP),this.background.setAlpha(.7),this.createPopup(),this.createTicketCoinIcon(),this.createCloseBtn(),this.createContents(),this.createTitle(),this.createCollectButton(),this.createViewAdsButton()}open=e=>{super.open(e);const t=this.scene.scene.get(K.GAME_SCENE);t instanceof ee&&t.screenManager.listenResizeEventForCalculateLight(this),this.scene.ads.canbeShowRewardAd()?this.viewAdButton.setDisabled(!1):this.viewAdButton.setDisabled(!0);const s=this.getData("rewardValue");this.setRewardValue(this.calculateRewardCoins(s)),this.runOpenAnimation(),this.scene.storage.dispatch(MA())};createPopup(){this.popup=new xt(this.scene,{x:0,y:0,width:332,height:404.5,rightEdge:870778,bottomRightCorner:221341,topInnerCornerStrokeWidth:2,rightInnerCornerStrokeWidth:3,lightY:-80}),this.add(this.popup)}recalculateLightPosition(){this.popup&&this.popup.recalculateLightPosition()}createTicketCoinIcon(){const e=new PC(this.scene);Phaser.Display.Align.In.TopCenter(e,this.popup,0,-30),this.add(e),this.coinIcon=e}createCloseBtn(){const e=new Ut(this.scene);e.onClick=this.handleClosePopup,Phaser.Display.Align.In.TopRight(e,this.popup,10,10),this.popup.add(e)}createContents(){const e=new vC(this.scene);Phaser.Display.Align.In.Center(e,this.popup,0,60),this.add(e),this.contents=e}createTitle(){const e=new bC(this.scene);Phaser.Display.Align.In.TopCenter(e,this.popup,0,-10),this.add(e),this.title=e}createCollectButton(){const e=new CC(this.scene);e.setName("Collect"),e.onClick=this.handleClosePopup,Phaser.Display.Align.In.BottomCenter(e,this.popup,-70,-20),xi.Enabled||Phaser.Display.Align.In.BottomCenter(e,this.popup,0,-20),this.add(e),this.collectButton=e}createViewAdsButton(){const e=new OC(this.scene);e.setName("CollectX2"),e.onClick=this.handleShowRewardedVideoAd,Phaser.Display.Align.In.BottomCenter(e,this.popup,70,-20),this.add(e),this.viewAdButton=e,xi.Enabled||e.kill()}handleClosePopup=()=>{this.runCloseAnimation(),this.rewardCoins(this.rewardValue)};handleShowRewardedVideoAd=async()=>{let e=null;const{audio:t,game:s}=this.scene;try{this.viewAdButton.setDisabled(!0),e=s.globalScene.time.delayedCall(200,()=>{s.globalScene.screen.open(P.NOTIFY_SCREEN,{message:s.lang.Text.LOADING_ADS,duration:0,loading:!0})}),t.muteAll(),await this.scene.ads.showRewardedVideoAsync(),this.scene.audio.playSound(X.DAILY_REWARD);const i=this.rewardValue.clone();i.multiply(2),this.rewardCoins(i),this.runCloseAnimation()}catch(i){if(console.info("🚀 > showRewardedAdAsync",i),i instanceof Object&&GameCore.Utils.Object.hasOwn(i,"code")&&i.code==="USER_INPUT"){this.showNotifySkipAds();return}this.showNotifyNoAds()}finally{this.adsTimer?.destroy(),t.unmuteAll(),this.viewAdButton.setDisabled(!1),e?.remove(),s.globalScene.screen.close(P.NOTIFY_SCREEN),this.scene.ads.preloadRewardedVideoAsync().catch(i=>{})}};showNotifyNoAds=e=>{if(e&&e.name!==P.CLOSEABLE_NOTIFY_SCREEN)return;const{globalScene:t}=this.scene.game;t.screen.open(P.CLOSEABLE_NOTIFY_SCREEN,{message:t.lang.Text.NO_ADS_TO_DISPLAY,duration:1500,loading:!1})};showNotifySkipAds=()=>{const{globalScene:e}=this.scene.game;e.screen.open(P.CLOSEABLE_NOTIFY_SCREEN,{message:e.lang.Text.SORRY_NO_REWARDS,duration:1500,loading:!1})};runOpenAnimation(){this.scene.requestBackgroundMaskUpdate(P.OFFLINE_REWARD_SCREEN,this.background.alpha),this.runPopupEntrancesAnimation(),this.runPopupContentEntrancesAnimation(100,400)}runCloseAnimation=()=>{this.runExitsAnimation(0,200)};runPopupEntrancesAnimation(){this.showUpAnimation||(this.showUpAnimation=new it({targets:[this.popup,this.title]})),this.showUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove(),this.coinIcon.runAnimation();const s=[this.collectButton,this.viewAdButton,this.contents],i=s.map(n=>n.alpha);s.forEach(n=>n.setAlpha(0)),this.contentShowUpAnimation=new is({targets:s,duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:n=>n.scale-.3,getEnd:n=>n.scale},alpha:{getStart:()=>0,getEnd:(n,r,c,o)=>i[o]}}}),this.contentShowUpAnimation.play()}rewardCoins(e){const t=e;this.scene.coin.plusCoins(t.baseValue,t.suffix);const s=this.scene.scene.get(K.GAME_SCENE);s instanceof ee&&s.updateUI()}calculateRewardCoins(e){let t=new q(e);const s=new q(F.BASE_UNIT_COIN),i=this.calculateRewardModifier();return t.multiply(i),t.divide(60),t.smallerThan(s)&&(t=s),t}calculateRewardModifier(){const e=this.calculateLevelModifier(),t=this.calculateUsedUnit();return e.multiply(t),e.multiply(F.BASE_UNIT_COIN),e}calculateLevelModifier(){let t=this.scene.player.getCustomData(DC);t<0&&(t=0),t++;const{UNIT_COIN_SCALE:s}=F;if(t<=50){const i=Math.pow(s,t),n=new q(1);return n.multiply(i),n}else{const i=Math.pow(s,50),n=Math.floor(t/50),r=t%50,c=new q(1);for(let l=0;l<n;l++)c.multiply(i);const o=Math.pow(s,r);return c.multiply(o),c}}calculateUsedUnit(){const e=this.scene.player.getCustomData(NC);if(!e||typeof e!="string")return 1;const t=e.split("/");let s=0,i=0;return t.forEach(n=>{n.split("-").forEach(c=>{if(c==="0")return;const o=c[0],l=parseInt(c.substring(1));o==="m"&&(s+=Math.pow(2,l-1)),o==="r"&&(i+=Math.pow(2,l-1))})}),s>i?s:i}runExitsAnimation(e,t){this.collectButton.setDisabled(!0),this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new Ye({targets:[this.background],delay:e,duration:t,props:{alpha:{start:.7,from:.7,to:0}},ease:Phaser.Math.Easing.Cubic.Out,onActive:()=>{this.coinIcon.kill(),this.contents.kill(),this.title.kill(),this.popup.kill(),this.collectButton.kill(),this.viewAdButton.kill()},onUpdate:(s,i)=>{this.scene.requestBackgroundMaskUpdate(P.OFFLINE_REWARD_SCREEN,i.alpha)},onComplete:()=>{this.coinIcon.revive(),this.contents.revive(),this.title.revive(),this.popup.revive(),this.collectButton.revive(),xi.Enabled&&this.viewAdButton.revive();const s=this.scene.scene.get(K.GAME_SCENE);s instanceof ee&&s.screenManager.removeResizeEventForCalculateLight(this),this.scene.screen.close(this.name),this.collectButton.setDisabled(!1),this.coinIcon.stopAnimation(),this.background.setAlpha(.7)}})),this.popupFadeOutAnimation.play()}setRewardValue(e){this.rewardValue=e,this.contents.setText(e.toString())}}const{KEY:MC,FRAME:Or}=L.DEFAULT;class ks extends Phaser.GameObjects.Container{icon;label;switch;hitZone;isSwitchOn;payload;parentName;constructor(e,t){super(e),this.payload=t,this.setName("SettingSwitch"),this.createHitZone(),this.createIcon(),this.createLabel(),this.createSwitch()}set onClick(e){this.hitZone.removeAllListeners(),this.hitZone.setInteractive({useHandCursor:!0}),this.hitZone.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{const t=!this.isSwitchOn;this.logButtonEvent(t),this.setSwitch(t),e(t),Et(50)})}setSwitch(e){e?(this.switch.setFrame(Or.SETTINGS_SWITCH_ON),this.switch.setWorldSize(37.5,22)):(this.switch.setFrame(Or.SETTINGS_SWITCH_OFF),this.switch.setWorldSize(37,21.5)),this.isSwitchOn=e}createIcon(){this.icon=this.scene.make.image({key:this.payload.iconKey,frame:this.payload.icon}),this.icon.setWorldSize(this.payload.iconWidth,this.payload.iconHeight),this.add(this.icon),Phaser.Display.Align.In.LeftCenter(this.icon,this.hitZone,this.payload.iconLeftOffset)}createLabel(){const e=this.scene.make.text({text:this.payload.label,style:{fontSize:"15px",color:"#FFFFFF",fontFamily:k.FONT_FAMILY,fixedWidth:100},origin:{x:0,y:.5}});e.setName("label"),e.setHighQuality(),this.add(e),e.setX(this.payload.localTextX),this.label=e}createSwitch(){this.switch=this.scene.make.image({key:MC}),this.setSwitch(!1),Phaser.Display.Align.In.RightCenter(this.switch,this.hitZone),this.add(this.switch)}createHitZone(){this.hitZone=this.scene.add.zone(0,0,180,45),this.add(this.hitZone)}logButtonEvent(e){const t=this.getParentName(),s=this.name;this.scene.analytics.event(G.BUTTON_CLICK,{button_name:s,value:e?"on":"off",screen_name:t})}getParentName(){if(this.parentName)return this.parentName;let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen){const t=e;return this.parentName=t.getScreenName(),this.parentName}e=e.parentContainer}return this.parentName=this.scene.getSceneName(),this.parentName}setDisabled(e){e?(this.hitZone?.disableInteractive(),this.setAlpha(.5)):(this.hitZone?.setInteractive(),this.setAlpha(1))}}const{KEY:kC,FRAME:UC}=L.DEFAULT,{KEY:Us,FRAME:xs}=L.DEFAULT_8_BIT;class hn extends GameCore.Screen{popup;sound;music;vibration;speedUp;title;showUpAnimation;contentShowUpAnimation;fadeOutAnimation;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.background.setAlpha(.7),this.setSize(this.scene.gameZone.displayWidth,this.scene.gameZone.displayHeight),this.createPopup(),this.createCloseButton(),this.createTitle(),this.createContent()}open(){super.open();const e=this.scene.scene.get(K.GAME_SCENE);e instanceof ee&&e.screenManager.listenResizeEventForCalculateLight(this),this.scene.requestBackgroundMaskUpdate(P.SETTINGS_SCREEN,this.background.alpha),this.runOpenAnimation();const s=!!this.scene.player.getPlayerSetting("sound");this.sound.setSwitch(s);const i=!!this.scene.player.getPlayerSetting("music");if(this.music.setSwitch(i),GameCore.Utils.Device.isDesktop()){const n=!!this.scene.player.getPlayerSetting("speedUp");this.speedUp.setSwitch(n);return}if(Ti()){const n=!!this.scene.player.getPlayerSetting("vibrate");this.vibration.setSwitch(n)}}handleChangeSound=e=>{this.scene.audio.playSound(X.TURN_SWITCH),this.scene.player.setSetting("sound",e)};handleChangeMusic=e=>{this.scene.audio.playSound(X.TURN_SWITCH),this.scene.player.setSetting("music",e),e?this.scene.audio.playMusic():this.scene.audio.pauseMusic()};handleChangeVibration=e=>{this.scene.audio.playSound(X.TURN_SWITCH),this.scene.player.setSetting("vibrate",e),Pc(e)};handleChangeSpeedUp=e=>{this.scene.audio.playSound(X.TURN_SWITCH),this.scene.player.setSetting("speedUp",e)};handleClosePopup=()=>{this.runFadeOutAnimation()};createPopup(){this.popup=new xt(this.scene,{x:0,y:0,width:261.5,height:323,rightEdge:870778,topInnerCornerStrokeWidth:2,rightInnerCornerStrokeWidth:3,lightY:-40}),this.add(this.popup)}recalculateLightPosition(){this.popup&&this.popup.recalculateLightPosition()}createCloseButton(){const e=new Ut(this.scene);e.setName("button"),Phaser.Display.Align.In.TopRight(e,this.popup,10,10),this.popup.add(e),e.onClick=this.handleClosePopup}createTitle(){const e=this.scene.make.text({text:this.scene.lang.Text.SETTINGS,style:{fontSize:"22px",stroke:"#000000",strokeThickness:2,color:"#FFFFFF",fixedWidth:325,align:"center",fontFamily:k.FONT_FAMILY}});e.setName("title"),e.setHighQuality(),e.setShadow(-8,8,"#000000",0,!0),this.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-13);const t=this.scene.make.image({key:kC,frame:UC.TITLE_LINE});t.setWorldSize(235,23),this.popup.add(t),Phaser.Display.Align.In.BottomCenter(t,e,0,30),this.title=e}createContent(){this.createSoundSetting(),this.createMusicSetting(),GameCore.Utils.Device.isDesktop()?this.createSpeedUpSetting():(this.createVibrationSetting(),Ti()||(this.vibration.setSwitch(!1),this.vibration.setDisabled(!0)))}createSoundSetting(){this.sound=new ks(this.scene,{iconKey:Us,icon:xs.ICON_SOUND,iconWidth:26,iconHeight:24,iconLeftOffset:6,localTextX:-60,label:`${this.scene.lang.Text.SOUND_FX}  `});const e=this.scene.lang.getCurrentLanguage();let t=15;switch(e){case"pt":t=13;break;case"es":t=11;break}this.sound.label.setFontSize(t),this.sound.setName("SettingSound"),this.add(this.sound),Phaser.Display.Align.In.Center(this.sound,this.popup,0,-55),this.sound.onClick=this.handleChangeSound;const s=this.scene.make.graphics({});s.fillStyle(16777215,.1),s.fillRect(-104.5,-.5,209,1),s.setPosition(0,-19.5),this.popup.add(s)}createMusicSetting(){this.music=new ks(this.scene,{iconKey:Us,icon:xs.ICON_MUSIC,iconWidth:20,iconHeight:20,iconLeftOffset:3,localTextX:-60,label:`${this.scene.lang.Text.MUSIC}      `}),this.music.setName("SettingMusic"),this.add(this.music),Phaser.Display.Align.In.Center(this.music,this.popup,0,15),this.music.onClick=this.handleChangeMusic;const e=this.scene.make.graphics({});e.fillStyle(16777215,.1),e.fillRect(-104.5,-.5,209,1),e.setPosition(0,45.5),this.popup.add(e)}createVibrationSetting(){this.vibration=new ks(this.scene,{iconKey:Us,icon:xs.ICON_VIBRATION,iconWidth:30.5,iconHeight:27.5,iconLeftOffset:10,localTextX:-60,label:`${this.scene.lang.Text.VIBRATION}`}),this.vibration.setName("SettingVibration"),this.add(this.vibration),Phaser.Display.Align.In.Center(this.vibration,this.popup,0,85),Ti()&&(this.vibration.onClick=this.handleChangeVibration)}createSpeedUpSetting(){this.speedUp=new ks(this.scene,{iconKey:Us,icon:xs.ICON_QUICK_FIGHT,iconWidth:19,iconHeight:24,iconLeftOffset:4,localTextX:-60,label:`${this.scene.lang.Text.QUICK_FIGHT}`});const e=this.scene.lang.getCurrentLanguage();let t=15;switch(e){case"ja":case"fr":t=13;break;case"de":t=11;break}this.speedUp.label.setFontSize(t),this.speedUp.setName("SettingSpeed"),this.add(this.speedUp),Phaser.Display.Align.In.Center(this.speedUp,this.popup,0,85),this.speedUp.onClick=this.handleChangeSpeedUp}runOpenAnimation(){this.runPopupEntrancesAnimation(),this.runPopupContentEntrancesAnimation(100,400)}runPopupEntrancesAnimation(){this.showUpAnimation||(this.showUpAnimation=new it({targets:[this.popup]})),this.showUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove();const s=[this.title,this.sound,this.music];this.speedUp&&s.push(this.speedUp),this.vibration&&s.push(this.vibration);const i=s.map(n=>n.alpha);this.contentShowUpAnimation=new is({targets:s,duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:n=>n.scale-.3,getEnd:n=>n.scale},alpha:{getStart:n=>(n.setAlpha(0),0),getEnd:(n,r,c,o)=>i[o]}}}),this.contentShowUpAnimation.play()}runFadeOutAnimation(){this.fadeOutAnimation||(this.fadeOutAnimation=new Ye({targets:[this.background],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.7,from:.7,to:0}},onActive:()=>{this.popup.kill(),this.title.kill(),this.sound.kill(),this.music.kill(),this.speedUp?.kill(),this.vibration?.kill()},onUpdate:(e,t)=>{this.scene.requestBackgroundMaskUpdate(P.SETTINGS_SCREEN,t.alpha)},onComplete:()=>{this.popup.revive(),this.title.revive(),this.sound.revive(),this.music.revive(),this.speedUp?.revive(),this.vibration?.revive();const e=this.scene.scene.get(K.GAME_SCENE);e instanceof ee&&e.screenManager.removeResizeEventForCalculateLight(this),this.background.setAlpha(.7),this.scene.screen.close(this.name)}})),this.fadeOutAnimation.play()}}const{KEY:xC,FRAME:BC}=L.DEFAULT,{KEY:Dr,FRAME:Nr}=L.DEFAULT_8_BIT;class Mr extends GameCore.Screen{popup;title;confirmBtn;cancelBtn;description;showUpAnimation;contentShowUpAnimation;fadeOutAnimation;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.background.setAlpha(.7),this.setSize(this.scene.gameZone.displayWidth,this.scene.gameZone.displayHeight),this.createPopup(),this.createCloseButton(),this.createTitle(),this.createContent()}open(){super.open();const e=this.scene.scene.get(K.GAME_SCENE);e instanceof ee&&e.screenManager.listenResizeEventForCalculateLight(this),this.scene.requestBackgroundMaskUpdate(P.RESET_DATA_SCREEN,this.background.alpha),this.runOpenAnimation()}handleClosePopup=()=>{this.runFadeOutAnimation()};createPopup(){this.popup=new xt(this.scene,{x:0,y:0,width:300,height:200,rightEdge:870778,topInnerCornerStrokeWidth:2,rightInnerCornerStrokeWidth:3,lightY:-40}),this.add(this.popup)}recalculateLightPosition(){this.popup&&this.popup.recalculateLightPosition()}createCloseButton(){const e=new Ut(this.scene);e.setName("button"),Phaser.Display.Align.In.TopRight(e,this.popup,10,10),this.popup.add(e),e.onClick=this.handleClosePopup}createTitle(){const e=this.scene.make.text({text:this.scene.lang.Text.RESET_DATA,style:{fontSize:"22px",stroke:"#000000",strokeThickness:2,color:"#FFFFFF",fixedWidth:325,align:"center",fontFamily:k.FONT_FAMILY}});e.setName("title"),e.setHighQuality(),e.setShadow(-8,8,"#000000",0,!0),this.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-13);const t=this.scene.make.image({key:xC,frame:BC.TITLE_LINE});t.setWorldSize(235,23),this.popup.add(t),Phaser.Display.Align.In.BottomCenter(t,e,0,30),this.title=e}createContent(){this.createDescription(),this.createConfirmButton(),this.createCancelButton()}createDescription(){const e=this.scene.lang.getCurrentLanguage();let t=17;switch(e){case"id":case"de":t=15;break}this.description=this.scene.make.bitmapText({text:this.scene.lang.Text.RESET_DESC,font:k.PRIMARY.KEY,size:this.scene.fontSize(t),origin:{x:.5,y:.5}}),this.description.setCenterAlign(),this.add(this.description),this.description.setPosition(0,-10)}createConfirmButton(){this.confirmBtn=new de(this.scene,Dr,Nr.BUTTON_RED,108,43),this.confirmBtn.setName("confirmBtn");const e=this.scene.lang.getCurrentLanguage();let t=-5;switch(e){case"tr":t=-8;break}const s=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(20)});s.setText(this.scene.lang.Text.YES),s.setDropShadow(-1,1.5,0),this.confirmBtn.add(s),s.setPosition(0,t),this.add(this.confirmBtn),Phaser.Display.Align.In.Center(this.confirmBtn,this.popup,-70,60),this.confirmBtn.onClick=()=>{const i=this.scene.scene.get(K.GAME_SCENE);i instanceof ee&&i.resetLevel();const n=this.scene.screen.get(P.SETTINGS_SCREEN);n instanceof hn&&n.handleClosePopup(),this.handleClosePopup()}}createCancelButton(){this.cancelBtn=new de(this.scene,Dr,Nr.BUTTON_GREEN,108,43),this.cancelBtn.setName("cancelBtn");const e=this.scene.lang.getCurrentLanguage();let t=-5;switch(e){case"tr":t=-8;break}const s=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(20)});s.setText(this.scene.lang.Text.NO),s.setDropShadow(-1,1.5,0),this.cancelBtn.add(s),s.setPosition(0,t),this.add(this.cancelBtn),Phaser.Display.Align.In.Center(this.cancelBtn,this.popup,70,60),this.cancelBtn.onClick=this.handleClosePopup}runOpenAnimation(){this.runPopupEntrancesAnimation(),this.runPopupContentEntrancesAnimation(100,400)}runPopupEntrancesAnimation(){this.showUpAnimation||(this.showUpAnimation=new it({targets:[this.popup]})),this.showUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove();const s=[this.title,this.description,this.confirmBtn,this.cancelBtn],i=s.map(n=>n.alpha);this.contentShowUpAnimation=new is({targets:s,duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:n=>n.scale-.3,getEnd:n=>n.scale},alpha:{getStart:n=>(n.setAlpha(0),0),getEnd:(n,r,c,o)=>i[o]}}}),this.contentShowUpAnimation.play()}runFadeOutAnimation(){this.fadeOutAnimation||(this.fadeOutAnimation=new Ye({targets:[this.background],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.7,from:.7,to:0}},onActive:()=>{this.popup.kill(),this.title.kill(),this.description.kill(),this.confirmBtn.kill(),this.cancelBtn.kill()},onUpdate:(e,t)=>{this.scene.requestBackgroundMaskUpdate(P.RESET_DATA_SCREEN,t.alpha)},onComplete:()=>{this.popup.revive(),this.title.revive(),this.description.revive(),this.confirmBtn.revive(),this.cancelBtn.revive();const e=this.scene.scene.get(K.GAME_SCENE);e instanceof ee&&e.screenManager.removeResizeEventForCalculateLight(this),this.background.setAlpha(.7),this.scene.screen.close(this.name)}})),this.fadeOutAnimation.play()}}const{KEY:FC,FRAME:kr}=L.GAMEPLAY;class GC extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitter;constructor(e){super(e,FC,kr.DASHBOARD_COINBAR_COIN),this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:kr.DASHBOARD_COINBAR_COIN,gravityY:160,angle:{min:-180,max:0},speed:{min:50,max:200},scale:{min:e*.8,max:e*.8},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.In},lifespan:1500})}explode(e,t,s){this.setActive(!0),this.setVisible(!0),this.emitter.explode(e,t,s)}}const{KEY:Rt,FRAME:HC}=L.EFFECTS,_t=HC,ae={CONFETTI_HEXAGON:{KEY:"confetti-hexagon-animation",TEXTURE:Rt,PREFIX:_t.FX_CONFETTI_HEXAGON,FRAME_RATE:8,END:5,ZERO_PAD:0},CONFETTI_STAR_X:{KEY:"confetti-star-x",TEXTURE:Rt,PREFIX:_t.ANIMATION_STAR_X,FRAME_RATE:4,END:4,ZERO_PAD:0},CONFETTI_STAR_Y:{KEY:"confetti-star-y",TEXTURE:Rt,PREFIX:_t.ANIMATION_STAR_Y,FRAME_RATE:4,END:4,ZERO_PAD:0},RIBBON_A:{KEY:"animation-ribbon-a",TEXTURE:Rt,PREFIX:_t.PREFIX_ANIMATION_RIBBON_CONFETTI_A,FRAME_RATE:16,END:3,ZERO_PAD:0},RIBBON_B:{KEY:"animation-ribbon-b",TEXTURE:Rt,PREFIX:_t.PREFIX_ANIMATION_RIBBON_CONFETTI_B,FRAME_RATE:16,END:4,ZERO_PAD:0},RIBBON_C:{KEY:"animation-ribbon-c",TEXTURE:Rt,PREFIX:_t.PREFIX_ANIMATION_RIBBON_CONFETTI_C,FRAME_RATE:16,END:4,ZERO_PAD:0},RIBBON_D:{KEY:"animation-ribbon-d",TEXTURE:Rt,PREFIX:_t.PREFIX_ANIMATION_RIBBON_CONFETTI_D,FRAME_RATE:16,END:4,ZERO_PAD:0}},{KEY:YC,TEXTURE:KC,FRAME_RATE:VC,END:WC,PREFIX:jC,ZERO_PAD:$C}=ae.RIBBON_A;class zC extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:VC,frames:e.generateFrameNames(KC,{prefix:jC,end:WC,zeroPad:$C,start:1}),yoyo:!0,showOnStart:!0};super(e,YC,t)}}const{KEY:XC,TEXTURE:qC,FRAME_RATE:ZC,END:QC,PREFIX:JC,ZERO_PAD:eR}=ae.RIBBON_B;class tR extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:ZC,frames:e.generateFrameNames(qC,{prefix:JC,end:QC,zeroPad:eR,start:1}),yoyo:!0,showOnStart:!0};super(e,XC,t)}}const{KEY:sR,TEXTURE:iR,FRAME_RATE:nR,END:aR,PREFIX:rR,ZERO_PAD:oR}=ae.RIBBON_C;class cR extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:nR,frames:e.generateFrameNames(iR,{prefix:rR,end:aR,zeroPad:oR,start:1}),yoyo:!0,showOnStart:!0};super(e,sR,t)}}const{KEY:lR,TEXTURE:hR,FRAME_RATE:uR,END:dR,PREFIX:pR,ZERO_PAD:gR}=ae.RIBBON_D;class fR extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:uR,frames:e.generateFrameNames(hR,{prefix:pR,end:dR,zeroPad:gR,start:1}),yoyo:!0,showOnStart:!0};super(e,lR,t)}}const{KEY:ER,TEXTURE:mR,FRAME_RATE:AR,END:SR,PREFIX:yR,ZERO_PAD:TR}=ae.CONFETTI_STAR_X;class IR extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:AR,frames:e.generateFrameNames(mR,{prefix:yR,end:SR,zeroPad:TR,start:1}),yoyo:!0,showOnStart:!0};super(e,ER,t)}}const{KEY:CR,TEXTURE:RR,FRAME_RATE:_R,END:vR,PREFIX:wR,ZERO_PAD:LR}=ae.CONFETTI_STAR_Y;class bR extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:_R,frames:e.generateFrameNames(RR,{prefix:wR,end:vR,zeroPad:LR,start:1}),showOnStart:!0};super(e,CR,t)}}class PR extends Phaser.GameObjects.Particles.Particle{scene;ribbon;graphics;colorUse;lastChange;currentFrame;isYoyo;isGravityChanged;points;constructor(e){super(e),this.scene=e.manager.scene,this.points=new Array(10).fill(null).map(()=>({x:0,y:0})),this.isYoyo=!1,this.isGravityChanged=!1,this.lastChange=0,this.currentFrame=-1,this.createGraphics(),this.randomRibbonUsedWhenFall()}randomRibbonUsedWhenFall(){switch(Phaser.Math.Between(0,3)){case 0:this.ribbon=this.scene.anims.get(ae.RIBBON_A.KEY);break;case 1:this.ribbon=this.scene.anims.get(ae.RIBBON_B.KEY);break;case 2:this.ribbon=this.scene.anims.get(ae.RIBBON_C.KEY);break;case 3:this.ribbon=this.scene.anims.get(ae.RIBBON_D.KEY);break;default:this.ribbon=this.scene.anims.get(ae.RIBBON_A.KEY);break}}setRibbonPosition(e,t){this.points.map(s=>{s.x=e,s.y=t})}createGraphics(){const e=[8443204,2928867,12013036,16376097,15285798];this.colorUse=e[Phaser.Math.Between(0,e.length-1)],this.graphics=this.scene.add.graphics({lineStyle:{width:3,color:this.colorUse}});const{x:t,y:s,depth:i}=this.emitter.manager;this.graphics.setDepth(i),this.graphics.setPosition(t,s)}update(e,t,s){const i=super.update(e,t,s);return this.updateFrames(e),this.updatePoints(),this.updateGraphics(),this.updateGravity(),this.updateVelocity(),this.updateColor(),i}updateFrames(e){this.lastChange+=e,this.lastChange>=this.ribbon.msPerFrame&&(this.isYoyo?this.currentFrame--:this.currentFrame++,this.currentFrame<0&&(this.isYoyo=!1,this.currentFrame=1),this.currentFrame>=this.ribbon.frames.length&&(this.isYoyo=!0,this.currentFrame-=1),this.frame=this.ribbon.frames[this.currentFrame].frame,this.lastChange-=this.ribbon.msPerFrame)}updatePoints(){this.graphics.visible&&(this.points.shift(),this.points.push({x:this.x,y:this.y}))}updateGraphics(){if(this.graphics.visible){for(const e of this.points)if(e.y===0)return;this.graphics.clear(),this.graphics.strokePoints(this.points)}}updateGravity(){this.lifeCurrent>this.life-2e3||this.isGravityChanged||(this.isGravityChanged=!0,this.graphics.destroy(),this.emitter.setVisible(!0),this.emitter.setGravityY(45))}updateVelocity(){if(this.graphics.visible){if(this.lifeCurrent>this.life-1800){this.velocityX+=Phaser.Math.Between(-12,12);return}this.velocityX>0?this.velocityX+=Phaser.Math.Between(-10,6):this.velocityX+=Phaser.Math.Between(-6,10)}}updateColor(){this.graphics.visible||(this.tint=this.colorUse)}}class OR extends Phaser.GameObjects.Particles.Particle{scene;isYoyo;isGravityChanged;lastChange;currentFrame;star;starX;starY;constructor(e){super(e),this.isYoyo=!1,this.isGravityChanged=!1,this.lastChange=0,this.currentFrame=-1,this.scene=e.manager.scene,this.starX=this.scene.anims.get(ae.CONFETTI_STAR_X.KEY),this.starY=this.scene.anims.get(ae.CONFETTI_STAR_Y.KEY),this.star=this.starX}update(e,t,s){const i=super.update(e,t,s);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(e),i}updateGravity(){this.lifeCurrent>this.life-2e3||this.isGravityChanged||(this.isGravityChanged=!0,this.emitter.setGravityY(15),this.emitter.setSpeedX(0))}updateVelocity(){this.lifeCurrent>this.life-2e3||(this.velocityX>0?this.velocityX+=Phaser.Math.Between(-6,3):this.velocityX+=Phaser.Math.Between(-3,6))}updateFrames(e){if(this.lastChange+=e,this.lastChange>=this.star.msPerFrame){const t=Phaser.Math.RND.between(0,1);this.star=t>0?this.starX:this.starY,this.isYoyo?this.currentFrame--:this.currentFrame++,this.currentFrame<0&&(this.isYoyo=!1,this.currentFrame=1,this.emitter.setAlpha(1)),this.currentFrame>=this.star.frames.length&&(this.isYoyo=!0,this.currentFrame-=1,this.emitter.setAlpha(.8)),this.frame=this.star.frames[this.currentFrame].frame,this.lastChange-=this.star.msPerFrame}}updateFrameRate(){this.lifeCurrent<this.life-2e3?this.star.msPerFrame=150:this.star.msPerFrame=Phaser.Math.RND.between(300,600)}}const{KEY:DR,FRAME:NR}=L.EFFECTS,Bi=NR;class MR extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitterConfetti;emitterRibbons;ribbonConfig;confettiConfig;width;height;constructor(e){super(e,DR,Bi.BLANK),this.emitterRibbons=[],this.emitterConfetti=[],this.createConfigs(),this.createAnimations(),this.scene.add.existing(this)}createConfigs(){const e=[8443204,2928867,12013036,16376097,15285798],t=1/this.scene.world.getPixelRatio();this.ribbonConfig={on:!1,visible:!1,timeScale:1.5,frame:Bi.BLANK,particleBringToTop:!0,speedY:{min:-480,max:-560},gravityY:290,lifespan:{min:4e3,max:6e3},rotate:{start:0,end:360*5,random:!0},scale:{min:t*.6,max:t},particleClass:PR},this.confettiConfig={on:!1,delay:200,timeScale:2,tint:e,particleBringToTop:!0,frame:Bi.PREFIX_ANIMATION_RIBBON_CONFETTI_A+"1",speedY:{min:-460,max:-580},gravityY:280,lifespan:{min:5e3,max:8e3},rotate:{start:0,end:360*3},scale:{min:t*.6,max:t},particleClass:OR}}createAnimations(){if(!this.scene.anims.get(ae.CONFETTI_STAR_X.KEY)){const e=new IR(this.scene.anims);this.scene.anims.add(ae.CONFETTI_STAR_X.KEY,e)}if(!this.scene.anims.get(ae.CONFETTI_STAR_Y.KEY)){const e=new bR(this.scene.anims);this.scene.anims.add(ae.CONFETTI_STAR_Y.KEY,e)}if(!this.scene.anims.get(ae.RIBBON_A.KEY)){const e=new zC(this.scene.anims);this.scene.anims.add(ae.RIBBON_A.KEY,e)}if(!this.scene.anims.get(ae.RIBBON_B.KEY)){const e=new tR(this.scene.anims);this.scene.anims.add(ae.RIBBON_B.KEY,e)}if(!this.scene.anims.get(ae.RIBBON_C.KEY)){const e=new cR(this.scene.anims);this.scene.anims.add(ae.RIBBON_C.KEY,e)}if(!this.scene.anims.get(ae.RIBBON_D.KEY)){const e=new fR(this.scene.anims);this.scene.anims.add(ae.RIBBON_D.KEY,e)}}run(e,t,s,i){this.setPosition(e,t),this.width=s,this.height=i,this.createEmitters(),this.emitterConfetti.forEach(n=>{n.emitParticle(25)}),this.emitterRibbons.forEach(n=>{n.emitParticle(20)})}stop(){this.emitterConfetti.forEach(e=>{e.killAll()}),this.emitterRibbons.forEach(e=>{e.killAll()}),this.kill()}createEmitters(){this.emitterRibbons=[],this.emitterConfetti=[],this.createConfettiLeftEmitter(),this.createConfettiRightEmitter(),this.createRibbonLeftEmitter(),this.createRibbonRightEmitter()}createConfettiLeftEmitter(){const e={...this.confettiConfig,speedX:{min:5,max:90}},t=this.createEmitter(e);this.emitterConfetti.push(t)}createConfettiRightEmitter(){const{width:e}=this,t={...this.confettiConfig,x:e,speedX:{min:-5,max:-90}},s=this.createEmitter(t);this.emitterConfetti.push(s)}createRibbonLeftEmitter(){const e={...this.ribbonConfig,speedX:{min:20,max:80},emitCallback:s=>{s.setRibbonPosition(0,0)}},t=this.createEmitter(e);this.emitterRibbons.push(t)}createRibbonRightEmitter(){const{width:e}=this,t={...this.ribbonConfig,x:e,speedX:{min:-20,max:-80},emitCallback:i=>{i.setRibbonPosition(e,0)}},s=this.createEmitter(t);this.emitterRibbons.push(s)}killAllParticles(){this.emitterConfetti.forEach(e=>{e.forEachAlive(t=>{t.lifeCurrent=0},this)}),this.emitterRibbons.forEach(e=>{e.forEachAlive(t=>{t.lifeCurrent=0},this)})}}class il extends de{paddingZone;showDebugZone;debugZone;constructor(e,t){const{key:s,frame:i,width:n,height:r,usePixelPerfect:c}=t;super(e,s,i,n,r,c);const{paddingZone:o=0,showDebugZone:l=!1}=t;this.paddingZone=o,this.showDebugZone=l}updateSize(){super.updateSize();const{width:e,height:t}=this,s=e+this.paddingZone,i=t+this.paddingZone;this.setSize(s,i),this.hitZone.setSize(s,i),this.showDebugZone&&(this.debugZone?.destroy(),this.debugZone=this.hitZone.drawDebugBox(10699282,.5),this.add(this.debugZone))}}const{KEY:Kt,FRAME:Vt}=L.DEFAULT_8_BIT,{Ads:Fi}=GameCore.Configs;class kR extends Phaser.GameObjects.Container{continueButton;coinText;getText;winContainer;loseContainer;postAdContinueAnimation;replayButton;postAdReplayAnimation;returnButton;postAdReturnAnimation;openAnimation;mode="NORMAL";constructor(e){super(e),this.setName("Footer"),this.createContinueButton(),this.createReplayButton(),this.createReturnButton(),this.scene.add.existing(this)}createContinueButton(){this.continueButton=new il(this.scene,{key:Kt,frame:Vt.RESULT_SCREEN_YELLOW_BUTTON,width:129,height:46}),this.continueButton.setName("Continue"),this.add(this.continueButton),this.createContinueWinContainer(),this.createContinueLoseContainer()}createContinueWinContainer(){const e=this.scene.make.container({});e.setSize(this.continueButton.width,this.continueButton.height),this.winContainer=e,this.continueButton.add(this.winContainer);const t=this.scene.lang.getCurrentLanguage();let s=18,i=18,n=-14,r=5;switch(t){case"ja":s=16,i=15,r=3,n=-15;break;case"zh":s=16,n=-12;break}this.getText=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(s)}),this.getText.setText(this.scene.lang.Text.GET),this.getText.setDropShadow(-.5,1.5,0),this.getText.setPosition(0,n),e.add(this.getText);const c=this.scene.make.image({key:Kt,frame:Vt.RESULT_SCREEN_SINGLE_COIN_ICON});c.setWorldSize(16,16),e.add(c),c.setPosition(-40,7);const o=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(i)});o.setText("0"),o.setTintText(15650560),o.setDropShadow(-1,1,0),o.setPosition(0,r),e.add(o),this.coinText=o}createContinueLoseContainer(){const e=this.scene.make.container({});e.setSize(this.continueButton.width,this.continueButton.height),this.loseContainer=e,this.continueButton.add(this.loseContainer);const t=this.scene.lang.getCurrentLanguage();let s=20;switch(t){case"pt":s=18;break;case"de":s=18;break}const i=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(s)});i.setText(this.scene.lang.Text.CLAIM),i.setDropShadow(-1,1,0),i.setPosition(0,-5),e.add(i)}createReplayButton(){this.replayButton=new de(this.scene,Kt,Vt.RESULT_SCREEN_GREEN_BUTTON,129,46),this.replayButton.setName("BattleReplay");const e=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(15)});e.setText(this.scene.lang.Text.REPLAY),e.setDropShadow(-1,1,0),e.setPosition(15,-5),this.replayButton.add(e);const t=this.scene.make.image({key:Kt,frame:Vt.ICON_REPLAY});t.setWorldSize(23.5,27.5),t.setPosition(-40,-3),this.replayButton.add(t),this.replayButton.setX(-70),this.add(this.replayButton)}createReturnButton(){this.returnButton=new de(this.scene,Kt,Vt.RESULT_SCREEN_YELLOW_BUTTON,129,46),this.returnButton.setName("BackToSinglePlay");const e=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(15)});e.setText(`      ${this.scene.lang.Text.BACK_TO_SINGLEPLAY}`),e.setDropShadow(-1,1,0),e.setPosition(15,-5),this.returnButton.add(e);const t=this.scene.make.image({key:Kt,frame:Vt.ICON_BACK_TO});t.setWorldSize(28.5,20.5),t.setPosition(-45,-2),this.returnButton.add(t),this.returnButton.setX(70),this.add(this.returnButton)}set onClickContinueBtn(e){this.continueButton.onClick=e}set onClickReplayBtn(e){this.replayButton.onClick=e}set onClickReturnBtn(e){this.returnButton.onClick=e}setMode(e,t,s){this.continueButton.setY(0),this.continueButton.setScale(1),this.continueButton.updateScaleDown(),this.replayButton.setPosition(-70,0),this.replayButton.setScale(1),this.returnButton.setPosition(70,0),this.returnButton.setScale(1),e==="BATTLE"?(this.replayButton.revive(),this.returnButton.revive(),this.continueButton.kill()):(this.replayButton.kill(),this.returnButton.kill(),this.continueButton.revive(),s==="win"?(this.winContainer.revive(),this.loseContainer.kill(),this.coinText.setText(t.toString()),this.getText.setText(this.scene.lang.Text.GET)):(this.winContainer.kill(),this.loseContainer.revive(),this.getText.setText(this.scene.lang.Text.CLAIM))),this.mode=e}setCoinText(e){this.winContainer.revive(),this.loseContainer.kill(),this.coinText.setText(e)}runAnimation(e){Fi.Enabled&&this.mode==="BATTLE"&&(this.openAnimation?.stop(),this.openAnimation?.remove(),this.returnButton.setAlpha(0),this.replayButton.setAlpha(0),this.openAnimation=new li({targets:[this.replayButton,this.returnButton],delay:e,duration:400,props:{alpha:{from:0,to:1}},onComplete:()=>{this.returnButton.setAlpha(1),this.replayButton.setAlpha(1)}}),this.openAnimation.play())}runPostAnimation(e){if(this.mode==="BATTLE"){this.openAnimation?.stop(),this.openAnimation?.remove(),this.postAdReplayAnimation?.stop(),this.postAdReplayAnimation?.remove(),this.postAdReturnAnimation?.stop(),this.postAdReturnAnimation?.remove(),this.replayButton.setDisabled(!0),this.replayButton.setAlpha(1);const t=this.replayButton.x;this.returnButton.setDisabled(!0),this.returnButton.setAlpha(1);const s=this.returnButton.x;if(!Fi.Enabled){const{scale:i}=this.replayButton,{scale:n}=this.returnButton;this.replayButton.setScale(i*1.2),this.replayButton.setPosition(t-15,-125),this.replayButton.setDisabled(!1),this.returnButton.setScale(n*1.2),this.returnButton.setPosition(s+15,-125),this.returnButton.setDisabled(!1);return}this.postAdReplayAnimation=this.scene.tweens.add({targets:this.replayButton,duration:500,delay:e,y:{from:0,to:-70},x:{from:t,to:t-15},scale:{from:this.replayButton.scale,to:this.replayButton.scale*1.2},ease:Phaser.Math.Easing.Quintic.Out,onComplete:()=>{this.replayButton.setDisabled(!1)}}),this.postAdReturnAnimation=this.scene.tweens.add({targets:this.returnButton,duration:500,delay:e,y:{from:0,to:-70},x:{from:s,to:s+15},scale:{from:this.returnButton.scale,to:this.returnButton.scale*1.2},ease:Phaser.Math.Easing.Quintic.Out,onComplete:()=>{this.returnButton.setDisabled(!1)}})}else{this.postAdContinueAnimation?.stop(),this.postAdContinueAnimation?.remove(),this.continueButton.setDisabled(!0),this.continueButton.setAlpha(1);const{scale:t}=this.continueButton;if(!Fi.Enabled){this.continueButton.setScale(t*1.5),this.continueButton.setPosition(0,-125),this.continueButton.setDisabled(!1);return}this.postAdContinueAnimation=this.scene.tweens.add({targets:this.continueButton,duration:500,delay:e,y:{from:0,to:-70},scale:{from:t,to:t*2},ease:Phaser.Math.Easing.Quintic.Out,onComplete:()=>{this.continueButton.updateScaleDown(),this.continueButton.setDisabled(!1)}})}}}const{KEY:Ur,FRAME:xr}=L.DEFAULT_8_BIT;class UR extends Phaser.GameObjects.Container{wheelArrow;luckSpinMilestones;luckSpinRewards;spinningTween;constructor(e){super(e,0,0),this.createWheelBackground(),this.createWheelArrow(),this.scene.add.existing(this)}createWheelBackground(){const e=this.scene.make.image({key:Ur,frame:xr.WHEEL_LUCKY_SPIN});this.scene.add.existing(e),this.add(e),e.setOrigin(.5,.5),e.setWorldSize(178.5,114.5),e.setY(-34),this.createText("x2",-63,-35),this.createText("x3",-18,-70),this.createText("x4",22,-60),this.createText("x5",45,-27)}createText(e,t,s){const i=this.scene.lang.getCurrentLanguage();let n=22;switch(i){case"ja":n=20;break}const r=this.scene.make.bitmapText({text:e,font:k.PRIMARY.KEY,size:this.scene.fontSize(n)});r.setDropShadow(-1,1),this.add(r),r.setPosition(t,s)}createWheelArrow(){this.wheelArrow=this.scene.make.image({key:Ur,frame:xr.WHEEL_ARROW}),this.wheelArrow.setWorldSize(17,26),this.add(this.wheelArrow),Phaser.Display.Align.In.Center(this.wheelArrow,this,0,-25),this.luckSpinMilestones=[-30,16,59],this.luckSpinRewards=[2,3,4,5]}startWheelSpinning(){this.spinningTween?.stop(),this.spinningTween?.remove();const e=this.scene.screen.get(P.RESULT_SCREEN);e instanceof nl&&(this.spinningTween=this.scene.tweens.addCounter({from:Phaser.Math.DegToRad(-90),to:Phaser.Math.DegToRad(90),onUpdate:t=>{const s=t.getValue();this.wheelArrow.setRotation(s);const i=Math.sin(s)*29,n=Math.cos(s)*-29;this.wheelArrow.setPosition(i,n),e?.updateCoinText(this.getCurrentMultiplierResult())},yoyo:!0,duration:625,repeat:-1}))}stopWheelSpinning(){this.spinningTween?.stop()}getCurrentMultiplierResult(){for(let e=0;e<this.luckSpinMilestones.length;e++){const t=this.luckSpinMilestones[e];if(this.wheelArrow.angle<=t)return this.luckSpinRewards[e]}return this.luckSpinRewards[this.luckSpinRewards.length-1]}handleOnOpen(){this.startWheelSpinning()}handleOnClose(){this.stopWheelSpinning()}}const{KEY:xR,FRAME:BR}=L.DEFAULT_8_BIT,{KEY:ls,FRAME:Qe}=L.DEFAULT_8_BIT,{MULTIPLY_REWARD_BATTLE:FR,MULTIPLY_REWARD_ROUND:GR}=F,{Ads:Gi}=GameCore.Configs;class HR extends GameCore.Screen{baseValue;rewardWheel;coinText;coinIcon;claimCoinText;claimText;resultText;levelCompletedText;ribbon;shineFx;collectButton;footerContainer;openAnimation;postAdCollectAnimation;fxSpinAnimation;fxScaleAnimation;coinTextAnimation;confettiAnimation;adsTimer;isRewardCollected;coinExplodeEffect;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.background.setAlpha(.9),this.setDepth($e.SCREEN),this.createContent(),this.createEffect()}createEffect(){this.coinExplodeEffect=new GC(this.scene),this.add(this.coinExplodeEffect),this.confettiAnimation=new MR(this.scene),this.confettiAnimation.setDepth($e.SCREEN+1)}open(e){super.open(e),this.scene.requestBackgroundMaskUpdate(P.RESULT_SCREEN,this.background.alpha);const s=this.getData("coinRewarded");this.baseValue=s,this.updateScreen(),this.collectButton.setDisabled(!1),this.collectButton.setAlpha(1),this.scene.ads.canbeShowRewardAd()?(this.collectButton.setDisabled(!1),this.collectButton.setAlpha(1)):(this.collectButton.setDisabled(!0),this.collectButton.setAlpha(.5)),this.rewardWheel.handleOnOpen(),this.runOpenAnimation()}closeScreen=()=>{this.stopShineFxTween(),this.rewardWheel.stopWheelSpinning(),this.confettiAnimation.killAllParticles();const e=this.getData("result");if(!this.isRewardCollected){const s=this.scene.scene.get(K.GAME_SCENE);s instanceof ee&&e==="win"&&s.rewardWinCoin(1)}this.scene.requestBackgroundMaskUpdate(P.RESULT_SCREEN,0),this.scene.screen.close(this.name),this.scene.audio.playSound(X.NEXT_ROUND_EFFECT)};updateScreen(){const e=this.baseValue.toString();this.coinText.setText(`+${e}`),this.isRewardCollected=!1,this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y);const t=this.getData("mode"),s=this.getData("result");if(this.footerContainer.setMode(t,this.baseValue,s),Gi.Enabled||this.footerContainer.runPostAnimation(0),s==="lose")this.resultText.setText(this.scene.lang.Text.FAILED),this.ribbon.setFrame(Qe.RESULT_SCREEN_RIBBON_LOSE),this.shineFx.setFrame(Qe.RESULT_SCREEN_FX_LOSE),this.levelCompletedText.setText("");else if(s==="win"){this.runConfetti(),this.resultText.setText(this.scene.lang.Text.VICTORY),this.ribbon.setFrame(Qe.RESULT_SCREEN_RIBBON_WIN),this.shineFx.setFrame(Qe.RESULT_SCREEN_FX_WIN);let i=GR;if(this.scene instanceof ee){const{gameMode:n}=this.scene;n===J.BATTLE&&(i=FR)}this.levelCompletedText.setText(`${this.scene.lang.Text.LEVEL_COMPLETED_BONUS_X}${i}`)}}runConfetti(){const{displayWidth:e,displayHeight:t}=this.scene.gameZone;this.confettiAnimation.run(0,t,e,t*.75)}handleOnCollect=()=>{this.viewAdsReward()};viewAdsReward=async()=>{let e=null;const{audio:t}=this.scene;try{this.rewardWheel.stopWheelSpinning(),e=this.scene.game.globalScene.time.delayedCall(200,()=>{this.scene.screen.open(P.NOTIFY_SCREEN,{message:this.scene.lang.Text.LOADING,duration:0,loading:!0})}),t.muteAll(),await this.scene.ads.showRewardedVideoAsync(),this.scene.screen.close(P.NOTIFY_SCREEN),this.handleLuckyReward()}catch(s){console.info("🚀 > showInterstitialAdAsync",s),this.handleFailedAdsReward()}finally{this.adsTimer?.destroy(),t.unmuteAll(),this.runPostAdAnimation(),e?.remove(),this.scene.game.globalScene.screen.close(P.NOTIFY_SCREEN),this.scene.ads.preloadRewardedVideoAsync().catch(s=>{})}};handleFailedAdsReward=()=>{this.scene.screen.open(P.CLOSEABLE_NOTIFY_SCREEN,{title:this.scene.lang.Text.DISPLAY_ADS_FAILED,message:this.scene.lang.Text.UNABLE_TO_DISPLAY_ADS,duration:1500,loading:!1})};handleLuckyReward=()=>{this.onWheelEnding()};onWheelEnding=()=>{this.runCoinTextAnimation();const e=this.rewardWheel.getCurrentMultiplierResult(),t=this.getData("result"),s=this.scene.scene.get(K.GAME_SCENE);t==="lose"?s.rewardLostCoin(e):t==="win"&&s.rewardWinCoin(e);const i=this.baseValue.clone();i.multiply(e),this.footerContainer.setCoinText(i.toString()),this.isRewardCollected=!0};createContent(){this.createCollectButton(),this.createFx(),this.createFooter(),this.createLevelCompleteText(),this.createGoldText(),this.createGoldIcon(),this.createEarnText(),this.createRibbon(),this.createRewardWheel()}createCollectButton(){const e=this.scene.lang.getCurrentLanguage();this.collectButton=new de(this.scene,ls,Qe.RESULT_SCREEN_GREEN_BUTTON_RESULT,181,71),this.collectButton.setName("ClaimWithAds"),this.add(this.collectButton);let t=30,s=-20,i=-30,n=10;switch(e){case"ru":t=20,s=-17,i=-40;break;case"es":t=21;break;case"pt":t=25;break;case"ja":t=25,s=-22,n=8;break;case"zh":t=25,i=-18,s=-15;break;case"tr":t=22,i=-32;break;case"fr":t=20;break;case"id":t=25;break;case"de":t=18,i=-37;break;case"it":t=23,i=-35;break}const r=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(t),origin:{x:0,y:.5}});r.setText(this.scene.lang.Text.GET+" x5"),r.setDropShadow(-1,1,0),this.claimText=r,this.collectButton.add(r),Phaser.Display.Align.In.Center(r,this.collectButton,i,s);const c=this.scene.make.image({key:xR,frame:BR.ICON_AD});c.setWorldSize(25.5,27),this.collectButton.add(c),Phaser.Display.Align.In.Center(c,this.collectButton,-60,-5);const o=this.scene.make.image({key:ls,frame:Qe.RESULT_SCREEN_SINGLE_COIN_ICON});o.setWorldSize(16,16),this.collectButton.add(o),Phaser.Display.Align.In.Center(o,this.collectButton,-15,13),this.claimCoinText=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(17)}),this.claimCoinText.setText("0"),this.claimCoinText.setTintText(14993153),this.claimCoinText.setDropShadow(-1.5,1,0),this.collectButton.add(this.claimCoinText),Phaser.Display.Align.In.Center(this.claimCoinText,this.collectButton,22,n),Phaser.Display.Align.In.Center(this.collectButton,this,0,100),this.collectButton.onClick=this.handleOnCollect,Gi.Enabled||this.collectButton.kill()}createFooter(){this.footerContainer=new kR(this.scene),this.add(this.footerContainer),this.footerContainer.onClickContinueBtn=this.handleClickContinueBtn,this.footerContainer.onClickReplayBtn=this.handleClickReplayBtn,this.footerContainer.onClickReturnBtn=this.handleClickContinueBtn,Phaser.Display.Align.In.Center(this.footerContainer,this.collectButton,0,130)}handleClickContinueBtn=()=>{const e=this.scene.scene.get(K.GAME_SCENE),t=this.getData("result"),s=this.getData("mode");e.events.once(Phaser.Scenes.Events.RESUME,()=>{e instanceof ee&&(s===J.NORMAL&&t==="lose"?e.replayRound():e.nextRound())}),this.closeScreen()};handleClickReplayBtn=()=>{const e=this.scene.scene.get(K.GAME_SCENE);e.events.once(Phaser.Scenes.Events.RESUME,()=>{e instanceof ee&&e.replayRound()}),this.closeScreen()};createLevelCompleteText(){this.levelCompletedText=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(18)}),this.levelCompletedText.setTintText(15650560),this.levelCompletedText.setDropShadow(-1,1,0),this.add(this.levelCompletedText),Phaser.Display.Align.In.Center(this.levelCompletedText,this,0,-80),this.levelCompletedText.setScale(this.collectButton.scaleX,this.collectButton.scaleY)}createGoldIcon(){this.coinIcon=this.scene.make.image({key:ls,frame:Qe.RESULT_SCREEN_GOLD_ICON}),this.coinIcon.setWorldSize(55,39.5),this.add(this.coinIcon),Phaser.Display.Align.In.Center(this.coinIcon,this,this.coinText.displayWidth/2,-120)}createGoldText(){this.coinText=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(32)}),this.coinText.setDropShadow(-1,1,0),this.add(this.coinText),Phaser.Display.Align.In.Center(this.coinText,this,-20,-125)}createEarnText(){const e=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(18)});e.setText(this.scene.lang.Text.YOU_EARNED),e.setDropShadow(-2,1,0),this.add(e),Phaser.Display.Align.In.Center(e,this,0,-180),e.setScale(this.collectButton.scaleX,this.collectButton.scaleY)}createFx(){this.shineFx=this.scene.make.image({key:ls,frame:Qe.RESULT_SCREEN_FX_WIN}),this.add(this.shineFx),this.shineFx.setWorldSize(375,407),Phaser.Display.Align.In.Center(this.shineFx,this,0,-120)}createRibbon(){const e=this.scene.lang.getCurrentLanguage();let t=-7;switch(e){case"ja":t=-10;break}this.ribbon=this.scene.make.image({key:ls,frame:Qe.RESULT_SCREEN_RIBBON_WIN}),this.add(this.ribbon),this.ribbon.setWorldSize(280,50),Phaser.Display.Align.In.Center(this.ribbon,this,2,-240),this.resultText=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(24)}),this.resultText.setDropShadow(-1,1,0),this.add(this.resultText),Phaser.Display.Align.In.Center(this.resultText,this.ribbon,3,t)}createRewardWheel(){this.rewardWheel=new UR(this.scene),this.add(this.rewardWheel),Phaser.Display.Align.In.Center(this.rewardWheel,this,0,40),Gi.Enabled||this.rewardWheel.kill()}runOpenAnimation(){this.openAnimation?.stop(),this.openAnimation?.remove(),this.collectButton.setAlpha(1);const e=this.list.filter(s=>s!==this.background&&s!==this.footerContainer),t=e.map(s=>s.alpha);e.forEach(s=>s.setAlpha(0)),this.openAnimation=new li({targets:e,delay:0,duration:400,props:{alpha:{getStart:()=>0,getEnd:(s,i,n,r)=>t[r]}},onComplete:()=>{this.runShineFxTween()}}),this.footerContainer.runAnimation(2500),this.openAnimation.play()}runShineFxTween(){const e=this.getData("result");this.fxSpinAnimation=this.scene.tweens.add({targets:this.shineFx,duration:e==="win"?2e4:4e4,ease:"Linear",repeat:-1,props:{rotation:{from:Phaser.Math.DegToRad(0),to:Phaser.Math.DegToRad(360)}},onStop:()=>{this.shineFx.rotation=Phaser.Math.DegToRad(0)}});const t=this.shineFx.scaleX,s=this.shineFx.scaleY;this.fxScaleAnimation=this.scene.tweens.add({targets:this.shineFx,duration:2e3,ease:Phaser.Math.Easing.Quadratic.Out,repeat:-1,yoyo:!0,props:{scaleX:{from:t,to:t*1.2},scaleY:{from:s,to:s*1.2}},onStop:()=>{this.shineFx.setScale(t,s)}})}stopShineFxTween(){this.fxSpinAnimation?.stop(),this.fxSpinAnimation?.remove(),this.fxScaleAnimation?.stop(),this.fxScaleAnimation?.remove()}runPostAdAnimation(){this.postAdCollectAnimation?.stop(),this.postAdCollectAnimation?.remove(),this.postAdCollectAnimation=this.scene.tweens.add({targets:this.collectButton,duration:500,alpha:{from:.5,to:0},ease:Phaser.Math.Easing.Quadratic.In}),this.footerContainer.runPostAnimation(500)}runCoinTextAnimation(){this.coinTextAnimation?.stop(),this.coinTextAnimation?.remove();const e=this.rewardWheel.getCurrentMultiplierResult(),t=this.baseValue.clone(),s=this.baseValue.clone();s.multiply(e);const i=s.clone();i.subtract(t),i.divide(10);const n=this.coinText.scaleX,r=this.coinText.scaleY;this.coinExplodeEffect.explode(12,this.coinIcon.x,this.coinIcon.y),this.coinTextAnimation=this.scene.tweens.addCounter({from:1,to:10,duration:150,onRepeat:()=>{t.add(i),this.coinText.setText(`+${t.toString()}`),this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y)},onStart:()=>{this.scene.audio.playSound(X.COIN_INCREASE_REPEATEDLY_SOUND),this.coinText.setScale(n*1.1,r*1.1),this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y),t.add(i),this.coinText.setText(`+${t.toString()}`),this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y)},onComplete:()=>{this.coinText.setScale(n,r),this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y)},onStop:()=>{this.coinText.setScale(n,r),this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y)},repeat:9})}updateCoinText(e){const t=this.baseValue.clone();t.multiply(e),this.claimCoinText.setText(`${t.toString()}`),this.claimText.setText(`${this.scene.lang.Text.GET} x${e}`)}}const nl=HR,{KEY:YR,FRAME:KR}=L.DEFAULT,{KEY:Br,FRAME:Fr}=L.DEFAULT_8_BIT;class Gr extends GameCore.Screen{popup;title;confirmBtn;cancelBtn;description;showUpAnimation;contentShowUpAnimation;fadeOutAnimation;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.background.setAlpha(.7),this.setSize(this.scene.gameZone.displayWidth,this.scene.gameZone.displayHeight),this.createPopup(),this.createCloseButton(),this.createTitle(),this.createContent()}open(){super.open();const e=this.scene.scene.get(K.GAME_SCENE);e instanceof ee&&e.screenManager.listenResizeEventForCalculateLight(this),this.scene.requestBackgroundMaskUpdate(P.START_OVER_POPUP,this.background.alpha),this.runOpenAnimation()}handleClosePopup=()=>{this.runFadeOutAnimation()};createPopup(){this.popup=new xt(this.scene,{x:0,y:0,width:300,height:200,rightEdge:870778,topInnerCornerStrokeWidth:2,rightInnerCornerStrokeWidth:3,lightY:-40}),this.add(this.popup)}recalculateLightPosition(){this.popup&&this.popup.recalculateLightPosition()}createCloseButton(){const e=new Ut(this.scene);e.setName("button"),Phaser.Display.Align.In.TopRight(e,this.popup,10,10),this.popup.add(e),e.onClick=()=>{const t=this.scene.scene.get(K.GAME_SCENE);t instanceof ee&&t.stateManager.levelComplete(),this.handleClosePopup()}}createTitle(){const e=this.scene.make.text({text:this.scene.lang.Text.START_OVER_TITLE,style:{fontSize:"22px",stroke:"#000000",strokeThickness:2,color:"#FFFFFF",fixedWidth:325,align:"center",fontFamily:k.FONT_FAMILY}});e.setName("title"),e.setHighQuality(),e.setShadow(-8,8,"#000000",0,!0),this.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-13);const t=this.scene.make.image({key:YR,frame:KR.TITLE_LINE});t.setWorldSize(235,23),this.popup.add(t),Phaser.Display.Align.In.BottomCenter(t,e,0,30),this.title=e}createContent(){this.createDescription(),this.createConfirmButton(),this.createCancelButton()}createDescription(){this.description=this.scene.make.bitmapText({text:this.scene.lang.Text.START_OVER_DESC,font:k.PRIMARY.KEY,size:this.scene.fontSize(17),origin:{x:.5,y:.5}}),this.description.setMaxWidth(275),this.description.setCenterAlign(),this.add(this.description),this.description.setPosition(0,-10)}createConfirmButton(){this.confirmBtn=new de(this.scene,Br,Fr.BUTTON_RED,108,43),this.confirmBtn.setName("confirmBtn");const e=this.scene.lang.getCurrentLanguage();let t=-5;switch(e){case"tr":t=-8;break}const s=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(20)});s.setText(this.scene.lang.Text.YES),s.setDropShadow(-1,1.5,0),this.confirmBtn.add(s),s.setPosition(0,t),this.add(this.confirmBtn),Phaser.Display.Align.In.Center(this.confirmBtn,this.popup,-70,60),this.confirmBtn.onClick=()=>{const i=this.scene.scene.get(K.GAME_SCENE);i instanceof ee&&i.resetLevel(),this.handleClosePopup()}}createCancelButton(){this.cancelBtn=new de(this.scene,Br,Fr.BUTTON_GREEN,108,43),this.cancelBtn.setName("cancelBtn");const e=this.scene.lang.getCurrentLanguage();let t=-5;switch(e){case"tr":t=-8;break}const s=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(20)});s.setText(this.scene.lang.Text.NO),s.setDropShadow(-1,1.5,0),this.cancelBtn.add(s),s.setPosition(0,t),this.add(this.cancelBtn),Phaser.Display.Align.In.Center(this.cancelBtn,this.popup,70,60),this.cancelBtn.onClick=()=>{const i=this.scene.scene.get(K.GAME_SCENE);i instanceof ee&&i.stateManager.levelComplete(),this.handleClosePopup()}}runOpenAnimation(){this.runPopupEntrancesAnimation(),this.runPopupContentEntrancesAnimation(100,400)}runPopupEntrancesAnimation(){this.showUpAnimation||(this.showUpAnimation=new it({targets:[this.popup]})),this.showUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove();const s=[this.title,this.description,this.confirmBtn,this.cancelBtn],i=s.map(n=>n.alpha);this.contentShowUpAnimation=new is({targets:s,duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:n=>n.scale-.3,getEnd:n=>n.scale},alpha:{getStart:n=>(n.setAlpha(0),0),getEnd:(n,r,c,o)=>i[o]}}}),this.contentShowUpAnimation.play()}runFadeOutAnimation(){this.fadeOutAnimation||(this.fadeOutAnimation=new Ye({targets:[this.background],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.7,from:.7,to:0}},onActive:()=>{this.popup.kill(),this.title.kill(),this.description.kill(),this.confirmBtn.kill(),this.cancelBtn.kill()},onUpdate:(e,t)=>{this.scene.requestBackgroundMaskUpdate(P.START_OVER_POPUP,t.alpha)},onComplete:()=>{this.popup.revive(),this.title.revive(),this.description.revive(),this.confirmBtn.revive(),this.cancelBtn.revive();const e=this.scene.scene.get(K.GAME_SCENE);e instanceof ee&&e.screenManager.removeResizeEventForCalculateLight(this),this.background.setAlpha(.7),this.scene.screen.close(this.name)}})),this.fadeOutAnimation.play()}}const VR=Pn(.55,.47,.43,.91),WR={targets:[],yoyo:!0,repeat:-1,duration:600,repeatDelay:50,ease:VR,easeParams:[0,.9],props:{scale:{from:1,to:1.2}}};class al extends Le{constructor(e){super(WR,e)}}const{KEY:jR,FRAME:Hr}=L.EFFECTS;class $R extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,jR,Hr.FX_COMET),this.createEmitZone(),this.createEmitters(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:Hr.FX_COMET,emitZone:{source:this.emitZone,type:"random"},deathZone:{source:this.emitZone,type:"onLeave"},timeScale:1,frequency:150,speedY:{min:-20,max:-60},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Cubic.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Cubic.Out},lifespan:{min:1500,max:2500}})}run(e,t,s,i,n){this.stop(),this.emitZone.setSize(i,n),this.emitZone.setPosition(t-i/2,s-n/2),this.emitter.setQuantity(e),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}}const{KEY:zR,FRAME:Yr}=L.DEFAULT_8_BIT;class XR extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,zR,Yr.UNIT_REWARD_PARTICLE),this.createEmitZone(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:Yr.UNIT_REWARD_PARTICLE,emitZone:{source:this.emitZone,type:"random"},timeScale:1,frequency:100,rotate:{min:0,max:90},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Expo.Out},lifespan:{min:3e3,max:4500}})}run(e,t,s,i,n,r=100){this.stop(),this.reset(),this.emitZone.setSize(i,n),this.emitZone.setPosition(t-i/2,s-n/2),this.emitter.setQuantity(e),this.emitter.setFrequency(r),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}reset(){this.createEmitters()}}const{KEY:qR,FRAME:Kr}=L.DEFAULT_8_BIT;class ZR extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,qR,Kr.UNIT_REWARD_ELLIPSE_FX),this.createEmitZone(),this.createEmitters(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:Kr.UNIT_REWARD_ELLIPSE_FX,emitZone:{source:this.emitZone,type:"random"},deathZone:{source:this.emitZone,type:"onLeave"},timeScale:1,frequency:150,speedY:{min:-20,max:-60},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Cubic.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Cubic.Out},lifespan:{min:1500,max:2500}})}run(e,t,s,i,n){this.stop(),this.emitZone.setSize(i,n),this.emitZone.setPosition(t-i/2,s-n/2),this.emitter.setQuantity(e),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}}const{KEY:Hi,FRAME:Yi}=L.DEFAULT_8_BIT;class QR extends Phaser.GameObjects.Container{giftAdIcon;particleTweens=[];bubbleTwinkleUp;iconAttentionAnimation;constructor(e){super(e),this.createGlow(),this.createFx(),this.createCurrencyIcon(),this.updateSize(),this.createEllipses(),this.createParticles(),this.scene.add.existing(this)}createGlow(){const e=this.scene.make.image({key:Hi,frame:Yi.UNIT_REWARD_GLOW});e.setWorldSize(372.5,372.5),this.add(e)}createFx(){const e=this.scene.make.image({key:Hi,frame:Yi.UNIT_REWARD_FX});e.setWorldSize(375,234.5),this.add(e)}createCurrencyIcon(){this.giftAdIcon=this.scene.add.image(0,0,Hi,Yi.UNIT_REWARD_GIFT_AD),this.giftAdIcon.setWorldSize(168.5,168),this.giftAdIcon.setY(0),this.add(this.giftAdIcon)}updateSize(){const{displayWidth:e,displayHeight:t}=this.giftAdIcon;this.setSize(e,t)}createEllipses(){this.bubbleTwinkleUp=new ZR(this.scene),this.bubbleTwinkleUp.setScale(1.5),this.add(this.bubbleTwinkleUp)}createParticles(){for(let e=0;e<4;e++){const t=new XR(this.scene);this.add(t),this.particleTweens.push(t)}}runLogoAttentionAnimation(e){this.iconAttentionAnimation||(this.iconAttentionAnimation=new al({targets:[this.giftAdIcon],delay:e,props:{scale:"+=0.05"}})),this.iconAttentionAnimation.play();const{x:t,y:s,width:i,height:n}=this.giftAdIcon;this.bubbleTwinkleUp.run(1,t,s,i,n),this.particleTweens.forEach(r=>{const c=Phaser.Math.Between(1e3,2e3);r.run(1,0,0,i,n,c)})}stopAnimation(){this.particleTweens.forEach(e=>{e.stop()}),this.iconAttentionAnimation.stop()}}const{KEY:Vr,FRAME:Wr}=L.DEFAULT_8_BIT;class JR extends de{constructor(e){super(e,Vr,Wr.BUTTON_GREEN_LONG,200,64),this.setName("ViewAd"),this.createIcon(),this.createViewText()}createIcon(){const e=this.scene.add.image(0,0,Vr,Wr.ICON_AD);e.setWorldSize(43.5,45.5),Phaser.Display.Align.In.Center(e,this,-60,-5),this.add(e)}createViewText(){const e=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(22)});e.setText(this.scene.lang.Text.GET_NOW),e.setDropShadow(-1.5,1.5,0),Phaser.Display.Align.In.Center(e,this,25,-5),this.add(e)}}const{KEY:Ki,FRAME:Vi}=L.DEFAULT_8_BIT,{LEVEL_PROGRESS:e_}=ye;class t_ extends GameCore.Screen{rewardValue;hand;viewAdButton;skipButton;giftIcon;giftIconWhite;currencyText;giftAdComponent;popupContents;cometTwinkle;starTwinkleUp;sparksExplosive;contentFadeOutAnimation;contentShowUpAnimation;giftEntrancesAnimation;giftAttentionAnimation;giftShakeAnimation;giftOpenAnimation;adsTimer;constructor(e,t,s,i){super(e,t,s,i),this.setDepth($e.POPUP),this.background.setAlpha(0),this.createViewAdsButton(),this.createSkipButton(),this.createGiftAdIcon(),this.createCurrencyText(),this.createEffects(),this.createGiftIcon(),this.createHand(),this.createContentsGroup()}open=e=>{super.open(e),this.background.setAlpha(0),this.scene.requestBackgroundMaskUpdate(P.UNIT_REWARD_SCREEN,this.background.alpha),this.setRewardValue(e.unitType),this.runOpenAnimation(),this.handleShowRewardedVideoAd()};handleClosePopup=()=>{this.runCloseAnimation()};handleShowRewardedVideoAd=async()=>{let e=null;const{audio:t,game:s}=this.scene;try{this.viewAdButton.setDisabled(!0),e=this.scene.game.globalScene.time.delayedCall(200,()=>{s.globalScene.screen.open(P.NOTIFY_SCREEN,{message:s.lang.Text.LOADING_ADS,duration:0,loading:!0})}),t.muteAll(),await this.scene.ads.showRewardedVideoAsync(),this.background.setAlpha(.8),this.scene.requestBackgroundMaskUpdate(P.UNIT_REWARD_SCREEN,this.background.alpha),this.starTwinkleUp.stop(),this.scene.audio.playSound(X.DAILY_REWARD),this.popupContents.killGroup(),this.runTheGiftEntrancesAnimation(0,1500)}catch(i){if(i instanceof Object&&GameCore.Utils.Object.hasOwn(i,"code")&&i.code==="USER_INPUT"){this.handleClosePopup(),this.showNotifySkipAds();return}this.handleClosePopup(),this.showNotifyNoAds()}finally{this.adsTimer?.destroy(),t.unmuteAll(),e?.remove(),this.scene.game.globalScene.screen.close(P.NOTIFY_SCREEN),this.scene.ads.preloadRewardedVideoAsync().catch(i=>{})}};setTheGiftClickable(e){e?this.giftIcon.setInteractive():this.giftIcon.disableInteractive()}handleTheGiftClick=()=>{this.setTheGiftClickable(!1),this.logButtonEvent("OpenGift"),this.hand.stopAnimation(),this.hand.kill(),this.giftIconWhite.revive(),this.scene.tweens.killTweensOf(this.giftIcon),Phaser.Display.Align.In.Center(this.giftIconWhite,this.giftIcon),this.scene.audio.playSound(X.GIFT_CHARGE),Et(50),this.runShakeTheGift(),this.runOpenTheGift()};logButtonEvent(e){const t=this.getScreenName();this.scene.analytics.event(G.BUTTON_CLICK,{button_name:e,screen_name:t})}showNotifyNoAds=e=>{if(e&&e.name!==P.CLOSEABLE_NOTIFY_SCREEN)return;const{globalScene:t}=this.scene.game;t.screen.open(P.CLOSEABLE_NOTIFY_SCREEN,{message:t.lang.Text.NO_ADS_TO_DISPLAY,duration:1500,loading:!1})};showNotifySkipAds=()=>{const{globalScene:e}=this.scene.game;e.screen.open(P.CLOSEABLE_NOTIFY_SCREEN,{message:e.lang.Text.SORRY_NO_REWARDS,duration:1500,loading:!1})};runOpenAnimation(){this.revive(),this.hand.stopAnimation(),this.hand.kill(),this.popupContents.reviveGroup(),this.starTwinkleUp.stop(),this.runPopupContentEntrancesAnimation(100,400),this.runLogoAttentionAnimation(500)}runCloseAnimation=()=>{this.runExitsAnimation(0,200)};runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove(),this.contentShowUpAnimation=new is({targets:this.popupContents.getChildren(),duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:s=>s.scale-.3,getEnd:s=>s.scale},alpha:{start:0,from:0,to:1}}}),this.contentShowUpAnimation.play()}runLogoAttentionAnimation(e){const{x:t,y:s,width:i,height:n}=this.giftAdComponent;this.starTwinkleUp.run(1,t,s,i,n),this.giftAdComponent.runLogoAttentionAnimation(e)}runTheGiftEntrancesAnimation(e,t){this.giftIcon.revive(),this.giftIcon.setAlpha(1),Phaser.Display.Align.In.TopRight(this.giftIcon,this.zone),this.giftEntrancesAnimation?.remove();const{x:s,y:i}=this.giftIcon,{x:n,y:r}=this.currencyText,c={x:s,y:i},o={x:n,y:r},l=1/this.scene.world.getPixelRatio();this.giftEntrancesAnimation=new cn({targets:[this.giftIcon],delay:e,duration:t,curve:[[c.x,c.y],[c.x-80,c.y+80],[o.x,o.y]],props:{scale:{start:l*.5,to:l},angle:{start:20,to:0}},onCurveUpdate:h=>{const u=h.x+Phaser.Math.RND.between(-40,40),p=h.y+Phaser.Math.RND.between(-40,40);this.cometTwinkle.explode(1,u,p)},onComplete:()=>{this.scene.audio.playSound(X.GIFT_REVEAL);const h=1.5;this.starTwinkleUp.setScale(h);const{x:d,y:u,width:p,height:g}=this.giftIcon;this.starTwinkleUp.run(1,d,u,p/h,g/h),this.moveTo(this.starTwinkleUp,this.length-1),this.runTheGiftAttentionAnimation()}}),this.giftEntrancesAnimation.play()}runTheGiftAttentionAnimation(){this.giftAttentionAnimation||(this.giftAttentionAnimation=new al({targets:[this.giftIcon],props:{scale:"+=0.05"}})),this.hand.revive(),this.hand.playAnimation(),Phaser.Display.Align.In.Center(this.hand,this.giftIcon,20,20),this.setTheGiftClickable(!0),this.giftAttentionAnimation.play()}runShakeTheGift(){this.giftShakeAnimation||(this.giftShakeAnimation=new el({targets:[this.giftIcon,this.giftIconWhite],duration:22})),this.giftShakeAnimation.play()}runOpenTheGift(){if(!this.giftOpenAnimation){const e=1/this.scene.world.getPixelRatio();this.giftOpenAnimation=new ti({targets:[this.giftIcon,this.giftIconWhite],duration:1500,props:{alpha:0,scale:e},onUpdate:()=>{this.giftIconWhite.setAlpha(1)},onComplete:()=>{this.giftShakeAnimation.stop(),this.giftIcon.kill(),this.giftIconWhite.kill(),this.sparksExplosive.explode(100,this.giftIcon.x,this.giftIcon.y,230),this.scene.audio.playSound(X.GIFT_EXPLODE),this.rewardUnit(),this.scene.time.delayedCall(500,this.runCloseAnimation)}})}this.giftOpenAnimation.play()}rewardUnit(){this.scene.analytics.event(G.EARN_UNIT,{value:`${this.rewardValue.toLowerCase()}-lv${this.getRewardedUnitLevel()}`});const e=this.scene.scene.get(K.GAME_SCENE);e instanceof ee&&e.spawnUnit(this.rewardValue,!0,this.getRewardedUnitLevel())}getRewardedUnitLevel(){const e=this.scene.player.getCustomData(e_),t=GameCore.Utils.Valid.isNumber(e)?e+1:1,{BUYING_UNIT_LEVEL:s}=F;let i=1;return s.forEach((n,r)=>{n<=t&&(i=r+1)}),i}runExitsAnimation(e,t){this.contentFadeOutAnimation||(this.contentFadeOutAnimation=new Ye({targets:this.popupContents.getChildren(),delay:e,duration:t,props:{alpha:{start:.8,to:0}},onComplete:()=>{this.scene.requestBackgroundMaskUpdate(P.UNIT_REWARD_SCREEN,0),this.scene.screen.close(this.name),this.viewAdButton.setDisabled(!1),this.skipButton.setDisabled(!1)}})),this.contentFadeOutAnimation.play()}createHand(){this.hand=new Xc(this.scene),this.add(this.hand)}createContentsGroup(){this.popupContents=this.scene.make.group({}),this.popupContents.addMultiple([this.giftAdComponent,this.currencyText])}createCurrencyText(){this.currencyText=this.scene.make.bitmapText({size:this.scene.fontSize(22),font:k.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.currencyText.setCenterAlign(),this.setRewardValue("MELEE"),this.add(this.currencyText)}setRewardValue(e){this.rewardValue=e,this.currencyText.setText(this.scene.lang.Text.WATCH_A_VIDEO),Phaser.Display.Align.In.BottomCenter(this.currencyText,this.giftAdComponent,0,20)}createViewAdsButton(){this.viewAdButton=new JR(this.scene),this.viewAdButton.onClick=this.handleShowRewardedVideoAd,this.viewAdButton.onDown=()=>{this.skipButton.setDisabled(!0)},this.viewAdButton.onOut=()=>{this.skipButton.setDisabled(!1)},Phaser.Display.Align.In.Center(this.viewAdButton,this.zone,0,100),this.viewAdButton.kill()}createSkipButton(){this.skipButton=new il(this.scene,{key:Ki,frame:Vi.UNIT_REWARD_NO_THANKS_TEXT,width:123.5,height:18.5,paddingZone:50}),this.skipButton.setName("NoThanks"),this.skipButton.onClick=this.handleClosePopup,this.skipButton.onDown=()=>{this.viewAdButton.setDisabled(!0)},this.skipButton.onOut=()=>{this.viewAdButton.setDisabled(!1)},Phaser.Display.Align.In.BottomCenter(this.skipButton,this.viewAdButton,0,80),this.skipButton.kill()}createGiftAdIcon(){this.giftAdComponent=new QR(this.scene),Phaser.Display.Align.In.Center(this.giftAdComponent,this.zone,0,-80),this.add(this.giftAdComponent)}createGiftIcon(){this.giftIconWhite=this.scene.make.image({key:Ki,frame:Vi.UNIT_REWARD_GIFT_GLOW,visible:!1}),this.giftIconWhite.setWorldSize(168.5,168),this.giftIconWhite.setDepth(W.PRIORITY),this.add(this.giftIconWhite),this.giftIcon=this.scene.make.image({key:Ki,frame:Vi.UNIT_REWARD_GIFT,visible:!1}),this.giftIcon.setInteractive({useHandCursor:!0}),this.giftIcon.setWorldSize(168.5,168),this.giftIcon.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleTheGiftClick),this.setTheGiftClickable(!1),this.add(this.giftIcon)}createEffects(){this.cometTwinkle=new Nc(this.scene),this.starTwinkleUp=new $R(this.scene),this.sparksExplosive=new Mc(this.scene),this.add([this.cometTwinkle,this.starTwinkleUp,this.sparksExplosive])}}const{KEY:s_,FRAME:jr}=L.EFFECTS;class i_ extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,s_,jr.FX_STAR_YELLOW),this.createEmitZone(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:jr.FX_STAR_YELLOW,emitZone:{source:this.emitZone,type:"random"},timeScale:1,frequency:100,alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Expo.Out},lifespan:{min:1500,max:3e3}})}run(e,t,s,i,n,r=100){this.stop(),this.reset(),this.emitZone.setSize(i,n),this.emitZone.setPosition(t-i/2,s-n/2),this.emitter.setQuantity(e),this.emitter.setFrequency(r),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}reset(){this.createEmitters()}}const{KEY:Wi}=L.UNITS,{KEY:ut,FRAME:dt}=L.DEFAULT_8_BIT;let n_=class extends Phaser.GameObjects.Container{glow;backEffect;bg;ribbon;healthContainer;healthText;atkContainer;atkText;unitName;unitFrame;particleTween=[];backEffectTween;exitTween;onExitComplete;loading;payload;constructor(e){super(e),this.scene=e,this.setName("UnitCard"),this.createGlow(),this.createBackEffect(),this.createBg(),this.updateSize(),this.createRibbon(),this.createHealthContainer(),this.createAtkContainer(),this.createUnitName(),this.createUnitFrame(),this.createAnimation(),this.scene.add.existing(this)}createGlow(){const e=this.scene.make.image({key:ut,frame:dt.UNIT_UNLOCK_GLOW});e.setName("glow"),e.setWorldSize(340.5,349.5),this.add(e),this.glow=e}createBackEffect(){const e=new sl(this.scene,{color:234748,width:{min:4,max:8},radius:{min:180,max:170},lineNumber:18});e.setName("backEffect"),e.setPosition(0,0),this.add(e),this.backEffect=e}createBg(){const e=this.scene.make.image({key:ut,frame:dt.UNIT_UNLOCK_FRAME});e.setName("frame"),e.setWorldSize(207.5,292),this.add(e),this.bg=e}createRibbon(){const e=this.scene.make.image({key:ut,frame:dt.UNIT_UNLOCK_BG});e.setName("ribbon"),e.setWorldSize(204,34.5),this.add(e),Phaser.Display.Align.In.TopCenter(e,this,-1,-4),this.ribbon=e}updateSize(){const{width:e,height:t}=this.bg;this.setSize(e,t)}createHealthContainer(){this.healthContainer=this.scene.make.container({}),this.healthContainer.setName("healthContainer");const e=this.scene.make.image({key:ut,frame:dt.UNIT_UNLOCK_BG_1});e.setName("health-bg"),e.setWorldSize(79.5,25),this.healthContainer.setSize(e.width,e.height);const t=this.scene.make.image({key:ut,frame:dt.UNIT_UNLOCK_ICON_HEART});t.setName("health-icon"),t.setWorldSize(21.5,19),Phaser.Display.Align.In.LeftCenter(t,e,-10);const s=this.scene.make.text({text:"0",style:{fontSize:"22px",color:"#ffffff",stroke:"#000000",strokeThickness:2,fixedWidth:13*22,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),s.setPosition(15,0),this.healthText=s,this.healthContainer.add([e,t,s]),this.add(this.healthContainer),Phaser.Display.Align.In.TopLeft(this.healthContainer,this,-15,-8)}createAtkContainer(){this.atkContainer=this.scene.make.container({}),this.atkContainer.setName("atkContainer");const e=this.scene.make.image({key:ut,frame:dt.UNIT_UNLOCK_BG_1});e.setName("atk-bg"),e.setWorldSize(79.5,25),this.atkContainer.setSize(e.width,e.height);const t=this.scene.make.image({key:ut,frame:dt.UNIT_UNLOCK_ICON_BATTLE});t.setName("atk-icon"),t.setWorldSize(20.5,18),Phaser.Display.Align.In.LeftCenter(t,e,-10);const s=this.scene.make.text({text:"0",style:{fontSize:"22px",color:"#ffffff",stroke:"#000000",strokeThickness:2,fixedWidth:13*22,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),s.setPosition(15,0),this.atkText=s,this.atkContainer.add([e,t,s]),this.add(this.atkContainer),Phaser.Display.Align.In.TopRight(this.atkContainer,this.ribbon,-15,-4)}createUnitName(){const e=this.scene.make.text({text:"Abcdefghjklmnopx",style:{fontSize:"22px",color:"#ffffff",fixedWidth:286,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});e.setHighQuality(),this.unitName=e,this.add(e),Phaser.Display.Align.In.BottomCenter(e,this,0,-21)}createUnitFrame(){this.loading=new _s(this.scene),this.loading.setY(-10),this.add(this.loading);const e=this.scene.make.image({key:ut,frame:dt.BLANK});e.setName("unitFrame"),e.setWorldSize(200,200),e.setY(-9),this.add(e),e.kill(),this.unitFrame=e}createAnimation(){for(let e=0;e<4;e++){const t=new i_(this.scene);this.add(t),this.particleTween.push(t)}this.backEffectTween=this.scene.add.tween({paused:!0,targets:this.backEffect,duration:1e6,ease:Phaser.Math.Easing.Linear,repeat:-1,props:{rotation:{start:0,to:180}}})}runAnimation(){this.glow.revive(),this.backEffect.revive();const{width:e,height:t}=this;this.particleTween.forEach(s=>{const i=Phaser.Math.Between(1e3,2e3);s.run(1,0,0,e/2,t/2.5,i)}),this.backEffectTween.resume()}stopAnimation(){this.particleTween.forEach(e=>{e.stop()}),this.backEffectTween.pause()}runExitAnimation(){this.glow.kill(),this.backEffect.kill(),this.createExitAnimation(),this.exitTween.play()}createExitAnimation(){if(this.exitTween)return;const{scale:e,x:t,y:s}=this;let i=t-160.5,n=s-300;const r=this.scene.game.scene.getScene(K.GAME_SCENE);if(r instanceof ee){const{x:c,y:o}=r.uiManager.getUnitBtnPos(),{x:l,y:h}=this.parentContainer.getLocalPoint(c,o);i=l,n=h}this.exitTween=this.scene.add.tween({paused:!0,targets:this,duration:800,ease:Phaser.Math.Easing.Cubic.Out,props:{scale:{from:e,to:e/10},x:{delay:600,from:t,to:i},y:{delay:600,from:s,to:n},alpha:{delay:1300,duration:200,from:1,to:0}},onComplete:()=>{this.onExitComplete&&this.onExitComplete(),this.setPosition(t,s),this.setScale(e),this.setAlpha(1)}})}updateInfo(e){this.payload=e;const{name:t,health:s,atk:i,frame:n}=e;this.unitFrame.kill(),this.loading.revive(),this.unitName.setText(t);const r=GameCore.Utils.Number.toAbbreviatedString(s);this.healthText.setText(r);const c=GameCore.Utils.Number.toAbbreviatedString(i);this.atkText.setText(c),this.scene.textures.get(Wi).has(n)?this.setUnitFrame():this.scene.textures.on(Phaser.Textures.Events.ADD,this.handleWaitAddTexture),this.unitFrame.setFrame(n)}handleWaitAddTexture=e=>{e===Wi&&(this.scene.textures.off(Phaser.Textures.Events.ADD,this.handleWaitAddTexture),!(!this.visible&&!this.active)&&this.setUnitFrame())};setUnitFrame(){const{frame:e}=this.payload;this.unitFrame.revive(),this.loading.kill(),this.unitFrame.setTexture(Wi,e),this.unitFrame.setWorldSize(200,200)}};const{FRAME:$r}=L.UNITS,{KEY:a_,FRAME:r_}=L.DEFAULT_8_BIT;class zr extends GameCore.Screen{frameBg;popup;title;unitCard;closeBtn;isShowingAdBanner;showPopupAnimation;constructor(e,t,s,i){super(e,t,s,i),this.background.setAlpha(.7),this.setDepth($e.POPUP),this.createPopup(),this.createUnitCard(),this.createPopupTitle(),this.createPopupAnimation()}createPopup(){this.popup=this.scene.make.container({}),this.add(this.popup),this.popup.setName("popup");const e=new xt(this.scene,{x:0,y:0,width:307,height:386,rightEdge:292019,topInnerCornerStrokeWidth:2,rightInnerCornerStrokeWidth:3,lightY:-80});e.setName("frame"),this.frameBg=e,this.popup.add(e);const{width:t,height:s}=e;this.popup.setSize(t,s),this.createCloseButton();const i=this.isShowingAdBanner?-50:0;Phaser.Display.Align.In.Center(this.popup,this,0,i)}recalculateLightPosition(){this.frameBg&&this.frameBg.recalculateLightPosition()}createPopupTitle(){const e=this.scene.make.container({});e.setName("title");const t=this.scene.make.image({key:a_,frame:r_.RIBBON_GREEN});t.setWorldSize(239,65),e.add(t);const s=this.scene.make.text({text:this.scene.lang.Text.NEW_CHARACTER,style:{fontSize:"23px",color:"#FFFFFF",fixedWidth:13*23,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),s.setPosition(0,-5),e.add(s),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-28),this.add(e),this.title=e}createUnitCard(){this.unitCard=new n_(this.scene),this.add(this.unitCard);const e=this.isShowingAdBanner?-25:25;this.unitCard.setY(e)}updateInfo(){const e=this.scene.scene.get(K.GAME_SCENE);if(!(e instanceof ee))return;const{unitManager:t}=e;if(!t)return;const{latestUnitMergePayload:s}=t,{level:i,type:n}=s,r=t.getUnitDataForUnlockingScreen();let c="";if(n===F.MELEE_UNIT_TYPE&&(c=$r.UNLOCKED.MELEE[i]),n===F.RANGED_UNIT_TYPE&&(c=$r.UNLOCKED.RANGED[i]),c==="")return;this.unitCard.updateInfo({frame:c,atk:r.damage,health:r.health,name:r.name});const o=this.isShowingAdBanner?-50:0;this.popup.setY(o),Phaser.Display.Align.In.TopCenter(this.title,this.popup,0,-28);const l=this.isShowingAdBanner?-25:25;this.unitCard.setY(l)}createCloseButton(){const e=new Ut(this.scene);e.setName("Close"),this.popup.add(e),Phaser.Display.Align.In.TopRight(e,this.popup,10,10),e.onClick=this.handleCloseScreen,this.closeBtn=e}open(){super.open(),this.scene.requestBackgroundMaskUpdate(P.UNIT_UNLOCK_SCREEN,this.background.alpha);const t=this.scene.scene.get(K.GAME_SCENE);t instanceof ee&&t.screenManager.listenResizeEventForCalculateLight(this),this.isShowingAdBanner=t?t.isBannerAdShowed:!0,this.showPopupAnimation.play(),this.updateInfo(),this.popup.revive(),this.title.revive(),this.background.revive(),this.unitCard.runAnimation()}close(){this.setBlockInputOutsideEnabled(!1),this.visible&&(this.popup.kill(),this.title.kill(),this.background.kill(),this.unitCard.onExitComplete=()=>{const e=this.scene.scene.get(K.GAME_SCENE);e instanceof ee&&e.screenManager.removeResizeEventForCalculateLight(this),this.scene.screen.close(this.name),this.scene.scene.resume(K.GAME_SCENE);const t=this.scene.game.scene.getScene(K.GAME_SCENE);t instanceof ee&&t.uiManager.runUnitBtnAnim(),this.scene.audio.playSound(X.COIN_SPAWN_SOUND),super.close()},this.unitCard.runExitAnimation(),this.scene.scene.resume(K.GAME_SCENE))}handleCloseScreen=()=>{this.unitCard.stopAnimation(),this.scene.requestBackgroundMaskUpdate(P.UNIT_UNLOCK_SCREEN,0),this.close()};createPopupAnimation(){this.showPopupAnimation=new it({targets:[this.popup,this.title,this.unitCard,this.closeBtn]})}}const{KEY:Xr,FRAME:qr}=L.DEFAULT_8_BIT;class o_ extends tl{numOfCols;colPadding;sliderBg;sliderBar;minSliderY;maxSliderY;constructor(e,t){super(e,t),this.numOfCols=t.numOfCols?t.numOfCols:2,this.colPadding=t.colPadding?t.colPadding:0,this.createSlider(),this.updateConfig(t.listConfigs)}createSlider(){const e=this.scene.make.image({key:Xr,frame:qr.UNIT_SCREEN_SLIDEBAR_BG});e.setName("sliderBg"),e.setWorldSize(6.5,255),Phaser.Display.Align.In.RightCenter(e,this,-3,5),this.add(e),this.sliderBg=e;const t=this.scene.make.image({key:Xr,frame:qr.UNIT_SCREEN_BAR});t.setName("sliderBar"),t.setWorldSize(3.5,41.5),Phaser.Display.Align.In.TopCenter(t,this.sliderBg),this.add(t),this.sliderBar=t;const{y:s,displayHeight:i}=this.sliderBg;this.minSliderY=s-i/2+this.sliderBar.displayHeight/2+1.5,this.maxSliderY=this.minSliderY+this.sliderBg.displayHeight-this.sliderBar.displayHeight-1.5}createEvents(){super.createEvents(),this.scene.events.on(Phaser.Scenes.Events.UPDATE,()=>{let e=this.value-this.marginTop;this.value<-this.maxHeight?e=-this.maxHeight:this.value>0&&(e=0),e=-e;const t=e/(this.maxHeight+this.marginTop);this.sliderBar.setY(this.minSliderY+t*(this.maxSliderY-this.minSliderY))})}updateMaxHeight(){const e=Math.ceil(this.listConfigs.length/this.numOfCols);return this.maxHeight=Math.max(e*(this.objHeight+this.padding)-this.padding+this.marginBottom-this.height,0)}addObjectIndex(e,t){for(let s=e;s<=t;s++){const{padding:i,listConfigs:n}=this;if(s>=n.length)return;const r=this.objects.getFirstDead(!0),c=r.height,o=Math.floor(s/this.numOfCols),l=s%this.numOfCols,h=c/2,d=(c+i)*o,u=this.height/2,p=h+d+this.value-u,g=r.width,f=g/2,E=-(this.numOfCols*(g+this.colPadding)-this.colPadding)/2+f+(g+this.colPadding)*l;r.updateInfo(n[s]),r.setPosition(E,p),r.setActive(!0),r.setVisible(!0),this.addAt(r),this.listObjects[s]=r}}getEndObjectIndex(){const{objHeight:e,padding:t,listConfigs:s}=this,i=e+t;return Math.min(this.numOfCols*Math.floor((this.height-this.value)/i)+(this.numOfCols-1),s.length)}updateListConfigMember(e,t,s){for(let n=0;n<this.listObjects.length;n++){const r=this.listConfigs[n],{unitType:c,originData:o,currentAdWatched:l}=r;if(!c||!o||l===void 0)continue;const{level:h}=o;if(h&&c===e&&h===t){r.currentAdWatched=s;break}}if(this.scene.ads.canbeShowRewardAd())return;this.objects.getMatching("active",!0).forEach(n=>{n.disableAds()})}}const{KEY:Bs,FRAME:Fs}=L.DEFAULT_8_BIT;class c_ extends de{countText;adContainer;btnText;iconAd;iconCoin;constructor(e){super(e,Bs,Fs.UNIT_SCREEN_AD_BUTTON,145,41),this.createText(),this.createAdCount()}createText(){const e=this.scene.lang.getCurrentLanguage();let t=-7;switch(e){case"ja":t=-9}const s=new pe(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(20)});s.setText(this.scene.lang.Text.FREE),s.setDropShadow(-1.5,1.5,0),s.setY(t),this.add(s),this.btnText=s}getBtnTextFontSize(e){const t=this.scene.lang.getCurrentLanguage();let s=20;switch(e){case"notAvailable":switch(t){case"pt":s=17;break;case"id":case"ja":s=18;break;case"de":case"it":case"tr":s=16;break}break;case"buy":switch(t){case"ja":s=18;break}break;case"collect":switch(t){case"ja":s=18;break}break;case"watch":switch(t){case"ja":s=18;break}break}return t==="ja"&&(s=16),s}createAdCount(){const e=this.scene.make.container({}),t=this.scene.make.image({key:Bs,frame:Fs.UNIT_SCREEN_AD_COUNT_BG});t.setWorldSize(68.5,17.5),e.setSize(68.5,17.5),e.add(t);const s=this.scene.make.image({key:Bs,frame:Fs.UNIT_SCREEN_AD_ICON});s.setWorldSize(9,7.5),s.setX(-25),e.add(s),this.iconAd=s;const i=this.scene.make.image({key:Bs,frame:Fs.UNIT_SCREEN_COIN_ICON});i.setWorldSize(12,11.5),i.setX(-25),e.add(i),this.iconCoin=i;const n=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(10),origin:{x:.5,y:.6}});n.setText("0/999"),e.add(n),this.countText=n,Phaser.Display.Align.In.BottomCenter(e,this),this.add(e),this.adContainer=e}setCountText(e,t){t===0?this.countText.setText(`${e.toString()}`):t===-1?this.countText.setText(""):this.countText.setText(`${e.toString()}/${t}`),t===0?this.setMode("buy"):t===-1?this.setMode("notAvailable"):e>=t?this.setMode("collect"):this.setMode("watch")}setMode(e){e==="watch"?(this.adContainer.revive(),this.iconAd.revive(),this.iconCoin.kill(),this.btnText.setText(this.scene.lang.Text.FREE)):e==="collect"?(this.adContainer.kill(),this.btnText.setText(this.scene.lang.Text.COLLECT)):e==="notAvailable"?(this.adContainer.kill(),this.btnText.setText(this.scene.lang.Text.UNAVAILABLE)):(this.adContainer.revive(),this.iconAd.kill(),this.iconCoin.revive(),this.btnText.setText(this.scene.lang.Text.BUY)),this.btnText.setFontSize(this.getBtnTextFontSize(e))}}const{KEY:ji,FRAME:Zr}=L.UNITS,{KEY:vt,FRAME:Je}=L.DEFAULT_8_BIT,{MaximumMeleeLevel:l_,MaximumRangedLevel:h_}=GameCore.Configs.Gameplay,{MELEE_UNIT_TYPE:u_,RANGED_UNIT_TYPE:d_}=F,{Ads:$i}=GameCore.Configs;class p_ extends Phaser.GameObjects.Container{background;watchAdButton;titleText;lock;healthContainer;healthText;atkContainer;atkText;unitIcon;payload;loading;constructor(e,t){super(e),this.scene=e,this.createBackground(),this.createWatchAdButton(),this.updateSize(),this.createUnitIcon(),this.createTitleText(),this.createLock(),this.createHealthContainer(),this.createAtkContainer(),t&&this.updateInfo(t),this.scene.add.existing(this)}updateInfo(e){this.payload={isUnlock:!1,isCanBuy:!1,coinNeed:new q(0),...e},this.updateFrame(),this.updateTitle(),this.updateAdButton(),this.updateLock(),this.updateUnitIcon(),this.updateHealthContainer(),this.updateAtkContainer()}disableAds(){const{currentAdWatched:e,targetAdWatched:t}=this.payload;t>0&&e<t&&this.watchAdButton.setDisabled(!0)}runShowUpAnimation(e=0,t=300){const s=e*100;this.runShowPopUpAnimation(s,t),this.runShowItemAnimation(s,t)}runShowPopUpAnimation(e,t){this.scene.tweens.killTweensOf(this),new it({targets:[this],delay:e,duration:t,props:{y:{start:this.y+70,to:this.y}}}).play()}runShowItemAnimation(e,t){const s=[this.background,this.watchAdButton,this.titleText,this.lock,this.healthContainer,this.atkContainer];this.unitIcon.visible&&this.unitIcon.active&&s.push(this.unitIcon);const i=s.map(r=>r.alpha);s.forEach(r=>r.setAlpha(0));const n=s.map(r=>r.scale);this.scene.tweens.killTweensOf(s),this.scene.add.tween({targets:s,duration:t,delay:this.scene.tweens.stagger(50,{start:e+50}),props:{scale:{duration:1e3,getStart:(r,c,o,l)=>n[l]*.8,getEnd:(r,c,o,l)=>n[l],ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]},alpha:{duration:500,getStart:r=>(r.setAlpha(0),0),getEnd:(r,c,o,l)=>i[l],ease:Phaser.Math.Easing.Cubic.Out}},onStop:()=>{s.forEach((r,c)=>{r.setScale(n[c])})},onComplete:()=>{s.forEach((r,c)=>{r.setScale(n[c])})}})}createBackground(){this.background=this.scene.make.image({key:vt,frame:Je.UNIT_SCREEN_FRAME_1}),this.background.setWorldSize(145,205),this.background.setY(-20.5),this.add(this.background)}createWatchAdButton(){const e=new c_(this.scene);e.onClick=this.handleClickWatchAd,this.add(e),Phaser.Display.Align.In.BottomCenter(e,this.background,0,41),this.watchAdButton=e,$i.Enabled||e.kill()}handleClickWatchAd=async()=>{const{currentAdWatched:e,targetAdWatched:t,updateDataCallback:s,unitType:i,originData:n,showAdsCallback:r,collectCallback:c}=this.payload,{level:o}=n;if(e>=t){const l=t===0;if(l||this.scene.analytics.event(G.BUTTON_CLICK,{button_name:this.watchAdButton.name,unit:`${i}-lv${o}`,watchCount:e}),!c(i,o,l))return;this.scene.analytics.event(G.EARN_UNIT,{value:`${i}-lv${o}`}),this.payload.currentAdWatched=0,s(i,o,this.payload.currentAdWatched),this.updateAdButton();return}this.scene.analytics.event(G.BUTTON_CLICK,{button_name:this.watchAdButton.name,unit:`${i}-lv${o}`,watchCount:e});try{if(!await r())return}catch{return}this.payload.currentAdWatched++,s(i,o,this.payload.currentAdWatched),this.updateAdButton()};updateSize(){const{width:e,height:t}=this.background;$i.Enabled?this.setSize(e,t+41):this.setSize(e,t+15)}createTitleText(){const e=this.scene.make.text({text:"Locked",style:{fontSize:"15px",color:"#FFFFFF",fixedWidth:195,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});e.setHighQuality(),this.add(e),this.titleText=e}createLock(){const e=this.scene.make.image({key:vt,frame:Je.UNIT_SCREEN_ICON_LOCK});e.setWorldSize(21,28),this.add(e),this.lock=e}createHealthContainer(){this.healthContainer=this.scene.make.container({});const e=this.scene.make.image({key:vt,frame:Je.UNIT_SCREEN_BG});e.setWorldSize(56.5,18),this.add(e);const t=this.scene.make.image({key:vt,frame:Je.UNIT_SCREEN_ICON_HEART});t.setWorldSize(15,13.5),Phaser.Display.Align.In.LeftCenter(t,e,-5);const s=this.scene.make.text({text:"0",style:{fontSize:"13px",color:"#FFFFFF",fixedWidth:13*13,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),s.setPosition(10,0),this.healthText=s,this.healthContainer.add([e,t,s]),this.add(this.healthContainer),Phaser.Display.Align.In.TopLeft(this.healthContainer,this.background,-35,-12)}createAtkContainer(){this.atkContainer=this.scene.make.container({});const e=this.scene.make.image({key:vt,frame:Je.UNIT_SCREEN_BG});this.add(e),e.setWorldSize(56.5,18);const t=this.scene.make.image({key:vt,frame:Je.UNIT_SCREEN_ICON_BATTLE});t.setWorldSize(14,13),Phaser.Display.Align.In.LeftCenter(t,e,-5);const s=this.scene.make.text({text:"0",style:{fontSize:"13px",color:"#FFFFFF",fixedWidth:13*13,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),s.setPosition(10,0),this.atkText=s,this.atkContainer.add([e,t,s]),this.add(this.atkContainer),Phaser.Display.Align.In.TopRight(this.atkContainer,this.background,-35,-12)}createUnitIcon(){this.loading=new _s(this.scene),this.loading.setY(-30),this.add(this.loading);const e=this.scene.make.image({key:vt,frame:Je.BLANK});e.setWorldSize(142,142),this.add(e),Phaser.Display.Align.In.Center(e,this.background,0,-8),e.kill(),this.unitIcon=e}updateFrame(){const{isUnlock:e}=this.payload;e?(this.background.setFrame(Je.UNIT_SCREEN_FRAME_1),this.background.setWorldSize(145,205)):(this.background.setFrame(Je.UNIT_SCREEN_FRAME_LOCKED),this.background.setWorldSize(145,202.5))}updateTitle(){const{isUnlock:e}=this.payload;if(e){const{name:t}=this.payload.originData;this.titleText.setText(t),this.titleText.setColor("#FFFFFF"),this.titleText.setPosition(0,58)}else{let t;this.isUnitComingSoon()?(t="Coming Soon",this.titleText.setPosition(0,58)):(t=this.scene.lang.Text.LOCKED,this.titleText.setPosition(0,58)),this.titleText.setText(t),this.titleText.setColor("#9AACBF")}}isUnitComingSoon(){const{originData:e,unitType:t}=this.payload,{level:s}=e;switch(t){case u_:return s>l_;case d_:return s>h_;default:return!0}}updateAdButton(){if(!$i.Enabled)return;const{isUnlock:e,currentAdWatched:t,targetAdWatched:s,isUnitBoardFull:i,coinNeed:n,isCanBuy:r,unitType:c,originData:o}=this.payload,{level:l}=o;let h=!1;const d=this.scene.scene.get(K.GAME_SCENE);if(d instanceof ee&&(h=d.gameMode===J.BATTLE),this.watchAdButton.setDisabled(!1),e)if(this.watchAdButton.setVisible(!0),s===0){const u=GameCore.Utils.String.toCamelCase(c);this.watchAdButton.setName(`Buy${u}Unit`),this.watchAdButton.disableLogEvent(!1),this.watchAdButton.setCountText(n,s),(!r||i||h)&&this.watchAdButton.setDisabled(!0)}else if(s===-1)this.watchAdButton.setName(`NotAvailable${c}${l}Unit`),this.watchAdButton.disableLogEvent(!0),this.watchAdButton.setCountText(0,s),this.watchAdButton.setDisabled(!0);else{let u="BuyUnitByRewardedVideo";t>=s&&(u="CollectUnitByRewardedVideo"),this.watchAdButton.setName(u),this.watchAdButton.disableLogEvent(!0),this.watchAdButton.setCountText(t,s),t>=s&&(i||h)&&this.watchAdButton.setDisabled(!0),t<s&&!this.scene.ads.canbeShowRewardAd()&&this.watchAdButton.setDisabled(!0)}else this.watchAdButton.setVisible(!1)}updateLock(){const{isUnlock:e}=this.payload;e?this.lock.setVisible(!1):(this.isUnitComingSoon()?this.lock.setPosition(-45,53):this.lock.setPosition(-57,25),this.lock.setVisible(!0))}updateUnitIcon(){const e=this.getUnitFrame();e!==""&&(this.scene.textures.get(ji).has(e)?this.setUnitFrame(e):this.scene.textures.on(Phaser.Textures.Events.ADD,this.handleWaitAddTexture))}getUnitFrame(){const{isUnlock:e,unitType:t}=this.payload,{level:s}=this.payload.originData;let i="UNLOCKED";e||(i="LOCKED");let n="";return t===F.MELEE_UNIT_TYPE&&(n=Zr[i].MELEE[s]),t===F.RANGED_UNIT_TYPE&&(n=Zr[i].RANGED[s]),n}handleWaitAddTexture=e=>{if(e!==ji||(this.scene.textures.off(Phaser.Textures.Events.ADD,this.handleWaitAddTexture),!this.visible&&!this.active))return;const t=this.getUnitFrame();t!==""&&this.setUnitFrame(t)};setUnitFrame(e){this.unitIcon.revive(),this.loading.kill(),this.unitIcon.setTexture(ji,e),this.unitIcon.setWorldSize(142,142)}updateHealthContainer(){const{health:e}=this.payload.originData,t=GameCore.Utils.Number.toAbbreviatedString(e);this.healthText.setText(t)}updateAtkContainer(){const{damage:e}=this.payload.originData,t=GameCore.Utils.Number.toAbbreviatedString(e);this.atkText.setText(t)}}const{Ads:g_}=GameCore.Configs;class f_ extends Phaser.GameObjects.Container{scroller;constructor(e){super(e),this.createScroller(),this.scene.add.existing(this)}createScroller(){const e=g_.Enabled?10:20;this.scroller=new o_(this.scene,{classType:p_,listConfigs:[],width:332-10,height:423.5-158,padding:10,marginTop:e,marginBottom:10,numOfCols:2,colPadding:5}),this.scroller.setName("scroller"),this.scroller.createMask(),this.scroller.setPosition(0,40),this.add(this.scroller)}updateData(e){e.length<1||(this.scroller.updateConfig(e),this.runAnimations())}updateListConfigMember(e,t,s){this.scroller.updateListConfigMember(e,t,s)}runAnimations(){const e=this.scroller.getChildren();if(e.length<1){const n=this.scene.screen.get(P.UNITS_SCREEN);if(!(n instanceof un))return;n.isSwitchable=!0;return}const t=Math.min(e.length,this.scroller.numOfCols*3),s=300;for(let n=0;n<t;n++){const r=e[n];r&&(r.setVisible(!0),r.runShowUpAnimation(n,s))}const i=s+t*100+50*5;this.scene.time.delayedCall(i,()=>{const n=this.scene.screen.get(P.UNITS_SCREEN);n instanceof un&&(n.isSwitchable=!0,this.scroller.setEnable(!0))})}}const{KEY:E_,FRAME:m_}=L.DEFAULT_8_BIT;class Qr extends de{focusFrame;text;constructor(e,t,s,i){super(e,t,s),this.createText(i),this.createFocus()}createText(e){const t=this.scene.make.text({text:e,style:{stroke:"#000000",strokeThickness:2,fontSize:"13px",color:"#FFFFFF",fixedWidth:169,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});t.setHighQuality(),t.setShadow(0,4,"#000000",0,!0),this.add(t),this.text=t}createFocus(){const e=this.scene.make.image({key:E_,frame:m_.UNIT_SCREEN_TAB_FOCUS});e.setName("focus"),e.setWorldSize(57,3.5),e.setVisible(!1),Phaser.Display.Align.In.Center(e,this,0,this.button.height),e.setPosition(0,13),this.add(e),this.focusFrame=e}turnOnFocus(){this.focusFrame.setVisible(!0),this.text.setColor("#FFFFFF")}turnOffFocus(){this.focusFrame.setVisible(!1),this.text.setColor("#72ABFA")}}const{KEY:zi,FRAME:Xi}=L.DEFAULT_8_BIT;class A_ extends Phaser.GameObjects.Container{ribbon;dinosaursBtn;warriorsBtn;constructor(e){super(e),this.createRibbon(),this.createDinosaursBtn(),this.createWarriorsBtn()}selectTabDinosaurs(){this.dinosaursBtn.turnOnFocus(),this.warriorsBtn.turnOffFocus()}selectTabWarriors(){this.dinosaursBtn.turnOffFocus(),this.warriorsBtn.turnOnFocus()}createRibbon(){const e=this.scene.make.image({key:zi,frame:Xi.UNIT_SCREEN_TAB_BG});e.setWorldSize(329,29),e.setName("ribbon"),Phaser.Display.Align.In.Center(e,this),this.add(e),this.ribbon=e}createDinosaursBtn(){const e=new Qr(this.scene,zi,Xi.BLANK,this.scene.lang.Text.DINOSAURS);e.button.setWorldSize(85,29),e.button.setVisible(!1),e.setName("DinosaursTab"),Phaser.Display.Align.In.Center(e,this.ribbon,-100,0),this.add(e),this.dinosaursBtn=e}createWarriorsBtn(){const e=new Qr(this.scene,zi,Xi.BLANK,this.scene.lang.Text.WARRIORS);e.button.setWorldSize(85,29),e.button.setVisible(!1),e.setName("WarriorsTab"),Phaser.Display.Align.In.Center(e,this.ribbon,0,0),this.add(e),this.warriorsBtn=e}}const{KEY:S_,FRAME:y_}=L.DEFAULT;class T_ extends Phaser.GameObjects.Container{popup;tabs;scrollerController;closeBtn;onClose;constructor(e){super(e),this.createPopup(),this.createPopupContents(),this.updateSize(),this.createCloseButton()}updateSize(){const{width:e,height:t}=this.popup;this.setSize(e,t)}createPopup(){this.popup=new xt(this.scene,{x:0,y:0,width:332,height:399,rightEdge:283798,bottomRightCorner:215172,bottomEdge:76382,mainTopColorGradient:145525,mainBotColorGradient:145525,topInnerCornerStrokeWidth:1.3,rightInnerCornerStrokeWidth:3}),this.popup.turnOffLight(),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this)}recalculateLightPosition(){this.popup&&this.popup.recalculateLightPosition()}createPopupContents(){this.createTitle(),this.createScrollerController(),this.createNonInteractiveArea(),this.createTabs()}createTitle(){const e=this.scene.add.container();e.setName("title");const t=this.scene.make.image({key:S_,frame:y_.RIBBON_BLUE});t.setWorldSize(239,67);const s=this.scene.make.text({text:`${this.scene.lang.Text.CHARACTER_LIST}`,style:{fontSize:"21px",color:"#FFFFFF",fixedWidth:13*22,align:"center",fontFamily:k.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),Phaser.Display.Align.In.Center(s,t,0,-10),e.add([t,s]),this.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-28)}createTabs(){this.tabs=new A_(this.scene),this.tabs.setName("tabs"),this.add(this.tabs),Phaser.Display.Align.In.TopCenter(this.tabs,this.popup,0,-85)}createScrollerController(){this.scrollerController=new f_(this.scene),this.add(this.scrollerController),Phaser.Display.Align.In.Center(this.scrollerController,this.popup)}createNonInteractiveArea(){let e=0;this.scene.world.isLandscape()&&(e=15);const t=40,s=332-10,i=423.5-158,n=this.scrollerController.y+t,r=i+50,c=this.scene.add.zone(0,0,s,r);c.setPosition(0,n-e-(i+(r-i)/2)),c.setInteractive(),this.add(c);const o=this.scene.add.zone(0,0,s,r);o.setPosition(0,n+e+(i+(r-i)/2)),o.setInteractive(),this.add(o)}createCloseButton(){this.closeBtn=new Ut(this.scene),Phaser.Display.Align.In.TopRight(this.closeBtn,this,10,10),this.add(this.closeBtn),this.closeBtn.onClick=this.handleOnCloseClick}handleOnCloseClick=()=>{this.onClose&&this.onClose()};updateData(e){this.scrollerController.updateData(e)}updateListConfigMember(e,t,s){this.scrollerController.updateListConfigMember(e,t,s)}removeAllBlocks(){this.scrollerController.updateData([])}}const{MELEE_UNLOCKED:I_,RANGED_UNLOCKED:C_,UNIT_SCREEN_AD_WATCHED_COUNT:Jr}=ye,{AD_WATCH_REQUIREMENT:eo}=F,{MaximumMeleeLevel:to,MaximumRangedLevel:R_}=GameCore.Configs.Gameplay;class __ extends GameCore.Screen{unitPopup;isSwitchable;showPopupAnimation;fadeOutAnimation;adsTimer;isShowingAds;constructor(e,t,s,i){super(e,t,s,i),this.background.setAlpha(.7),this.setDepth($e.POPUP),this.createUnitPopup()}open(){super.open(),this.isShowingAds=!1,this.scene.requestBackgroundMaskUpdate(P.UNITS_SCREEN,this.background.alpha),this.runPopupAnimation(),this.isSwitchable=!1,this.selectDinosaursTab()}selectDinosaursTab(){this.unitPopup.tabs.selectTabDinosaurs(),this.unitPopup.removeAllBlocks();const e=this.getDataOf(F.MELEE_UNIT_TYPE);this.unitPopup.updateData(e)}selectWarriorsTab(){this.unitPopup.tabs.selectTabWarriors(),this.unitPopup.removeAllBlocks();const e=this.getDataOf(F.RANGED_UNIT_TYPE);this.unitPopup.updateData(e)}recalculateLightPosition(){this.unitPopup&&this.unitPopup.recalculateLightPosition()}getDataOf(e){const t=[],s=this.scene.scene.get(K.GAME_SCENE),i=this.getAdWatchedCount(e);let n=!0,r=1,c=!1;if(s instanceof ee&&(n=!(s.fieldManager.getRemainingAvailablePlacement()>0),r=s.getBuyingUnitLevel(),c=s.tutorialManager.isRunning()),e===F.MELEE_UNIT_TYPE){let o=this.scene.player.getCustomData(I_);(!o||typeof o!="number")&&(o=1);const l=this.scene.coin.getCurrentCoins();let h=new q(0),d=!0;if(s instanceof ee){const p=s.unitManager.getPlayerMeleeSpawnedUnitsCount();h=s.coinManager.getUnitPrice(p)}if(l.smallerThan(h)){const p=l.toString(),g=h.toString();p!==g&&(d=!1)}this.scene.cache.json.get("unitData").melee.forEach(p=>{t.push({originData:p,unitType:F.MELEE_UNIT_TYPE,isUnlock:p.level<=o,currentAdWatched:i[p.level-1],targetAdWatched:!c&&p.level>=r?eo[p.level-1]:-1,isUnitBoardFull:n,isCanBuy:p.level===1&&d,coinNeed:h,updateDataCallback:this.updateListConfig,showAdsCallback:this.handleShowRewardedVideoAd,collectCallback:this.handleCollectUnit})})}else if(e===F.RANGED_UNIT_TYPE){let o=this.scene.player.getCustomData(C_);(!o||typeof o!="number")&&(o=1);const l=this.scene.coin.getCurrentCoins();let h=new q(0),d=!0;if(s instanceof ee){const p=s.unitManager.getPlayerRangedSpawnedUnitsCount();h=s.coinManager.getUnitPrice(p)}if(l.smallerThan(h)){const p=l.toString(),g=h.toString();p!==g&&(d=!1)}this.scene.cache.json.get("unitData").ranged.forEach(p=>{t.push({originData:p,unitType:F.RANGED_UNIT_TYPE,isUnlock:p.level<=o,currentAdWatched:i[p.level-1],targetAdWatched:!c&&p.level>=r?eo[p.level-1]:-1,isUnitBoardFull:n,isCanBuy:p.level===1&&d,coinNeed:h,updateDataCallback:this.updateListConfig,showAdsCallback:this.handleShowRewardedVideoAd,collectCallback:this.handleCollectUnit})})}else console.error("Unknown type: ",e);return t}getAdWatchedCount(e){const t=this.scene.player.getCustomData(Jr);let s={},i=0;if(e===F.MELEE_UNIT_TYPE)s=t.MELEE,i=to;else if(e===F.RANGED_UNIT_TYPE)s=t.RANGED,i=R_;else{console.error("Unknown type: ",e);const r=[];for(let c=0;c<i;c++)r.push(0);return r}const n=[];for(const[r,c]of Object.entries(s)){const o=parseInt(r);if(o>i||o<1)break;n[o-1]=c}return n.forEach((r,c)=>{r===void 0&&(console.error("Undefined ad watched count for level: ",c+1),n[c]=0)}),n}createUnitPopup(){this.unitPopup=new T_(this.scene),this.unitPopup.setName("UnitPopup"),this.unitPopup.onClose=this.handleCloseScreen,Phaser.Display.Align.In.Center(this.unitPopup,this,0,-20),this.add(this.unitPopup),this.unitPopup.tabs.dinosaursBtn.onClick=this.handleSelectDinosaursTab,this.unitPopup.tabs.warriorsBtn.onClick=this.handleSelectWarriorsTab}handleSelectDinosaursTab=()=>{this.isSwitchable&&(this.isSwitchable=!1,this.selectDinosaursTab())};handleSelectWarriorsTab=()=>{this.isSwitchable&&(this.isSwitchable=!1,this.selectWarriorsTab())};handleCloseScreen=()=>{this.runFadeOutAnimation()};runPopupAnimation(){this.showPopupAnimation||(this.showPopupAnimation=new it({targets:[this.unitPopup]})),this.showPopupAnimation.play()}runFadeOutAnimation(){this.fadeOutAnimation||(this.fadeOutAnimation=new Ye({targets:[this.background],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.7,from:.7,to:0}},onActive:()=>{this.unitPopup.kill()},onUpdate:(e,t)=>{this.scene.requestBackgroundMaskUpdate(P.UNITS_SCREEN,t.alpha)},onComplete:()=>{this.unitPopup.revive(),this.background.setAlpha(.7),this.scene.screen.close(this.name)}})),this.fadeOutAnimation.play()}updateListConfig=(e,t,s)=>{let i={MELEE:{},RANGED:{}};try{i=this.mergeAndGetAdWatchedCountConfig(e,t,s)}catch(n){console.error(n)}this.scene.player.setCustomData(Jr,i),this.unitPopup.updateListConfigMember(e,t,s)};mergeAndGetAdWatchedCountConfig(e,t,s){if(t===void 0||s===void 0)return{MELEE:{},RANGED:{}};if(e===F.MELEE_UNIT_TYPE&&t<=to&&t>0)return{MELEE:{[t]:s},RANGED:{}};if(e===F.RANGED_UNIT_TYPE)return{MELEE:{},RANGED:{[t]:s}};throw Error(`Unknown type in Get Ad Watched Config: ${e}`)}handleShowRewardedVideoAd=async()=>{if(this.isShowingAds)return!1;let e=!1,t=null;const{audio:s,game:i}=this.scene;try{this.isShowingAds=!0,t=i.globalScene.time.delayedCall(200,()=>{i.globalScene.screen.open(P.NOTIFY_SCREEN,{message:i.lang.Text.LOADING_ADS,duration:0,loading:!0})}),s.muteAll(),await this.scene.ads.showRewardedVideoAsync(),i.globalScene.screen.close(P.NOTIFY_SCREEN),this.scene.audio.playSound(X.DAILY_REWARD),e=!0}catch(n){e=!1,console.info("🚀 > showRewardedAdAsync",n),n instanceof Object&&GameCore.Utils.Object.hasOwn(n,"code")&&n.code==="USER_INPUT"?this.showNotifySkipAds():this.showNotifyNoAds()}finally{this.isShowingAds=!1,this.adsTimer?.destroy(),s.unmuteAll(),t?.remove(),i.globalScene.screen.close(P.NOTIFY_SCREEN),this.scene.ads.preloadRewardedVideoAsync().catch(n=>{})}return e};showNotifyNoAds=e=>{if(e&&e.name!==P.CLOSEABLE_NOTIFY_SCREEN)return;const{globalScene:t}=this.scene.game;t.screen.open(P.CLOSEABLE_NOTIFY_SCREEN,{message:t.lang.Text.NO_ADS_TO_DISPLAY,duration:1500,loading:!1})};showNotifySkipAds=()=>{const{globalScene:e}=this.scene.game;e.screen.open(P.CLOSEABLE_NOTIFY_SCREEN,{message:e.lang.Text.SORRY_NO_REWARDS,duration:1500,loading:!1})};handleCollectUnit=(e,t,s=!1)=>{const i=this.scene.scene.get(K.GAME_SCENE);let n=!1;return i instanceof ee&&(e===F.MELEE_UNIT_TYPE?n=i.spawnUnit("MELEE",!0,t,s):n=i.spawnUnit("RANGED",!0,t,s)),this.handleCloseScreen(),n}}const un=__;class v_ extends Te{scene;isLandscape;constructor(e){super(e),this.scene=e,this.isLandscape=this.scene.world.isLandscape()}start(){this.isRunning()||super.start()}showSettingsScreen=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(P.SETTINGS_SCREEN);t||(t=e.add(P.SETTINGS_SCREEN,hn),this.isLandscape?(t.incY(-10),t.incScale(-.15)):t.incY(-40)),t instanceof hn&&t.recalculateLightPosition(),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,()=>{this.scene.scene.resume()}),e.open(P.SETTINGS_SCREEN)};showLeaderboardScreen=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(P.LEADER_BOARD_SCREEN);t||(t=e.add(P.LEADER_BOARD_SCREEN,_r)),t instanceof _r&&t.recalculateLightPosition(),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,()=>{this.scene.scene.resume()}),e.open(P.LEADER_BOARD_SCREEN)};showUnitsScreen=()=>{const{effectManger:e,layoutManager:t}=this.scene;e.stopRewardCurveAnimation(),t.objects.showUnitButton.stopAnimation();const{screen:s}=this.scene.game.globalScene;let i=s.get(P.UNITS_SCREEN);i||(i=s.add(P.UNITS_SCREEN,un),this.isLandscape&&i.incScale(-.1)),i.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),i.once(GameCore.Screens.Events.CLOSE,()=>{this.scene.scene.resume()}),s.open(P.UNITS_SCREEN)};showUnitUnlockScreen=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(P.UNIT_UNLOCK_SCREEN);t||(t=e.add(P.UNIT_UNLOCK_SCREEN,zr),this.isLandscape&&(t.incY(-10),t.incScale(-.1))),t instanceof zr&&t.recalculateLightPosition(),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,s=>{s.off(GameCore.Screens.Events.OPEN),this.scene.unitManager.enableDragOnPlayerUnits(),this.scene.scene.resume()}),e.open(P.UNIT_UNLOCK_SCREEN),this.scene.audio.playSound(X.UNIT_UNLOCK)};showResultScreen=(e,t,s)=>{const{screen:i}=this.scene.game.globalScene;let n=i.get(P.RESULT_SCREEN);n||(n=i.add(P.RESULT_SCREEN,nl),this.isLandscape&&n.incScale(-.18)),n.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),n.once(GameCore.Screens.Events.CLOSE,r=>{r.off(GameCore.Screens.Events.OPEN),this.scene.scene.resume()}),t===J.NORMAL||t===J.BATTLE?i.open(P.RESULT_SCREEN,{result:e,coinRewarded:s,mode:t}):i.open(P.RESULT_SCREEN,{result:e,coinRewarded:s,mode:J.NORMAL})};showOfflineScreen=()=>{const e=this.scene.storage.getState(),t=LA(e);if(t<=-1||bA(e))return;const{screen:i}=this.scene.game.globalScene;let n=i.get(P.OFFLINE_REWARD_SCREEN);n||(n=i.add(P.OFFLINE_REWARD_SCREEN,Pr)),n instanceof Pr&&n.recalculateLightPosition(),n.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),n.once(GameCore.Screens.Events.CLOSE,()=>{this.scene.scene.resume()}),i.open(P.OFFLINE_REWARD_SCREEN,{rewardValue:t})};showLoadingScreen=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(P.LOADING_SCREEN);t||(t=e.add(P.LOADING_SCREEN,TC)),e.open(P.LOADING_SCREEN)};closeLoadingScreen=()=>{const{globalScene:e}=this.scene.game;e.screen.close(P.LOADING_SCREEN)};showChallengeSplashScreen=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(P.CHALLENGE_SPLASH_SCREEN);t||(t=e.add(P.CHALLENGE_SPLASH_SCREEN,QI)),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,()=>{this.scene.scene.resume(),this.scene.audio.setMusicVolume(.4,2e3)}),e.open(P.CHALLENGE_SPLASH_SCREEN)};showUnitRewardScreen=e=>{const{screen:t}=this.scene.game.globalScene;this.scene.effectManger.stopRewardCurveAnimation();let s=t.get(P.UNIT_REWARD_SCREEN);s||(s=t.add(P.UNIT_REWARD_SCREEN,t_)),s.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),s.once(GameCore.Screens.Events.CLOSE,i=>{i.off(GameCore.Screens.Events.OPEN),this.scene.scene.resume()}),t.open(P.UNIT_REWARD_SCREEN,{unitType:e})};showResetDataPopup=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(P.RESET_DATA_SCREEN);t||(t=e.add(P.RESET_DATA_SCREEN,Mr)),t instanceof Mr&&t.recalculateLightPosition(),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,s=>{s.off(GameCore.Screens.Events.OPEN),this.scene.scene.resume()}),e.open(P.RESET_DATA_SCREEN)};showStartOverPopup=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(P.START_OVER_POPUP);t||(t=e.add(P.START_OVER_POPUP,Gr)),t instanceof Gr&&t.recalculateLightPosition(),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,s=>{s.off(GameCore.Screens.Events.OPEN),this.scene.scene.resume()}),e.open(P.START_OVER_POPUP)};listenResizeEventForCalculateLight(e){window.addEventListener("resize",this.updateLightPosition(e))}removeResizeEventForCalculateLight(e){window.removeEventListener("resize",this.updateLightPosition(e))}timeOutEvent;updateLightPosition=e=>()=>{this.timeOutEvent&&clearTimeout(this.timeOutEvent),this.timeOutEvent=setTimeout(()=>{e.recalculateLightPosition()},500)}}const{LEVEL_PROGRESS:w_}=ye,{DelayFinishGame:L_}=GameCore.Configs.Gameplay;class b_ extends qc{uiManager;unitManager;coinManager;fieldManager;levelManager;powerManager;stateManager;spineManager;effectManger;layoutManager;screenManager;devToolManager;tutorialManager;animationManager;difficultyManager;accessibilityManager;gameMode;levelStartAt;levelEndAt;isBannerAdShowed;isStartOverPopupShowed;preload(){this.events.on(Phaser.Scenes.Events.WAKE,this.run),this.events.on(Phaser.Scenes.Events.CREATE,this.run),this.events.on(Phaser.Scenes.Events.SLEEP,this.quit),this.events.on(Phaser.Scenes.Events.PAUSE,this.handlePauseScene),this.events.on(Phaser.Scenes.Events.RESUME,this.handleResumeScene)}handlePauseScene=()=>{this.unitManager.hideAllUnits(),this.unitManager.hideAllProjectiles(),this.spineManager.hideAllSpines(),this.effectManger.hideAllTextEffects()};handleResumeScene=()=>{this.stateManager.isInLevelLoadingState()||this.unitManager.showAllAliveUnits(),this.stateManager.isInPlayingState()&&this.unitManager.showAllHpBarUnits(),this.unitManager.showAllProjectiles(),this.spineManager.showAllSpines(),this.effectManger.showAllTextEffects(),this.powerManager.syncSpeedSetting()};create(){super.create(),this.createManager(),this.addGlobalMethodsForGlance(),this.levelStartAt=0,this.levelEndAt=0,this.isBannerAdShowed=!1,this.isStartOverPopupShowed=!1,this.facebook.attemptToAddShortcut()}addGlobalMethodsForGlance=()=>{const e=()=>{this.screen.get(P.SETTINGS_SCREEN)?.visible&&this.screen.close(P.SETTINGS_SCREEN)},t=()=>{this.screen.get(P.UNIT_REWARD_SCREEN)?.visible&&this.screen.close(P.UNIT_REWARD_SCREEN)};window.pauseEvent=()=>{this.screen.get(P.SETTINGS_SCREEN)?.visible||this.screenManager.showSettingsScreen()},window.resumeEvent=()=>{e()},window.replayGameEvent=async()=>{e(),t();const s=this.levelManager.currentLevelId;this.selectLevel(s)},window.gotoLevel=s=>{s<1||(e(),t(),this.selectLevel(s))},window.nextLevelEvent=()=>{e(),t(),this.stateManager.changeStateTo(new bn(this))},window.gotoHomeEvent=()=>{e(),t()}};createManager(){this.layoutManager=new KI(this),this.coinManager=new aA(this),this.unitManager=new uT(this),this.levelManager=new mA(this),this.fieldManager=new fA(this),this.powerManager=new yA(this),this.stateManager=new FA(this),this.spineManager=new TA(this),this.effectManger=new dA(this),this.screenManager=new v_(this),this.devToolManager=new WI(this),this.tutorialManager=new JT(this),this.animationManager=new eA(this),this.difficultyManager=new rA(this),this.accessibilityManager=new lE(this),this.uiManager=new YA(this)}initManager(){this.uiManager.init(),this.unitManager.init(),this.coinManager.init(),this.levelManager.init(),this.fieldManager.init(),this.spineManager.init(),this.effectManger.init(),this.powerManager.init(),this.screenManager.init(),this.devToolManager.init(),this.tutorialManager.init(),this.difficultyManager.init(),this.accessibilityManager.init(),this.layoutManager.init()}startManager(){this.coinManager.start(),this.unitManager.start(),this.levelManager.start(),this.fieldManager.start(),this.effectManger.start(),this.powerManager.start(),this.screenManager.start(),this.devToolManager.start(),this.tutorialManager.start(),this.difficultyManager.start(),this.accessibilityManager.start(),this.uiManager.start(),this.layoutManager.start()}stopManager(){this.uiManager.stop(),this.levelManager.stop(),this.coinManager.stop(),this.fieldManager.stop(),this.unitManager.stop(),this.spineManager.stop(),this.effectManger.stop(),this.powerManager.stop(),this.screenManager.stop(),this.devToolManager.stop(),this.tutorialManager.stop(),this.difficultyManager.stop(),this.accessibilityManager.stop(),this.layoutManager.stop()}handleSpawnRanged=()=>{if(!this.stateManager.isInReadyState())return;const e=this.coin.getCurrentCoins();if(!(e instanceof q))return;const t=this.unitManager.getPlayerRangedSpawnedUnitsCount();let s=this.coinManager.getUnitPrice(t);console.log("🤖 ? rangedPrice",s);const i=this.getBuyingUnitLevel();if(e.smallerThan(s)){const r=e.toString(),c=s.toString();if(r!==c){this.screenManager.showUnitRewardScreen("RANGED"),this.audio.playSound(X.BUTTON_CLICK);return}s=e}const n=this.fieldManager.getAvailablePlacement();n&&(this.coin.minusCoins(s.baseValue,s.suffix),this.unitManager.createPlayerArcher(n.rowId,n.colId,i),this.fieldManager.getRemainingAvailablePlacement()===0&&this.effectManger.playFullFloatText(),this.updateUI(),this.unitManager.savePlayerUnits(),this.audio.playSound(X.BUTTON_CLICK))};handleSpawnMelee=()=>{if(!this.stateManager.isInReadyState())return;const e=this.unitManager.getPlayerMeleeSpawnedUnitsCount();let t=this.coinManager.getUnitPrice(e);console.log("🤖 ? meleePrice",t);const s=this.getBuyingUnitLevel(),i=this.coin.getCurrentCoins();if(!(i instanceof q))return;if(i.smallerThan(t)){const r=i.toString(),c=t.toString();if(r!==c){this.screenManager.showUnitRewardScreen("MELEE"),this.audio.playSound(X.BUTTON_CLICK);return}t=i}const n=this.fieldManager.getAvailablePlacement();n&&(this.coin.minusCoins(t.baseValue,t.suffix),this.unitManager.createPlayerMelee(n.rowId,n.colId,s),this.fieldManager.getRemainingAvailablePlacement()===0&&this.effectManger.playFullFloatText(),this.updateUI(),this.unitManager.savePlayerUnits(),this.audio.playSound(X.BUTTON_CLICK))};spawnUnit(e,t=!0,s=1,i=!1){if(!this.stateManager.isInReadyState())return!1;const n=this.fieldManager.getAvailablePlacement();if(!n)return!1;if(i){const c=this.coin.getCurrentCoins();if(!(c instanceof q))return!1;let o=0;e==="MELEE"?o=this.unitManager.getPlayerMeleeSpawnedUnitsCount():o=this.unitManager.getPlayerRangedSpawnedUnitsCount();let l=this.coinManager.getUnitPrice(o);if(console.log(`🤖 ? ${e} unit price`,l),c.smallerThan(l)){const h=c.toString(),d=l.toString();if(h!==d)return!1;l=c}this.coin.minusCoins(l.baseValue,l.suffix)}let r;return t?(e=="MELEE"?r=this.uiManager.getMeleeBlockWorldPosition():r=this.uiManager.getRangedBlockWorldPosition(),this.effectManger.runCurveAnimationRewardUnit(r.x,r.y,n,e,s)):e=="MELEE"?this.unitManager.createPlayerMelee(n.rowId,n.colId,s):this.unitManager.createPlayerArcher(n.rowId,n.colId,s),this.updateUI(),this.unitManager.savePlayerUnits(),!0}getBuyingUnitLevel(){const{currentLevelId:e}=this.levelManager,{BUYING_UNIT_LEVEL:t}=F;let s=1;return t.forEach((i,n)=>{i<=e&&(s=n+1)}),s}giveEnoughCoins(e){let t=0,s;e=="MELEE"?(t=this.unitManager.getPlayerMeleeSpawnedUnitsCount(),s=this.coinManager.getUnitPrice(t)):(t=this.unitManager.getPlayerRangedSpawnedUnitsCount(),s=this.coinManager.getUnitPrice(t));const i=this.coin.getCurrentCoins();i instanceof q&&i.smallerThan(s)&&(s.subtract(i),this.coin.plusCoins(s.baseValue,s.suffix))}updateUI(){this.uiManager.updateUIData(),this.fieldManager.getRemainingAvailablePlacement()===0&&(this.uiManager.disableUnitBlocks(),this.uiManager.disableAdsUnitBlocks()),this.uiManager.isStartButtonDisabled()&&this.uiManager.enableStartButton()}run=()=>{this.stateManager.init()};quit=()=>{this.stateManager.quit()};prepareRound=()=>{this.levelStartAt=Date.now(),this.gameMode===J.NORMAL&&this.time.delayedCall(1e3,this.screenManager.showOfflineScreen),this.stateManager.ready()};restartScene=()=>{this.stateManager.init()};startRound=()=>{this.stateManager.play(),this.audio.playSound(X.START_BATTLE)};replayRound=async()=>{if(this.unitManager.hideAllUnits(),this.gameMode===J.BATTLE){const e=this.game.battle.getReplayOpponentId();if(!e){this.stateManager.levelLoading();return}await this.game.battle.createBattle(e),this.layoutManager.objects.freeCoinsItem.revive();return}else this.layoutManager.objects.freeCoinsItem.revive(),this.stateManager.ready()};nextRound=()=>{this.unitManager.hideAllUnits(),this.stateManager.levelLoading()};gameOver(e){this.unitManager.setReadyAllUnits(),this.levelEndAt=Date.now(),e==="win"?this.handleStartOverFlow():this.stateManager.levelFail()}handleStartOverFlow(){this.levelManager.currentLevelId>=1598&&this.gameMode===J.NORMAL&&!this.isStartOverPopupShowed?(this.audio.playSound(X.WIN_BATTLE),this.effectManger.playResultWinAnimation(),this.isStartOverPopupShowed=!0,this.time.delayedCall(L_,this.screenManager.showStartOverPopup)):this.stateManager.levelComplete()}rewardLostCoin(e){const t=this.coinManager.getTotalCoinsByAttack();t.multiply(e),console.log("🤖 ? rewardLostCoin",t,{rewardCoins:t,multiply:e}),this.coin.plusCoins(t.baseValue,t.suffix)}rewardWinCoin(e){const t=this.coinManager.getRewardCoinsByAttackCoins();t.multiply(e),console.log("🤖 ? rewardWinCoin",t,{rewardCoins:t,multiply:e}),this.coin.plusCoins(t.baseValue,t.suffix)}updateLevelToLeaderboard(e){const{dispatch:t}=this.storage,s=this.player.getCustomData("playerLevelProgress"),i=this.player.getCustomData("playerUnitData");t(VT(e,{playerLevel:s,playerUnitData:i}))}update(){this.stateManager.update()}resetLevel=async()=>{const e=new En({}).toObject(),{coins:t,gameData:s}=e;await this.player.setMultiCustomData({coinBaseValue:t.baseValue,coinSuffixValue:t.suffix,playerUnitData:s.playerUnitData,playerLevelProgress:s.playerLevelProgress,meleeUnlockedUnitLevel:s.meleeUnlockedUnitLevel,rangedUnlockedUnitLevel:s.rangedUnlockedUnitLevel}),this.coin.receiveCoins(t.baseValue,t.suffix),this.coinManager.initModifier(),this.difficultyManager.intData(),this.levelManager.setCurrentLevelId(1),this.tutorialManager.initTutorialData(),this.resetGameplay()};selectLevel=e=>{this.player.setCustomData(w_,e-1),this.coinManager.initModifier(),this.difficultyManager.intData(),this.levelManager.setCurrentLevelId(e-1),this.resetGameplay()};resetGameplay(){this.unitManager.initSpawnPools(),this.unitManager.emptyPlayerUnits(),this.uiManager.updateUIData(),this.stateManager.quit(),this.stateManager.levelLoading()}initGameMode(){this.gameMode=J.NORMAL,this.battle.getStatus()===st.STARTED&&(this.gameMode=J.BATTLE),console.log("🤖 ? initGameMode",this.gameMode)}updateUnitData=Ts(()=>{this.player.setMultiCustomData({playerUnitData:this.unitManager.serializePlayerUnitData()})},2e3);async isChallengeMode(){try{const e=this.storage.getState(),t=sf(e);return console.info("🚀 > isRequestingDetectGameMode",t),t?(await this.storage.dispatch(await Lc()),this.isContextChallenge()):!1}catch(e){console.warn("isChallengeMode",e)}return!1}isContextChallenge(){try{const e=this.storage.getState();return vn(e)===$t}catch(e){return console.warn(e),!1}}getPlayedTimeSeconds(){return Math.floor((this.levelEndAt-this.levelStartAt)/1e3)}}const ee=b_,so=(a,e,t)=>{if(e&&t){const n=window.game.globalScene.children.getAll();let r=!0;if(n.forEach(c=>{!(c instanceof GameCore.Screen)||c===t||c.visible&&(r=!1)}),!r)return}const s=document.getElementById("background-mask");s&&(s.style.backgroundColor=`rgba(0, 0, 0, ${a})`)};class P_{backgroundAlphaList;constructor(){this.backgroundAlphaList=[]}requestBackgroundMaskUpdate(e,t){const s=this.backgroundAlphaList.findIndex(i=>i.screenName===e);if(e===P.CHALLENGE_SPLASH_SCREEN){const i=this.backgroundAlphaList.find(n=>n.screenName===P.LOADING_SCREEN);if(i&&i.alpha!==0){this.handleChallengeSplashScreenCase();return}}s===-1?this.backgroundAlphaList.push({alpha:t,screenName:e}):this.backgroundAlphaList[s].alpha=t,this.updateBackgroundMask()}handleChallengeSplashScreenCase(){const e=this.backgroundAlphaList.findIndex(s=>s.screenName===P.CHALLENGE_SPLASH_SCREEN),t=this.backgroundAlphaList.find(s=>s.screenName===P.LOADING_SCREEN);t&&t.alpha!==0&&(e===-1?this.backgroundAlphaList.push({alpha:0,screenName:P.CHALLENGE_SPLASH_SCREEN}):this.backgroundAlphaList[e].alpha=0)}updateBackgroundMask(){if(this.backgroundAlphaList.length===0){so(0);return}let e=1;this.backgroundAlphaList.forEach(t=>{e*=1-t.alpha}),so(1-e)}}const rl=a=>({type:Mo,payload:{sceneKey:a}}),O_=a=>a.scene.currentSceneKey,D_=j([O_],a=>a),{KEY:N_,FRAME:M_}=L.DEFAULT;class k_ extends Phaser.GameObjects.Container{fps=0;fpsString="FPS: %1";fpsText;background;lastUpdate;constructor(e){super(e,0,0),this.createFps(),this.setDepth(W.DEBUG),this.scene.add.existing(this),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=e=>{if(e-this.lastUpdate<800)return;this.lastUpdate=e;const t=Math.floor(this.scene.game.loop.actualFps);this.setFps(t)};setFps(e){this.fps=e;const t=Phaser.Utils.String.Format(this.fpsString,[e]);this.fpsText.setText(t)}createFps(){this.background=this.scene.make.image({key:N_,frame:M_.BLANK}),this.background.setName("BG"),this.background.setTint(13801480),this.background.setWorldSize(65,20),this.fpsText=this.scene.make.bitmapText({size:this.scene.fontSize(14),text:this.fpsString,font:k.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.fpsText.setName("FPS Meter"),Phaser.Display.Align.In.Center(this.fpsText,this.background,5,-1),this.add([this.background,this.fpsText]),this.setFps(0)}}class U_ extends Phaser.GameObjects.Container{performance;memory=0;maxMemoryLimit;maxPercentThreshold;normalColor=3459162;warningColor=16768343;alarmColor=15812200;memoryString="Memory: %1MB / %2MB";memoryText;lastUpdate;constructor(e){if(super(e,0,0),this.performance=window.performance,this.createMemory(),this.setDepth(W.DEBUG),this.scene.add.existing(this),!this.isSupport()){this.memoryText.setText("Memory: not supported!");return}const{jsHeapSizeLimit:t}=this.performance.memory;this.maxPercentThreshold=90,this.setMaxMemory(t/1048576),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=e=>{if(e-this.lastUpdate<1e3)return;this.lastUpdate=e;const{usedJSHeapSize:t}=this.performance.memory,s=this.maxMemoryLimit*1048576,i=Math.round(t/1048576);this.setMemory(i),this.memoryText.setTint(this.normalColor),t>this.maxPercentThreshold/100*s&&this.memoryText.setTint(this.warningColor),t>s&&this.memoryText.setTint(this.alarmColor)};isSupport(){return this.performance&&!!this.performance?.memory}setMaxMemory(e){this.maxMemoryLimit=Math.round(e)}setMemory(e){this.memory=e;const t=Phaser.Utils.String.Format(this.memoryString,[e,this.maxMemoryLimit]);this.memoryText.setText(t)}createMemory(){this.memoryText=this.scene.make.bitmapText({size:this.scene.fontSize(14),text:this.memoryString,font:k.PRIMARY.KEY,depth:2e3}),this.memoryText.setName("Memory Meter"),this.add(this.memoryText),this.setMemory(0)}}class x_ extends Phaser.GameObjects.Container{payload;background;shadow;constructor(e,t){super(e),this.payload=t,this.createBackground(),this.createShadow()}createBackground(){const{width:e,height:t}=this.payload,s=-e/2,i=-t/2;this.background=this.scene.add.graphics(),this.background.fillStyle(657688,1),this.background.fillRect(s,i,e,t),this.background.lineStyle(2,65794),this.background.strokeRect(s,i,e,t),this.add(this.background)}createShadow(){const{width:e,height:t}=this.payload,s=-e/2,i=-t/2+t;this.shadow=this.scene.add.graphics(),this.shadow.fillStyle(397608,.8),this.shadow.fillRect(s,i,e,5),this.add(this.shadow)}}const{KEY:B_,FRAME:F_}=L.DEFAULT_8_BIT;class ol extends GameCore.Screen{board;notifyIcon;loadingIcon;titleText;messageText;openAnimation;closeTimerEvent;constructor(e,t,s,i){super(e,t,s,i),this.addBoard(),this.addNotifyIcon(),this.addLoadingIcon(),this.addTitleText(),this.addMessageText(),this.setDepth($e.PRIORITY),this.background.setAlpha(.8)}open(e){super.open(e),this.scene.requestBackgroundMaskUpdate(P.NOTIFY_SCREEN,this.background.alpha);const[s="",i="",n=0,r=!1]=this.getData(["title","message","duration","loading"]);this.setTitle(s),this.setMessage(i),this.showLoading(r),this.closeTimerEvent?.remove(),n>0&&(this.closeTimerEvent=this.scene.time.addEvent({delay:n,callback:()=>{this.visible&&this.scene.screen.close(this.name)}})),this.runOpenAnimation()}addBoard(){this.board=new x_(this.scene,{width:this.zone.width,height:300}),Phaser.Display.Align.In.Center(this.board,this.zone),this.add(this.board),this.board.kill()}close(){super.close(),this.scene.requestBackgroundMaskUpdate(P.NOTIFY_SCREEN,0)}addNotifyIcon(){this.notifyIcon=this.scene.make.image({key:B_,frame:F_.ICON_ALERT}),this.notifyIcon.setWorldSize(125.5,106),this.add(this.notifyIcon),Phaser.Display.Align.In.Center(this.notifyIcon,this.zone,0,-90)}addLoadingIcon(){this.loadingIcon=new _s(this.scene),this.add(this.loadingIcon),Phaser.Display.Align.In.Center(this.loadingIcon,this.zone,0,-30)}addTitleText(){this.titleText=this.scene.make.bitmapText({size:this.scene.fontSize(26),font:k.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.titleText.setTint(11482972),this.titleText.setCenterAlign(),this.titleText.setMaxWidth(this.width),Phaser.Display.Align.In.Center(this.titleText,this.zone,0,10),this.add(this.titleText)}addMessageText(){this.messageText=this.scene.make.bitmapText({size:this.scene.fontSize(22),font:k.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.messageText.setCenterAlign(),Phaser.Display.Align.In.Center(this.messageText,this.zone,0,90),this.add(this.messageText)}setTitle(e){this.titleText.setText(e)}setMessage(e){this.messageText.setText(e)}showLoading(e){this.titleText.setVisible(!e),this.notifyIcon.setVisible(!e),this.loadingIcon.setVisible(e)}runOpenAnimation(){this.openAnimation?.stop(),this.openAnimation?.remove(),this.openAnimation=new is({targets:[this.notifyIcon],props:{scale:{getStart:e=>e.scale-.3,getEnd:e=>e.scale}}}),this.openAnimation.play()}logPageviewOnOpen(){}logPageviewOnClose(){}}class G_ extends ol{constructor(e,t,s,i){super(e,t,s,i)}open(e){super.open(e),this.scene.requestBackgroundMaskUpdate(P.CLOSEABLE_NOTIFY_SCREEN,this.background.alpha),this.addOneTimeCloseEvent()}addOneTimeCloseEvent(){this.scene.input.once(Phaser.Input.Events.POINTER_DOWN,()=>{this.scene.screen.close(this.name)})}close(){super.close(),this.scene.requestBackgroundMaskUpdate(P.CLOSEABLE_NOTIFY_SCREEN,0),this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,void 0,this,!0)}}const{KEY:H_,FRAME:Y_}=L.DEFAULT_8_BIT;class Nn extends qc{mask;fadeInAnim;fadeOutAnim;fpsMeter;memoryMeter;backgroundMaskManager;init(){this.listenScenesEvents(),this.game.globalScene=this,this.backgroundMaskManager=new P_}setup(){this.scaleGame(),this.addMask(),this.addNotifyScreen(),this.addCloseableNotifyScreen(),this.addFPS(),this.addMemory()}addNotifyScreen(){this.screen.add(P.NOTIFY_SCREEN,ol)}addCloseableNotifyScreen(){this.screen.add(P.CLOSEABLE_NOTIFY_SCREEN,G_)}addMask(){this.mask=this.make.image({key:H_,frame:Y_.BLANK});const{width:e,height:t}=this.gameZone;this.mask.setAlpha(0),this.mask.setOrigin(0,0),this.mask.setTint(0),this.mask.setWorldSize(e,t)}addFPS(){const{ShowFPSInGame:e}=GameCore.Configs.Statistics;e&&(this.fpsMeter=new k_(this),this.fpsMeter.setDepth(W.ON_TOP),Phaser.Display.Align.In.TopLeft(this.fpsMeter,this.gameZone,-20,-10))}addMemory(){const{ShowMemoryInGame:e}=GameCore.Configs.Statistics;e&&(this.memoryMeter=new U_(this),Phaser.Display.Align.In.TopLeft(this.memoryMeter,this.gameZone,-45,-3))}updateSceneState(){this.setGlobalSceneOnTop()}setGlobalSceneOnTop(){this.scene.bringToTop(this)}runMaskFadeInAnimation(){this.mask&&GameCore.Configs.EnableEffectSceneTransition&&(this.fadeInAnim?.remove(),this.fadeOutAnim?.remove(),this.fadeInAnim=new li({targets:[this.mask],duration:400,ease:Phaser.Math.Easing.Cubic.In,props:{alpha:{start:0,from:0,to:.6}}}),this.mask.setAlpha(0),this.fadeInAnim.play())}runMaskFadeOutAnimation(){this.mask&&GameCore.Configs.EnableEffectSceneTransition&&(this.fadeInAnim?.remove(),this.fadeOutAnim?.remove(),this.fadeOutAnim=new Ye({targets:[this.mask],duration:400,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.6,from:.6,to:0}}}),this.mask.setAlpha(1),this.fadeOutAnim.play())}listenScenesEvents(){this.scene.manager.getScenes(!1).forEach(t=>{t.events.on(Phaser.Scenes.Events.CREATE,this.emitGameEventStartScene),t.events.on(Phaser.Scenes.Events.SLEEP,this.emitGameEventSleepScene),t.events.on(Phaser.Scenes.Events.WAKE,this.emitGameEventWakeScene),t.events.on(Phaser.Scenes.Events.PAUSE,this.emitGameEventPauseScene),t.events.on(Phaser.Scenes.Events.RESUME,this.emitGameEventResumeScene),t.events.on(Phaser.Scenes.Events.SHUTDOWN,this.emitGameEventShutdownScene)}),this.events.on(Ks.RUN,this.runScene),this.events.on(Ks.SLEEP,this.sleepScene),this.events.on(Ks.SWITCH,this.switchScene)}getActiveScene(){return this.scene.manager.getScenes(!0)[0]}getCurrentScene(){return this.currentScene}requestBackgroundMaskUpdate(e,t){this.backgroundMaskManager.requestBackgroundMaskUpdate(e,t)}recalculateBackgroundMask(){this.backgroundMaskManager.updateBackgroundMask()}get currentScene(){const e=this.storage.getState(),t=D_(e);let s;return t?s=this.scene.manager.getScene(t):s=this.getActiveScene(),s.scene}runScene=e=>{this.currentScene.run(e)};sleepScene=e=>{this.currentScene.sleep(e)};switchScene=e=>{this.currentScene.switch(e)};updateActiveSceneKey(e){e!==K.GLOBAL_SCENE&&this.storage.dispatch(rl(e))}emitGameEventStartScene=e=>{const{key:t}=e.scene;console.info("%cScene start","color: #D27D2D",t),this.updateSceneState(),this.runMaskFadeOutAnimation(),this.updateActiveSceneKey(t),this.game.events.emit(Phaser.Scenes.Events.START,t)};emitGameEventSleepScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene sleep","color: #D27D2D",t),t!==K.LOAD_SCENE&&(this.runMaskFadeInAnimation(),this.game.events.emit(Phaser.Scenes.Events.SLEEP,t))};emitGameEventWakeScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene wake","color: #D27D2D",t),t!==K.LOAD_SCENE&&(this.updateSceneState(),this.runMaskFadeOutAnimation(),this.updateActiveSceneKey(t),this.game.events.emit(Phaser.Scenes.Events.WAKE,t))};emitGameEventPauseScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene pause","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.PAUSE,t)};emitGameEventResumeScene=e=>{const{key:t}=e.scene;console.info("%cScene resume","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.RESUME,t)};emitGameEventShutdownScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene shutdown","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.SHUTDOWN,t)};logEventOpen(){}logPageviewOnOpen(){}}class K_ extends Error{constructor(e,t){super(e,t),this.name="LoadResourceFail",this.message=e||"Load resource fail",this.payload=t}}const{MELEE_UNIT_TYPE:Gs,RANGED_UNIT_TYPE:Hs,ALIEN_UNIT_TYPE:io}=F,{UNITS_SPINES:V_}=L,{PLAYER_UNIT_DATA:no,LEVEL_PROGRESS:hs}=ye,{UnitsConfig:ao,Rollbar:W_}=GameCore.Configs,{MaximumMeleeLevel:j_,MaximumRangedLevel:$_}=GameCore.Configs.Gameplay;class z_ extends Phaser.Scene{requestingSpines=[];requestingSprites=[];isLazyLoadRequesting;loadingPercent=0;preload(){window.getLoadingPerc=()=>this.loadingPercent,this.facebook.progressLoading.loadingProgressFbLoadScene(),this.analytics.event(G.SCREEN_OPEN,{screen_name:"LoadScene"});const e=s=>{this.loadingPercent=Math.max(this.loadingPercent,s*100),s===1&&this.load.off("progress",e),this.facebook.progressLoading.onProgress(s)};this.load.on("progress",e),this.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,s=>{const i=new K_("Load resources at LoadScene failed.");this.rollbar.sendException(i,{file:s})});const t=this.getLevelJsonName();this.load.on(`filecomplete-json-${t}`,()=>{this.scene.wake(),this.loadEnemyUnits(t)}),this.load.json(t,`assets/json/${t}.json`),this.loadDefaultUnits(),this.loadPlayerUnits(),this.load.json("unitData","assets/json/unit-data.json"),this.loadFonts(),this.textStyler.addFont({type:"local",fontType:"truetype",fontName:k.FONT_FAMILY}),this.load.multiatlas({key:L.DEFAULT_8_BIT.KEY,atlasURL:L.DEFAULT_8_BIT.JSON,path:L.DEFAULT_8_BIT.PATH}),this.load.atlas({key:L.DEFAULT.KEY,atlasURL:L.DEFAULT.JSON,textureURL:L.DEFAULT.TEXTURE}),this.load.atlas({key:L.GAMEPLAY.KEY,atlasURL:L.GAMEPLAY.JSON,textureURL:L.GAMEPLAY.TEXTURE}),this.loadBackgroundByCurrentLevel(),this.load.multiatlas({key:L.EFFECTS.KEY,path:L.EFFECTS.PATH,atlasURL:L.EFFECTS.JSON}),this.load.spine(L.SPINE_EFFECTS.FX_MERGE.KEY,L.SPINE_EFFECTS.FX_MERGE.jsonPATH,L.SPINE_EFFECTS.FX_MERGE.atlasPATH),this.player.updateData().then(this.handleUpdateNotificationData).catch(s=>{console.warn("LoadScene: player.updateData() failed",s)})}create(){this.audio.initSound(),this.analytics.event(G.LOAD_COMPLETE),this.facebook.on("startgame",this.handleFBInstantGameStarted),this.facebook.gameStarted(),this.setupGlobalScene(),this.logGlanceNewUserToRollbar(),this.setAdsAvailabilityThenStartGame()}setAdsAvailabilityThenStartGame(){if(!GameCore.Configs.Ads.Enabled){this.startGame();return}const e=setInterval(()=>{if(!window.__glanceAdsSDKInitiated)return;clearInterval(e),GameCore.Configs.Ads.Enabled=!1;const t=!window.GlanceGamingAdInterface,s=!window.GlanceGamingAdInterface.isLibraryInitialized||!window.GlanceGamingAdInterface.isLibraryInitialized(),i=!window.GlanceGamingAdInterface.showStickyBannerAd,n=!window.GlanceGamingAdInterface.loadRewardedAd;if(t||s||i||n){this.startGame();return}GameCore.Configs.Ads.Enabled=!0,this.startGame()},50)}handleFBInstantGameStarted=()=>{window.__fbGameReady=!0,this.updateBackgroundElement(),this.player.updateData().catch(e=>{this.rollbar.sendException(e)}),this.player.requestConnectedPlayers()};updateBackgroundElement(){if(!this.world.isUsingLandscapeBackground())return;const t=document.getElementById("background-image");if(!t)return;const s=this.player.getCustomData(hs);if(typeof s!="number"||s<0){t.src=M.BG_LANDSCAPE_TREE.FILE;return}let i=M.BG_LANDSCAPE_TREE.FILE;switch(Math.floor((s+1)/10)%5){case 0:i=M.BG_LANDSCAPE_TREE.FILE;break;case 1:i=M.BG_LANDSCAPE_DESERT.FILE;break;case 2:i=M.BG_LANDSCAPE_ICE.FILE;break;case 3:i=M.BG_LANDSCAPE_CRYSTAL.FILE;break;case 4:i=M.BG_LANDSCAPE_VOLCANO.FILE;break}t.src=i}handleUpdateNotificationData=()=>{const e=this.player.getPlayer(),{playerId:t,name:s,locale:i,data:n}=e,r=this.player.getCustomData("levelProgress");this.notification.updateData({playerId:t,name:s,photo:"",locale:i,friendIds:this.player.getConnectedPlayerIds(10,0),gameSettings:this.player.getPlayerSettings(),gameProgress:{currentLevel:r},gameStatistics:{highScore:n.score}}),this.notification.sendRequest()};setupGlobalScene(){const e=this.scene.get(K.GLOBAL_SCENE);e instanceof Nn&&e.setup()}startGame=()=>{this.showStickyBannerAd(),this.preloadAds(),this.analytics.event(G.APP_READY),this.storage.dispatch(rl(K.LOAD_SCENE)),this.storage.dispatch(IA())};showStickyBannerAd=()=>{this.ads.showBannerAdAsync().catch(e=>{console.warn(e)})};preloadAds=()=>{this.ads.preloadRewardedVideoAsync().catch(e=>{}),this.ads.preloadInterstitialAdAsync().catch(e=>{})};loadBackgroundByCurrentLevel(){const e=this.player.getCustomData(hs);if(typeof e!="number"||e<0){this.loadAllBackgrounds();return}const t=Math.floor((e+1)/10)%5;this.world.isUsingLandscapeBackground()?(this.loadBackgroundImage(M.BG_LANDSCAPE_TREE.FILE,M.BG_LANDSCAPE_TREE.KEY),t===1?this.loadBackgroundImage(M.BG_LANDSCAPE_DESERT.FILE,M.BG_LANDSCAPE_DESERT.KEY):t===2?this.loadBackgroundImage(M.BG_LANDSCAPE_ICE.FILE,M.BG_LANDSCAPE_ICE.KEY):t===3?this.loadBackgroundImage(M.BG_LANDSCAPE_CRYSTAL.FILE,M.BG_LANDSCAPE_CRYSTAL.KEY):t===4&&this.loadBackgroundImage(M.BG_LANDSCAPE_VOLCANO.FILE,M.BG_LANDSCAPE_VOLCANO.KEY)):(this.load.image(M.BG_TREE.KEY,M.BG_TREE.FILE),t===1?this.load.image(M.BG_DESERT.KEY,M.BG_DESERT.FILE):t===2?this.load.image(M.BG_ICE.KEY,M.BG_ICE.FILE):t===3?this.load.image(M.BG_CRYSTAL.KEY,M.BG_CRYSTAL.FILE):t===4&&this.load.image(M.BG_VOLCANO.KEY,M.BG_VOLCANO.FILE))}loadFonts(){const e=this.lang.getCurrentLanguage();switch(e){case"tr":k.PRIMARY={KEY:"BalooTr",TEXTURE:"./assets/fonts/BalooTr.png",DATA:"./assets/fonts/BalooTr.xml"},k.FONT_FAMILY="BalooTr";break;case"ja":k.PRIMARY={KEY:"MPlusJa",TEXTURE:"./assets/fonts/MPlusJa.png",DATA:"./assets/fonts/MPlusJa.xml"},k.FONT_FAMILY="MPlusJa";break;case"id":k.PRIMARY={KEY:"LilitaOne-en",TEXTURE:"./assets/fonts/LilitaOne-en.png",DATA:"./assets/fonts/LilitaOne-en.xml"};break;default:k.PRIMARY={KEY:`LilitaOne-${e}`,TEXTURE:`./assets/fonts/LilitaOne-${e}.png`,DATA:`./assets/fonts/LilitaOne-${e}.xml`};break}this.load.bitmapFont(k.PRIMARY.KEY,k.PRIMARY.TEXTURE,k.PRIMARY.DATA)}getLevelJsonName(){const e=this.player.getCustomData(hs),s=Math.floor((e||0)/100)*100+1,i=s+99,n=(1e4+s).toString().substring(1),r=(1e4+i).toString().substring(1);return`levels-${n}-${r}`}loadDefaultUnits(){const e=this.getBuyingUnitLevel(),t=`m1-r1-m${e}-r${e}-0/0-0-0-0-0/0-0-0-0-0`;this.loadUnits("spine",t)}getBuyingUnitLevel(){const e=this.player.getCustomData(hs),t=GameCore.Utils.Valid.isNumber(e)?e+1:1,{BUYING_UNIT_LEVEL:s}=F;let i=1;return s.forEach((n,r)=>{n<=t&&(i=r+1)}),i}loadPlayerUnits(){const e=this.player.getCustomData(no);if(!e||typeof e!="string"){this.loadAllUnits();return}const t=this.upgradePlayerUnits(e);this.player.setCustomData(no,t),this.loadUnits("spine",t)}upgradePlayerUnits(e){const t=this.getPlayerUnitList(e),s=this.getBuyingUnitLevel(),i=[],n=[];for(let c=0;c<15;c++){const o=t[c],l=o[0];l!=="m"&&l!=="r"||parseInt(o.substring(1))>=s||(l==="m"?i.push(c):n.push(c))}for(let c=0;c<i.length;c++)t[i[c]]=`m${s-1}`,t[n[c]]=`r${s-1}`;if(i.length%2===1){const c=i[0];t[c]=`m${s}`}if(n.length%2===1){const c=n[0];t[c]=`r${s}`}const r=this.handleCannotMergeCase(t);return this.serializePlayerUnitData(r)}handleCannotMergeCase(e){if(this.isBoardCanBeMerged(e))return e;const t=this.getBuyingUnitLevel();let s=Number.MAX_SAFE_INTEGER,i=-1,n=Number.MAX_SAFE_INTEGER,r=-1,c=Number.MAX_SAFE_INTEGER,o=-1,l=Number.MAX_SAFE_INTEGER,h=-1,d=0;for(let u=0;u<e.length;u++){const p=e[u],g=p[0];if(g!=="m"&&g!=="r")continue;d++;const f=parseInt(p.substring(1));g==="m"?f<s?(n=s,r=i,s=f,i=u):f<n&&(n=f,r=u):f<c?(l=c,h=o,c=f,o=u):f<l&&(l=f,h=u)}return d===15&&t===s&&i!==-1&&r!==-1?e[i]=e[r]:d===15&&t===c&&o!==-1&&h!==-1&&(e[o]=e[h]),e}isBoardCanBeMerged(e){const t=new Map,s=new Map;e.forEach(o=>{const l=o[0];if(l!=="m"&&l!=="r")return;const h=parseInt(o.substring(1));switch(l){case Gs:{const d=t.get(h);d?t.set(h,d+1):t.set(h,1);break}case Hs:{const d=s.get(h);d?s.set(h,d+1):s.set(h,1);break}}});const n=Array.from(t,([o,l])=>({key:o,value:l})).some(o=>{const{key:l,value:h}=o;return h>1&&l+1<=j_}),c=Array.from(s,([o,l])=>({key:o,value:l})).some(o=>{const{key:l,value:h}=o;return h>1&&l+1<=$_});return n||c}getPlayerUnitList(e){const t=e.split("/"),s=[];return t.forEach(i=>{i.split("-").forEach(r=>{s.push(r)})}),s}serializePlayerUnitData(e){let t="",s=0;for(let i=0;i<3;i++){let n="";for(let r=0;r<5;r++)n+=e[s],s++,r!==4&&(n+="-");t+=n,i!==2&&(t+="/")}return t}loadEnemyUnits(e){const t=this.player.getCustomData(hs),s=typeof t=="number"?t:0,i=Math.floor(s/100)*100+1,n=s-i+1,c=this.cache.json.get(e).levels[n],o=`${c.enemy_row1}/${c.enemy_row2}/${c.enemy_row3}`;this.loadUnits("spine",o)}loadUnits(e,t){const s=t.split("/"),i=[];s.forEach(n=>{n.split("-").forEach(c=>{if(c==="0"||i.includes(c))return;let o=io;if(c[0]==="m"?o=Gs:c[0]==="r"&&(o=Hs),o===io)return;const l=parseInt(c.substring(1));if(o===Gs){if(ao.MELEE.listLevelsUseSprite.includes(l)){if(e==="spine")return}else if(e==="sprite")return}if(o===Hs){if(ao.RANGED.listLevelsUseSprite.includes(l)){if(e==="spine")return}else if(e==="sprite")return}i.push(c),this.loadUnit(e,l,o)})})}loadUnit(e,t,s){const{MELEE:i,RANGED:n}=V_;let r=null;switch(s){case Gs:t>0&&t<=Object.keys(i).length&&(r=i[t]);break;case Hs:t>0&&t<=Object.keys(n).length&&(r=n[t]);break}if(r){if(e==="spine"){if(this.requestingSpines.includes(r.KEY))return;this.requestingSpines.push(r.KEY),this.load.spine(r.KEY,r.jsonPATH,r.atlasPATH),this.isLazyLoadRequesting=!0}if(e==="sprite"){if(this.textures.exists(r.KEY)||this.requestingSprites.includes(r.KEY))return;this.requestingSprites.push(r.KEY),console.log("load sprite unit",r.KEY),this.load.multiatlas({key:r.KEY,atlasURL:r.JSON,path:r.PATH}),this.isLazyLoadRequesting=!0}}}lazyLoadResource(){this.isLazyLoadRequesting=!1,this.loadSounds(),this.loadAllUnits(),this.loadAvatarUnits(),this.loadAllBackgrounds(),this.isLazyLoadRequesting&&(this.scene.wake(),this.load.once(Phaser.Loader.Events.COMPLETE,()=>{this.scene.sleep()}),this.load.start())}loadSounds(){const{FILE_KEY_COMPLETE:e}=Phaser.Loader.Events;this.cache.audio.exists(Dt.BACKGROUND.KEY)||(this.load.once(`${e}audio-${Dt.BACKGROUND.KEY}`,this.handleLoadMusicCompleted),this.load.audio(Dt.BACKGROUND.KEY,Dt.BACKGROUND.FILE),this.isLazyLoadRequesting=!0)}handleLoadMusicCompleted=()=>{this.audio.initMusic(Dt.BACKGROUND.KEY),this.audio.playMusic(),this.audio.setMusicVolume(.4,3e3)};loadAllUnits(){this.loadUnits("spine","m1-m2-m3-m4-m5/m6-m7-m8-m9-m10/m11-r1-r2-r3-r4-r5"),this.loadUnits("spine","r6-r7-r8-r9-r10/r11-0-0-0-0/0-0-0-0-0")}loadAvatarUnits(){this.textures.exists(L.UNITS.KEY)||(this.load.multiatlas({key:L.UNITS.KEY,atlasURL:L.UNITS.JSON,path:L.UNITS.PATH}),this.isLazyLoadRequesting=!0)}loadAllBackgrounds(){this.world.isUsingLandscapeBackground()?(this.textures.exists(M.BG_LANDSCAPE_TREE.KEY)||(this.loadBackgroundImage(M.BG_LANDSCAPE_TREE.FILE,M.BG_LANDSCAPE_TREE.KEY),this.isLazyLoadRequesting=!0),this.textures.exists(M.BG_LANDSCAPE_DESERT.KEY)||(this.loadBackgroundImage(M.BG_LANDSCAPE_DESERT.FILE,M.BG_LANDSCAPE_DESERT.KEY),this.isLazyLoadRequesting=!0),this.textures.exists(M.BG_LANDSCAPE_ICE.KEY)||(this.loadBackgroundImage(M.BG_LANDSCAPE_ICE.FILE,M.BG_LANDSCAPE_ICE.KEY),this.isLazyLoadRequesting=!0),this.textures.exists(M.BG_LANDSCAPE_VOLCANO.KEY)||(this.loadBackgroundImage(M.BG_LANDSCAPE_VOLCANO.FILE,M.BG_LANDSCAPE_VOLCANO.KEY),this.isLazyLoadRequesting=!0),this.textures.exists(M.BG_LANDSCAPE_CRYSTAL.KEY)||(this.loadBackgroundImage(M.BG_LANDSCAPE_CRYSTAL.FILE,M.BG_LANDSCAPE_CRYSTAL.KEY),this.isLazyLoadRequesting=!0)):(this.textures.exists(M.BG_TREE.KEY)||(this.load.image(M.BG_TREE.KEY,M.BG_TREE.FILE),this.isLazyLoadRequesting=!0),this.textures.exists(M.BG_DESERT.KEY)||(this.load.image(M.BG_DESERT.KEY,M.BG_DESERT.FILE),this.isLazyLoadRequesting=!0),this.textures.exists(M.BG_ICE.KEY)||(this.load.image(M.BG_ICE.KEY,M.BG_ICE.FILE),this.isLazyLoadRequesting=!0),this.textures.exists(M.BG_VOLCANO.KEY)||(this.load.image(M.BG_VOLCANO.KEY,M.BG_VOLCANO.FILE),this.isLazyLoadRequesting=!0),this.textures.exists(M.BG_CRYSTAL.KEY)||(this.load.image(M.BG_CRYSTAL.KEY,M.BG_CRYSTAL.FILE),this.isLazyLoadRequesting=!0))}async loadBackgroundImage(e,t){return new Promise((s,i)=>{const n=new Image;n.crossOrigin="use-credentials",n.onload=()=>{this.load.image(t,e),s()},n.onerror=()=>{console.error("Load image failed",e),i()},n.src=e})}logGlanceNewUserToRollbar(){if(!W_.Enable)return;this.player.getPlayer().isUserNew&&"__GLANCE_ENV"in window&&this.rollbar.sendException(new Error("Glance new user"))}}const{Valid:ro}=GameCore.Utils;class X_{currencies;constructor(e){this.initDefaultValues(),ro.isObject(e)&&Object.keys(e).forEach(t=>{Object.hasOwn(e,t)&&ro.isNumber(e[t])&&(this.currencies[t]=e[t])})}initDefaultValues(){this.currencies={}}toObject(){return{...this.currencies}}}const{Object:wt,Valid:pt}=GameCore.Utils;class q_{currentLevel;itemsCollected;levelsCompleted;constructor(e){this.initDefaultValues(),pt.isObject(e)&&(wt.hasOwn(e,"currentLevel")&&pt.isNumber(e.currentLevel)&&(this.currentLevel=e.currentLevel),wt.hasOwn(e,"itemsCollected")&&Array.isArray(e.itemsCollected)&&(this.itemsCollected=e.itemsCollected.filter(t=>!(!pt.isObject(t)||!wt.hasOwn(t,"itemId")||!pt.isString(t.itemId)||!wt.hasOwn(t,"quantity")||!pt.isNumber(t.quantity)))),wt.hasOwn(e,"levelsCompleted")&&Array.isArray(e.levelsCompleted)&&(this.levelsCompleted=e.levelsCompleted.filter(t=>!(!pt.isObject(t)||!wt.hasOwn(t,"score")||!pt.isNumber(t.score)||!wt.hasOwn(t,"levelId")||!pt.isString(t.levelId)))))}initDefaultValues(){this.currentLevel=0,this.levelsCompleted=[],this.itemsCollected=[]}toObject(){return{currentLevel:this.currentLevel,itemsCollected:this.itemsCollected,levelsCompleted:this.levelsCompleted}}}const{Object:Ys,Valid:us}=GameCore.Utils;class Z_{highScore;timePlayed;totalGamesWon;totalGamesLose;constructor(e){this.initDefaultValues(),us.isObject(e)&&(Ys.hasOwn(e,"highScore")&&us.isNumber(e.highScore)&&(this.highScore=e.highScore),Ys.hasOwn(e,"timePlayed")&&us.isNumber(e.timePlayed)&&(this.timePlayed=e.timePlayed),Ys.hasOwn(e,"totalGamesWon")&&us.isNumber(e.totalGamesWon)&&(this.totalGamesWon=e.totalGamesWon),Ys.hasOwn(e,"totalGamesLose")&&us.isNumber(e.totalGamesLose)&&(this.totalGamesLose=e.totalGamesLose))}initDefaultValues(){this.highScore=0,this.timePlayed=0,this.totalGamesWon=0,this.totalGamesLose=0}toObject(){return{highScore:this.highScore,timePlayed:this.timePlayed,totalGamesWon:this.totalGamesWon,totalGamesLose:this.totalGamesLose}}}const{sound:Q_,music:J_,vibrate:ev,speedUp:tv}=Zt;class sv{sound;music;vibrate;speedUp;constructor(e){const{sound:t,music:s,vibrate:i,speedUp:n}=e||{};this.sound=GameCore.Utils.Valid.isBoolean(t)?t:Q_,this.music=GameCore.Utils.Valid.isBoolean(s)?s:J_,this.vibrate=GameCore.Utils.Valid.isBoolean(i)?i:ev,this.speedUp=GameCore.Utils.Valid.isBoolean(n)?n:tv}toObject(){return{sound:this.sound,music:this.music,vibrate:this.vibrate,speedUp:this.speedUp}}}const{settings:iv}=Ac,{Object:Re,Valid:et}=GameCore.Utils;class nv{score;gpId;appId;glanceId;playerId;name;photo;locale;friendIds;gameProgress;gameSettings;gameStatistics;currencyBalance;constructor(e){this.initDefaultValues(),et.isObject(e)&&(Re.hasOwn(e,"score")&&et.isNumber(e.score)&&(this.score=e.score),Re.hasOwn(e,"gpId")&&et.isString(e.gpId)&&(this.gpId=e.gpId),Re.hasOwn(e,"appId")&&et.isString(e.appId)&&(this.appId=e.appId),Re.hasOwn(e,"glanceId")&&et.isString(e.glanceId)&&(this.glanceId=e.glanceId),Re.hasOwn(e,"playerId")&&et.isString(e.playerId)&&(this.playerId=e.playerId),Re.hasOwn(e,"name")&&et.isString(e.name)&&(this.name=e.name),Re.hasOwn(e,"photo")&&et.isString(e.photo)&&(this.photo=e.photo),Re.hasOwn(e,"locale")&&et.isString(e.locale)&&(this.locale=e.locale),Re.hasOwn(e,"friendIds")&&Array.isArray(e.friendIds)&&(this.friendIds=e.friendIds),Re.hasOwn(e,"gameProgress")&&(this.gameProgress=new q_(e.gameProgress).toObject()),Re.hasOwn(e,"gameStatistics")&&(this.gameStatistics=new Z_(e.gameStatistics).toObject()),Re.hasOwn(e,"currencyBalance")&&(this.currencyBalance=new X_(e.currencyBalance).toObject()),Re.hasOwn(e,"gameSettings")&&(this.gameSettings=new sv(e.gameSettings).toObject()))}initDefaultValues(){this.score=0,this.gpId="",this.appId="",this.glanceId="",this.playerId="",this.name="",this.photo="",this.locale="en_US",this.friendIds=[],this.gameProgress={currentLevel:0,itemsCollected:[],levelsCompleted:[]},this.gameSettings={...iv},this.gameStatistics={highScore:0,timePlayed:0,totalGamesWon:0,totalGamesLose:0},this.currencyBalance={}}toObject(){return{score:this.score,gpId:this.gpId,appId:this.appId,glanceId:this.glanceId,playerId:this.playerId,name:this.name,photo:this.photo,locale:this.locale,friendIds:this.friendIds,gameProgress:this.gameProgress,gameSettings:this.gameSettings,gameStatistics:this.gameStatistics,currencyBalance:this.currencyBalance}}}class av extends Phaser.Plugins.BasePlugin{data;endpoint;enabled;async setup(e,t){this.enabled=!0,this.endpoint=e,console.log("NotificationPlugin: configure",e,t),this.updateData(t)}updateData=async e=>{if(!this.enabled)return;const t=Me(this.data,e);this.data=new nv(t).toObject(),console.log("NotificationPlugin: updatePayload",this.data)};sendRequest=async()=>{try{if(!this.enabled)return;const{playerId:e}=this.data,t={...this.data};console.log("NotificationPlugin: sendRequest",t);const i=(await es(`players/${e}`,t,{},this.endpoint,10))?.data||{};this.updateData(i)}catch(e){console.warn("NotificationPlugin: sendRequest",e)}}}class oo extends GameCore.Ads.AdInstance{instance;placementId;constructor(e,t){super(e),this.instance=null,this.placementId=t}static setGame(e){self.game=e}async loadAsync(){if(console.log("loadAsync",this.type,this.status),this.status===GameCore.Ads.Status.IDLE)try{if(this.status=GameCore.Ads.Status.LOADING,this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");await this.instance.loadAsync(),this.status=GameCore.Ads.Status.FILLED}catch(e){throw this.status=GameCore.Ads.Status.IDLE,this.instance=null,e}}async showAsync(){try{if(console.log("showAsync",this.type,this.status),this.status===GameCore.Ads.Status.LOADING)throw new GameCore.Ads.AdError("AD_ARE_LOADING","Ads are loading.");if(this.status!==GameCore.Ads.Status.FILLED)throw new GameCore.Ads.AdError("AD_NOT_FILLED","Ads no fill.");if(this.status=GameCore.Ads.Status.SHOWING,this.instance===null)throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.type===GameCore.Ads.Types.INTERSTITIAL&&window.sendCustomAnalyticsEvent(G.GLANCE_GAME_LEVEL,{successCB:()=>window.handleNextLevel()}),this.type===GameCore.Ads.Types.REWARDED&&window.sendCustomAnalyticsEvent(G.GLANCE_REWARDED_AD,{failureCB:()=>window.handleRewardedFail(),successCB:()=>window.handleRewardedSuccess()}),await this.instance.showAsync();const e=this.getSceneName();this.type===GameCore.Ads.Types.INTERSTITIAL&&self.game.analytics.showInterstitialAd(e),this.type===GameCore.Ads.Types.REWARDED&&self.game.analytics.showRewardedVideoAd(e),this.status=GameCore.Ads.Status.IDLE,this.instance=null}catch(e){console.warn("showAsync error",e),e instanceof Object&&GameCore.Utils.Object.hasOwn(e,"code")?e.code:(this.status=GameCore.Ads.Status.IDLE,this.instance=null);const t=this.getSceneName();throw self.game.analytics.showAdFail(this.type,t,e),e}}getStatus(){return this.status}async createInstanceByType(e){const{facebook:t}=self.game;switch(e){case GameCore.Ads.Types.REWARDED:return await t.getRewardedVideoAsync(this.placementId);case GameCore.Ads.Types.INTERSTITIAL:return await t.getInterstitialAdAsync(this.placementId);default:return null}}getSceneName(){try{const{globalScene:e}=self.game;return e instanceof Nn?e.getCurrentScene().scene.getSceneName():"unknown"}catch{return"unknown"}}}const{Object:co,Valid:gt}=GameCore.Utils;class rv extends Phaser.Game{constructor(e){super(e)}async boot(){super.boot(),this.addExtraGameObjectMethods(),this.addExtraFBInstantFunctions(),this.addPlugins(),await this.addDevPlugins(),await this.initAdsAsync(),this.addScenes(),this.addDevScenes(),this.initWorld(),this.initStorage(),this.initLanguage(),this.initUtils(),this.initRollbar(),this.initConsole(),this.initDebugger(),this.initStatistics(),this.initLevelBuilder(),this.initParticleEditor(),this.initNotificationPlugin(),this.initAdaptivePerformance(),this.initProfilerPlugin(),this.handleShowInterAdWhenStartGame(),this.handleShowBackgroundElement(),this.addGlanceGlobalMethods()}start(){super.start()}addExtraGameObjectMethods(){const e=new hu;e.addKillRevive(),e.addKillReviveGroup(),e.addDrawDebugBox(),e.addSetWorldSize(),e.addSetWorldSizeForContainer(),e.addGetWorldPosition(),e.addHighQuality()}addExtraFBInstantFunctions(){const e=new cu(this.facebook);this.facebook.getLocale=e.getLocale,this.facebook.shareAsync=e.shareAsync,this.facebook.inviteAsync=e.inviteAsync,this.facebook.switchAsync=e.switchAsync,this.facebook.chooseAsync=e.chooseAsync,this.facebook.createAsync=e.createAsync,this.facebook.sendMessage=e.sendMessage,this.facebook.isSupportAPI=e.isSupportAPI,this.facebook.getContextID=e.getContextID,this.facebook.getPlayerToken=e.getPlayerToken,this.facebook.matchPlayerAsync=e.matchPlayerAsync,this.facebook.getContextPlayers=e.getContextPlayers,this.facebook.setLoadingProgress=e.setLoadingProgress,this.facebook.attemptToAddShortcut=e.attemptToAddShortcut,this.facebook.attemptToSubscribeBot=e.attemptToSubscribeBot,this.facebook.postSessionScoreAsync=e.postSessionScoreAsync,this.facebook.getRewardedVideoAsync=e.getRewardedVideoAsync,this.facebook.sendNotificationAsync=e.sendNotificationAsync,this.facebook.getInterstitialAdAsync=e.getInterstitialAdAsync,e.injectTournament(),this.facebook.progressLoading=new lu(this)}addPlugins(){this.plugins.install("Storage",Wg,!0,"storage"),this.plugins.install("Rollbar",gp,!0,"rollbar"),this.plugins.install("AdsManager",du,!0,"ads"),this.plugins.install("AuthManager",Ou,!0,"auth"),this.plugins.install("CoinManager",Ld,!0,"coin"),this.plugins.install("AudioManager",Au,!0,"audio"),this.plugins.install("WorldManager",qg,!0,"world"),this.plugins.install("BattleManager",Sd,!0,"battle"),this.plugins.install("PlayerManager",Xd,!0,"player"),this.plugins.install("LanguageManager",$f,!0,"lang"),this.plugins.install("ProfileManager",np,!0,"profile"),this.plugins.install("AnalyticsManager",gu,!0,"analytics"),this.plugins.install("NotificationPlugin",av,!0,"notification"),this.plugins.install("AdaptivePerformance",Md,!0,"performance"),this.plugins.installScenePlugin("textStyler",Xg,"textStyler"),this.plugins.installScenePlugin("ScreenManager",mp,"screen"),this.plugins.installScenePlugin("FrameCapture",Dd,"frameCapture"),window.SpinePlugin&&this.plugins.installScenePlugin("SpinePlugin",SpinePlugin,"spine"),this.storage=this.plugins.get("Storage"),this.rollbar=this.plugins.get("Rollbar"),this.ads=this.plugins.get("AdsManager"),this.auth=this.plugins.get("AuthManager"),this.audio=this.plugins.get("AudioManager"),this.world=this.plugins.get("WorldManager"),this.battle=this.plugins.get("BattleManager"),this.player=this.plugins.get("PlayerManager"),this.lang=this.plugins.get("LanguageManager"),this.profile=this.plugins.get("ProfileManager"),this.analytics=this.plugins.get("AnalyticsManager"),this.notification=this.plugins.get("NotificationPlugin"),this.performance=this.plugins.get("AdaptivePerformance")}async addDevPlugins(){if(!gt.isDebugger())return;const e=(await rt(()=>import("./devtool.js").then(r=>r.i),[],import.meta.url)).default,t=(await rt(()=>import("./devtool.js").then(r=>r.a),[],import.meta.url)).default,s=(await rt(()=>import("./devtool.js").then(r=>r.b),[],import.meta.url)).default,i=(await rt(()=>import("./devtool.js").then(r=>r.c),[],import.meta.url)).default,n=(await rt(()=>import("./devtool.js").then(r=>r.d),[],import.meta.url)).default;this.plugins.install("Console",e,!0,"console"),this.plugins.install("Debugger",t,!0,"debugger"),this.plugins.install("Profiler",s,!0,"profiler"),this.plugins.install("LevelBuilder",i,!0,"level-builder"),this.plugins.install("ParticleEditor",n,!0,"particle-editor"),this.eruda=this.plugins.get("Console"),this.debugger=this.plugins.get("Debugger"),this.profiler=this.plugins.get("Profiler"),this.statistics=this.plugins.get("Statistics"),this.profiler=this.plugins.get("Profiler"),this.levelBuilder=this.plugins.get("LevelBuilder"),this.particleEditor=this.plugins.get("ParticleEditor")}addScenes(){this.scene.add(K.BOOT_SCENE,nE,!0),this.scene.add(K.LOAD_SCENE,z_,!1),this.scene.add(K.GAME_SCENE,ee,!1),this.scene.add(K.GLOBAL_SCENE,Nn,!1)}async addDevScenes(){if(!GameCore.Utils.Valid.isDebugger())return;const e=(await rt(()=>import("./devscene.js").then(i=>i.T),[],import.meta.url)).default,t=(await rt(()=>import("./devscene.js").then(i=>i.i),[],import.meta.url)).default,s=(await rt(()=>import("./devscene.js").then(i=>i.L),[],import.meta.url)).default;this.scene.add(K.TEST_SCENE,e,!1),this.scene.add(K.ANIMATIONS_SCENE,t,!1),this.scene.add(K.LEVEL_BUILDER_SCENE,s,!1)}async initAdsAsync(){const{Ads:e}=GameCore.Configs;oo.setGame(this);const t=oo,s={...e.InterstitialAdOptions};s.showWhenStartGame&&(s.secondsFirstTime=0),this.ads.configure(t,{enabled:e.Enabled,calculateSafeAreaBottom:e.CalculateSafeAreaBottom,enableRewardVideoResetInterstitial:e.EnableRewardVideoResetInterstitial,interstitialAdOptions:s,rewardAdOptions:e.RewardAdOptions,bannerAdOptions:e.BannerAdOptions})}initWorld(){const{Game:e}=GameCore.Configs,{AutoResize:t,PortraitRatio:s,PortraitWidth:i,PortraitHeight:n,LandscapeRatio:r,LandscapeWidth:c,LandscapeHeight:o,DisableLandscape:l,FullSizeOnLandscape:h}=e,d=t,u=l,p=h,g=s,f=i,m=n,E=r,A=c,S=o;this.world.configure({autoResize:d,portraitRatio:g,portraitWidth:f,portraitHeight:m,landscapeRatio:E,landscapeWidth:A,landscapeHeight:S,disableLandscape:u,fullSizeOnLandscape:p}),this.world.resize(e.ForcePixelRatio)}initStorage(){const e=new uf(this);this.storage.setInitiator(e)}initLanguage(){const e=this.facebook.getLocale()||"en";this.lang.configure({locale:e,upperCaseText:!0})}initUtils(){this.handlePauseAudio(),this.removeUnusedPipelines(),cf()}initConsole(){if(!gt.isDebugger())return;const{ShowConsole:e}=GameCore.Configs.Debugger;e&&this.eruda.configure({tool:["console","info"],defaults:{theme:"Dark"}})}initDebugger(){if(!gt.isDebugger())return;const{ShowInspector:e,ShowMonitoring:t}=GameCore.Configs.Debugger;!e&&!t||this.debugger.configure(GameCore.Configs.Debugger)}initStatistics(){if(!gt.isDebugger())return;const{Enable:e}=GameCore.Configs.Statistics;e&&this.statistics.configure(GameCore.Configs.Statistics)}initParticleEditor(){if(!gt.isDebugger())return;const{Enable:e}=GameCore.Configs.ParticleEditor;e&&this.particleEditor.configure(GameCore.Configs.ParticleEditor)}initLevelBuilder(){if(!GameCore.Utils.Valid.isDebugger())return;const{Enable:e}=GameCore.Configs.LevelBuilder;e&&this.levelBuilder.configure(GameCore.Configs.LevelBuilder)}initProfilerPlugin(){if(!gt.isDebugger())return;const{Enable:e}=GameCore.Configs.ProfilerPlugin;e&&this.profiler.configure()}initNotificationPlugin(){const{AppId:e}=GameCore.Configs,{Enable:t,ApiUrl:s}=GameCore.Configs.Notification;if(!t)return;let i=null;if(co.hasOwn(window.__glancePlayerData,"glanceId")&&gt.isString(window.__glancePlayerData.glanceId)&&(i=window.__glancePlayerData.glanceId),!i)return;let n=null;if(co.hasOwn(window.__glancePlayerData,"gpID")&&gt.isString(window.__glancePlayerData.gpID)&&(n=window.__glancePlayerData.gpID),!n)return;const r={gpId:n,appId:e,glanceId:i};this.notification.setup(s,r)}addGlanceGlobalMethods(){window.enableSound=e=>{this.player.setSetting("music",e),this.player.setSetting("sound",e),e?this.audio.playMusic():this.audio.pauseMusic()}}initAdaptivePerformance(){const{Enable:e,...t}=GameCore.Configs.Performance;if(!e)return;const s=this.world.getPixelRatio();this.performance.configure({pixelRatio:s,...t}),this.performance.active()}initRollbar(){const{Enable:e}=GameCore.Configs.Rollbar;console.warn({isRollbarEnabled:e}),e&&this.rollbar.setup()}handlePauseAudio(){this.sound.pauseOnBlur=!1,document.addEventListener("visibilitychange",()=>{if(document.hidden){this.audio.pauseMusic(),this.audio.pauseAllSounds();return}this.audio.playMusic(),this.audio.resumeAllSounds()})}removeUnusedPipelines(){const e=this.renderer;if(!(e instanceof Phaser.Renderer.WebGL.WebGLRenderer))return;const{pipelines:t}=e,s=Phaser.Renderer.WebGL.Pipelines;if(!s)return;[s.ROPE_PIPELINE,s.LIGHT_PIPELINE,s.POINTLIGHT_PIPELINE,s.BITMAPMASK_PIPELINE].forEach(n=>{t.get(n)?.destroy(),t.remove(n)})}async handleShowInterAdWhenStartGame(){const{InterstitialAdOptions:e}=GameCore.Configs.Ads;if(e.showWhenStartGame)try{this.audio.muteAll(),await this.ads.preloadInterstitialAdAsync(),await this.ads.showInterstitialAdAsync()}catch(t){console.info("🚀 > showInterstitialAdAsync",t)}finally{this.audio.unmuteAll(),this.ads.preloadInterstitialAdAsync().catch(()=>{})}}handleShowBackgroundElement(){if(!this.world.isLandscape())return;const e=document.getElementById("background");e&&(e.style.display="block");const t=document.getElementById("app");t&&t.classList.remove("has-background")}}const{ShowInspector:ov}=GameCore.Configs.Debugger,cv={parent:"app",type:Phaser.AUTO,width:0,height:0,scale:{autoRound:!0},dom:{createContainer:!1},loader:{maxParallelDownloads:6,crossOrigin:"no-cros"},audio:{noAudio:!1,disableWebAudio:!1},input:{gamepad:!1,keyboard:ov,touch:{capture:!0},smoothFactor:1,activePointers:1,windowEvents:!1},disableContextMenu:!0,render:{pixelArt:!1,antialias:!0,antialiasGL:!0,transparent:!1,desynchronized:!1,powerPreference:"high-performance",clearBeforeRender:!1,roundPixels:!1},plugins:{global:[]}};Qh();const lv=()=>{try{const a=new rv(cv);window.game=a}catch(a){me(a)}},hv=()=>{const a=setInterval(()=>{if(!window.__analyticsInitiated||!window.FBInstant)return;//! temporarily fix for not use adapter
window.GameSDK=window.FBInstant,window.__fbGameReady=!1,clearInterval(a),clearInterval(window.__fbInstantLoadingTimer),GameSDK.setLoadingProgress(30),"gtag"in window&&gtag("event","app_initialize",{send_to:["GA"]}),lv()},50)};hv();export{ae as A,q as B,Nc as C,W as D,Qc as E,EI as F,MR as G,pI as H,TI as I,de as J,k as K,Py as L,il as M,aC as N,zS as O,Fc as P,oT as Q,oi as R,K as S,F as U,L as a,qc as b,Bo as c,Ue as d,wy as e,Ry as f,Ku as g,Ty as h,Ay as i,fy as j,dy as k,ly as l,ry as m,iy as n,ey as o,P as p,nl as q,Le as r,Me as s,AI as t,i_ as u,uI as v,Mc as w,$R as x,el as y,cn as z};
