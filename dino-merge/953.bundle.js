"use strict";(self.webpackChunkgame_core=self.webpackChunkgame_core||[]).push([[953],{602:function(e,t,r){r.r(t),r.d(t,{default:function(){return U}});var n=r(26),a=r.n(n),i=r(39),o=r.n(i),l=r(51),s=r.n(l),d=r(63),c=r.n(d),u=r(3),h=r(7),p=r(0),v=r(2),f=r.n(v),m=r(4),g=r.n(m),E=r(29),y=r.n(E),C=r(45),F=r.n(C),B=r(62),b=r.n(B),w=r(633),L=r(639),M=r(700),P=r(697),x=r(64),S=r(657),_=r(645);function A(e,t){var r="undefined"!==typeof s()&&c()(e)||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){var r;if(!e)return;if("string"===typeof e)return I(e,t);var n=a()(r=Object.prototype.toString.call(e)).call(r,8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return o()(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var k=_.Z.MELEE_UNIT_TYPE,j=_.Z.RANGED_UNIT_TYPE,O=function(){function e(e,t,r){var n=this;this.levelBuilder=void 0,this.root=void 0,this.creatureBlade=void 0,this.levelBlade=void 0,this.removeBtn=void 0,this.square=void 0,this.unit=void 0,this.currentCreature="none",this.currentLevel="none",this.statsParam={stats:"{}"},this.handleChangeCreature=function(e){n.currentCreature=e.value,"none"===n.currentCreature?n.levelBlade.disabled=!0:n.levelBlade.disabled=!1,n.changeLevelConfigList(e.value),n.updateStatsInfo()},this.handleChangeLevel=function(e){n.currentLevel=e.value,n.recreateCreature()},this.handleRemoveBtnClick=function(){var e,t;null==(e=n.unit)||e.getCurrentDisplay().destroy(),null==(t=n.unit)||t.destroy(),n.unit=null,n.creatureBlade.value="none",n.levelBlade.value="none",n.updateStatsInfo(),n.removeBtn.disabled=!0},this.levelBuilder=e,this.square=r,this.root=t.addFolder({title:"Editor",index:2,hidden:!0}),this.createListCreature(),this.createListLevel(),this.createRemoveBtn(),this.createStatsInfo()}var t=e.prototype;return t.createListCreature=function(){var e=this.root.addBlade({view:"list",label:"Creature",options:this.getCreatureList(),value:""});e.on("change",this.handleChangeCreature),this.creatureBlade=e},t.getCreatureList=function(){return[{text:"Melee",value:k},{text:"Ranged",value:j}]},t.createListLevel=function(){var e=this.root.addBlade({view:"list",label:"Level",options:[],value:""});e.on("change",this.handleChangeLevel),e.disabled=!0,this.levelBlade=e},t.changeLevelConfigList=function(e){if(!e)return this.levelBlade.options=[],void(this.levelBlade.value="none");var t=this.square.scene.cache.json.get("unitData"),r=[];switch(e){case k:t.melee.forEach((function(e){r.push({text:e.name,value:e.level.toString()})}));break;case j:t.ranged.forEach((function(e){r.push({text:e.name,value:e.level.toString()})}))}this.levelBlade.options=r,this.levelBlade.value="none"},t.recreateCreature=function(){var e,t;if("none"!==this.currentCreature&&"none"!==this.currentLevel){switch(this.removeBtn.disabled=!1,null==(e=this.unit)||e.getCurrentDisplay().destroy(),null==(t=this.unit)||t.destroy(),this.unit=null,this.currentCreature){case k:this.unit=this.square.currentScene.unitManager.createMelee(y()(this.currentLevel));break;case j:this.unit=this.square.currentScene.unitManager.createRange(y()(this.currentLevel));break;default:this.unit=this.square.currentScene.unitManager.createRange(0)}this.unit.setDepth(S.Z.BUTTON),Phaser.Display.Align.In.Center(this.unit,this.square),this.updateStatsInfo(),this.levelBuilder.recalculatePower(this.square.isPlayer)}},t.createRemoveBtn=function(){var e=this.root.addButton({title:"Remove Creature"});e.on("click",this.handleRemoveBtnClick),e.disabled=!0,this.removeBtn=e},t.createStatsInfo=function(){this.root.addMonitor(this.statsParam,"stats",{multiline:!0,lineCount:10})},t.updateStatsInfo=function(){if("none"!==this.currentCreature&&"none"!==this.currentLevel){var e=this.square.scene.cache.json.get("unitData");switch(this.currentCreature){case k:for(var t,r=A(e.melee);!(t=r()).done;){var n=t.value;if(n.level.toString()===this.currentLevel){this.statsParam.stats=F()(n,null,2);break}}break;case j:for(var a,i=A(e.ranged);!(a=i()).done;){var o=a.value;if(o.level.toString()===this.currentLevel){this.statsParam.stats=F()(o,null,2);break}}break;default:this.statsParam.stats="{}"}}else this.statsParam.stats="{}"},t.getConfig=function(){return"none"===this.currentCreature||"none"===this.currentLevel?"0":""+this.currentCreature[0].toLowerCase()+this.currentLevel},t.importConfig=function(e){if(console.log("%c config: ","font-size:12px;background-color: #2EAFB0;color:#fff;",e),"0"!==e){var t="none";switch(e.charAt(0)){case"m":t=k;break;case"r":t=j;break;default:alert("Invalid config")}this.creatureBlade.value=t,this.levelBlade.value=e.substring(1),this.recreateCreature()}},t.changeSquare=function(e){this.square=e,this.unit&&Phaser.Display.Align.In.Center(this.unit,this.square)},t.getFolderConfigObject=function(){return{creature:this.currentCreature,level:this.currentLevel}},t.setFolderConfigObject=function(e){this.creatureBlade.value=e.creature,this.levelBlade.value=e.level},t.getPower=function(){return this.unit&&this.currentCreature&&this.currentLevel?y()(this.currentLevel):0},t.clear=function(){this.handleRemoveBtnClick()},t.show=function(){this.root.hidden=!1},t.hide=function(){this.root.hidden=!0},e}();function R(e,t){var r="undefined"!==typeof s()&&c()(e)||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){var r;if(!e)return;if("string"===typeof e)return T(e,t);var n=a()(r=Object.prototype.toString.call(e)).call(r,8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return o()(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var N=function(e){function t(){for(var t,r,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(r=e.call.apply(e,g()(t=[this]).call(t,a))||this).pane=void 0,r.element=void 0,r.configFolder=void 0,r.importFolder=void 0,r.statsFolder=void 0,r.testFolder=void 0,r.exportFolder=void 0,r.testMapBtn=void 0,r.loadMapBtn=void 0,r.returnBtn=void 0,r.editorEnemyFolderMap=void 0,r.editorPlayerFolderMap=void 0,r.curChooseEditorFolder=void 0,r.importParam={config:"{}"},r.powerParam={config:"",power:{enemyPowerEstimate:0,playerPowerEstimate:0}},r.testParam={level_id:1,coins:"1K"},r.importJSON=function(e){try{r.testParam.level_id=e.level_id,r.editorEnemyFolderMap.forEach((function(e){e.clear()})),e.enemy_row1.split("-").forEach((function(e,t){var n,a="1"+(t+1);null==(n=r.editorEnemyFolderMap.get(a))||n.importConfig(e)})),e.enemy_row2.split("-").forEach((function(e,t){var n,a="2"+(t+1);null==(n=r.editorEnemyFolderMap.get(a))||n.importConfig(e)})),e.enemy_row3.split("-").forEach((function(e,t){var n,a="3"+(t+1);null==(n=r.editorEnemyFolderMap.get(a))||n.importConfig(e)}))}catch(t){console.error(t)}},r.randomEnemyUnitsOnBoard=function(){for(var e,t,n=[],a=[],i=[],o=R(r.editorEnemyFolderMap);!(t=o()).done;){var l=t.value,s=(l[0],l[1]);i.push(s);var d=s.getFolderConfigObject(),c=d.creature,u=d.level;"ranged"===c&&n.push({creature:c,level:u}),"melee"===c&&a.push({creature:c,level:u}),s.clear()}var h=[10,11,12,13,14];GameCore.Utils.Array.shuffle(h);var p=[5,6,7,8,9];GameCore.Utils.Array.shuffle(p);var v=[0,1,2,3,4];GameCore.Utils.Array.shuffle(v);var f=g()(e=[]).call(e,v,p,h);n.forEach((function(e,t){i[f[t]].setFolderConfigObject(e)})),a.forEach((function(e,t){i[f[14-t]].setFolderConfigObject(e)}))},r.testMap=function(){var e;r.testMapBtn.disabled=!0,r.returnBtn.disabled=!1,null==(e=r.curChooseEditorFolder)||e.hide(),r.importFolder.expanded=!1,r.importFolder.disabled=!0,r.statsFolder.expanded=!1,r.statsFolder.disabled=!0;var t=r.game.scene.getScene(L.C.LEVEL_BUILDER_SCENE);t.load.once(Phaser.Loader.Events.COMPLETE,(function(){t.scene.switch(L.C.GAME_SCENE);var e=t.scene.get(L.C.GAME_SCENE);e.events.once(Phaser.Scenes.Events.PRE_UPDATE,(function(){e.stateManager.levelLoading()}))})),t.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,(function(e){console.warn(e.error)}));var n=r.getTestLevelJson();console.log("mapObject: ",n),t.cache.json.exists("level-builder-json")&&t.cache.json.remove("level-builder-json"),t.load.json({key:"level-builder-json",url:n}),t.load.start()},r.loadMap=function(){r.loadMapBtn.disabled=!0;var e=r.getLevelJson();console.log(e);var t=r.game.scene.getScene(L.C.LEVEL_BUILDER_SCENE);t.cache.json.exists("level-builder-json")&&t.cache.json.remove("level-builder-json"),t.load.json({key:"level-builder-json",url:e}),t.load.once(Phaser.Loader.Events.COMPLETE,(function(){r.loadMapBtn.disabled=!1,r.importJSON(e)})),t.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,(function(e){console.warn(e.error)})),t.load.start()},r.getTestLevelJson=function(){var e=r.getExportConfig(),t="",n="",a="";r.editorPlayerFolderMap.forEach((function(e,r){var i=e.getConfig();switch(r[0]){case"1":"1"!==r[1]&&(t+="-"),t+=i;break;case"2":"1"!==r[1]&&(n+="-"),n+=i;break;case"3":"1"!==r[1]&&(a+="-"),a+=i}}));var i=r.testParam.coins;[/^[0-9]+[KMBT]?$/,/^[0-9]+[A-Z][A-Z]$/].some((function(e){return e.test(i)}))||alert("Invalid coins, postfix is one of /[0-9]+[KMBT]*/, /[0-9]+[A-Z][A-Z]/");var o=0;if(/^[0-9]+$/.test(i))o=0;else if(/^[0-9]+K$/.test(i))i=i.replace("K",""),o=1;else if(/^[0-9]+M*$/.test(i))i=i.replace("M",""),o=2;else if(/^[0-9]+B*$/.test(i))i=i.replace("B",""),o=3;else if(/^[0-9]+T*$/.test(i))i=i.replace("T",""),o=4;else{var l=/[A-Z][A-Z]/.exec(i)[0];i=i.replace(/[A-Z][A-Z]/,""),o=4+26*(y()(l[0])-65)+(y()(l[1])-65)}var s=1e3*y()(i);return(0,h.Z)({},e,{coins:new w.Z(s,o,!0),player_row1:t,player_row2:n,player_row3:a})},r.getLevelJson=function(){var e=r.game.scene.getScene(L.C.LEVEL_BUILDER_SCENE);if(!e.cache.json.exists("levels"))return{};var t=r.testParam.level_id,n=e.cache.json.get("levels").levels[t-1];return n||{}},r.returnToLevelBuilder=function(){var e,t=r.game.scene.getScene(L.C.GAME_SCENE);t.stateManager.currentState instanceof P.Z||t.stateManager.currentState instanceof M.Z?(t.scene.switch(L.C.LEVEL_BUILDER_SCENE),t.cache.tilemap.exists("level-builder-json")&&t.cache.tilemap.remove("level-builder-json"),r.returnBtn.disabled=!0,null==(e=r.curChooseEditorFolder)||e.show(),r.importFolder.disabled=!1,r.statsFolder.disabled=!1,r.testMapBtn.disabled=!1,r.loadMapBtn.disabled=!1):alert("Can not change to level builder when not in ready or playing state")},r.exportToJSON=function(){var e=r.getExportConfig();console.log(F()(e)),r.downloadConfig(e,"level_"+e.level_id)},r.getExportConfig=function(){var e="",t="",n="";return r.editorEnemyFolderMap.forEach((function(r,a){var i=r.getConfig();switch(a[0]){case"1":"1"!==a[1]&&(e+="-"),e+=i;break;case"2":"1"!==a[1]&&(t+="-"),t+=i;break;case"3":"1"!==a[1]&&(n+="-"),n+=i}})),{level_id:r.testParam.level_id,enemy_row1:e,enemy_row2:t,enemy_row3:n}},r}(0,p.Z)(t,e);var r=t.prototype;return r.configure=function(){var e=(0,u.Z)(f().mark((function e(t){var r,n,a,i,o,l,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(r=t||{}).Expanded,a=void 0!==n&&n,i=r.AutoRefresh,o=void 0===i||i,l=r.Opacity,s=void 0===l?.8:l,this.pane=new x.Pane({title:"Level Builder",expanded:a}),this.element=this.pane.element,this.initConfig(s),this.createImportFolder(),this.createListSquare(),this.createPowerEstimate(),this.createTestFolder(),this.createExportFolder(),this.createReturnBtn(),o&&this.update(),GameCore.Utils.Device.isMobile()&&(this.pane.expanded=!1);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.initConfig=function(e){var t=this;this.configFolder=this.pane.addFolder({title:"Config",expanded:!1});var r={opacity:e,x:-8,y:-8,width:300,hide:this.hide.bind(this)};this.element.parentElement&&(this.element.parentElement.style.top=-r.y+"px",this.element.parentElement.style.left=-r.x+"px",this.element.parentElement.style.width=r.width+"px"),this.element.style.opacity=""+r.opacity,this.configFolder.addInput(r,"opacity",{min:0,max:1,step:.1}).on("change",(function(e){t.element.style.opacity=""+e.value})),this.configFolder.addInput(r,"x",{step:1}).on("change",(function(e){t.element.parentElement&&(t.element.parentElement.style.left=-e.value+"px")})),this.configFolder.addInput(r,"y",{step:1}).on("change",(function(e){t.element.parentElement&&(t.element.parentElement.style.top=-e.value+"px")})),this.configFolder.addInput(r,"width",{min:200,max:500,step:1}).on("change",(function(e){t.element.parentElement&&(t.element.parentElement.style.width=e.value+"px")})),this.configFolder.addButton({title:"Hide Panel"}).on("click",r.hide),this.element.onwheel=function(e){var n=e.deltaY;r.y<=-8&&n<0||r.y>=t.element.clientHeight-document.body.clientHeight-8&&n>0||(r.y+=n/2)}.bind(this)},r.createImportFolder=function(){var e=this;this.importFolder=this.pane.addFolder({title:"Import Options",expanded:!1}),this.importFolder.addInput(this.importParam,"config"),this.importFolder.addButton({title:"Import JSON"}).on("click",(function(){var t=JSON.parse(e.importParam.config);GameCore.Utils.Valid.isObject(t)&&e.importJSON(t)}))},r.createListSquare=function(){this.editorEnemyFolderMap=new(b()),this.editorPlayerFolderMap=new(b())},r.createPowerEstimate=function(){var e=this;this.statsFolder=this.pane.addFolder({title:"General",expanded:!1}),this.statsFolder.addButton({title:"Reset Player Board"}).on("click",(function(){e.editorPlayerFolderMap.forEach((function(e){e.clear()}))})),this.statsFolder.addButton({title:"Reset Enemy Board"}).on("click",(function(){e.editorEnemyFolderMap.forEach((function(e){e.clear()}))})),this.statsFolder.addButton({title:"Reset Board"}).on("click",(function(){e.editorPlayerFolderMap.forEach((function(e){e.clear()})),e.editorEnemyFolderMap.forEach((function(e){e.clear()}))})),this.statsFolder.addButton({title:"Random Enemy Unit On Board"}).on("click",this.randomEnemyUnitsOnBoard),this.statsFolder.addMonitor(this.powerParam,"config",{multiline:!0,lineCount:4})},r.createTestFolder=function(){this.testFolder=this.pane.addFolder({title:"Test Map",expanded:!1}),this.testFolder.addInput(this.testParam,"level_id",{min:1,max:200,step:1}),this.testFolder.addInput(this.testParam,"coins"),this.testMapBtn=this.testFolder.addButton({title:"Test Map"}),this.testMapBtn.on("click",this.testMap),this.testMapBtn.disabled=!0,this.loadMapBtn=this.testFolder.addButton({title:"Load Map"}),this.loadMapBtn.on("click",this.loadMap),this.loadMapBtn.disabled=!0},r.createExportFolder=function(){this.exportFolder=this.pane.addFolder({title:"Export Options",expanded:!1}),this.exportFolder.addInput(this.testParam,"level_id",{step:1}),this.exportFolder.addButton({title:"Export JSON"}).on("click",this.exportToJSON)},r.downloadConfig=function(e,t){var r="data:text/json;charset=utf-8,"+encodeURIComponent(F()(e,null,2)),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download",t+".json"),document.body.appendChild(n),n.click(),n.remove()},r.update=function(){this.pane.refresh(),requestAnimationFrame(this.update.bind(this))},r.createReturnBtn=function(){var e=this.pane.addButton({title:"Return to Level Builder"});e.on("click",this.returnToLevelBuilder),this.returnBtn=e},r.createEditorFolderForSquare=function(e){var t=new O(this,this.pane,e);e.isPlayer?this.editorPlayerFolderMap.set(e.id,t):this.editorEnemyFolderMap.set(e.id,t)},r.showEditorFolderForSquare=function(e){var t,r;if(t=e.isPlayer?this.editorPlayerFolderMap.get(e.id):this.editorEnemyFolderMap.get(e.id))return null==(r=this.curChooseEditorFolder)||r.hide(),this.curChooseEditorFolder=t,void t.show()},r.recalculatePower=function(e){var t=0;e?(this.editorPlayerFolderMap.forEach((function(e){t+=e.getPower()})),this.powerParam.power.playerPowerEstimate=t):(this.editorEnemyFolderMap.forEach((function(e){t+=e.getPower()})),this.powerParam.power.enemyPowerEstimate=t),this.powerParam.config=F()(this.powerParam.power,null,2)},r.hide=function(){this.pane.hidden=!0},r.show=function(){this.pane.hidden=!1},t}(Phaser.Plugins.BasePlugin),U=N}}]);